import{_ as s,c as a,a2 as i,o as t}from"./chunks/framework.DXKzXLg0.js";const u=JSON.parse('{"title":"LSP setup","description":"","frontmatter":{"prev":{"text":"Features","link":"/feature/index"},"next":false},"headers":[],"relativePath":"feature/lsp-setup.md","filePath":"feature/lsp-setup.md"}'),n={name:"feature/lsp-setup.md"};function l(r,e,p,h,o,c){return t(),a("div",null,e[0]||(e[0]=[i(`<h1 id="lsp-setup" tabindex="-1">LSP setup <a class="header-anchor" href="#lsp-setup" aria-label="Permalink to &quot;LSP setup&quot;">​</a></h1><p>Here we will explore the &quot;high level&quot; functions we can use to integrate a language server with Neovim:</p><ul><li><a href="https://neovim.io/doc/user/lsp.html#vim.lsp.config()" target="_blank" rel="noreferrer">vim.lsp.config()</a></li><li><a href="https://neovim.io/doc/user/lsp.html#vim.lsp.enable()" target="_blank" rel="noreferrer">vim.lsp.enable()</a></li></ul><p>Keep in mind these were added in Neovim v0.11. On older versions of Neovim we would have to use the &quot;low level&quot; functions of the <a href="./lsp-client.html">LSP client</a>.</p><h2 id="quickstart" tabindex="-1">Quickstart <a class="header-anchor" href="#quickstart" aria-label="Permalink to &quot;Quickstart&quot;">​</a></h2><p>Let&#39;s start with a good copy/paste friendly example:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;luals&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cmd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lua-language-server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  filetypes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lua&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  root_markers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.luarc.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.luarc.jsonc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;luals&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Is important to remember that the <a href="https://neovim.io/doc/user/lsp.html#LSP" target="_blank" rel="noreferrer">vim.lsp</a> module only works with <a href="/learn-nvim/feature/lsp-client.html#what-s-a-language-server">language servers</a>. And in this example we are using <a href="https://github.com/LuaLS/lua-language-server" target="_blank" rel="noreferrer">LuaLS</a>, a language server for <a href="/learn-nvim/101/lua-intro.html">lua</a>. The latest version of LuaLS is available in <a href="https://github.com/LuaLS/lua-language-server/releases/latest" target="_blank" rel="noreferrer">the github releases page</a> and there is always the option to <a href="https://luals.github.io/wiki/build/" target="_blank" rel="noreferrer">build it from source</a>.</p><p>This snippet of code could be placed in the <a href="./../101/from-vimscript-to-lua.html#the-entry-point">init.lua</a> file or a <a href="./global-plugin.html">global plugin</a>. It just needs to be executed during Neovim&#39;s startup process, and it should run only once.</p><p>So, <code>vim.lsp.config()</code> is the function we use to define the configuration for a language server. And with <code>vim.lsp.enable()</code> we tell Neovim which configuration we actually want to use.</p><p>But why two functions?</p><p>Making the configuration and setup two separate steps makes it possible to create configurations per project. For example, if a language server needs special settings to work in a monorepo we could have two configurations, one for standalone projects and one for monorepos. And then we can choose which one to use depending on the project we are working on.</p><p>It also opens the door for third-party plugins. A plugin could create a configuration and we can decide when to enable it.</p><h2 id="lsp-config" tabindex="-1">LSP config <a class="header-anchor" href="#lsp-config" aria-label="Permalink to &quot;LSP config&quot;">​</a></h2><p><code>vim.lsp.config()</code> can be used to define a configuration for a language server or extend an existing configuration.</p><p>The first argument should be a string. This will be the name we will provide to <code>vim.lsp.enable()</code>. The second argument must be a <a href="/learn-nvim/101/lua-intro.html#lua-tables">lua table</a>, this will be the configuration for the server. The available options are the same as <a href="https://neovim.io/doc/user/lsp.html#vim.lsp.ClientConfig" target="_blank" rel="noreferrer">vim.lsp.start()</a> with a few extra fields.</p><p>This is the bare minimum we need to make a language server work:</p><ul><li><p><code>cmd</code>: The command Neovim will use to launch the language server as a background process. This can be a list of strings, where the first element is the executable of the language server and each extra argument must be a separate string.</p></li><li><p><code>filetypes</code>: The list of languages the server can handle. These must be valid filetypes Neovim supports.</p></li><li><p><code>root_markers</code>: Should be a list of file names or directories. This will be used to determine the root directory of the project.</p></li></ul><h2 id="the-lsp-directory" tabindex="-1">The lsp directory <a class="header-anchor" href="#the-lsp-directory" aria-label="Permalink to &quot;The lsp directory&quot;">​</a></h2><p>We also have the option to define a &quot;default configuration&quot; for a language server. These can be located anywhere in the <a href="/learn-nvim/feature/global-plugin.html#the-runtimepath">runtimepath</a>, in a directory called <code>lsp</code>.</p><p>Our personal Neovim configuration can have this structure:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>nvim</span></span>
<span class="line"><span>├── init.lua</span></span>
<span class="line"><span>└── lsp</span></span>
<span class="line"><span>    └── luals.lua</span></span></code></pre></div><p><code>lsp/luals.lua</code> is where we write the configuration for the language server. This must be a lua script that returns a lua table.</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cmd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lua-language-server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  filetypes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lua&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  root_markers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.luarc.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.luarc.jsonc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>And now in <code>init.lua</code> we can enable it.</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;luals&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>In this case the name of the configuration comes from the name of the script in the <code>lsp</code> directory.</p><p>Is worth mention is still possible to call <code>vim.lsp.enable()</code> even on vimscript, thanks to the <a href="https://neovim.io/doc/user/lua.html#%3Alua" target="_blank" rel="noreferrer">:lua</a> command. In an <code>init.vim</code> file we could do this.</p><div class="language-vim vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vim</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lua </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim.lsp.enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;luals&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="lsp-enable" tabindex="-1">LSP enable <a class="header-anchor" href="#lsp-enable" aria-label="Permalink to &quot;LSP enable&quot;">​</a></h2><p>We use <code>vim.lsp.enable()</code> to tell Neovim which language server should start automatically.</p><p>The way this works is Neovim will create an autocommand on the <a href="https://neovim.io/doc/user/autocmd.html#FileType" target="_blank" rel="noreferrer">FileType event</a>. When the event is triggered it&#39;ll call the function <code>vim.lsp.start()</code> with the configuration we provided.</p><p>So nothing will happen immediately after we execute <code>vim.lsp.enable()</code>. It is only after we open a file that Neovim will try to spawn the language server. I say this with the hope you don&#39;t over-engineer your personal configuration for the sake of shorter startup times.</p><h2 id="lsp-defaults" tabindex="-1">LSP defaults <a class="header-anchor" href="#lsp-defaults" aria-label="Permalink to &quot;LSP defaults&quot;">​</a></h2><p>After a language server is active in the current <a href="/learn-nvim/101/edit-multiple-files.html#buffers-windows-and-tabs">buffer</a> Neovim will enable certain features.</p><p>The following built-in keymaps will use the active language server if possible.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ctrl-]          -&gt; go to definition</span></span>
<span class="line"><span>gq              -&gt; format selected text or text object</span></span>
<span class="line"><span>K               -&gt; display documentation of the symbol under the cursor</span></span>
<span class="line"><span>ctrl-x + ctrl-o -&gt; in insert mode, trigger code completion</span></span></code></pre></div><p>These keymaps are inherited from Vim. The default behavior triggers a function that has been a part of Vim (and Neovim) since before language servers were created. Is just that now when there is a language server active it&#39;ll change function they trigger.</p><p>For example, <code>gq</code> will always try to format text. But the underlying function, which in this case is the <a href="https://neovim.io/doc/user/options.html#&#39;formatexpr&#39;" target="_blank" rel="noreferrer">formatexpr</a>, changes if there is an active language server.</p><p>The following keymaps are Neovim specific:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>grn        -&gt; renames all references of the symbol under the cursor</span></span>
<span class="line"><span>gra        -&gt; list code actions available in the line under the cursor</span></span>
<span class="line"><span>grr        -&gt; lists all the references of the symbol under the cursor</span></span>
<span class="line"><span>gri        -&gt; lists all the implementations for the symbol under the cursor</span></span>
<span class="line"><span>gO         -&gt; lists all symbols in the current buffer</span></span>
<span class="line"><span>ctrl-s     -&gt; in insert mode, display function signature under the cursor</span></span>
<span class="line"><span>[d         -&gt; jump to previous diagnostic in the current buffer</span></span>
<span class="line"><span>]d         -&gt; jump to next diagnostic in the current buffer</span></span>
<span class="line"><span>ctrl-w + d -&gt; show error/warning message in the line under the cursor</span></span></code></pre></div><p>Neovim will also try other features of language servers.</p><ul><li><p>Semantic highlight: This is for code syntax highlight. Whenever possible Neovim will use the information sent by the language server to provide more accurate syntax highlight.</p></li><li><p>Diagnostics: This is the term Neovim uses for error and warning messages. Whenever possible Neovim will show errors in the current buffer. Things like missing semi-colon or type mismatch... that sort of thing.</p></li></ul>`,43)]))}const g=s(n,[["render",l]]);export{u as __pageData,g as default};
