<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Functional programming for your everyday javascript: Using a Maybe | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://vonheikemen.github.io/devlog/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="javascript, functional-programming, learning, software, coding, development" name=keywords><meta content="We'll see how an implementation of the Maybe Type can influence how we write code" name=description><link href=https://dev.to/vonheikemen/functional-programming-for-your-everyday-javascript-using-a-maybe-126j rel=canonical><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/tags/>Explore tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/>Devlog en español</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2024 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Functional programming for your everyday javascript: Using a Maybe</h1><span class=post-date>2019-10-28 | Originally published at <a href=https://dev.to/vonheikemen/functional-programming-for-your-everyday-javascript-using-a-maybe-126j> dev.to </a> | 13 min read | <a href=https://vonheikemen.github.io/devlog/es/web-development/learn-fp/using-a-maybe/> Leer en español </a> </span><p>Have you ever heard about monads and how great they are? Maybe you have but you still don't get it. Well... I'm not here to tell you what they are, I won't try to sell them to you either, what I will do is show you an example of how would it be if you use them in your javascripts.<p>We'll do something fun, lets solve a fairly trivial problem in an unnecessary complicated way.<p>Suppose that we have a dictionary stored in a json file or a plain js object.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>accident</span><span style=color:#5fb3b3>"</span><span>: [</span><span style=color:#5fb3b3>"</span><span style=color:#99c794>An unexpected, unfortunate mishap, failure or loss with the potential for harming human life, property or the environment.</span><span style=color:#5fb3b3>", "</span><span style=color:#99c794>An event that happens suddenly or by chance without an apparent cause.</span><span style=color:#5fb3b3>"</span><span>]</span><span style=color:#5fb3b3>, 
</span><span>    </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>accumulator</span><span style=color:#5fb3b3>"</span><span>: [</span><span style=color:#5fb3b3>"</span><span style=color:#99c794>A rechargeable device for storing electrical energy in the form of chemical energy, consisting of one or more separate secondary cells.</span><span style=color:#5fb3b3>\\</span><span style=color:#99c794>n(Source: CED)</span><span style=color:#5fb3b3>"</span><span>]</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>acid</span><span style=color:#5fb3b3>"</span><span>: [</span><span style=color:#5fb3b3>"</span><span style=color:#99c794>A compound capable of transferring a hydrogen ion in solution.</span><span style=color:#5fb3b3>", "</span><span style=color:#99c794>Being harsh or corrosive in tone.</span><span style=color:#5fb3b3>", "</span><span style=color:#99c794>Having an acid, sharp or tangy taste.</span><span style=color:#5fb3b3>", "</span><span style=color:#99c794>A powerful hallucinogenic drug manufactured from lysergic acid.</span><span style=color:#5fb3b3>", "</span><span style=color:#99c794>Having a pH less than 7, or being sour, or having the strength to neutralize  alkalis, or turning a litmus paper red.</span><span style=color:#5fb3b3>"</span><span>]</span><span style=color:#5fb3b3>,
</span><span>    
</span><span style=color:#5fb3b3>     </span><span style=color:#5f6364>// ... moar words and meanings
</span><span>    
</span><span>    </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>Paris</span><span style=color:#5fb3b3>"</span><span>: [</span><span style=color:#5fb3b3>"</span><span style=color:#99c794>The capital and largest city of France.</span><span style=color:#5fb3b3>"</span><span>]
</span><span>  </span><span style=color:#5fb3b3>}
</span></code></pre><p>We want a form that lets a user search one of this words and then shows the meaning(s). This is simple, right? What could possibly go wrong?<p>Because everyone loves HTML we'll start with that.<pre class=language-html data-lang=html style=background:#2b2c2f;color:#cccece><code class=language-html data-lang=html><span style=color:#5fb3b3><</span><span style=color:#eb606b>form </span><span style=color:#bb80b3>id</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>search_form</span><span style=color:#5fb3b3>">
</span><span>  </span><span style=color:#5fb3b3><</span><span style=color:#eb606b>label </span><span style=color:#bb80b3>for</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>search_input</span><span style=color:#5fb3b3>"></span><span>Search a word</span><span style=color:#5fb3b3>&LT/</span><span style=color:#eb606b>label</span><span style=color:#5fb3b3>>
</span><span>  </span><span style=color:#5fb3b3><</span><span style=color:#eb606b>input </span><span style=color:#bb80b3>id</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>search_input</span><span style=color:#5fb3b3>" </span><span style=color:#bb80b3>type</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>text</span><span style=color:#5fb3b3>">
</span><span>  </span><span style=color:#5fb3b3><</span><span style=color:#eb606b>button </span><span style=color:#bb80b3>type</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>submit</span><span style=color:#5fb3b3>"></span><span>Submit</span><span style=color:#5fb3b3>&LT/</span><span style=color:#eb606b>button</span><span style=color:#5fb3b3>>
</span><span style=color:#5fb3b3>&LT/</span><span style=color:#eb606b>form</span><span style=color:#5fb3b3>>
</span><span>
</span><span style=color:#5fb3b3><</span><span style=color:#eb606b>div </span><span style=color:#bb80b3>id</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>result</span><span style=color:#5fb3b3>">&LT/</span><span style=color:#eb606b>div</span><span style=color:#5fb3b3>>
</span></code></pre><p>In the first version we will just try get one those values based on the user input.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// main.js
</span><span>
</span><span style=color:#5f6364>// magically retrieve the data from a file or whatever
</span><span style=color:#c594c5>const </span><span>entries </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>data</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>format</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>results</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span>results</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>join</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTbr></span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// I regret nothing
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#6699cc>window</span><span style=color:#5fb3b3>.</span><span>search_form</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>addEventListener</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>submit</span><span style=color:#5fb3b3>', </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>ev</span><span style=color:#5fb3b3>) {
</span><span>  ev</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>preventDefault</span><span>()</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>let </span><span>input </span><span style=color:#5fb3b3>= </span><span>ev</span><span style=color:#5fb3b3>.</span><span>target[</span><span style=color:#f99157>0</span><span>]</span><span style=color:#5fb3b3>;
</span><span>  window</span><span style=color:#5fb3b3>.</span><span>result</span><span style=color:#5fb3b3>.</span><span>innerHTML </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>format</span><span>(entries[input</span><span style=color:#5fb3b3>.</span><span>value])</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span></code></pre><p>Naturally the first thing we try to search is "acid." And behold here are the results.<blockquote><p>A compound capable of transferring a hydrogen ion in solution. Being harsh or corrosive in tone. Having an acid, sharp or tangy taste. A powerful hallucinogenic drug manufactured from lysergic acid. Having a pH less than 7, or being sour, or having the strength to neutralize alkalis, or turning a litmus paper red.</blockquote><p>Now we search for "paris", I'm sure it's there. What did we get? Nothing. Not exactly nothing, we got.<blockquote><p>TypeError: results is undefined</blockquote><p>We also got an unpredictable submit button that sometime works and sometimes doesn't. So what do we want? What do we really, really want? Safety, objects that don't crash our application, we want reliable objects.<p>What we will do is implement containers that let us describe the flow of execution without worrying about the value they hold. Sounds good, right? Let me show you what I mean with a little javascript. Try this.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span style=color:#6699cc>is_even </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>num </span><span style=color:#c594c5>=> </span><span>num </span><span style=color:#5fb3b3>% </span><span style=color:#f99157>2 </span><span style=color:#5fb3b3>=== </span><span style=color:#f99157>0</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#c594c5>const </span><span>odd_arr </span><span style=color:#5fb3b3>= </span><span>[</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>,</span><span style=color:#f99157>3</span><span style=color:#5fb3b3>,</span><span style=color:#f99157>4</span><span style=color:#5fb3b3>,</span><span style=color:#f99157>5</span><span>]</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>filter</span><span>(is_even)</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>map</span><span>(</span><span style=color:#f99157>val </span><span style=color:#c594c5>=> </span><span>val</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>toString</span><span>())</span><span style=color:#5fb3b3>;
</span><span style=color:#c594c5>const </span><span>empty_arr </span><span style=color:#5fb3b3>= </span><span>[]</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>filter</span><span>(is_even)</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>map</span><span>(</span><span style=color:#f99157>val </span><span style=color:#c594c5>=> </span><span>val</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>toString</span><span>())</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#fac863>console</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>log</span><span>(</span><span style=color:#5fb3b3>{</span><span>odd_arr</span><span style=color:#5fb3b3>, </span><span>empty_arr</span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span></code></pre><p>Did it throw an exception on the empty array? (if it did let me know). Isn't that nice? Doesn't it feel all warm and fuzzy knowing that the array methods would do the right thing even if there isn't anything to work with? That is what we want.<p>You might be wondering couldn't we just write a few <code>if</code> statements and be done with it? Well... yeah, but where is the fun in that? We all know that chaining functions is cool, and we are fans of functional programming, we do what every functional programming savvy does: <strong>hide things under a function</strong>.<p>So we are going to hide an <code>if</code> statement (or maybe a couple), if the value we evaluate is undefined-ish we return a wrapper that will know how to behave no matter what happens.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// maybe.js
</span><span style=color:#5f6364>// (I would like to apologize for the many `thing`s you'll see)
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>Maybe</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>the_thing</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>if</span><span>(the_thing </span><span style=color:#5fb3b3>=== </span><span style=color:#f99157>null 
</span><span>     </span><span style=color:#5fb3b3>|| </span><span>the_thing </span><span style=color:#5fb3b3>=== </span><span style=color:#f99157>undefined 
</span><span>     </span><span style=color:#5fb3b3>|| </span><span>the_thing</span><span style=color:#5fb3b3>.</span><span>is_nothing
</span><span>  ) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>return </span><span style=color:#6699cc>Nothing</span><span>()</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#5fb3b3>  </span><span style=color:#5f6364>// I don't want nested Maybes
</span><span>  </span><span style=color:#c594c5>if</span><span>(the_thing</span><span style=color:#5fb3b3>.</span><span>is_just) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>return </span><span>the_thing</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span>
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#6699cc>Just</span><span>(the_thing)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>This wrappers are not going to be your standard by the book <code>Maybe</code> you see in a proper functional programming language. We will cheat a little in the name of convenience and side effects. Also their methods will be named after the methods in the Option type you find in Rust (I like those names better). Here is where the magic happens.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// maybe.js
</span><span>
</span><span style=color:#5f6364>// I lied, there will be a lot of cheating and `fun`s.
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>Just</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>thing</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#6699cc>map</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>Maybe</span><span>(</span><span style=color:#6699cc>fun</span><span>(thing))</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>and_then</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>fun</span><span>(thing)</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>or_else</span><span style=color:#5fb3b3>: () </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>Maybe</span><span>(thing)</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>tap</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span>(</span><span style=color:#6699cc>fun</span><span>(thing)</span><span style=color:#5fb3b3>, </span><span style=color:#6699cc>Maybe</span><span>(thing))</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>unwrap_or</span><span style=color:#5fb3b3>: () </span><span style=color:#c594c5>=> </span><span>thing</span><span style=color:#5fb3b3>,
</span><span>    
</span><span>    </span><span style=color:#6699cc>filter</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>predicate_fun </span><span style=color:#c594c5>=> 
</span><span>      </span><span style=color:#6699cc>predicate_fun</span><span>(thing) 
</span><span>        </span><span style=color:#5fb3b3>? </span><span style=color:#6699cc>Maybe</span><span>(thing) 
</span><span>        </span><span style=color:#5fb3b3>: </span><span style=color:#6699cc>Nothing</span><span>()</span><span style=color:#5fb3b3>,
</span><span>    
</span><span>    is_just</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span>    is_nothing</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>inspect</span><span style=color:#5fb3b3>: () </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>`</span><span style=color:#99c794>Just(</span><span style=color:#5fb3b3>${</span><span>thing</span><span style=color:#5fb3b3>}</span><span style=color:#99c794>)</span><span style=color:#5fb3b3>`,
</span><span>  </span><span style=color:#5fb3b3>};
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>Nothing</span><span style=color:#5fb3b3>() {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{
</span><span>    map</span><span style=color:#5fb3b3>: </span><span>Nothing</span><span style=color:#5fb3b3>,
</span><span>    and_then</span><span style=color:#5fb3b3>: </span><span>Nothing</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>or_else</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>fun</span><span>()</span><span style=color:#5fb3b3>,
</span><span>    tap</span><span style=color:#5fb3b3>: </span><span>Nothing</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>unwrap_or</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>arg </span><span style=color:#c594c5>=> </span><span>arg</span><span style=color:#5fb3b3>,
</span><span>
</span><span>    filter</span><span style=color:#5fb3b3>: </span><span>Nothing</span><span style=color:#5fb3b3>,
</span><span>
</span><span>    is_just</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span>    is_nothing</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>inspect</span><span style=color:#5fb3b3>: () </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>`</span><span style=color:#99c794>Nothing</span><span style=color:#5fb3b3>`,
</span><span>  </span><span style=color:#5fb3b3>};
</span><span style=color:#5fb3b3>}
</span></code></pre><p>What is the purpose of these methods?<ul><li><code>map</code>: Applies the function <code>fun</code> to <code>the_thing</code> and wraps it again on a Maybe to keep the party going... I mean to keep the shape of the object, so you can keep chaining functions.<li><code>and_then</code>: This is mostly an escape hatch. Apply the function <code>fun</code> and let fate decide.<li><code>or_else</code>: It is the <code>else</code> to your <code>map</code> and <code>and_then</code>. The other path. The "what if is not there?"<li><code>tap</code>: These one is there just for the side effects. If you see it then it's probably affecting something outside of it's scope (or maybe is just the perfect place to put a <code>console.log</code>).<li>filter: It "lets you go through" if the predicate function returns something truthy.<li><code>unwrap_or</code>: This is how you get <code>the_thing</code> out. You'll want this when you're done chaining methods and you're ready to get back to the imperative world.</ul><p>Lets go back to our form and see it in action. We'll make a function <code>search</code> that may o may not retrieve a match to the user's query. If it does we'll chain other functions that will be executed in a "safe context."<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// main.js
</span><span>
</span><span style=color:#c594c5>const </span><span style=color:#6699cc>search </span><span style=color:#5fb3b3>= (</span><span style=color:#f99157>data</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>input</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>Maybe</span><span>(data[input])</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#c594c5>const </span><span style=color:#6699cc>search_word </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>word </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>search</span><span>(entries</span><span style=color:#5fb3b3>, </span><span>word)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>map</span><span>(format)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>unwrap_or</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>word not found</span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>;
</span></code></pre><p>And now we replace our unholy old way with the new safe(r) function.<pre class=language-diff data-lang=diff style=background:#2b2c2f;color:#cccece><code class=language-diff data-lang=diff><span> window.search_form.addEventListener('submit', function(ev) {
</span><span>   ev.preventDefault();
</span><span>   let input = ev.target[0];
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>  window.result.innerHTML = format(entries[input.value]);
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>  window.result.innerHTML = search_word(input.value);
</span><span> });
</span></code></pre><p>Now we test. Search for "accident."<blockquote><p>An unexpected, unfortunate mishap, failure or loss with the potential for harming human life, property or the environment. An event that happens suddenly or by chance without an apparent cause.</blockquote><p>Now Paris. Search for "paris."<blockquote><p>word not found</blockquote><p>It didn't freeze the button, that's good. But I know Paris is there. If you check you'll see that is "Paris." We'll just capitalize the user input so they don't have to. First we'll try to search the exact input, if that fails we'll try the capitalize way.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// main.js
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>create_search</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>data</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>exact</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#f99157>input </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>const </span><span>word </span><span style=color:#5fb3b3>= </span><span>exact </span><span style=color:#5fb3b3>? </span><span>input </span><span style=color:#5fb3b3>: </span><span style=color:#6699cc>capitalize</span><span>(input)</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#c594c5>return </span><span style=color:#6699cc>Maybe</span><span>(data[word])</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>capitalize</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>str</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span>str</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>charAt</span><span>(</span><span style=color:#f99157>0</span><span>)</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>toUpperCase</span><span>() </span><span style=color:#5fb3b3>+ </span><span>str</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>slice</span><span>(</span><span style=color:#f99157>1</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Change the search function.<pre class=language-diff data-lang=diff style=background:#2b2c2f;color:#cccece><code class=language-diff data-lang=diff><span style=color:#5fb3b3>-</span><span style=color:#ec5f67> const search = (data, input) => Maybe(data[input]);
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794> const search = create_search(entries, true);
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794> const search_name = create_search(entries, false);
</span><span style=color:#5fb3b3>-
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67> const search_word = word => search(entries, word)
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794> const search_word = word => search(word)
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>   .or_else(() => search_name(word))
</span><span>    .map(format)
</span><span>    .unwrap_or('word not found');
</span></code></pre><p>Very nice. This what we got so far in main.js if you wanna see the whole picture.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// main.js
</span><span>
</span><span style=color:#c594c5>const </span><span>entries </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>data</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>create_search</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>data</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>exact</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#f99157>input </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>const </span><span>word </span><span style=color:#5fb3b3>= </span><span>exact </span><span style=color:#5fb3b3>? </span><span>input </span><span style=color:#5fb3b3>: </span><span style=color:#6699cc>capitalize</span><span>(input)</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#c594c5>return </span><span style=color:#6699cc>Maybe</span><span>(data[word])</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>capitalize</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>str</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span>str</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>charAt</span><span>(</span><span style=color:#f99157>0</span><span>)</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>toUpperCase</span><span>() </span><span style=color:#5fb3b3>+ </span><span>str</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>slice</span><span>(</span><span style=color:#f99157>1</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>format</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>results</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span>results</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>join</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTbr></span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>const </span><span>search </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>create_search</span><span>(entries</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>true</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#c594c5>const </span><span>search_name </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>create_search</span><span>(entries</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>false</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#c594c5>const </span><span style=color:#6699cc>search_word </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>word </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>search</span><span>(word)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>or_else</span><span>(</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>search_name</span><span>(word))
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>map</span><span>(format)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>unwrap_or</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>word not found</span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#6699cc>window</span><span style=color:#5fb3b3>.</span><span>search_form</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>addEventListener</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>submit</span><span style=color:#5fb3b3>', </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>ev</span><span style=color:#5fb3b3>) {
</span><span>  ev</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>preventDefault</span><span>()</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>let </span><span>input </span><span style=color:#5fb3b3>= </span><span>ev</span><span style=color:#5fb3b3>.</span><span>target[</span><span style=color:#f99157>0</span><span>]</span><span style=color:#5fb3b3>;
</span><span>  window</span><span style=color:#5fb3b3>.</span><span>result</span><span style=color:#5fb3b3>.</span><span>innerHTML </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>search_word</span><span>(input</span><span style=color:#5fb3b3>.</span><span>value)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span></code></pre><p>But is that all we want in life? No, of course not, we want love but since javascript can't give us that we'll settle for a little "suggest word" feature. I want to search "accu" and have a confirm dialog telling me "Did you mean accumulator?"<p>We'll need help with this one, we'll bring a dependency, one that can perform a fuzzy search on the entries: <a href=https://github.com/wouter2203/fuzzy-search#readme rel=noopener target=_blank>fuzzy-search</a>. So we add the following.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// main.js
</span><span>
</span><span style=color:#c594c5>import </span><span>FuzzySearch </span><span style=color:#c594c5>from </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>https://unpkg.com/fuzzy-search@3.0.1/src/FuzzySearch.js</span><span style=color:#5fb3b3>';
</span><span>
</span><span style=color:#c594c5>const </span><span>fzf </span><span style=color:#5fb3b3>= new </span><span>FuzzySearch(
</span><span>  </span><span style=color:#fac863>Object</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>keys</span><span>(entries)</span><span style=color:#5fb3b3>,
</span><span>  []</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#5fb3b3>{</span><span>caseSensitive</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>, </span><span>sort</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>}
</span><span>)</span><span style=color:#5fb3b3>;
</span></code></pre><p>But again we can't perform a safe operation 'cause the moment we try to get a match from an empty array the whole thing will fall apart. So what do we do? We hide things under a function.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// main.js
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>suggest</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>word</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>const </span><span>matches </span><span style=color:#5fb3b3>= </span><span>fzf</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>search</span><span>(word)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#6699cc>Maybe</span><span>(matches[</span><span style=color:#f99157>0</span><span>])</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Fuzzy search is ready, now lets throw in a super awesome confirm dialog. You'll love it.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// main.js
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>confirm_word</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>value</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>if</span><span>(value </span><span style=color:#5fb3b3>&& </span><span style=color:#6699cc>confirm</span><span>(</span><span style=color:#5fb3b3>`</span><span style=color:#99c794>Did you mean </span><span style=color:#5fb3b3>${</span><span>value</span><span style=color:#5fb3b3>}`</span><span>)) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>return </span><span>value</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>We combine the new functions with our <code>search</code>.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// main.js
</span><span>
</span><span style=color:#c594c5>const </span><span style=color:#6699cc>suggest_word </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>value </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>suggest</span><span>(value)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>map</span><span>(confirm_word)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>map</span><span>(search)</span><span style=color:#5fb3b3>;
</span></code></pre><p>Add the feature to <code>search_word</code>.<pre class=language-diff data-lang=diff style=background:#2b2c2f;color:#cccece><code class=language-diff data-lang=diff><span> const search_word = word => search(word)
</span><span>   .or_else(() => search_name(word))
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>  .or_else(suggest_word(word))
</span><span>   .map(format)
</span><span>   .unwrap_or('word not found');
</span></code></pre><p>That works! But lets say we are allergic to <code>if</code> statements and not to mention that it's just rude to return <code>undefined</code> from a function. We can do better.<pre class=language-diff data-lang=diff style=background:#2b2c2f;color:#cccece><code class=language-diff data-lang=diff><span> function confirm_word(value) {
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>  if(value && confirm(`Did you mean ${value}`)) {
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>    return value;
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>  }
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>  return confirm(`Did you mean ${value}`);
</span><span> }
</span></code></pre><pre class=language-diff data-lang=diff style=background:#2b2c2f;color:#cccece><code class=language-diff data-lang=diff><span> const suggest_word = value => () => suggest(value)
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>  .map(confirm_word)
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>  .filter(confirm_word)
</span><span>   .map(search);
</span></code></pre><p>Something bugs me. I search "accu", the dialog pops in, I confirm the suggestion and the results appears. But "accu" it's still there in the input, it's awkward. Lets update the input with the right word.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span style=color:#6699cc>update_input </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>val </span><span style=color:#c594c5>=> </span><span>window</span><span style=color:#5fb3b3>.</span><span>search_form[</span><span style=color:#f99157>0</span><span>]</span><span style=color:#5fb3b3>.</span><span>value </span><span style=color:#5fb3b3>= </span><span>val</span><span style=color:#5fb3b3>;
</span></code></pre><pre class=language-diff data-lang=diff style=background:#2b2c2f;color:#cccece><code class=language-diff data-lang=diff><span> const suggest_word = value => () => suggest(value)
</span><span>   .filter(confirm_word)
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>  .tap(update_input)
</span><span>   .map(search);
</span></code></pre><p>Want to see it in action? There you go.<p data-pen-title="Maybe I got your word" style="height:600px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;border:2px solid;margin:1em 0;padding:1em" class=codepen data-default-tab=js,result data-height=600 data-preview=true data-slug-hash=JjjNvLE data-theme-id=dark data-user=VonHeikemen><span> See the Pen <a href=https://codepen.io/VonHeikemen/pen/JjjNvLE>Maybe I got your word</a> by Heiker (<a href=https://codepen.io/VonHeikemen>@VonHeikemen</a>) on <a href=https://codepen.io>CodePen</a>. </span></p><script async src=https://static.codepen.io/assets/embed/ei.js></script><h2 id=bonus-track>Bonus track</h2><blockquote><p><em>Warning</em>: The main point of the post (which is me showing that codepen example) was already accomplished. What follows is a strange experiment to see if I could make that <code>Maybe</code> function support asynchronous operations. If you are tired just skip everything and check out the last example code.</blockquote><p>Now you might be saying: this is cute and all but in the "real world" we make http requests, query a database, make all sorts of asynchronous stuff, can this still be useful in that context?<p>I hear you. Our current implementation just supports normal blocking tasks. You would have to break the chain of <code>Maybes</code> the moment a <code>Promise</code> shows up.<p>But what if... listen... we make a promise aware <code>Just</code>. We can do that, an <code>AsyncJust</code>? <code>JustAsync</code>? Oh, that's awful.<p>If you don't know, a <code>Promise</code> is a data type that javascript uses to coordinate future events. To do so it uses a method called <code>then</code> that takes a callback (it also has <code>catch</code> for when things go wrong) So if we hijack what goes into that <code>then</code> then we can keep our nice <code>Maybe</code> interface.<p>How good are you following a bunch of callbacks?<p>Here I go. Let me show you the <code>Future</code>.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// Don't judge me. 
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>Future</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>promise_thing</span><span style=color:#5fb3b3>) { 
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#6699cc>map</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>Future</span><span>(promise_thing</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>then</span><span>(</span><span style=color:#6699cc>map_future</span><span>(fun)))</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>and_then</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>Future</span><span>(promise_thing</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>then</span><span>(</span><span style=color:#6699cc>map_future</span><span>(fun)))</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>or_else</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>Future</span><span>(promise_thing</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>catch</span><span>(fun))</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>tap</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>Future</span><span>(promise_thing</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>then</span><span>(</span><span style=color:#f99157>val </span><span style=color:#c594c5>=> </span><span>(</span><span style=color:#6699cc>fun</span><span>(val)</span><span style=color:#5fb3b3>, </span><span>val)))</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>unwrap_or</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>arg </span><span style=color:#c594c5>=> </span><span>promise_thing</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>catch</span><span>(</span><span style=color:#f99157>val </span><span style=color:#c594c5>=> </span><span>arg)</span><span style=color:#5fb3b3>,
</span><span>
</span><span>    </span><span style=color:#6699cc>filter</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>Future</span><span>(promise_thing</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>then</span><span>(</span><span style=color:#6699cc>filter_future</span><span>(fun)))</span><span style=color:#5fb3b3>, 
</span><span>
</span><span>    is_just</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span>    is_nothing</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span>    is_future</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#6699cc>inspect</span><span style=color:#5fb3b3>: () </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>`</span><span style=color:#99c794>&LTPromise></span><span style=color:#5fb3b3>`
</span><span>  </span><span style=color:#5fb3b3>};
</span><span style=color:#5fb3b3>}
</span></code></pre><p>If we remove the noise maybe we could understand better.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5f6364>// In it's very core is callbacks all the way.
</span><span>
</span><span style=color:#5fb3b3>{
</span><span>  map</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span>promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>then</span><span>(fun)</span><span style=color:#5fb3b3>,
</span><span>  and_then</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span>promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>then</span><span>(fun)</span><span style=color:#5fb3b3>,
</span><span>  or_else</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span>promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>catch</span><span>(fun)</span><span style=color:#5fb3b3>,
</span><span>  tap</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span>promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>then</span><span>(</span><span style=color:#f99157>val </span><span style=color:#c594c5>=> </span><span>(</span><span style=color:#6699cc>fun</span><span>(val)</span><span style=color:#5fb3b3>, </span><span>val)))</span><span style=color:#5fb3b3>,
</span><span>  unwrap_or</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>arg </span><span style=color:#c594c5>=> </span><span>promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>catch</span><span>(</span><span style=color:#f99157>val </span><span style=color:#c594c5>=> </span><span>arg)</span><span style=color:#5fb3b3>,
</span><span>
</span><span>  filter</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>fun </span><span style=color:#c594c5>=> </span><span>promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>then</span><span>(fun)</span><span style=color:#5fb3b3>, 
</span><span style=color:#5fb3b3>}
</span></code></pre><ul><li><code>map</code>/<code>and_then</code>: these do the same thing because you can't get out of a <code>Promise</code>.<li><code>or_else</code>: puts your callback in the <code>catch</code> method to mimic an <code>else</code> behavior.<li><code>tap</code>: uses <code>then</code> to peek at the value. Since this is for side effects we return the value again.<li><code>unwrap_or</code>: It will return the promise so you can use <code>await</code>. If everything goes well the original value of the <code>Promise</code> will be returned when you <code>await</code>, else the provided argument will be returned. Either way the promise doesn't throw an error because the <code>Future</code> attached the <code>catch</code> method to it.<li><code>filter</code>: these one is a special kind of <code>map</code> that's why <code>filter_future</code> exists.<li>Almost all these methods return a new <code>Future</code> 'cause <code>promise.then</code> returns a new <code>Promise</code>.</ul><p>What makes the <code>Future</code> weird is what happens inside <code>map</code>. Remember <code>map_future</code>?<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>map_future</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fun</span><span style=color:#5fb3b3>) { </span><span style=color:#5f6364>// `fun` is the user's callback
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#f99157>val </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#5f6364>/* Evaluate the original value */
</span><span>    </span><span style=color:#c594c5>let </span><span>promise_content </span><span style=color:#5fb3b3>= </span><span>val</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// It needs to decide if the value of the Promise
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// can be trusted
</span><span>    </span><span style=color:#c594c5>if</span><span>(</span><span style=color:#6699cc>Maybe</span><span>(promise_content)</span><span style=color:#5fb3b3>.</span><span>is_nothing) </span><span style=color:#5fb3b3>{
</span><span>      </span><span style=color:#fac863>Promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>reject</span><span>()</span><span style=color:#5fb3b3>;
</span><span>      </span><span style=color:#c594c5>return</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// If it is a Just then unwrap it.
</span><span>    </span><span style=color:#c594c5>if</span><span>(promise_content</span><span style=color:#5fb3b3>.</span><span>is_just) </span><span style=color:#5fb3b3>{
</span><span>      promise_content </span><span style=color:#5fb3b3>= </span><span>val</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>unwrap_or</span><span>()</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>
</span><span>    </span><span style=color:#5f6364>/* Evaluate the return value of the user's callback */
</span><span>
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// Use Maybe because I have trust issues.
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// For the javascript world is undefined and full of errors.
</span><span>    </span><span style=color:#c594c5>const </span><span>result </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>Maybe</span><span>(</span><span style=color:#6699cc>fun</span><span>(promise_content))</span><span style=color:#5fb3b3>;
</span><span>
</span><span>    </span><span style=color:#c594c5>if</span><span>(result</span><span style=color:#5fb3b3>.</span><span>is_just) </span><span style=color:#5fb3b3>{
</span><span style=color:#5fb3b3>      </span><span style=color:#5f6364>// If it gets here it's all good.
</span><span>      </span><span style=color:#c594c5>return </span><span>result</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>unwrap_or</span><span>()</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// at this point i should check if result is a Future
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// if that happens you are using them in a wrong way
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// so for now I don't do it 
</span><span>
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// There is something seriously wrong.
</span><span>    </span><span style=color:#c594c5>return </span><span style=color:#fac863>Promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>reject</span><span>()</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Now <code>filter_future</code>.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>filter_future</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>predicate_fun</span><span style=color:#5fb3b3>) { </span><span style=color:#5f6364>// the user's function
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#f99157>val </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>const </span><span>result </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>predicate_fun</span><span>(val)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// Did you just returned a `Promise`?
</span><span>    </span><span style=color:#c594c5>if</span><span>(result</span><span style=color:#5fb3b3>.</span><span>then) </span><span style=color:#5fb3b3>{
</span><span style=color:#5fb3b3>      </span><span style=color:#5f6364>// You did! That's why you can't have nice things.
</span><span> 
</span><span style=color:#5fb3b3>      </span><span style=color:#5f6364>// peek inside the user's promise.
</span><span>      </span><span style=color:#c594c5>const </span><span style=color:#6699cc>return_result </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>the_real_result </span><span style=color:#c594c5>=> </span><span>the_real_result 
</span><span>        </span><span style=color:#5fb3b3>? </span><span>val
</span><span>        </span><span style=color:#5fb3b3>: </span><span style=color:#fac863>Promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>reject</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5fb3b3>      </span><span style=color:#5f6364>// keep the promise chain alive.
</span><span>      </span><span style=color:#c594c5>return </span><span>result</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>then</span><span>(return_result)</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>
</span><span>    </span><span style=color:#c594c5>return </span><span>result </span><span style=color:#5fb3b3>? </span><span>val </span><span style=color:#5fb3b3>: </span><span style=color:#fac863>Promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>reject</span><span>()</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>There is one last thing I would like to do and that is create a helper function to convert a regular value into a <code>Future</code>.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span>Future</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>from_val </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>val</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#6699cc>Future</span><span>(</span><span style=color:#fac863>Promise</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>resolve</span><span>(val))</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>All we have to do now to support a <code>Future</code> in a <code>Maybe</code> is this.<pre class=language-diff data-lang=diff style=background:#2b2c2f;color:#cccece><code class=language-diff data-lang=diff><span> function Maybe(the_thing) {
</span><span>   if(the_thing === null 
</span><span>     || the_thing === undefined 
</span><span>     || the_thing.is_nothing
</span><span>   ) {
</span><span>     return Nothing();
</span><span>   }
</span><span style=color:#5fb3b3>-
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>  if(the_thing.is_just) {
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>  if(the_thing.is_future || the_thing.is_just) {
</span><span>     return the_thing;
</span><span>    }
</span><span>
</span><span>    return Just(the_thing);
</span><span> }
</span></code></pre><p>But the million dollar question remains. Does it actually work?<p>I have <a href=https://github.com/VonHeikemen/maybe-type-in-js rel=noopener target=_blank>CLI version</a> of this. And here is the same codepen example with some tweaks: I added the <code>Future</code> related functions, the confirm dialog is actually a dialog (<a href=https://github.hubspot.com/vex/ rel=noopener target=_blank>this one</a>) and the event listener is now an async function that can <code>await</code> the result.<p data-pen-title="Maybe I will promise you a word" style="height:600px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;border:2px solid;margin:1em 0;padding:1em" class=codepen data-default-tab=js,result data-height=600 data-preview=true data-slug-hash=oNNwagG data-theme-id=dark data-user=VonHeikemen><span> See the Pen <a href=https://codepen.io/VonHeikemen/pen/oNNwagG>Maybe I will promise you a word</a> by Heiker (<a href=https://codepen.io/VonHeikemen>@VonHeikemen</a>) on <a href=https://codepen.io>CodePen</a>. </span><h3 id=bonus-bonus-edit>Bonus bonus edit</h3><p>That is how it looks like when we cheat. If we didn't cheat it would be like <a href=https://codepen.io/VonHeikemen/pen/QWWYJwZ rel=noopener target=_blank>this</a>.<h2 id=other-resources>Other resources</h2><ul><li><a href=https://www.toptal.com/javascript/option-maybe-either-future-monads-js rel=noopener target=_blank>Option/Maybe, Either, and Future Monads in JavaScript, Python, Ruby, Swift, and Scala</a><li><a href=https://jrsinclair.com/articles/2016/marvellously-mysterious-javascript-maybe-monad/ rel=noopener target=_blank>The Marvellously Mysterious JavaScript Maybe Monad</a><li><a href="https://www.youtube.com/watch?v=pgq-Pfg6ul4" rel=noopener target=_blank>Monad Mini-Series: Functors (video)</a><li><a href="https://www.youtube.com/watch?v=SfWR3dKnFIo" rel=noopener target=_blank>Oh Composable World! (video)</a></ul><hr><p>Have any question? Feel free to leave a comment in one of these platform where I have shared this:<ul><li><a href=https://dev.to/vonheikemen/functional-programming-for-your-everyday-javascript-using-a-maybe-126j rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/using-a-maybe rel=noopener target=_blank>Hashnode</a></ul><p>You can reach out to me on social media:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Thank you for reading. If you find this article useful and want to support my efforts, buy me a coffee ☕</p><a href=https://www.buymeacoffee.com/vonheikemen style=display:flex;justify-content:center target=_blank> <img alt="Buy Me A Coffee" src=https://cdn.buymeacoffee.com/buttons/v2/default-blue.png style=height:60px!important;width:217px!important> </a></div></div>