<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  An introduction to Monads (in js) | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://vonheikemen.github.io/devlog/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="javascript, functional-programming, software, coding, development" name=keywords><meta content="Trying to explain monads without loosing our minds" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/tags/>Explore tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/>Devlog en español</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2024 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>An introduction to Monads (in js)</h1><span class=post-date>2020-09-02 | 7 min read | <a href=https://vonheikemen.github.io/devlog/es/web-development/learn-fp/an-introduction-to-monads-in-js/> Leer en español </a> </span><p>Oh the infamous M word. The one we don't speak about in javascript. Well, today we are going talk about it, specifically we are going to "review" one definition I really like, the only one that doesn't make my head explode. In order to keep our sanity we are just going to explore the aspects we can model using javascript. Everyone ready? Let us begin.<p>Here it is. This is the easy one, I swear. Monads are...<blockquote><p>pointed functors that can flatten.</blockquote><p>You said you were ready. Anyway, we can do this. Once you understand the behaviour of a functor the rest will fall into place.<h2 id=enter-functors>Enter Functors</h2><p>From a <em>javascripty</em> point of view you can think of them as containers with a very special feature: they allow you to transform their inner value in any way you see fit without leaving said container.<p>Isn't that intriguing? How would that look like in code. Let's try to make the simplest functor we can think of.<h3 id=the-box>The Box</h3><pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#69c>Box</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>data</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#69c>map</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fn</span><span style=color:#5fb3b3>) {
</span><span>      </span><span style=color:#c594c5>return </span><span style=color:#69c>Box</span><span>(</span><span style=color:#69c>fn</span><span>(data))</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>What happens in here? Well, we created a <code>Box</code> specifically designed to hold a <code>data</code> value and the only way to gain access to the value is through the <code>map</code> method. This <code>map</code> thing takes a function <code>fn</code> as an argument, applies that function to <code>data</code> and puts the result back in another <code>Box</code>. I must tell you that not all functors look like this, but in general this is the pattern they all follow. Let's use it.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>xbox </span><span style=color:#5fb3b3>= </span><span style=color:#69c>Box</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>x</span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#c594c5>const </span><span style=color:#69c>to_uppercase </span><span style=color:#5fb3b3>= (</span><span style=color:#f99157>str</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span>str</span><span style=color:#5fb3b3>.</span><span style=color:#69c>toUpperCase</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span>xbox</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(to_uppercase)</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(</span><span style=color:#fac863>console</span><span style=color:#5fb3b3>.</span><span style=color:#69c>log</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#5f6364>// => X
</span><span style=color:#5f6364>// => Object { map: map() }
</span></code></pre><p>So, that <code>Box</code> seems um... useless. Yeah, that's by design but not mine, this is actually the <code>Identity</code> functor. It may not be useful in our day to day coding but for educational purposes it works like a charm.<p>What is the benefit of these functor things? By adding this tiny layer of abstraction we can separate an "effect" from a pure computation. To illustrate this let's take a look at one functor with an actual purpose.<h3 id=a-familiar-face>A familiar face</h3><p>You may or may not know this already but arrays follow the pattern I have described for the <code>Box</code>. Check this out.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>xbox </span><span style=color:#5fb3b3>= </span><span>[</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>x</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>;
</span><span style=color:#c594c5>const </span><span style=color:#69c>to_uppercase </span><span style=color:#5fb3b3>= (</span><span style=color:#f99157>str</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span>str</span><span style=color:#5fb3b3>.</span><span style=color:#69c>toUpperCase</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span>xbox</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(to_uppercase)</span><span style=color:#5fb3b3>;
</span><span style=color:#5f6364>// => Array [ "X" ]
</span></code></pre><p>The array is a container, it has a <code>map</code> method which allows us to transform the value it holds inside, and the transformed value gets wrapped again in a new array.<p>Okay, that's fine, but what is the "effect" of an array? They give you the ability to hold multiple values inside one structure, that's what they do. <code>Array.map</code> in particular makes sure your callback function is applied to every value inside the array. It doesn't matter if you have a 100 items in your array or none at all, <code>.map</code> takes care of the logic that deals with <strong>when</strong> it should apply the callback function so you can focus on <strong>what</strong> to do with the value.<p>And of course you can use functors for so much more, like error handling or null checks, even async tasks can be modelled with functors. Now, I would love to keep talking about this but we have to go back to the monad definition.<h2 id=the-pointed-part>The Pointed part</h2><p>So, we need our functors to be "pointed". This is a fancy way of telling us that we need a helper function that can put any value into the simplest unit of our functor. This function is known as "pure", other names include "unit" and "of".<p>Let's look at arrays one more time. If we put a value into the simplest unit of an array, what do we get? Yes, an array with just one item. Interestingly enough there is a built-in function for that.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span style=color:#fac863>Array</span><span style=color:#5fb3b3>.</span><span style=color:#69c>of</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>No way</span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#5f6364>// => Array [ "No way" ]
</span><span>
</span><span style=color:#fac863>Array</span><span style=color:#5fb3b3>.</span><span style=color:#69c>of</span><span>(</span><span style=color:#f99157>42</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#5f6364>// => Array [ 42 ]
</span><span>
</span><span style=color:#fac863>Array</span><span style=color:#5fb3b3>.</span><span style=color:#69c>of</span><span>(</span><span style=color:#f99157>null</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#5f6364>// => Array [ null ]
</span></code></pre><p>This helper function is specially useful if the normal way of creating your functor is somewhat convoluted. With this function you could just wrap any value you want and start <code>.map</code>ping right away. Well... there is more to it, but that's the main idea. Let's keep going.<h2 id=into-the-flatland>Into the Flatland</h2><p>Now we are getting into the heart of the problem. Wait... what is exactly the problem?<p>Imagine this situation, we have a number in a <code>Box</code> and we want to use <code>map</code> to apply a function called <code>action</code>. Something like this.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>number </span><span style=color:#5fb3b3>= </span><span style=color:#69c>Box</span><span>(</span><span style=color:#f99157>41</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#c594c5>const </span><span style=color:#69c>action </span><span style=color:#5fb3b3>= (</span><span style=color:#f99157>number</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span style=color:#69c>Box</span><span>(number </span><span style=color:#5fb3b3>+ </span><span style=color:#f99157>1</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#c594c5>const </span><span>result </span><span style=color:#5fb3b3>= </span><span>number</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(action)</span><span style=color:#5fb3b3>;
</span></code></pre><p>Everything seems fine until you realise <code>action</code> returns another <code>Box</code>. So <code>result</code> is in fact a <code>Box</code> inside another <code>Box</code>: <code>Box(Box(42))</code>. And now in order to get to the new value you have to do this.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span>result</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>box</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span>box</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>value</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>{</span><span style=color:#5f6364>/* Do stuff */</span><span style=color:#5fb3b3>}</span><span>))</span><span style=color:#5fb3b3>;
</span></code></pre><p>That's bad. No one wants to work with data like that. This is where monads can help us. They are functors that have the "ability" to merge these unnecessary nested layers. In our case it can transform <code>Box(Box(42))</code> into <code>Box(42)</code>. How? With the help of a method called <code>join</code>.<p>This is how it looks like for our <code>Box</code>.<pre class=language-diff data-lang=diff style=color:#cccece;background-color:#2b2c2f><code class=language-diff data-lang=diff><span>  function Box(data) {
</span><span>    return {
</span><span>      map(fn) {
</span><span>        return Box(fn(data));
</span><span>      },
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>     join() {
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>       return data;
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>     }
</span><span>    }
</span><span>  }
</span></code></pre><p>I know what you're thinking, it doesn't look like I'm joining anything. You may even suggest that I change the name to "extract". Just hold it right there. Let's go back to our <code>action</code> example, we are going to fix it.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>result </span><span style=color:#5fb3b3>= </span><span>number</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(action)</span><span style=color:#5fb3b3>.</span><span style=color:#69c>join</span><span>()</span><span style=color:#5fb3b3>;
</span></code></pre><p>Ta-da! Now we get a <code>Box(42)</code>, we can get to the value we want with just one <code>map</code>. Oh come on, you're still giving me the look? Okay, let's say I change the name to <code>extract</code>, now it's like this.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>result </span><span style=color:#5fb3b3>= </span><span>number</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(action)</span><span style=color:#5fb3b3>.</span><span style=color:#69c>extract</span><span>()</span><span style=color:#5fb3b3>;
</span></code></pre><p>Here is the problem, if I read that line alone I would expect <code>result</code> to be a "normal" value, something I can use freely. I'm going to be a little bit upset when I find I have to deal with a <code>Box</code> instead. On the other hand, if I read <code>join</code>, I know that <code>result</code> it's still a monad and I can prepare for that.<p>You may think "Okay I got it, but you know what? I write javascript I'm just going to ignore these functor things and I won't need monads". Totally valid, you could do that. The bad news is <strong>arrays are functors</strong>, so you can't escape them. The good news is <strong>arrays are monads</strong>, so when you get into this situation of nested structures (and you will) you can fix that easily.<p>So, arrays don't have a <code>join</code> method... I mean they do, but it's called <code>flat</code>. Behold.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span>[[</span><span style=color:#f99157>41</span><span>]</span><span style=color:#5fb3b3>, </span><span>[</span><span style=color:#f99157>42</span><span>]]</span><span style=color:#5fb3b3>.</span><span style=color:#69c>flat</span><span>()</span><span style=color:#5fb3b3>;
</span><span style=color:#5f6364>// => Array [ 41, 42 ]
</span></code></pre><p>There you go, after calling <code>flat</code> you can move on without worrying about any extra layer getting in your way. That's it, in practice that's the essence of monads and the problem they solve.<p>Before I go I need to cover one more thing.<h2 id=monads-in-chains>Monads In Chains</h2><p>It turns out this combination of <code>map/join</code> is so common that there is actually a method that combines the features of those two. This one also has multiple names in the wild: "chain", "flatMap", "bind", ">>=" (in haskell). Arrays in particular call it <code>flatMap</code>.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span style=color:#69c>split </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>str </span><span style=color:#c594c5>=> </span><span>str</span><span style=color:#5fb3b3>.</span><span style=color:#69c>split</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>/</span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>[</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>some/stuff</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>another/thing</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>.</span><span style=color:#69c>flatMap</span><span>(split)</span><span style=color:#5fb3b3>;
</span><span style=color:#5f6364>// => Array(4) [ "some", "stuff", "another", "thing" ]
</span></code></pre><p>How cool is that? Instead having an array with two nested arrays, we have just one big array. This is so much easier to handle than a nested structure.<p>But not only does it save you a few keystroke but it also encourage function composition in the same way <code>map</code> does. You could do something like this.<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span>monad</span><span style=color:#5fb3b3>.</span><span style=color:#69c>flatMap</span><span>(action)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(another)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(cool)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#69c>flatMap</span><span>(getItNow)</span><span style=color:#5fb3b3>;
</span></code></pre><p>I'm not saying you should do this with arrays. I'm saying that if you do make your own monad, you can compose functions in this style. Just remember, if the function returns a monad you need <code>flatMap</code>, if not use <code>map</code>.<h2 id=conclusion>Conclusion</h2><p>We learned that monads are just functors with extra features. In other words they magical containers that... don't like to hold other containers inside? Let's try again: they are magical onions with... nevermind, they are magical, let's leave it at that.<p>They can be used to add an "effect" to any regular value. So we can use them for things like error handling, asynchronous operations, dealing with side effects, and a whole bunch of other things.<p>We also learned that you either love them or hate them and there is nothing in between.<h2 id=sources>Sources</h2><ul><li><a href=https://mostly-adequate.gitbooks.io/mostly-adequate-guide/content/ch09.html rel=noopener target=_blank>Professor Frisby's Mostly Adequate Guide to Functional Programming. Chapter 9: Monadic Onions</a><li><a href=https://github.com/thefrontside/funcadelic.js rel=noopener target=_blank>Funcadelic.js</a><li><a href=https://github.com/fantasyland/fantasy-land rel=noopener target=_blank>Fantasy Land</a></ul><hr><p>Have any question? Feel free to leave a comment in one of these platform where I have shared this:<ul><li><a href=https://dev.to/vonheikemen/an-introduction-to-monads-in-js-2f7d rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/an-introduction-to-monads-in-js rel=noopener target=_blank>Hashnode</a></ul><p>You can reach out to me on social media:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Thank you for reading. If you find this article useful and want to support my efforts, buy me a coffee ☕</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>