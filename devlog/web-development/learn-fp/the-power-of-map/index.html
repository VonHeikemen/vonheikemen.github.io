<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Functional programming for your everyday javascript: The power of map | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://vonheikemen.github.io/devlog/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="javascript, functional-programming, learning, software, coding, development" name=keywords><meta content="Let's see what makes map so special" name=description><link href=https://dev.to/vonheikemen/functional-programming-for-your-everyday-javascript-the-power-of-map-4n9m rel=canonical><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/tags/>Explore tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/>Devlog en español</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2026 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Functional programming for your everyday javascript: The power of map</h1><span class=post-date>2020-02-16 | Originally published at <a href=https://dev.to/vonheikemen/functional-programming-for-your-everyday-javascript-the-power-of-map-4n9m> dev.to </a> | 8 min read | <a href=https://vonheikemen.github.io/devlog/es/web-development/learn-fp/the-power-of-map/> Leer en español </a> </span><p>This time we are going to take a look inside the world of <code>functors</code> and what makes them so special. Functors is one of those terms that you hear every now and then when people talk about functional programming but when the time comes to explain it they either bombard you with more abstract terms or tell you just the details you need to know. Since I have no knowledge of category theory I'm not going to pretend that I know exactly what a functor is, I'm just going show enough for you to know how you can spot them in the wild and how you can use them to your advantage.<h2 id=seriously-what-is-a-functor>Seriously, what is a functor?</h2><p>I'm convinced that the term is difficult to understand because one, you need to some other terms in order to get the whole picture and two, the theory behind it doesn't really translate very well in code. But it wouldn't hurt to have at least a clue of what they are.<p>You can think of them as a relation that exist between two sets of values. I know it's vague, this will make sense in a second. Say we have two arrays.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>const</span><span> favorite_numbers</span><span style=color:#e6c384>  =</span><span style=color:#9cabca> [</span><span style=color:#d27e99>42</span><span style=color:#9cabca>,</span><span style=color:#d27e99> 69</span><span style=color:#9cabca>,</span><span style=color:#d27e99> 73</span><span style=color:#9cabca>];</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> increased_numbers</span><span style=color:#e6c384> =</span><span style=color:#9cabca> [</span><span style=color:#d27e99>43</span><span style=color:#9cabca>,</span><span style=color:#d27e99> 70</span><span style=color:#9cabca>,</span><span style=color:#d27e99> 74</span><span style=color:#9cabca>];</span></span></code></pre><p>Nice, we have a set <code>favorite_numbers</code> and a set <code>increased_numbers</code>, they are two separate arrays in different variables but we all know that there is a connection between those two, but more importantly we can express that connection with code. Imagine that the array <code>increased_numbers</code> doesn't exist but we still need those numbers, to make them appear again all we need is our good old friend <code>map</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>const</span><span> increased_numbers</span><span style=color:#e6c384> =</span><span> favorite_numbers</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#957fb8> =></span><span> num</span><span style=color:#e6c384> +</span><span style=color:#d27e99> 1</span><span style=color:#9cabca>);</span></span></code></pre><p><code>map</code> will go through every number, increase it and put it in a new array which brings <code>increased_numbers</code> back into existence. Even though <code>increased_numbers</code> is something we made, we didn't create it out nowhere, we didn't magically invent <code>43</code>, <code>70</code> and <code>74</code>. All we did was describe a relation between those numbers and our <code>favorite_numbers</code>.<p>So, is that the whole history? Are functors just arrays? The answer to that is a big no. Arrays are just a freakishly convenient way to illustrate a common use of functors. This leaves a question in the air.<h2 id=how-do-you-recognize-them>How do you recognize them?</h2><p>I often hear other people describing functors as boxes. I for one don't think they're wrong because using a container data structure is one of easiest ways to implement a functor. The box analogy is specially funny 'cause in javascript we use brackets to create arrays, so you can actually create a functor by putting a value in a box. See.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// A value</span></span>
<span class=giallo-l><span style=color:#d27e99>1</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// A box</span></span>
<span class=giallo-l><span style=color:#9cabca>[];</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Look, a value in a box.</span></span>
<span class=giallo-l><span style=color:#9cabca>[</span><span style=color:#d27e99>1</span><span style=color:#9cabca>];</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// I regret nothing.</span></span></code></pre><p>Going back to the original question, how do we recognize them? Okay, so it turns out that there are rules.<h3 id=da-rules>Da rules</h3><p>Again I'll be using array of numbers just because is convenient but this rules must apply to any structure that wants to be in the functor club.<h4 id=identity>Identity</h4><p>Given the <code>identity</code> function.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> identity</span><span style=color:#9cabca>(</span><span>x</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> x</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p><code>value</code> and <code>value.map(identity)</code> must be equivalent.<p>For example.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#9cabca>[</span><span style=color:#d27e99>1</span><span style=color:#9cabca>,</span><span style=color:#d27e99>2</span><span style=color:#9cabca>,</span><span style=color:#d27e99>3</span><span style=color:#9cabca>];</span><span style=color:#727169>               // => [1,2,3]</span></span>
<span class=giallo-l><span style=color:#9cabca>[</span><span style=color:#d27e99>1</span><span style=color:#9cabca>,</span><span style=color:#d27e99>2</span><span style=color:#9cabca>,</span><span style=color:#d27e99>3</span><span style=color:#9cabca>].</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>identity</span><span style=color:#9cabca>);</span><span style=color:#727169> // => [1,2,3]</span></span></code></pre><p>Why is this important? What does this tell us?<p>Valid questions. This tells us that the <code>map</code> function must preserve the shape of the data structure. In our example, if we map an array of three elements we must receive a new array of three elements. If we had an array of a hundred elements, using <code>.map(identity)</code> should return an array of a hundred elements. You get the point.<h4 id=composition>Composition</h4><p>Given two functions <code>fx</code> and <code>gx</code> the following must be true.<p><code>value.map(fx).map(gx)</code> and <code>value.map(arg => gx(fx(arg)))</code> must be equivalent.<p>Example time.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> add_one</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> num</span><span style=color:#e6c384> +</span><span style=color:#d27e99> 1</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> times_two</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> num</span><span style=color:#e6c384> *</span><span style=color:#d27e99> 2</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#9cabca>[</span><span style=color:#d27e99>1</span><span style=color:#9cabca>].</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>add_one</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>times_two</span><span style=color:#9cabca>);</span><span style=color:#727169>         // => [4]</span></span>
<span class=giallo-l><span style=color:#9cabca>[</span><span style=color:#d27e99>1</span><span style=color:#9cabca>].</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> times_two</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>add_one</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#9cabca>)));</span><span style=color:#727169> // => [4]</span></span></code></pre><p>If you know how <code>Array.map</code> works this feels like 'well duh!'. This actually gives you a chance to optimize your code for readability or performance. In the case of arrays, multiple calls to <code>map</code> can have a big impact on performance when the number of elements in the list grows.<p>And that's it. Those two rules are all you need to know to spot a functor.<h2 id=does-it-always-has-to-be-map>Does it always has to be .map?</h2><p>I guess by now you wish to know what other things out there follow those rules that I just mentioned, if not I'll tell you anyway. There is another popular structure that also follows the rules and that is <code>Promise</code>. Let's see.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// A value</span></span>
<span class=giallo-l><span style=color:#d27e99>1</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// A box</span></span>
<span class=giallo-l><span style=color:#7aa89f>Promise</span><span style=color:#9cabca>.</span><span style=color:#e6c384>resolve</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Look, a value in a box</span></span>
<span class=giallo-l><span style=color:#7aa89f>Promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>resolve</span><span style=color:#9cabca>(</span><span style=color:#d27e99>1</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Identity rule</span></span>
<span class=giallo-l><span style=color:#7aa89f>Promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>resolve</span><span style=color:#9cabca>(</span><span style=color:#d27e99>1</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>identity</span><span style=color:#9cabca>);</span><span style=color:#727169> // => 1 (in the future)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Composition</span></span>
<span class=giallo-l><span style=color:#7aa89f>Promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>resolve</span><span style=color:#9cabca>(</span><span style=color:#d27e99>1</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>add_one</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>times_two</span><span style=color:#9cabca>);</span><span style=color:#727169>        // => 4</span></span>
<span class=giallo-l><span style=color:#7aa89f>Promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>resolve</span><span style=color:#9cabca>(</span><span style=color:#d27e99>1</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> times_two</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>add_one</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#9cabca>)));</span><span style=color:#727169> // => 4</span></span></code></pre><p>To be fair, <code>Promise.then</code> behaves more like <code>Array.flatMap</code> than <code>Array.map</code> but we will ignore that.<p>Fine, we have <code>Array</code> and we have <code>Promise</code> both are containers of some sort and both have methods that follow the rules. But what if they didn't have those methods, what if <code>Array.map</code> didn't exist? Would that mean that <code>Array</code> is no longer a functor? Do we lose all the benefits?<p>Let's take a step back. If <code>Array.map</code> doesn't exists then <code>Array</code> is no longer a functor? I don't know, I'm not an FP lawyer. Do we lose all the benefits? No, we could still treat arrays as functors, we just lose the super convenient <code>.map</code> syntax. We can create our own <code>map</code> outside of the structure.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>const</span><span> List</span><span style=color:#e6c384> =</span><span style=color:#9cabca> {</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  map</span><span style=color:#9cabca>(</span><span>fn</span><span style=color:#9cabca>,</span><span> arr</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8>    let</span><span> result</span><span style=color:#e6c384> =</span><span style=color:#9cabca> [];</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    for</span><span style=color:#9cabca> (</span><span style=color:#957fb8>let</span><span> data</span><span style=color:#e6c384> of</span><span> arr</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span>      result</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>push</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>fn</span><span style=color:#9cabca>(</span><span>data</span><span style=color:#9cabca>));</span></span>
<span class=giallo-l><span style=color:#9cabca>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span> result</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l><span style=color:#9cabca>};</span></span></code></pre><p>See? Is not that bad. And it works.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// Identity rule</span></span>
<span class=giallo-l><span>List</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>identity</span><span style=color:#9cabca>, [</span><span style=color:#d27e99>1</span><span style=color:#9cabca>]);</span><span style=color:#727169> // => [1]</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Composition</span></span>
<span class=giallo-l><span>List</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>times_two</span><span style=color:#9cabca>,</span><span> List</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>add_one</span><span style=color:#9cabca>, [</span><span style=color:#d27e99>1</span><span style=color:#9cabca>]));</span><span style=color:#727169>   // => [4]</span></span>
<span class=giallo-l><span>List</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> times_two</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>add_one</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#9cabca>)), [</span><span style=color:#d27e99>1</span><span style=color:#9cabca>]);</span><span style=color:#727169> // => [4]</span></span></code></pre><p>Are you thinking what I'm thinking? Probably not. This is what I'm thinking, if we can map arrays without a <code>.map</code> then nothing can stop us from doing the same thing with plain objects, because after all, objects can also hold sets of values.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>const</span><span> Obj</span><span style=color:#e6c384> =</span><span style=color:#9cabca> {</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  map</span><span style=color:#9cabca>(</span><span>fn</span><span style=color:#9cabca>,</span><span> ob</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8>    let</span><span> result</span><span style=color:#e6c384> =</span><span style=color:#9cabca> {};</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    for</span><span style=color:#9cabca> (</span><span style=color:#957fb8>let</span><span style=color:#9cabca> [</span><span>key</span><span style=color:#9cabca>,</span><span> value</span><span style=color:#9cabca>]</span><span style=color:#e6c384> of</span><span> Object</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>entries</span><span style=color:#9cabca>(</span><span>ob</span><span style=color:#9cabca>)) {</span></span>
<span class=giallo-l><span>      result</span><span style=color:#9cabca>[</span><span>key</span><span style=color:#9cabca>]</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> fn</span><span style=color:#9cabca>(</span><span>value</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#9cabca>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span> result</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l><span style=color:#9cabca>};</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Why stop at `map`? </span></span>
<span class=giallo-l><span style=color:#727169>// Based on this you can also create a `filter` and `reduce`</span></span></code></pre><p>Let's see it.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// Identity rule</span></span>
<span class=giallo-l><span>Obj</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>identity</span><span style=color:#9cabca>, {</span><span>some</span><span style=color:#9cabca>:</span><span style=color:#d27e99> 1</span><span style=color:#9cabca>,</span><span> prop</span><span style=color:#9cabca>:</span><span style=color:#d27e99> 2</span><span style=color:#9cabca>});</span><span style=color:#727169> // => {some: 1, prop: 2}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Composition</span></span>
<span class=giallo-l><span>Obj</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>times_two</span><span style=color:#9cabca>,</span><span> Obj</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>add_one</span><span style=color:#9cabca>, {</span><span>some</span><span style=color:#9cabca>:</span><span style=color:#d27e99> 1</span><span style=color:#9cabca>,</span><span> prop</span><span style=color:#9cabca>:</span><span style=color:#d27e99> 2</span><span style=color:#9cabca>}));</span><span style=color:#727169> // => {some: 4, prop: 6}</span></span>
<span class=giallo-l><span>Obj</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> times_two</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>add_one</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#9cabca>)), {</span><span>some</span><span style=color:#9cabca>:</span><span style=color:#d27e99> 1</span><span style=color:#9cabca>,</span><span> prop</span><span style=color:#9cabca>:</span><span style=color:#d27e99> 2</span><span style=color:#9cabca>});</span><span style=color:#727169> // => {some: 4, prop: 6}</span></span></code></pre><h2 id=do-it-yourself>Do It Yourself</h2><p>All this talk about arrays and plain objects is useful but now I feel like we know enough to make our own functor, the rules seem to be very simple. Let's do something vaguely useful. Have you ever heard of Observables? Good, because we are going to something like that. We'll make a simpler version of <a rel="noopener external" href=https://mithril.js.org/stream.html target=_blank>mithril-stream</a>, it'll be fun.<p>The goal here to handle a stream of values over time. The API of our utility will be this.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// Set initial state</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> num_stream</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> Stream</span><span style=color:#9cabca>(</span><span style=color:#d27e99>0</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Create a dependent stream</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> increased</span><span style=color:#e6c384> =</span><span> num_stream</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>add_one</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Get the value from a stream</span></span>
<span class=giallo-l><span style=color:#7e9cd8>num_stream</span><span style=color:#9cabca>();</span><span style=color:#727169> // => 0</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Push a value to the stream</span></span>
<span class=giallo-l><span style=color:#7e9cd8>num_stream</span><span style=color:#9cabca>(</span><span style=color:#d27e99>42</span><span style=color:#9cabca>);</span><span style=color:#727169> // => 42</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// The source stream updates</span></span>
<span class=giallo-l><span style=color:#7e9cd8>num_stream</span><span style=color:#9cabca>();</span><span style=color:#727169> // => 42</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// The dependent stream also updates</span></span>
<span class=giallo-l><span style=color:#7e9cd8>increased</span><span style=color:#9cabca>();</span><span style=color:#727169> // => 43</span></span></code></pre><p>Let's start with the getter and setter function.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> Stream</span><span style=color:#9cabca>(</span><span>state</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8>  let</span><span style=color:#7e9cd8> stream</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>value</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#727169>    // If we get an argument we update the state</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    if</span><span style=color:#9cabca>(</span><span style=color:#ff5d62>arguments</span><span style=color:#9cabca>.</span><span>length</span><span style=color:#e6c384> ></span><span style=color:#d27e99> 0</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span>      state</span><span style=color:#e6c384> =</span><span> value</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    // return current state</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span> state</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> stream</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>This should work.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// Initial state</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> num_stream</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> Stream</span><span style=color:#9cabca>(</span><span style=color:#d27e99>42</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Get state</span></span>
<span class=giallo-l><span style=color:#7e9cd8>num_stream</span><span style=color:#9cabca>();</span><span style=color:#727169> // => 42</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Update</span></span>
<span class=giallo-l><span style=color:#7e9cd8>num_stream</span><span style=color:#9cabca>(</span><span style=color:#d27e99>73</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Check</span></span>
<span class=giallo-l><span style=color:#7e9cd8>num_stream</span><span style=color:#9cabca>();</span><span style=color:#727169> // => 73</span></span></code></pre><p>We know we want a <code>map</code> method but what is the effect we want? We want the callback to listen to the changes of the source stream. Let's start with the listener part, we want to store an array of listeners and execute each one right after the state changes.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=diff><span class=giallo-l><span>  function Stream(state) {</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a>   let listeners = [];</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span></span>
<span class=giallo-l><span>    let stream = function(value) {</span></span>
<span class=giallo-l><span>      if(arguments.length > 0) {</span></span>
<span class=giallo-l><span>        state = value;</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a>       listeners.forEach(fn => fn(value));</span></span>
<span class=giallo-l><span>      }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>      return state;</span></span>
<span class=giallo-l><span>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    return stream;</span></span>
<span class=giallo-l><span>  }</span></span></code></pre><p>Now we go for the <code>map</code> method, but is not going to be just any method, we need to follow the rules:<ul><li><p>Identity: When <code>map</code> is called it needs to preserve the shape of the structure. This means that we need to return a new stream.</p><li><p>Composition: Calling <code>map</code> multiple times must be equivalent of composing the callbacks supplied to those <code>map</code>s.</p></ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> Stream</span><span style=color:#9cabca>(</span><span>state</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8>  let</span><span> listeners</span><span style=color:#e6c384> =</span><span style=color:#9cabca> [];</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>  let</span><span style=color:#7e9cd8> stream</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>value</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    if</span><span style=color:#9cabca>(</span><span style=color:#ff5d62>arguments</span><span style=color:#9cabca>.</span><span>length</span><span style=color:#e6c384> ></span><span style=color:#d27e99> 0</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span>      state</span><span style=color:#e6c384> =</span><span> value</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span>      listeners</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>forEach</span><span style=color:#9cabca>(</span><span>fn</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> fn</span><span style=color:#9cabca>(</span><span>value</span><span style=color:#9cabca>));</span></span>
<span class=giallo-l><span style=color:#9cabca>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span> state</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  stream</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>fn</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#727169>    // Create new instance with transformed state.</span></span>
<span class=giallo-l><span style=color:#727169>    // This will execute the callback when calling `map`</span></span>
<span class=giallo-l><span style=color:#727169>    // this might not be what you want if you use a </span></span>
<span class=giallo-l><span style=color:#727169>    // function that has side effects. Just beware.</span></span>
<span class=giallo-l><span style=color:#957fb8>    let</span><span> target</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> Stream</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>fn</span><span style=color:#9cabca>(</span><span>state</span><span style=color:#9cabca>));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    // Transform the value and update stream</span></span>
<span class=giallo-l><span style=color:#957fb8>    const</span><span style=color:#7e9cd8> listener</span><span style=color:#e6c384> =</span><span> value</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> target</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>fn</span><span style=color:#9cabca>(</span><span>value</span><span style=color:#9cabca>));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    // Update the source listeners</span></span>
<span class=giallo-l><span>    listeners</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>push</span><span style=color:#9cabca>(</span><span>listener</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span> target</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> stream</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>Let's test the rules. We begin with identity.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// Streams are like a cascade</span></span>
<span class=giallo-l><span style=color:#727169>// the first is the most important</span></span>
<span class=giallo-l><span style=color:#727169>// this is the one that triggers all the listeners</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> num_stream</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> Stream</span><span style=color:#9cabca>(</span><span style=color:#d27e99>0</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Create dependent stream</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> identity_stream</span><span style=color:#e6c384> =</span><span> num_stream</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>identity</span><span style=color:#9cabca>);</span><span> </span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// update the source</span></span>
<span class=giallo-l><span style=color:#7e9cd8>num_stream</span><span style=color:#9cabca>(</span><span style=color:#d27e99>42</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Check</span></span>
<span class=giallo-l><span style=color:#7e9cd8>num_stream</span><span style=color:#9cabca>();</span><span style=color:#727169>      // => 42</span></span>
<span class=giallo-l><span style=color:#7e9cd8>identity_stream</span><span style=color:#9cabca>();</span><span style=color:#727169> // => 42</span></span></code></pre><p>Now let's check the composition rule.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// Create source stream</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> num_stream</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> Stream</span><span style=color:#9cabca>(</span><span style=color:#d27e99>0</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Create dependents</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> map_stream</span><span style=color:#e6c384> =</span><span> num_stream</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>add_one</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>times_two</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> composed_stream</span><span style=color:#e6c384> =</span><span> num_stream</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> times_two</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>add_one</span><span style=color:#9cabca>(</span><span>num</span><span style=color:#9cabca>)));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Update source</span></span>
<span class=giallo-l><span style=color:#7e9cd8>num_stream</span><span style=color:#9cabca>(</span><span style=color:#d27e99>1</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// Check</span></span>
<span class=giallo-l><span style=color:#7e9cd8>map_stream</span><span style=color:#9cabca>();</span><span style=color:#727169>      // => 4</span></span>
<span class=giallo-l><span style=color:#7e9cd8>composed_stream</span><span style=color:#9cabca>();</span><span style=color:#727169> // => 4</span></span></code></pre><p>Our job is done. But is this any useful? Can you do something with it? Well yes, you could use it in event handlers to manipulate user input. Like this.<p data-pen-title="an fmap example" style="box-sizing:border-box;border:2px solid;justify-content:center;align-items:center;height:600px;margin:1em 0;padding:1em;display:flex" class=codepen data-default-tab=js,result data-height=600 data-preview=true data-slug-hash=dyoMJRw data-theme-id=dark data-user=VonHeikemen><span> See the Pen <a href=https://codepen.io/VonHeikemen/pen/dyoMJRw>an fmap example</a> by Heiker (<a href=https://codepen.io/VonHeikemen>@VonHeikemen</a>) on <a href=https://codepen.io>CodePen</a>. </span></p><script async src=https://static.codepen.io/assets/embed/ei.js></script><h3 id=more-examples>More examples</h3><p>I think by now you understand really well what functors do, but if you still want to see more examples you can check out this articles.<ul><li><a href=https://vonheikemen.github.io/devlog/web-development/learn-fp/using-a-maybe/>Handling the absence of a value</a><li><a rel="noopener external" href=https://jrsinclair.com/articles/2018/how-to-deal-with-dirty-side-effects-in-your-pure-functional-javascript/ target=_blank>Handling side effects</a></ul><h2 id=conclusion>Conclusion</h2><p>The only question that remains is "what is the benefit of using functors?"<p>I'll do my best here:<ul><li><p>This pattern allows you to focus on one problem at time. The <code>map</code> function handles how you get the data and in the callback you can focus only on processing the data.</p><li><p>Reusability. This style of programming really encourage the creation of single purpose function that a lot of the times can become useful even across projects.</p><li><p>Extensibility through composition. People have mixed feelings about this one, specially if we are talking about arrays. This is another thing that functors encourage, that is using chains of functions to implement a procedure.</p></ul><h2 id=sources>Sources</h2><ul><li><a rel="noopener external" href=https://dev.to/techgirl1908/why-is-map-called-map-2l03 target=_blank>Why is map called map?</a><li><a rel="noopener external" href=https://github.com/fantasyland/fantasy-land target=_blank>Fantasy land</a><li><a rel="noopener external" href=https://github.com/fantasyland/static-land target=_blank>Static land</a><li><a rel="noopener external" href=https://github.com/thefrontside/funcadelic.js target=_blank>funcadelic.js</a><li><a rel="noopener external" href=https://jrsinclair.com/articles/2018/how-to-deal-with-dirty-side-effects-in-your-pure-functional-javascript/ target=_blank>How to deal with dirty side effects in your pure functional JavaScript</a><li><a rel="noopener external" href=https://jrsinclair.com/articles/2020/whats-more-fantastic-than-fantasy-land-static-land/ target=_blank>What’s more fantastic than fantasy land? An Introduction to Static land</a><li><a rel="noopener external" href=https://medium.com/@lettier/your-easy-guide-to-monads-applicatives-functors-862048d61610 target=_blank>Your easy guide to Monads, Applicatives, & Functors</a></ul><hr><p>Have any question? Feel free to leave a comment in one of these platform where I have shared this:<ul><li><a href=https://dev.to/vonheikemen/functional-programming-for-your-everyday-javascript-the-power-of-map-4n9m rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/the-power-of-map rel=noopener target=_blank>Hashnode</a></ul><p>You can reach out to me on social media:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Bluesky <a rel="noopener me" href=https://bsky.app/profile/vonheikemen.bsky.social target=_blank> @vonheikemen.bsky.social </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Thank you for reading. If you find this article useful and want to support my efforts, buy me a coffee ☕</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>