<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  How an applicative functor can help us validate forms | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="javascript, functional-programming, software, coding, development" name=keywords><meta content="Validating a form 'functional style'" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/tags/>Explore tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/>Devlog en español</a></ul> © 2020-2024 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>How an applicative functor can help us validate forms</h1><span class=post-date>2021-10-03 | 8 min read | <a href=https://vonheikemen.github.io/devlog/es/web-development/applicative-functors-and-form-validation/> Leer en español </a> </span><p>We will 'play' with applicative functors. To be more specific we will use it to validate some user input that comes from a form.<p>If you don't know what's an applicative maybe you want like summary or something... it ain't going happen. Still haven't found a way to explain them without telling you a bunch of stuff you won't need.<p>If you really, really want to know more about applicatives I recommend reading at least one of these.<ul><li><a href=https://vonheikemen.github.io/devlog/web-development/learn-fp/the-power-of-map/>Speaking of functors.</a><li><a href=https://vonheikemen.github.io/devlog/web-development/learn-fp/applicative-functors/>Have you met applicative functors?</a><li><a href=https://vonheikemen.github.io/devlog/web-development/tagged-unions-and-fantasy-land/>Exploring Fantasy Land.</a></ul><p>For now I'll tell you with an example one of the problems we can solve using applicatives.<h2 id=imagine>Imagine</h2><p>Imagine a situation like this: you have some value and a regular function, you want to apply the function to the value.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>value </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>1</span><span style=color:#5fb3b3>;
</span><span style=color:#c594c5>const </span><span style=color:#6699cc>fn </span><span style=color:#5fb3b3>= (</span><span style=color:#f99157>x</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span>x </span><span style=color:#5fb3b3>+ </span><span style=color:#f99157>1</span><span style=color:#5fb3b3>;
</span></code></pre><p>The solution is quite simple.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#6699cc>fn</span><span>(value)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// => 2
</span></code></pre><p>All good. No need for fancy stuff. But now let's say <code>value</code> and <code>fn</code> are both "trapped" inside a data structure (could be anything).<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>Value </span><span style=color:#5fb3b3>= </span><span>[</span><span style=color:#f99157>1</span><span>]</span><span style=color:#5fb3b3>;
</span><span style=color:#c594c5>const </span><span>Fn </span><span style=color:#5fb3b3>= </span><span>[</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>x</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span>x </span><span style=color:#5fb3b3>+ </span><span style=color:#f99157>1</span><span>]</span><span style=color:#5fb3b3>;
</span></code></pre><p>So we have things inside arrays. Okay. But what happens if we want to apply the function? How do we proceed? Like this?<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span>[Fn[</span><span style=color:#f99157>0</span><span>](Value[</span><span style=color:#f99157>0</span><span>])]</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// => [2]
</span></code></pre><p>Oh, that can't be right. In an ideal world we could do something like this.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span>Value</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>ap</span><span>(Fn)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// => [2]
</span></code></pre><p>What we want to treat this apply operation like another method in our structure.<p>The bad news is that we don't live in a world where arrays can do that. The good news is we can implement <code>.ap</code> ourselves.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>List </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#6699cc>ap</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>Fn</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>Value</span><span style=color:#5fb3b3>) {
</span><span>    </span><span style=color:#c594c5>return </span><span>Value</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>flatMap</span><span>(</span><span style=color:#f99157>x </span><span style=color:#c594c5>=> </span><span>Fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>map</span><span>(</span><span style=color:#f99157>f </span><span style=color:#c594c5>=> </span><span style=color:#6699cc>f</span><span>(x)))</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>};
</span></code></pre><p>With this little helper we can solve our problem.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>Value </span><span style=color:#5fb3b3>= </span><span>[</span><span style=color:#f99157>1</span><span>]</span><span style=color:#5fb3b3>;
</span><span style=color:#c594c5>const </span><span>Fn </span><span style=color:#5fb3b3>= </span><span>[</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>x</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span>x </span><span style=color:#5fb3b3>+ </span><span style=color:#f99157>1</span><span>]</span><span style=color:#5fb3b3>;
</span><span>
</span><span>List</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>ap</span><span>(Fn</span><span style=color:#5fb3b3>, </span><span>Value)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// => [2]
</span></code></pre><h2 id=the-next-step>The next step</h2><p>Let's put our attention in another structure: objects.<p>Imagine the same situation but this time the things we want to use are inside an object with the same "shape".<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>Value </span><span style=color:#5fb3b3>= {</span><span>email</span><span style=color:#5fb3b3>: '</span><span style=color:#99c794>this@example.com</span><span style=color:#5fb3b3>'};
</span><span style=color:#c594c5>const </span><span>Fn </span><span style=color:#5fb3b3>= {</span><span style=color:#6699cc>email</span><span style=color:#5fb3b3>: (</span><span style=color:#f99157>input</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span>input</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>includes</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>@</span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>};
</span></code></pre><p>What do we do? We'll take the value from one key and applied to the function with that same key.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>Obj </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#6699cc>ap</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>Fn</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>Data</span><span style=color:#5fb3b3>) {
</span><span>    </span><span style=color:#c594c5>const </span><span>result </span><span style=color:#5fb3b3>= {};
</span><span>    </span><span style=color:#c594c5>for</span><span>(</span><span style=color:#c594c5>let </span><span>key </span><span style=color:#5fb3b3>in </span><span>Data) </span><span style=color:#5fb3b3>{
</span><span>      result[key] </span><span style=color:#5fb3b3>= </span><span>Fn[key](Data[key])</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>
</span><span>    </span><span style=color:#c594c5>return </span><span>result</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>And now we test.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>Value </span><span style=color:#5fb3b3>= {</span><span>email</span><span style=color:#5fb3b3>: '</span><span style=color:#99c794>this@example.com</span><span style=color:#5fb3b3>'};
</span><span style=color:#c594c5>const </span><span>Fn </span><span style=color:#5fb3b3>= {</span><span style=color:#6699cc>email</span><span style=color:#5fb3b3>: (</span><span style=color:#f99157>input</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span>input</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>includes</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>@</span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>};
</span><span>
</span><span>Obj</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>ap</span><span>(Fn</span><span style=color:#5fb3b3>, </span><span>Value)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// => {email: true}
</span></code></pre><h2 id=let-s-compose>Let's compose</h2><p>We are making some good progress. We can apply one validation, but do you think that's enough? Probably not. There is a good chance we need to tell the user what they did wrong. Also, it would be a nice if we could apply more than one validation.<p>I want a list of pairs. Each pair will have a function and a message. Something like this.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span>[
</span><span>  [long_enough</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Come on, try again.</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>,
</span><span>  [is_email</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Totally not an email.</span><span style=color:#5fb3b3>'</span><span>]
</span><span>]
</span></code></pre><p>If the function returns <code>false</code> then message will be added to an array. Simple, right? Let's just turn that idea into a function.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>validate</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>validations</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>input</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>const </span><span>error </span><span style=color:#5fb3b3>= </span><span>[]</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>for</span><span>(</span><span style=color:#c594c5>let </span><span style=color:#5fb3b3>[</span><span>validation</span><span style=color:#5fb3b3>, </span><span>msg</span><span style=color:#5fb3b3>] of </span><span>validations) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>const </span><span>is_valid </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>validation</span><span>(input)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>    </span><span style=color:#c594c5>if</span><span>(</span><span style=color:#5fb3b3>!</span><span>is_valid) </span><span style=color:#5fb3b3>{
</span><span>      error</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>push</span><span>(msg)</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>  </span><span style=color:#5fb3b3>}
</span><span>
</span><span>  </span><span style=color:#c594c5>return </span><span>error</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Notice the <code>input</code> is the last parameter, that's because I want partially apply the function. Basically, I want to "bind" the <code>validations</code> parameter to a value without executing the function. For this I'll just use <code>Function.bind</code>.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span>validate</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bind</span><span>(</span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, </span><span>[
</span><span>  [long_enough</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Come on, try again.</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>,
</span><span>  [is_email</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Totally not an email.</span><span style=color:#5fb3b3>'</span><span>]
</span><span>])</span><span style=color:#5fb3b3>;
</span></code></pre><p>There are other ways to achieve this effect but I like <code>.bind</code>.<p>Anyway, now let's create the validation that we want to use.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>long_enough</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>input</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span>input</span><span style=color:#5fb3b3>.</span><span>length </span><span style=color:#5fb3b3>>= </span><span style=color:#f99157>2</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>is_email</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>input</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span>input</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>includes</span><span>(</span><span style=color:#5fb3b3>"</span><span style=color:#99c794>@</span><span style=color:#5fb3b3>"</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>no_numbers</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>input</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>!</span><span>(</span><span style=color:#5fb3b3>/\d/.</span><span style=color:#6699cc>test</span><span>(input))</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Now we can put everything together to make a test.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>input </span><span style=color:#5fb3b3>= {
</span><span>  name</span><span style=color:#5fb3b3>: '</span><span style=color:#99c794>1</span><span style=color:#5fb3b3>',
</span><span>  email</span><span style=color:#5fb3b3>: '</span><span style=color:#99c794>a</span><span style=color:#5fb3b3>'
</span><span style=color:#5fb3b3>};
</span><span>
</span><span style=color:#c594c5>const </span><span>validations </span><span style=color:#5fb3b3>= {
</span><span>  name</span><span style=color:#5fb3b3>: </span><span>validate</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bind</span><span>(</span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, </span><span>[
</span><span>    [long_enough</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Come on, try again.</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>,
</span><span>    [no_numbers</span><span style=color:#5fb3b3>, "</span><span style=color:#99c794>Don't get smart. No numbers.</span><span style=color:#5fb3b3>"</span><span>]
</span><span>  ])</span><span style=color:#5fb3b3>,
</span><span>  email</span><span style=color:#5fb3b3>: </span><span>validate</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bind</span><span>(</span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, </span><span>[
</span><span>    [long_enough</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Am I a joke to you?</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>,
</span><span>    [is_email</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Totally not an email.</span><span style=color:#5fb3b3>'</span><span>]
</span><span>  ])
</span><span style=color:#5fb3b3>};
</span><span>
</span><span>Obj</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>ap</span><span>(validations</span><span style=color:#5fb3b3>, </span><span>input)</span><span style=color:#5fb3b3>;
</span></code></pre><p><code>Obj.ap</code> should return this.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5fb3b3>{
</span><span>  name</span><span style=color:#5fb3b3>: </span><span>[
</span><span>    </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>Come on, try again.</span><span style=color:#5fb3b3>",
</span><span>    </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>Don't get smart. No numbers.</span><span style=color:#5fb3b3>"
</span><span>  ]</span><span style=color:#5fb3b3>,
</span><span>  email</span><span style=color:#5fb3b3>: </span><span>[
</span><span>    </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>Am I a joke to you?</span><span style=color:#5fb3b3>",
</span><span>    </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>Totally not an email.</span><span style=color:#5fb3b3>"
</span><span>  ]
</span><span style=color:#5fb3b3>}
</span></code></pre><p>If we want to check if the form is actually valid we would have to check if any of the keys has an error message.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>is_valid</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>form_errors</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>const </span><span style=color:#6699cc>is_empty </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>msg </span><span style=color:#c594c5>=> </span><span style=color:#5fb3b3>!</span><span>msg</span><span style=color:#5fb3b3>.</span><span>length</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#fac863>Object</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>values</span><span>(form_errors)</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>every</span><span>(is_empty)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#6699cc>is_valid</span><span>(Obj</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>ap</span><span>(validations</span><span style=color:#5fb3b3>, </span><span>input))</span><span style=color:#5fb3b3>;
</span></code></pre><p>After this all we need to do is show the error messages (if there are any) to the user. This part of the process will be very different depending on the thing you're building. I can't really show you an example that is generic and good enough for everyone. What I can do is make this imaginary scenerio a little bit more specific.<h2 id=a-register-form>A register form</h2><p>Let's assume each field in our form looks like this in our html.<pre class=language-html data-lang=html style=background:#2b2c2f;color:#cccece><code class=language-html data-lang=html><span style=color:#5fb3b3><</span><span style=color:#eb606b>div </span><span style=color:#bb80b3>class</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>field</span><span style=color:#5fb3b3>">
</span><span>  </span><span style=color:#5fb3b3><</span><span style=color:#eb606b>label </span><span style=color:#bb80b3>class</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>label</span><span style=color:#5fb3b3>"></span><span>Name of field:</span><span style=color:#5fb3b3>&LT/</span><span style=color:#eb606b>label</span><span style=color:#5fb3b3>>
</span><span>  </span><span style=color:#5fb3b3><</span><span style=color:#eb606b>div </span><span style=color:#bb80b3>class</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>control</span><span style=color:#5fb3b3>">
</span><span>    </span><span style=color:#5fb3b3><</span><span style=color:#eb606b>input </span><span style=color:#bb80b3>name</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>field-name</span><span style=color:#5fb3b3>" </span><span style=color:#bb80b3>class</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>input</span><span style=color:#5fb3b3>" </span><span style=color:#bb80b3>type</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>text</span><span style=color:#5fb3b3>">
</span><span>  </span><span style=color:#5fb3b3>&LT/</span><span style=color:#eb606b>div</span><span style=color:#5fb3b3>>
</span><span>  </span><span style=color:#5fb3b3><</span><span style=color:#eb606b>ul </span><span style=color:#bb80b3>data-errors</span><span style=color:#5fb3b3>="</span><span style=color:#99c794>field-name</span><span style=color:#5fb3b3>">&LT/</span><span style=color:#eb606b>ul</span><span style=color:#5fb3b3>>
</span><span style=color:#5fb3b3>&LT/</span><span style=color:#eb606b>div</span><span style=color:#5fb3b3>>
</span></code></pre><p>When the input fails the validation we want to show the list of messages in the <code>ul</code> element.<p>Let's start with something basic, add a listener to the <code>submit</code> event in the form.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>submit</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#6699cc>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>preventDefault</span><span>()</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span>
</span><span style=color:#6699cc>document</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>forms</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>namedItem</span><span>(</span><span style=color:#5fb3b3>"</span><span style=color:#99c794>myform</span><span style=color:#5fb3b3>"</span><span>)
</span><span>  </span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>addEventListener</span><span>(</span><span style=color:#5fb3b3>"</span><span style=color:#99c794>submit</span><span style=color:#5fb3b3>", </span><span>submit)</span><span style=color:#5fb3b3>;
</span></code></pre><p>Now we gather the data from the user. This time around we need more than just the input, we'll also need the name of the field. So our objects are going to be a bit more complex.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>collect_data</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>form</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>const </span><span>result </span><span style=color:#5fb3b3>= {};
</span><span>  </span><span style=color:#c594c5>const </span><span>formdata </span><span style=color:#5fb3b3>= new </span><span>FormData(form)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#c594c5>for </span><span>(</span><span style=color:#c594c5>let </span><span>entry </span><span style=color:#5fb3b3>of </span><span>formdata</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>entries</span><span>()) </span><span style=color:#5fb3b3>{
</span><span>    result[entry[</span><span style=color:#f99157>0</span><span>]] </span><span style=color:#5fb3b3>= {
</span><span>      field</span><span style=color:#5fb3b3>: </span><span>entry[</span><span style=color:#f99157>0</span><span>]</span><span style=color:#5fb3b3>,
</span><span>      value</span><span style=color:#5fb3b3>: </span><span>entry[</span><span style=color:#f99157>1</span><span>]</span><span style=color:#5fb3b3>,
</span><span>    </span><span style=color:#5fb3b3>};
</span><span>  </span><span style=color:#5fb3b3>}
</span><span>
</span><span>  </span><span style=color:#c594c5>return </span><span>result</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>We add it to the <code>submit</code> function.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>submit</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#6699cc>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>preventDefault</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#c594c5>const </span><span>input </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>collect_data</span><span>(</span><span style=color:#ec5f67>this</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#fac863>console</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>log</span><span>(input)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>At this point we need to apply the validations but the current version of <code>validate</code> will not be enough. Now we need to handle an object instead of a plain string.<pre class=language-diff data-lang=diff style=background:#2b2c2f;color:#cccece><code class=language-diff data-lang=diff><span style=color:#5fb3b3>-</span><span style=color:#ec5f67> function validate(validations, input) {
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>   const error = [];
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794> function validate(validations, field) {
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>   const result = {...field};
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>   result.errors = [];
</span><span>
</span><span>    for(let [validation, msg] of validations) {
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>     const is_valid = validation(input);
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>     result.is_valid = validation(field.value);
</span><span>
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>     if(!is_valid) {
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>       error.push(msg);
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>     if(!result.is_valid) {
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>       result.errors.push(msg);
</span><span>      }
</span><span>    }
</span><span>
</span><span style=color:#5fb3b3>-</span><span style=color:#ec5f67>   return error;
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>   return result;
</span><span>  }
</span></code></pre><p>So now we pass <code>field.value</code> to the validation. And also instead of returning an array, we return an object with this shape.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#5fb3b3>{
</span><span>  field</span><span style=color:#5fb3b3>: </span><span style=color:#fac863>String</span><span style=color:#5fb3b3>,
</span><span>  value</span><span style=color:#5fb3b3>: </span><span style=color:#fac863>String</span><span style=color:#5fb3b3>,
</span><span>  is_valid</span><span style=color:#5fb3b3>: </span><span style=color:#fac863>Boolean</span><span style=color:#5fb3b3>,
</span><span>  errors</span><span style=color:#5fb3b3>: </span><span style=color:#fac863>Array
</span><span style=color:#5fb3b3>}
</span></code></pre><p>We do this because we'll need all this extra data after the validation process.<p>Just like before, let's pretend we're just validating a name and an email. We'll use the same functions as before with our new <code>validate</code>.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>submit</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#6699cc>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>preventDefault</span><span>()</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>const </span><span>input </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>collect_data</span><span>(</span><span style=color:#ec5f67>this</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#c594c5>const </span><span>validations </span><span style=color:#5fb3b3>= {
</span><span>    name</span><span style=color:#5fb3b3>: </span><span>validate</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bind</span><span>(</span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, </span><span>[
</span><span>      [long_enough</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Come on, try again.</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>,
</span><span>      [no_numbers</span><span style=color:#5fb3b3>, "</span><span style=color:#99c794>Don't get smart. No numbers.</span><span style=color:#5fb3b3>"</span><span>]
</span><span>    ])</span><span style=color:#5fb3b3>,
</span><span>    email</span><span style=color:#5fb3b3>: </span><span>validate</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bind</span><span>(</span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, </span><span>[
</span><span>      [long_enough</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Am I a joke to you?</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>,
</span><span>      [is_email</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Totally not an email.</span><span style=color:#5fb3b3>'</span><span>]
</span><span>    ])
</span><span>  </span><span style=color:#5fb3b3>};
</span><span>
</span><span>  </span><span style=color:#c594c5>const </span><span>formdata </span><span style=color:#5fb3b3>= </span><span>Obj</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>ap</span><span>(validations</span><span style=color:#5fb3b3>, </span><span>input)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#fac863>console</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>log</span><span>(formdata)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>But you know what? I want to do something funny. I want to take <code>validations</code> out of there. I'll be turning that into a function using <code>Obj.ap.bind</code>.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>const </span><span>validate_form </span><span style=color:#5fb3b3>= </span><span>Obj</span><span style=color:#5fb3b3>.</span><span>ap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bind</span><span>(</span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, {
</span><span>  name</span><span style=color:#5fb3b3>: </span><span>validate</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bind</span><span>(</span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, </span><span>[
</span><span>    [long_enough</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Come on, try again.</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>,
</span><span>    [no_numbers</span><span style=color:#5fb3b3>, "</span><span style=color:#99c794>Don't get smart. No numbers.</span><span style=color:#5fb3b3>"</span><span>]
</span><span>  ])</span><span style=color:#5fb3b3>,
</span><span>  email</span><span style=color:#5fb3b3>: </span><span>validate</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bind</span><span>(</span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, </span><span>[
</span><span>    [long_enough</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Am I a joke to you?</span><span style=color:#5fb3b3>'</span><span>]</span><span style=color:#5fb3b3>,
</span><span>    [is_email</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>Totally not an email.</span><span style=color:#5fb3b3>'</span><span>]
</span><span>  ])
</span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span></code></pre><p>With this our function <code>submit</code> can be a little bit more declarative.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>submit</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#6699cc>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>preventDefault</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#c594c5>const </span><span>input </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>collect_data</span><span>(</span><span style=color:#ec5f67>this</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>const </span><span>formdata </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>validate_form</span><span>(input)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#fac863>console</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>log</span><span>(formdata)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>With validations out of the way, we need to check if the form is actually valid. To do this we will check if <code>.is_valid</code> is <code>true</code> in every field. If the form is valid we want to send the data somewhere, else we would show the error messages.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>is_valid</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>formdata</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#fac863>Object</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>values</span><span>(formdata)</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>every</span><span>(</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>field</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=> </span><span>field</span><span style=color:#5fb3b3>.</span><span>is_valid)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#6699cc>submit</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#6699cc>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>preventDefault</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#c594c5>const </span><span>input </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>collect_data</span><span>(</span><span style=color:#ec5f67>this</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>const </span><span>formdata </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>validate_form</span><span>(input)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#c594c5>if</span><span>(</span><span style=color:#6699cc>is_valid</span><span>(formdata)) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#6699cc>send_data</span><span>(input)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>} </span><span style=color:#c594c5>else </span><span style=color:#5fb3b3>{
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// show errors
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>In this last step we'll show each error message in an <code>li</code> element inside the <code>ul</code> of each field.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>show_errors</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>input</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>const </span><span>el </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>document</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>querySelector</span><span>(</span><span style=color:#5fb3b3>`</span><span style=color:#99c794>[data-errors=</span><span style=color:#5fb3b3>${</span><span>input</span><span style=color:#5fb3b3>.</span><span>field</span><span style=color:#5fb3b3>}</span><span style=color:#99c794>]</span><span style=color:#5fb3b3>`</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  el</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>replaceChildren</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#c594c5>for </span><span>(</span><span style=color:#c594c5>let </span><span>msg </span><span style=color:#5fb3b3>of </span><span>input</span><span style=color:#5fb3b3>.</span><span>errors) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>const </span><span>li </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>document</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>createElement</span><span>(</span><span style=color:#5fb3b3>'</span><span style=color:#99c794>li</span><span style=color:#5fb3b3>'</span><span>)</span><span style=color:#5fb3b3>;
</span><span>    li</span><span style=color:#5fb3b3>.</span><span>textContent </span><span style=color:#5fb3b3>= </span><span>msg</span><span style=color:#5fb3b3>;
</span><span>    el</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>appendChild</span><span>(li)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>But wait... one last thing. We can't have an applicative without a <code>map</code> function. Let's fix that.<pre class=language-diff data-lang=diff style=background:#2b2c2f;color:#cccece><code class=language-diff data-lang=diff><span>  const Obj = {
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>   map(fn, data) {
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>     const result = {};
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>     for (let key in data) {
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>       result[key] = fn(data[key]);
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>     }
</span><span style=color:#5fb3b3>+
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>     return result;
</span><span style=color:#5fb3b3>+</span><span style=color:#99c794>   },
</span><span>    ap(Fn, Data) {
</span><span>      const result = {};
</span><span>      for (let key in Data) {
</span><span>        result[key] = Fn[key](Data[key]);
</span><span>      }
</span><span>
</span><span>      return result;
</span><span>    }
</span><span>  };
</span></code></pre><p>Now I feel better. We'll use this new function to show the messages.<pre class=language-js data-lang=js style=background:#2b2c2f;color:#cccece><code class=language-js data-lang=js><span style=color:#c594c5>function </span><span style=color:#6699cc>submit</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#6699cc>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>preventDefault</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#c594c5>const </span><span>input </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>collect_data</span><span>(</span><span style=color:#ec5f67>this</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>const </span><span>formdata </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>validate_form</span><span>(input)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>  </span><span style=color:#c594c5>if</span><span>(</span><span style=color:#6699cc>is_valid</span><span>(formdata)) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#6699cc>send_data</span><span>(input)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>} </span><span style=color:#c594c5>else </span><span style=color:#5fb3b3>{
</span><span>    Obj</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>map</span><span>(show_errors</span><span style=color:#5fb3b3>, </span><span>formdata)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Yes, I know, I should be using a regular <code>for</code> loop because "side effects". We are done, let's not fight over details here.<p>To prove this stuff works I have this wonderful codepen example with a semi-functional form.<p data-pen-title="Applicative functors and form validation" style="height:600px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;border:2px solid;margin:1em 0;padding:1em" class=codepen data-default-tab=js,result data-height=600 data-preview=true data-slug-hash=PojjGpM data-theme-id=dark data-user=VonHeikemen><span> See the Pen <a href=https://codepen.io/VonHeikemen/pen/PojjGpM>Applicative functors and form validation</a> by Heiker (<a href=https://codepen.io/VonHeikemen>@VonHeikemen</a>) on <a href=https://codepen.io>CodePen</a>. </span></p><script async src=https://static.codepen.io/assets/embed/ei.js></script><h2 id=conclusion>Conclusion</h2><p>We took a brief look at the <code>.ap</code> method we find in applicative functors. We learned that in javascript there is no such thing so we have to implement it ourselves. Finally we used our new found knowledge to validate a simple input.<hr><p>If you have a question you can reach out to me on social media:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Thank you for reading. If you find this article useful and want to support my efforts, buy me a coffee ☕</p><a href=https://www.buymeacoffee.com/vonheikemen style=display:flex;justify-content:center target=_blank> <img alt="Buy Me A Coffee" src=https://cdn.buymeacoffee.com/buttons/v2/default-blue.png style=height:60px!important;width:217px!important> </a></div></div>