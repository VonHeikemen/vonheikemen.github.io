<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Want to use env variables in that config file? Well, you can... kind of | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://vonheikemen.github.io/devlog/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="shell, todayilearned, software, coding, development" name=keywords><meta content="Meet the envsubst command" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/tags/>Explore tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/>Devlog en español</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2024 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Want to use env variables in that config file? Well, you can... kind of</h1><span class=post-date>2021-10-20 | 3 min read | <a href=https://vonheikemen.github.io/devlog/es/tools/embed-env-variables-in-any-config-file/> Leer en español </a> </span><p>Imagine there is a tool you want to install in every OS you manage and that tool needs a configuration file. There is a good chance a piece of information in that file needs to change according to the type of OS you're using, or maybe it changes according to the context (whether is a personal computer or a workstation... stuff like that). So you always need to make some tweaks to this config. Wouldn't be great if you could use some variables? It turns out you can... kind of.<h2 id=meet-the-envsubst-command>Meet the envsubst command</h2><p>With <code>envsubst</code> we can embed the value of environment variables inside a string that comes from the <strong>standard input</strong>.<p>We can try it out. In the terminal we can do something like this.<pre class=language-sh data-lang=sh style=color:#cccece;background-color:#2b2c2f><code class=language-sh data-lang=sh><span style=color:#69c>echo </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>there is no place like $HOME</span><span style=color:#5fb3b3>' | </span><span style=color:#69c>envsubst
</span></code></pre><p>If you are using linux you should get this message.<pre style=color:#cccece;background-color:#2b2c2f><code><span>there is no place like /home/user
</span></code></pre><p>So what I'm trying to say is we can cheat. We can use <code>envsubst</code> like a preprocessor to create our config files based on some template.<h2 id=real-world-example>Real world example</h2><p>In my case <code>envsubst</code> solved a bit of a problem I had with <code>npm</code>. In my home folder I have an <code>.npmrc</code> file with the following structure.<pre style=color:#cccece;background-color:#2b2c2f><code><span>prefix=&LTsome-path>
</span><span>ignore-scripts=true
</span><span>
</span><span>init-author=&LTsome-name> (&LTsome-link>)
</span><span>init-license=MIT
</span></code></pre><p>As you might have guessed some of these fields can change according to the OS or context. But now that I know about <code>envsubst</code> I can have a template in <code>~/templates/npmrc</code> and use that as a base for every other machine.<p>So how do I do? First thing is the template.<pre style=color:#cccece;background-color:#2b2c2f><code><span>prefix=$XDG_CONFIG_HOME/npm/packages
</span><span>ignore-scripts=true
</span><span>
</span><span>init-author=$USER_NAME ($CONTACT_LINK)
</span><span>init-license=MIT
</span></code></pre><p>This is good enough.<p>I always like to test things, so next thing is try showing the result on the terminal.<pre class=language-sh data-lang=sh style=color:#cccece;background-color:#2b2c2f><code class=language-sh data-lang=sh><span style=color:#69c>envsubst </span><span style=color:#5fb3b3>< </span><span style=color:#ec5f67>~</span><span style=color:#69c>/templates/npmrc
</span></code></pre><p>When we use <code><</code> we are telling our shell we want to take the content of that file and send it to <code>envsubst</code> using the standard input. This is known as a file redirection. So, if all our environment variables are set <code>envsubst</code> should show this.<pre style=color:#cccece;background-color:#2b2c2f><code><span>prefix=/home/user/.config/npm/packages
</span><span>ignore-scripts=true
</span><span>
</span><span>init-author=Heiker (https://github.com/VonHeikemen)
</span><span>init-license=MIT
</span></code></pre><p>Now to really make this work we need to redirect this thing to <code>~/.npmrc</code>.<pre class=language-sh data-lang=sh style=color:#cccece;background-color:#2b2c2f><code class=language-sh data-lang=sh><span style=color:#69c>envsubst </span><span style=color:#5fb3b3>< </span><span style=color:#ec5f67>~</span><span style=color:#69c>/templates/npmrc </span><span style=color:#5fb3b3>> </span><span style=color:#ec5f67>~</span><span style=color:#69c>/.npmrc
</span></code></pre><p>Technically we are done but since we are here let's explore another posibility.<p>I already showed you that our template can come from any command, the only requirement to keep in mind is we need to get the content from the standard input.<p>So, if we get creative we could put our template in any server (like say github), download it using <code>curl</code> and pass that content to <code>envsubst</code>.<pre class=language-sh data-lang=sh style=color:#cccece;background-color:#2b2c2f><code class=language-sh data-lang=sh><span style=color:#69c>curl</span><span style=color:#5fb3b3> -</span><span style=color:#f99157>s </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>https://raw.githubusercontent.com/&LTuser>/&LTrepo>/main/npmrc</span><span style=color:#5fb3b3>" \
</span><span>  </span><span style=color:#5fb3b3>| </span><span style=color:#69c>envsubst </span><span style=color:#5fb3b3>> </span><span style=color:#ec5f67>~</span><span style=color:#69c>/.npmrc
</span></code></pre><p>This works like charm. It means we don't even need the template to live in our local environment.<h2 id=a-cross-platform-alternative>A cross-platform alternative</h2><p>One last thing. If you're using linux you probably have this tool in your system. In case you don't, you could try and get this version which was written using <code>go</code>.<ul><li><a href=https://github.com/a8m/envsubst rel=noopener target=_blank>github.com/a8m/envsubst</a></ul><p>In their <a href=https://github.com/a8m/envsubst/releases rel=noopener target=_blank>release page</a> they have prebuilt binaries for windows, mac and linux.<h2 id=conclusion>Conclusion</h2><p>We learned about <code>envsubst</code> and how we can use it to create a config file based on a template. We learned <code>envsubst</code> needs to take the content of the template from the standard input, this opens the posibility for us to get what we need from other files or commands. Lastly, we saw how we can use file redirections to take final result into the config file we want.<h2 id=source>Source</h2><ul><li><a href=https://www.mankier.com/1/envsubst rel=noopener target=_blank>man envsubst</a></ul><hr><p>If you have a question you can reach out to me on social media:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Bluesky <a rel="noopener me" href=https://bsky.app/profile/vonheikemen.bsky.social target=_blank> @vonheikemen.bsky.social </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Thank you for reading. If you find this article useful and want to support my efforts, buy me a coffee ☕</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>