<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  The illusion of fast startup times in vim | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://vonheikemen.github.io/devlog/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="vim, neovim, shell, software, coding, development" name=keywords><meta content="Speed up vim's startup times with this one weird 'trick'" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/tags/>Explore tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/>Devlog en español</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2026 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>The illusion of fast startup times in vim</h1><span class=post-date>2021-08-22 | 4 min read | <a href=https://vonheikemen.github.io/devlog/es/tools/the-illusion-of-fast-startup-times-in-vim/> Leer en español </a> </span><p>With an emphasis on the word "Illusion". What I'm going to show you is not a "magic trick" that will make vim go faster. Don't get your hopes up. The only thing we'll do here is delay the inevitable.<h2 id=what-do-we-want-to-achieve>What do we want to achieve?</h2><p>I want to load my optional plugins after vim interface is fully loaded and ready to go.<h2 id=why>Why?</h2><p>Because when I open vim there is a little timeframe of maybe 2 or 3 seconds where my mind goes from "what was I going to do?" to "Yeah, that thing". That's when I want to load the plugins. This way we only the deal with necessary stuff at startup, and then rest of the "nice to have" can happen in this timeframe where <strong>I</strong> am not doing anything in the editor.<h2 id=let-s-get-to-it>Let's get to it</h2><p>In vim we have an <a rel="noopener external" href=https://vimhelp.org/autocmd.txt.html#autocmd-events target=_blank>event</a> called <code>VimEnter</code>, it gets emitted when is done executing all the initial scripts and plugins. In theory this should be enough, but not for me, I really want to be sure. So what I'd like to do is wait 20 miliseconds after this event is dispatched, it should be enough time for vim to load the interface, and then load the plugins.<p>For this we will need an autocommand and the <code>timer_start</code> function. So let's make a test.We'll print a message 5 seconds after vim has started. We'll put this in our <code>.vimrc</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>function</span><span style=color:#e6c384>!</span><span style=color:#7e9cd8> s:load_plugins</span><span style=color:#9cabca>(</span><span>t</span><span style=color:#9cabca>)</span><span> abort</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  echom</span><span style=color:#98bb6c> "vim is ready"</span></span>
<span class=giallo-l><span>endfunction</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>augroup</span><span> user_cmds</span></span>
<span class=giallo-l><span>  autocmd</span><span style=color:#e6c384>!</span></span>
<span class=giallo-l><span>  autocmd</span><span style=color:#7aa89f> VimEnter</span><span> * call</span><span style=color:#7e9cd8> timer_start</span><span style=color:#9cabca>(</span><span style=color:#d27e99>5000</span><span style=color:#9cabca>,</span><span style=color:#7e9cd8> function</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'s:load_plugins'</span><span style=color:#9cabca>))</span></span>
<span class=giallo-l><span style=color:#957fb8>augroup</span><span> END</span></span></code></pre><p>Next time we open vim we should see the message <code>vim is ready</code>, after a few seconds. If you missed it you can check with command <code>:messages</code>.<p>Now we know it works. Change the delay time from <code>5000</code> to <code>20</code>. And in <code>s:load_plugins</code> put all the necessary commands to load your plugins.<p>This next part will depend a lot on how you manage your plugins. I'm going to use a built-in feature known as <a rel="noopener external" href=https://vimhelp.org/repeat.txt.html#packages target=_blank>packages</a>. Some plugins managers don't use it, so make sure it does by reading the docs.<p>The last piece of the puzzle is the <code>packadd</code> command, is what we'll use to load all our "optional plugins". So our function should be something like this.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>function</span><span style=color:#e6c384>!</span><span style=color:#7e9cd8> s:load_plugins</span><span style=color:#9cabca>(</span><span>t</span><span style=color:#9cabca>)</span><span> abort</span></span>
<span class=giallo-l><span style=color:#727169>  " list of plugins</span></span>
<span class=giallo-l><span>  packadd vim-surround</span></span>
<span class=giallo-l><span>  packadd vim-obsession</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>  "(optional) run all the scripts in the `after` folder</span></span>
<span class=giallo-l><span>  runtime</span><span style=color:#e6c384>!</span><span> OPT after</span><span style=color:#c0a36e>/plugin/</span><span>*.vim</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>  "(optional) emit a user 'event'</span></span>
<span class=giallo-l><span style=color:#727169>  " so we can call other autocommands in this moment</span></span>
<span class=giallo-l><span>  doautocmd </span><span style=color:#7aa89f>User</span><span> PluginsLoaded</span></span>
<span class=giallo-l><span>endfunction</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>augroup</span><span> user_cmds</span></span>
<span class=giallo-l><span>  autocmd</span><span style=color:#e6c384>!</span></span>
<span class=giallo-l><span>  autocmd</span><span style=color:#7aa89f> VimEnter</span><span> * call</span><span style=color:#7e9cd8> timer_start</span><span style=color:#9cabca>(</span><span style=color:#d27e99>20</span><span style=color:#9cabca>,</span><span style=color:#7e9cd8> function</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'s:load_plugins'</span><span style=color:#9cabca>))</span></span>
<span class=giallo-l><span style=color:#957fb8>augroup</span><span> END</span></span></code></pre><p>That's it. But I'm not done.<h2 id=what-about-lua>What about lua?</h2><p>Neovim (version 0.5) makes it possible to write our config file entirely in lua, and a lot of people are doing just that. It's possible to write this in your lua config, but the current limitations of the API will force you to write a lot of vimscript.<p>Here is what you'll need to do in lua.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> load_plugins</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>  vim.</span><span style=color:#7e9cd8>cmd</span><span style=color:#98bb6c> [[</span></span>
<span class=giallo-l><span style=color:#98bb6c>    packadd vim-surround</span></span>
<span class=giallo-l><span style=color:#98bb6c>    packadd vim-obsession</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#98bb6c>    runtime! OPT after/plugin/*.vim</span></span>
<span class=giallo-l><span style=color:#98bb6c>    doautocmd User PluginsLoaded</span></span>
<span class=giallo-l><span style=color:#98bb6c>  ]]</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.</span><span style=color:#7e9cd8>cmd</span><span style=color:#98bb6c> [[</span></span>
<span class=giallo-l><span style=color:#98bb6c>  augroup user_cmds</span></span>
<span class=giallo-l><span style=color:#98bb6c>    autocmd!</span></span>
<span class=giallo-l><span style=color:#98bb6c>    autocmd VimEnter * lua vim.defer_fn(load_plugins, 20)</span></span>
<span class=giallo-l><span style=color:#98bb6c>  augroup END</span></span>
<span class=giallo-l><span style=color:#98bb6c>]]</span></span></code></pre><p>I'm using a global function just because is the easiest way to write it. In general I advice against it. If you know how to create and use a lua module, use that instead.<h2 id=fair-warning>Fair warning</h2><p>You should consider what plugins you're going to load using this method.<p>Let's take <code>NERDTree</code> (a file manager) as an example. If you open up a folder in the terminal, something like <code>vim .</code>, <code>NERDTree</code> can show you the files in the folder automatically. But that specific feature will not work if you load it after <code>VimEnter</code>.<p>Syntax plugins can also be affected by this. If you load them late in the process you might actually see when the default colors change to the ones declared by the plugin. Is not a nice experience.<h2 id=conclusion>Conclusion</h2><p>We learned about <code>VimEnter</code>, an event that vim emits when the startup process is done. We learned about <code>timer_start</code> and <code>vim.defer_fn</code>, how we can use them to execute a function at a later time. Finally, we pieced together all of this to load all optional plugins in a specific moment when we as users are not interacting with the editor.<p>But we should also be careful with this. Loading a plugin outside the startup process can have unexpected side effects. So we should first decide what plugins can be optional.<h2 id=sources>Sources</h2><ul><li><a rel="noopener external" href=https://vimhelp.org/eval.txt.html#timers target=_blank>:help timers</a><li><a rel="noopener external" href=https://vimhelp.org/autocmd.txt.html#%3Adoautocmd target=_blank>:help :doautocmd</a><li><a rel="noopener external" href=https://vimhelp.org/autocmd.txt.html#User target=_blank>:help User</a><li><a rel="noopener external" href=https://vimhelp.org/repeat.txt.html#%3Apackadd target=_blank>:help :packadd</a><li><a rel="noopener external" href=https://vimhelp.org/repeat.txt.html#%3Aruntime target=_blank>:help :runtime</a><li><a rel="noopener external" href=https://neovim.io/doc/user/lua.html#vim.defer_fn() target=_blank>:help vim.defer_fn</a></ul><hr><p>Have any question? Feel free to leave a comment in one of these platform where I have shared this:<ul><li><a href=https://dev.to/vonheikemen/the-illusion-of-fast-startup-times-in-vim-bfo rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/the-illusion-of-fast-startup-times-in-vim rel=noopener target=_blank>Hashnode</a></ul><p>You can reach out to me on social media:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Bluesky <a rel="noopener me" href=https://bsky.app/profile/vonheikemen.bsky.social target=_blank> @vonheikemen.bsky.social </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Thank you for reading. If you find this article useful and want to support my efforts, buy me a coffee ☕</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>