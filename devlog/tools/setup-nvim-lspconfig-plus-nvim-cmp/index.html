<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Setup nvim-lspconfig + nvim-cmp | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://vonheikemen.github.io/devlog/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="vim, neovim, shell, software, coding, development" name=keywords><meta content="Let's configure Neovim's builtin LSP client with nvim-lspconfig and nvim-cmp" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/tags/>Explore tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/>Devlog en espaÃ±ol</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> Â© 2020-2026 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Setup nvim-lspconfig + nvim-cmp</h1><span class=post-date>2022-05-23 | 9 min read | <a href=https://vonheikemen.github.io/devlog/es/tools/setup-nvim-lspconfig-plus-nvim-cmp/> Leer en espaÃ±ol </a> </span><blockquote>Last updated: 2024-10-05</blockquote><p>Neovim includes a lua framework that allows the editor to communicate with a language server. What does that mean for us? Means we can have some IDE-like features such as rename variables, smart jump to definition, list references, etc. But of course we need to configure all of this first.<h2 id=wait-why-do-we-need-all-these-plugins>Wait, why do we need all these plugins?</h2><p>Out of the box Neovim offers the tools to start and query a language server but it doesn't have any opinion on how we should use them. Enter <a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig target=_blank>nvim-lspconfig</a>, with it Neovim can scan the "root directory" of a project and choose which language server you configured should be initialiazed.<p>And then we have <a rel="noopener external" href=https://github.com/hrsh7th/nvim-cmp target=_blank>nvim-cmp</a>, the autocompletion plugin. I think the completions provided by Neovim are good enough but the thing is it requires a fair amount of manual intervention. Modern code editors have all this automated in a way that feels more intuitive, this is what nvim-cmp offers. We can have that smart autocompletion in Neovim.<p>Now you know the why, let's move on to the how.<h2 id=requirements>Requirements</h2><ul><li>Neovim v0.8 or greater is recommended. v0.7 can work too, with a few tweaks.<li>An LSP server.<li>Install <a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig target=_blank>nvim-lspconfig</a>.<li>Install plugins for autocompletion: <ul><li><a rel="noopener external" href=https://github.com/hrsh7th/nvim-cmp target=_blank>nvim-cmp</a><li><a rel="noopener external" href=https://github.com/hrsh7th/cmp-buffer target=_blank>cmp-buffer</a><li><a rel="noopener external" href=https://github.com/hrsh7th/cmp-path target=_blank>cmp-path</a><li><a rel="noopener external" href=https://github.com/saadparwaiz1/cmp_luasnip target=_blank>cmp_luasnip</a><li><a rel="noopener external" href=https://github.com/hrsh7th/cmp-nvim-lsp target=_blank>cmp-nvim-lsp</a><li><a rel="noopener external" href=https://github.com/L3MON4D3/LuaSnip target=_blank>LuaSnip</a><li><a rel="noopener external" href=https://github.com/rafamadriz/friendly-snippets target=_blank>friendly-snippets</a></ul></ul><p>In <code>nvim-lspconfig</code> documentation you'll find instructions to install the language servers it supports: <a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig/blob/master/doc/configs.md target=_blank>configs.md</a><h2 id=lsp-config>LSP Config</h2><p>What we need to do here is use the module <code>lspconfig</code> and call the <code>.setup()</code> of the language server we want to configure.<p>How do we know which language servers are supported? lspconfig's documentation has the answer. You can find the list of valid names using <code>:help lspconfig-all</code>.<p>For the language <code>lua</code> we can use a server called <code>lua_ls</code>. Install it and then call it in your config like this.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local lspconfig</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'lspconfig'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>lspconfig.lua_ls.</span><span style=color:#7e9cd8>setup</span><span>({})</span></span></code></pre><p>There is one thing you need to keep in mind. We are going to use nvim-cmp to handle the autocompletion. So, we have to modify an option called <code>capabilities</code> in every language server we use. This option tells the language server the features Neovim supports.<p>We are going to tell the language server what features nvim-cmp adds to Neovim. For this we call the module <code>cmp_nvim_lsp</code> and get the default capabilities.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local lsp_capabilities</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp_nvim_lsp'</span><span>).</span><span style=color:#7e9cd8>default_capabilities</span><span>()</span></span></code></pre><p>Once we have this new variable <code>lsp_capabilities</code> we can add it to our setup.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local lspconfig</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'lspconfig'</span><span>)</span></span>
<span class=giallo-l><span>local lsp_capabilities</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp_nvim_lsp'</span><span>).</span><span style=color:#7e9cd8>default_capabilities</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>lspconfig.lua_ls.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l><span>  capabilities</span><span style=color:#e6c384> =</span><span> lsp_capabilities,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>If want to know the available options in <code>.setup()</code> checkout the help page using <code>:help lspconfig-setup</code>.<p>At this point to take advantage of some "LSP features" we need to create some keybindings. Neovim will emit the event <code>LspAttach</code> each time a language server is attached to a buffer, this will give us the opportunity to create our keybindings. Here is an example.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'LspAttach'</span><span>, {</span></span>
<span class=giallo-l><span>  desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'LSP actions'</span><span>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  callback</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>    local</span><span style=color:#7e9cd8> bufmap</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>mode</span><span style=color:#9cabca>,</span><span> lhs</span><span style=color:#9cabca>,</span><span> rhs</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      local opts</span><span style=color:#e6c384> =</span><span> {buffer</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>}</span></span>
<span class=giallo-l><span>      vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(mode, lhs, rhs, opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Displays hover information about the symbol under the cursor</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'K'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.hover()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Jump to the definition</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gd'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.definition()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Jump to declaration</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gD'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.declaration()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Lists all the implementations for the symbol under the cursor</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gi'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.implementation()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Jumps to the definition of the type symbol</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'go'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.type_definition()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Lists all the references </span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gr'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.references()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Displays a function's signature information</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gs'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.signature_help()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Renames all references to the symbol under the cursor</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;F2>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.rename()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Selects a code action available at the current cursor position</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;F4>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.code_action()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Show diagnostics in a floating window</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gl'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.open_float()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Move to the previous diagnostic</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'[d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.goto_prev()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Move to the next diagnostic</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>']d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.goto_next()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>This autocommand can live anywhere in our configuration. And if we wanted to, we could write it in vimscript (I'm not doing that here).<blockquote><p>Note: if you are using Neovim v0.7.2 or lower you'll need to create a function and add it to the <code>on_attach</code> option of each language server. See <code>:help lspconfig-keybindings</code> for an example.</blockquote><p>So, here is the complete code to configure one language server using <code>lspconfig</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local lspconfig</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'lspconfig'</span><span>)</span></span>
<span class=giallo-l><span>local lsp_capabilities</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp_nvim_lsp'</span><span>).</span><span style=color:#7e9cd8>default_capabilities</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>lspconfig.lua_ls.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l><span>  capabilities</span><span style=color:#e6c384> =</span><span> lsp_capabilities,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h2 id=snippets>Snippets</h2><p>This is a good time to configure our snippet engine. The next bit is not related to language servers, LSP or whatever. We are just going to load the snippets we have installed.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'luasnip.loaders.from_vscode'</span><span>).</span><span style=color:#7e9cd8>lazy_load</span><span>()</span></span></code></pre><p>The <code>.lazy_load()</code> function will load any snippet we have in our <code>runtimepath</code>. And by that I mean the ones available in <code>friendly-snippets</code>.<h2 id=autocompletion>Autocompletion</h2><p>Before we start, <code>nvim-cmp</code>'s documentation says we should set <code>completeopt</code> with the following values:<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.opt.completeopt</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'menuone'</span><span>, </span><span style=color:#98bb6c>'noselect'</span><span>}</span></span></code></pre><p>To configure nvim-cmp we will use two modules <code>cmp</code> and <code>luasnip</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local cmp</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp'</span><span>)</span></span>
<span class=giallo-l><span>local luasnip</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'luasnip'</span><span>)</span></span></code></pre><p><code>cmp</code> is the one we will use to configure <code>nvim-cmp</code>. And this <code>luansnip</code>? Well, nvim-cmp doesn't "know" how to expand a snippet, that's why we need it.<p>We are going to spend some time exploring nvim-cmp's options. I want to explain all the things I do in my personal configuration. For now let's just add the setup function.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local select_opts</span><span style=color:#e6c384> =</span><span> {behavior</span><span style=color:#e6c384> =</span><span> cmp.SelectBehavior.Select}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>cmp.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>})</span></span></code></pre><h3 id=snippet-expand>snippet.expand</h3><p>Callback function, it receives data from a snippet. This is where <code>nvim-cmp</code> expect us to provide a thing that can expand snippets, and we do that with <code>luasnip.lsp_expand</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>snippet</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  expand</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>args</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    luasnip.</span><span style=color:#7e9cd8>lsp_expand</span><span>(args.body)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span>},</span></span></code></pre><h3 id=sources>sources</h3><p>Here we can list all the data sources nvim-cmp will use to populate the completion list.<p>Each "source" is a lua table that must have a <code>name</code> property. That <code>name</code> is not the name of the plugin, it's the "id" the plugin used when creating the source. Each source should tell what name they have in their documentation.<p>Other properties you should be aware of are <code>priority</code> and <code>keyword_length</code>. <code>priority</code> allows nvim-cmp to sort the completion list. If you do not set a <code>priority</code> then the order of the sources will determine the priority. Now with <code>keyword_length</code> you can control how many characters are necesary to begin querying the source.<p>In my personal configuration I have the sources setup this way.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>sources</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'path'</span><span>},</span></span>
<span class=giallo-l><span>  {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'nvim_lsp'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 1</span><span>},</span></span>
<span class=giallo-l><span>  {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'buffer'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 3</span><span>},</span></span>
<span class=giallo-l><span>  {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'luasnip'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 2</span><span>},</span></span>
<span class=giallo-l><span>},</span></span></code></pre><ul><li><code>path</code>: Autocomplete file paths.<li><code>nvim_lsp</code>: Shows suggestions based on the response of a language server.<li><code>buffer</code>: Suggests words found in the current buffer.<li><code>luasnip</code>: Shows available snippets and expands them if they are chosen.</ul><h3 id=window-documentation>window.documentation</h3><p>Controls the appearance and settings for the documentation window. To configure this quickly nvim-cmp offers a preset we can use to add some borders.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>window</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  documentation</span><span style=color:#e6c384> =</span><span> cmp.config.window.</span><span style=color:#7e9cd8>bordered</span><span>()</span></span>
<span class=giallo-l><span>},</span></span></code></pre><h3 id=formatting-fields>formatting.fields</h3><p>List of strings that determines the order of the elements in an item.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>formatting</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  fields</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'abbr'</span><span>, </span><span style=color:#98bb6c>'kind'</span><span>}</span></span>
<span class=giallo-l><span>},</span></span></code></pre><p><code>abbr</code> is the content of the suggestion. <code>kind</code> is the type of data, this can be text, class, function, etc. Finally, <code>menu</code> which apparently is empty by default.<h3 id=formatting-format>formatting.format</h3><p>Callback function that allows us to customize the appearance of the completion menu. A simple example I can show: assign an icon to a field based on the source name.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>formatting</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  fields</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'abbr'</span><span>, </span><span style=color:#98bb6c>'kind'</span><span>},</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  format</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>entry</span><span style=color:#9cabca>,</span><span> item</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    local menu_icon</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>      nvim_lsp</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Î»'</span><span>,</span></span>
<span class=giallo-l><span>      luasnip</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'â‹—'</span><span>,</span></span>
<span class=giallo-l><span>      buffer</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Î©'</span><span>,</span></span>
<span class=giallo-l><span>      path</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'ðŸ–«'</span><span>,</span></span>
<span class=giallo-l><span>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    item.menu</span><span style=color:#e6c384> =</span><span> menu_icon[entry.source.name]</span></span>
<span class=giallo-l><span style=color:#957fb8>    return</span><span> item</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span><span>,</span></span>
<span class=giallo-l><span>},</span></span></code></pre><h3 id=mapping>mapping</h3><p>List of keybindings. For this we need to declare a list of key/value pairs. Where the value is a function of the <code>cmp</code> module. Like this.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>mapping</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  [</span><span style=color:#98bb6c>'&lt;CR>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>}),</span></span>
<span class=giallo-l><span>}</span></span></code></pre><p>In this example <code>['&lt;CR>']</code> is the key/shortcut we want to bind. The function on the other side of the assignment is the action we want to execute.<p>Here is a list of common keybindings:<ul><li>Move between completion items.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;Up>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts),</span></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;Down>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-p>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts),</span></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-n>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts),</span></span></code></pre><ul><li>Scroll text in the documentation window.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-u>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>scroll_docs</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>4</span><span>),</span></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-d>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>scroll_docs</span><span>(</span><span style=color:#d27e99>4</span><span>),</span></span></code></pre><ul><li>Cancel completion.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-e>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>abort</span><span>(),</span></span></code></pre><ul><li>Confirm selection.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-y>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>}),</span></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;CR>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>}),</span></span></code></pre><ul><li>Jump to the next placeholder in the snippet.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-f>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> luasnip.</span><span style=color:#7e9cd8>jumpable</span><span>(</span><span style=color:#d27e99>1</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>    luasnip.</span><span style=color:#7e9cd8>jump</span><span>(</span><span style=color:#d27e99>1</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span></code></pre><ul><li>Jump to the previous placeholder in the snippet.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-b>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> luasnip.</span><span style=color:#7e9cd8>jumpable</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>1</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>    luasnip.</span><span style=color:#7e9cd8>jump</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>1</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span></code></pre><ul><li>Autocomplete with tab.</ul><p>If the completion menu is visible, move to the next item. If the line is "empty", insert a <code>Tab</code> character. If the cursor is inside a word, trigger the completion menu.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;Tab>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>  local col</span><span style=color:#e6c384> =</span><span> vim.fn.</span><span style=color:#7e9cd8>col</span><span>(</span><span style=color:#98bb6c>'.'</span><span>) </span><span style=color:#e6c384>-</span><span style=color:#d27e99> 1</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> cmp.</span><span style=color:#7e9cd8>visible</span><span>() </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>    cmp.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>  elseif</span><span> col</span><span style=color:#e6c384> ==</span><span style=color:#d27e99> 0</span><span style=color:#e6c384> or</span><span> vim.fn.</span><span style=color:#7e9cd8>getline</span><span>(</span><span style=color:#98bb6c>'.'</span><span>):</span><span style=color:#7e9cd8>sub</span><span>(col, col):</span><span style=color:#7e9cd8>match</span><span>(</span><span style=color:#98bb6c>'%s'</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  else</span></span>
<span class=giallo-l><span>    cmp.</span><span style=color:#7e9cd8>complete</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span></code></pre><ul><li>If the completion menu is visible, move to the previous item.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;S-Tab>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> cmp.</span><span style=color:#7e9cd8>visible</span><span>() </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>    cmp.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>  else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span></code></pre><h3 id=complete-cmp-config>Complete cmp config</h3><p>Here is the entire configuration for <code>nvim-cmp</code> and <code>luansnip</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.opt.completeopt</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'menuone'</span><span>, </span><span style=color:#98bb6c>'noselect'</span><span>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'luasnip.loaders.from_vscode'</span><span>).</span><span style=color:#7e9cd8>lazy_load</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local cmp</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp'</span><span>)</span></span>
<span class=giallo-l><span>local luasnip</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'luasnip'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local select_opts</span><span style=color:#e6c384> =</span><span> {behavior</span><span style=color:#e6c384> =</span><span> cmp.SelectBehavior.Select}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>cmp.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l><span>  snippet</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    expand</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>args</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      luasnip.</span><span style=color:#7e9cd8>lsp_expand</span><span>(args.body)</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>  sources</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'path'</span><span>},</span></span>
<span class=giallo-l><span>    {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'nvim_lsp'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 1</span><span>},</span></span>
<span class=giallo-l><span>    {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'buffer'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 3</span><span>},</span></span>
<span class=giallo-l><span>    {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'luasnip'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 2</span><span>},</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>  window</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    documentation</span><span style=color:#e6c384> =</span><span> cmp.config.window.</span><span style=color:#7e9cd8>bordered</span><span>()</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>  formatting</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    fields</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'abbr'</span><span>, </span><span style=color:#98bb6c>'kind'</span><span>},</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    format</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>entry</span><span style=color:#9cabca>,</span><span> item</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      local menu_icon</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>        nvim_lsp</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Î»'</span><span>,</span></span>
<span class=giallo-l><span>        luasnip</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'â‹—'</span><span>,</span></span>
<span class=giallo-l><span>        buffer</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Î©'</span><span>,</span></span>
<span class=giallo-l><span>        path</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'ðŸ–«'</span><span>,</span></span>
<span class=giallo-l><span>      }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>      item.menu</span><span style=color:#e6c384> =</span><span> menu_icon[entry.source.name]</span></span>
<span class=giallo-l><span style=color:#957fb8>      return</span><span> item</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>,</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>  mapping</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;Up>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;Down>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-p>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-n>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-u>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>scroll_docs</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>4</span><span>),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-d>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>scroll_docs</span><span>(</span><span style=color:#d27e99>4</span><span>),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-e>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>abort</span><span>(),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-y>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>}),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;CR>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>}),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-f>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      if</span><span> luasnip.</span><span style=color:#7e9cd8>jumpable</span><span>(</span><span style=color:#d27e99>1</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>        luasnip.</span><span style=color:#7e9cd8>jump</span><span>(</span><span style=color:#d27e99>1</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>        fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      end</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-b>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      if</span><span> luasnip.</span><span style=color:#7e9cd8>jumpable</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>1</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>        luasnip.</span><span style=color:#7e9cd8>jump</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>1</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>        fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      end</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;Tab>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      local col</span><span style=color:#e6c384> =</span><span> vim.fn.</span><span style=color:#7e9cd8>col</span><span>(</span><span style=color:#98bb6c>'.'</span><span>) </span><span style=color:#e6c384>-</span><span style=color:#d27e99> 1</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>      if</span><span> cmp.</span><span style=color:#7e9cd8>visible</span><span>() </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>        cmp.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>      elseif</span><span> col</span><span style=color:#e6c384> ==</span><span style=color:#d27e99> 0</span><span style=color:#e6c384> or</span><span> vim.fn.</span><span style=color:#7e9cd8>getline</span><span>(</span><span style=color:#98bb6c>'.'</span><span>):</span><span style=color:#7e9cd8>sub</span><span>(col, col):</span><span style=color:#7e9cd8>match</span><span>(</span><span style=color:#98bb6c>'%s'</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span style=color:#7e9cd8>        fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      else</span></span>
<span class=giallo-l><span>        cmp.</span><span style=color:#7e9cd8>complete</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      end</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;S-Tab>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      if</span><span> cmp.</span><span style=color:#7e9cd8>visible</span><span>() </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>        cmp.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>      else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>        fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      end</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h2 id=bonus-content>Bonus content</h2><p>Technically we are ready. All the code shown so far should get us a functional setup. We can now use our language servers and autocompletion. But there are still a couple of customizations we can make.<h3 id=change-diagnostic-icons>Change diagnostic icons</h3><p>We do this using a function called <code>sign_define</code>. Keep in mind this is not a lua function, it's vimscript. We access it using the prefix <code>vim.fn</code>. To know the details of this function check the documentation: <code>:help sign_define</code>.<p>Anyway, this is the code you'll need to change the sign icons.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local</span><span style=color:#7e9cd8> sign</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>opts</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>  vim.fn.</span><span style=color:#7e9cd8>sign_define</span><span>(opts.name, {</span></span>
<span class=giallo-l><span>    texthl</span><span style=color:#e6c384> =</span><span> opts.name,</span></span>
<span class=giallo-l><span>    text</span><span style=color:#e6c384> =</span><span> opts.text,</span></span>
<span class=giallo-l><span>    numhl</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> ''</span></span>
<span class=giallo-l><span>  })</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#7e9cd8>sign</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignError'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'âœ˜'</span><span>})</span></span>
<span class=giallo-l><span style=color:#7e9cd8>sign</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignWarn'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'â–²'</span><span>})</span></span>
<span class=giallo-l><span style=color:#7e9cd8>sign</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignHint'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'âš‘'</span><span>})</span></span>
<span class=giallo-l><span style=color:#7e9cd8>sign</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignInfo'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Â»'</span><span>})</span></span></code></pre><h3 id=diagnostics-config>Diagnostics config</h3><p>This time we must use the <code>vim.diagnostic</code> module, specifically the <code>.config()</code> function. It takes a lua table as an argument, and these are the defaults.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>{</span></span>
<span class=giallo-l><span>  virtual_text</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>  signs</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>  update_in_insert</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>  underline</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>  severity_sort</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>  float</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>}</span></span></code></pre><ul><li><p><code>virtual_text</code>: Show diagnostic message using virtual text.</p><li><p><code>signs</code>: Show a sign next to the line with a diagnostic.</p><li><p><code>update_in_insert</code>: Update diagnostics while editing in insert mode.</p><li><p><code>underline</code>: Use an underline to show a diagnostic location.</p><li><p><code>severity_sort</code>: Order diagnostics by severity.</p><li><p><code>float</code>: Show diagnostic messages in floating windows.</p></ul><p>Each one of these option can be either a boolean or a lua table. You can find more details about them in the documentation: <code>:help vim.diagnostic.config()</code>.<p>I prefer less distracting diagnostics. This is the setup I use.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.diagnostic.</span><span style=color:#7e9cd8>config</span><span>({</span></span>
<span class=giallo-l><span>  virtual_text</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>  severity_sort</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>  float</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    border</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'rounded'</span><span>,</span></span>
<span class=giallo-l><span>    source</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'always'</span><span>,</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h3 id=help-windows-with-borders>Help windows with borders</h3><p>There are two LSP methods that use floating windows: <code>vim.lsp.buf.hover()</code> and <code>vim.lsp.buf.signature_help()</code>. By default these windows don't have any style, but we can change that by modifying the associated "handler" of each method. To achieve this we need to use <code>vim.lsp.with()</code>.<p>I don't want to bore you with the details so let me just show you the code.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.lsp.handlers[</span><span style=color:#98bb6c>'textDocument/hover'</span><span>] </span><span style=color:#e6c384>=</span><span> vim.lsp.</span><span style=color:#7e9cd8>with</span><span>(</span></span>
<span class=giallo-l><span>  vim.lsp.handlers.hover,</span></span>
<span class=giallo-l><span>  {border</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'rounded'</span><span>}</span></span>
<span class=giallo-l><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.lsp.handlers[</span><span style=color:#98bb6c>'textDocument/signatureHelp'</span><span>] </span><span style=color:#e6c384>=</span><span> vim.lsp.</span><span style=color:#7e9cd8>with</span><span>(</span></span>
<span class=giallo-l><span>  vim.lsp.handlers.signature_help,</span></span>
<span class=giallo-l><span>  {border</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'rounded'</span><span>}</span></span>
<span class=giallo-l><span>)</span></span></code></pre><h3 id=install-language-servers-locally>Install language servers "locally"</h3><p>Sooner or later you are going to find out about this plugin: <a rel="noopener external" href=https://github.com/williamboman/mason.nvim target=_blank>mason.nvim</a>. With it you can manage your language servers using Neovim. You'll be able to install, update and remove language server.<p>But the servers you install using this method will not be available globally. They are installed in the "data folder" of Neovim. Now, some servers work fine in this setup others require extra configurations so it's recommended that you add <a rel="noopener external" href=https://github.com/williamboman/mason-lspconfig.nvim target=_blank>mason-lspconfig</a>.<p>Once you have both plugins you should setup mason.nvim using these functions.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'mason'</span><span>).</span><span style=color:#7e9cd8>setup</span><span>()</span></span>
<span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'mason-lspconfig'</span><span>).</span><span style=color:#7e9cd8>setup</span><span>()</span></span></code></pre><p>After doing that you should use <code>lspconfig</code> like you usually do. Pretend mason.nvim doesn't even exists.<p>Here is an example usage.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'mason'</span><span>).</span><span style=color:#7e9cd8>setup</span><span>()</span></span>
<span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'mason-lspconfig'</span><span>).</span><span style=color:#7e9cd8>setup</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local lspconfig</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'lspconfig'</span><span>)</span></span>
<span class=giallo-l><span>local lsp_capabilities</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp_nvim_lsp'</span><span>).</span><span style=color:#7e9cd8>default_capabilities</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>lspconfig.lua_ls.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l><span>  capabilities</span><span style=color:#e6c384> =</span><span> lsp_capabilities,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>Right now this is all I have to say about <code>mason.nvim</code>. If you want to know more about it you'll have read their documentation.<h2 id=conclusion>Conclusion</h2><p>We've learned the things <code>nvim-lspconfig</code> can do for us. We figure out how to make a global config for our servers. We setup a handful of LSP functions in our keybindings. Basically, we know everything we need to take advantage of the cool features a language server can provide.<p>We had the chance to assemble a configuration for <code>nvim-cmp</code> from scratch. We explored some common options step by step.<p>Finally, we made some additional customizations to diagnostics. Learned a little something about configuring LSP handlers, specifically the ones using floating windows. And we took a brief look at a method to install language servers locally.<p>You can find all the configuration code here: <a rel="noopener external" href=https://gist.github.com/VonHeikemen/8fc2aa6da030757a5612393d0ae060bd target=_blank>nvim-lspconfig + nvim-cmp</a>.<p>And here you can find a fully functional Neovim setup: <a rel="noopener external" href=https://github.com/VonHeikemen/nvim-starter/tree/03-lsp target=_blank>nvim-starter - branch: 03-lsp</a>.<h2 id=sources-1>Sources</h2><ul><li><a rel="noopener external" href=https://neovim.io/doc/user/lsp.html target=_blank>:help lsp.txt</a><li><a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig/blob/9e6bcf5a8915e8423d5cc7f82c5069c11272184d/doc/lspconfig.txt#L240 target=_blank>:help lspconfig-global-defaults</a><li><a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig/blob/9e6bcf5a8915e8423d5cc7f82c5069c11272184d/doc/lspconfig.txt#L481 target=_blank>:help lspconfig-keybindings</a><li><a rel="noopener external" href=https://github.com/hrsh7th/nvim-cmp/blob/6e1e3865158f340d6cd3936937eb56947b5a90f9/doc/cmp.txt#L360 target=_blank>:help cmp-config</a><li><a rel="noopener external" href=https://github.com/hrsh7th/nvim-cmp/blob/6e1e3865158f340d6cd3936937eb56947b5a90f9/doc/cmp.txt#L227 target=_blank>:help cmp-mapping</a><li><a rel="noopener external" href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.config() target=_blank>:help vim.diagnostic.config()</a></ul><hr><p>Have any question? Feel free to leave a comment in one of these platform where I have shared this:<ul><li><a href=https://dev.to/vonheikemen/neovim-lsp-setup-nvim-lspconfig-nvim-cmp-4k8e rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/setup-nvim-lspconfig-nvim-cmp rel=noopener target=_blank>Hashnode</a></ul><p>You can reach out to me on social media:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Bluesky <a rel="noopener me" href=https://bsky.app/profile/vonheikemen.bsky.social target=_blank> @vonheikemen.bsky.social </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Thank you for reading. If you find this article useful and want to support my efforts, buy me a coffee â˜•</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>