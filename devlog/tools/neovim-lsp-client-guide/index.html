<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  A guide on Neovim's LSP client | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://vonheikemen.github.io/devlog/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="neovim, shell, software, coding, development" name=keywords><meta content="Enable IDE-like features in Neovim without installing any additional plugins" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/tags/>Explore tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/>Devlog en español</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2024 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>A guide on Neovim's LSP client</h1><span class=post-date>2023-12-25 | 23 min read | <a href=https://vonheikemen.github.io/devlog/es/tools/neovim-lsp-client-guide/> Leer en español </a> </span><blockquote>Last updated: 2024-10-05</blockquote><p>Maybe I should have called this "How to enable IDE-like features without third party plugins." Sounds interesting, right? That's basically what I want to show you here.<p>We don't need any third party plugins, but we do need this:<ol><li>Neovim v0.8 or greater.<li>A language server.<li>Patience/Energy to write some lua code for each language server.</ol><p>If you want to implement any of this stuff in your own configuration, consider dedicating a little bit of time to learn the basics of lua. Here are a couple of links to help you with that:<ul><li><a href="https://www.youtube.com/watch?v=NneB6GX1Els" rel=noopener target=_blank>Lua crash course (11 min video)</a><li><a href=https://learnxinyminutes.com/docs/lua/ rel=noopener target=_blank>Learn X in Y minutes: Where X = lua</a><li>And... there is also <a href=https://neovim.io/doc/user/lua-guide.html rel=noopener target=_blank>Neovim's official lua guide</a></ul><h2 id=let-s-start-with-the-language-server>Let's start with the language server</h2><p>A language server is an external program that follows the <a href=https://microsoft.github.io/language-server-protocol/ rel=noopener target=_blank>Language Server Protocol</a>. The LSP specification defines what type of messages a language server can receive, and also how it should respond. The idea here is that <a href=https://microsoft.github.io/language-server-protocol/implementors/tools/ rel=noopener target=_blank>any tool that follows the LSP specification</a> can communicate with a language server.<p>And so the language server is the thing that analyzes our source code and it can tell the editor what to do.<p><em>Where can we find these language servers?</em><p>The website for the LSP specification <a href=https://microsoft.github.io/language-server-protocol/implementors/servers/ rel=noopener target=_blank>has a list</a>.<h3 id=in-this-particular-case>In this particular case...</h3><p>I'm going to use <a href=https://intelephense.com/ rel=noopener target=_blank>intelephense</a> to show the minimal configuration needed to setup a language server in Neovim.<p>If you want to test intelephense you need to install <a href=https://nodejs.org/en rel=noopener target=_blank>NodeJS</a>. And then you can install the server running this command in the terminal.<pre class=language-sh data-lang=sh style=background:#2b2c2f;color:#cccece><code class=language-sh data-lang=sh><span style=color:#6699cc>npm install</span><span style=color:#5fb3b3> -</span><span style=color:#f99157>g</span><span style=color:#6699cc> intelephense
</span></code></pre><p>Once you have a language server installed it's a good idea to check if Neovim "knows" where it is. You can execute this command inside Neovim.<pre class=language-vim data-lang=vim style=background:#2b2c2f;color:#cccece><code class=language-vim data-lang=vim><span>:</span><span style=color:#6699cc>echo exepath</span><span>(</span><span style=color:#99c794>'intelephense'</span><span>)
</span></code></pre><p>This should show you the path to the language server executable. If it doesn't, it means something went wrong during the installation.<p>In case you didn't click on the link to intelephense, you should know that is a language server for php. If you just want to test the code I show here, you don't need the php interpreter installed, just the source code of a php project. You can use this repository: <a href=https://github.com/minicli/minicli rel=noopener target=_blank>minicli</a>, is a decent size codebase and doesn't depend on any other php libraries.<h2 id=basic-usage>Basic Usage</h2><p>Before we write any code we should learn how to use the language server. The first piece of information we need is the command that starts the server. This should be in the official documentation of said server.<p>If we can't find the basic usage in the documentation we can go to <a href=https://github.com/neovim/nvim-lspconfig rel=noopener target=_blank>nvim-lspconfig</a>'s github repository. In there we look for a folder called <a href=https://github.com/neovim/nvim-lspconfig/tree/master/lua/lspconfig/configs rel=noopener target=_blank>configs</a>, this contains configuration files for a bunch of language servers.<p>Right now we are interested in intelephense, so we should inspect the contents of <a href=https://github.com/neovim/nvim-lspconfig/blob/16666f1bc40f69ce05eb1883fd8c0d076284d8a5/lua/lspconfig/configs/intelephense.lua rel=noopener target=_blank>intelephense.lua</a>. The thing we are looking for is in a property called <code>default_config</code>. This piece of code right here:<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>default_config </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#99c794>cmd </span><span style=color:#5fb3b3>= { '</span><span style=color:#99c794>intelephense</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>--stdio</span><span style=color:#5fb3b3>' },
</span><span>  </span><span style=color:#99c794>filetypes </span><span style=color:#5fb3b3>= { '</span><span style=color:#99c794>php</span><span style=color:#5fb3b3>' },
</span><span>  </span><span style=color:#6699cc>root_dir </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>pattern</span><span style=color:#5fb3b3>)
</span><span>    </span><span style=color:#c594c5>local </span><span>cwd </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>uv</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>cwd</span><span style=color:#5fb3b3>()
</span><span>    </span><span style=color:#c594c5>local </span><span>root </span><span style=color:#5fb3b3>= </span><span>util</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>root_pattern</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>composer.json</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>.git</span><span style=color:#5fb3b3>')(</span><span>pattern</span><span style=color:#5fb3b3>)
</span><span>
</span><span>    </span><span style=color:#5f6364>-- prefer cwd if root is a descendant
</span><span>    </span><span style=color:#c594c5>return </span><span>util</span><span style=color:#5fb3b3>.</span><span>path</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>is_descendant</span><span style=color:#5fb3b3>(</span><span>cwd</span><span style=color:#5fb3b3>, </span><span>root</span><span style=color:#5fb3b3>) and </span><span>cwd </span><span style=color:#5fb3b3>or </span><span>root
</span><span>  </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><p>The <code>cmd</code> property has the command we need to start the language server. <code>filetypes</code> is the list of languages the server can handle. And I'm going to talk about the <code>root_dir</code> in a little while.<h2 id=execute-on-filetype>Execute on filetype</h2><p>Since we only need intelephense in php files we can use something called a filetype plugin. That's a script that gets executed after Neovim assigns a filetype to a buffer.<p>We create a filetype plugin in our Neovim configuration simply by adding a script in the folder <code>ftplugin</code>. Note that the name of the script needs to be the same as a valid filetype.<p>We can navigate to Neovim's configuration folder, open Neovim and then create the <code>ftplugin</code> folder.<pre class=language-vim data-lang=vim style=background:#2b2c2f;color:#cccece><code class=language-vim data-lang=vim><span>:call </span><span style=color:#6699cc>mkdir</span><span>(</span><span style=color:#99c794>'./ftplugin'</span><span>, </span><span style=color:#99c794>'p'</span><span>)
</span></code></pre><p>We want a filetype plugin for php, so we create a new file called <code>php.lua</code>.<pre class=language-vim data-lang=vim style=background:#2b2c2f;color:#cccece><code class=language-vim data-lang=vim><span>:edit ftplugin/php.</span><span style=color:#6699cc>lua</span><span> | write
</span></code></pre><p>Inside this new file we are going to execute the function that enables intelephense.<h2 id=root-directory>Root directory</h2><p>The last piece of information we need is the root directory. We just have to tell the language server where is our project folder.<p>In our filetype plugin we are going to use a function called <a href=https://neovim.io/doc/user/lua.html#vim.fs.find() rel=noopener target=_blank>vim.fs.find()</a>. We will give it a list of files and it will return the path of the first match it finds.<p>What do we look for? We search for common configuration files that projects have in their root folder. So, in php is very common to have a <code>composer.json</code> file. Javascript projects usually have a <code>package.json</code>. Rust projects have a <code>cargo.toml</code>. We feed this information to <code>vim.fs.find()</code> and it should give us a path we can use.<p>We can make a test already by adding this piece of code in the newly created <code>php.lua</code>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- ftplugin/php.lua
</span><span>
</span><span style=color:#c594c5>local </span><span>root_files </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>composer.json</span><span style=color:#5fb3b3>'}
</span><span style=color:#c594c5>local </span><span>paths </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>fs</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>find</span><span style=color:#5fb3b3>(</span><span>root_files</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>stop </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>env</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>HOME</span><span style=color:#5fb3b3>})
</span><span>
</span><span style=color:#6699cc>print</span><span style=color:#5fb3b3>(</span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>fs</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>dirname</span><span style=color:#5fb3b3>(</span><span>paths</span><span style=color:#5fb3b3>[</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>]))
</span></code></pre><p>By default <code>vim.fs.find()</code> will look in the current folder and then the parent folders. The <code>stop</code> argument tells the function it should stop the search if it hits the <code>home</code> folder (you don't want your language server to analyze your home folder by accident).<p>Since <code>vim.fs.find()</code> returns a list we just pick the first item. And to make sure we get the path to a folder we use <code>vim.fs.dirname()</code>.<p>We can navigate to a php project with a composer.json file and check that the project path is detected correctly.<h2 id=start-the-client>Start the client</h2><p>We are ready to enable the language server. Now we call the function <a href=https://neovim.io/doc/user/lsp.html#vim.lsp.start() rel=noopener target=_blank>vim.lsp.start()</a>. The first time this is executed it will launch the language server as an external process. When called again with the same root directory it will only send information to the existing process.<p>Our php filetype plugin should look like this.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- ftplugin/php.lua
</span><span>
</span><span style=color:#c594c5>local </span><span>root_files </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>composer.json</span><span style=color:#5fb3b3>'}
</span><span style=color:#c594c5>local </span><span>paths </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>fs</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>find</span><span style=color:#5fb3b3>(</span><span>root_files</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>stop </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>env</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>HOME</span><span style=color:#5fb3b3>})
</span><span style=color:#c594c5>local </span><span>root_dir </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>fs</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>dirname</span><span style=color:#5fb3b3>(</span><span>paths</span><span style=color:#5fb3b3>[</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>])
</span><span>
</span><span style=color:#c594c5>if </span><span>root_dir </span><span style=color:#c594c5>then
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>start</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>    </span><span style=color:#99c794>cmd </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>intelephense</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>--stdio</span><span style=color:#5fb3b3>'},
</span><span style=color:#6699cc>    </span><span style=color:#99c794>root_dir </span><span style=color:#5fb3b3>= </span><span>root_dir</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>})
</span><span style=color:#c594c5>end
</span></code></pre><p>With this setup we should get "diagnostics" out the box. If there is an error in a php file Neovim will show what line has the error, and also the message. Something like this.<p><img alt="Example code from slimphp framework showing an error" src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xcdxdx9kj3xh90o2369u.png><p>The <code>E</code> in line 8 is a diagnostic sign, it indicates there is an error. And the thing after the <code>■</code> symbol is "virtual text" showing the error message.<h3 id=server-settings>Server settings</h3><p>Now, some server specific configuration should be placed in a property called <code>settings</code> in the <code>vim.lsp.start()</code> function. But here's the thing, you may find the documentation of some language servers shows them in this format:<pre style=background:#2b2c2f;color:#cccece><code><span>intelephense.files.maxSize: 1000000
</span></code></pre><p>We would need to adapt this so it works with Neovim's LSP client. Let me show you how it should be.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>start</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>  </span><span style=color:#99c794>cmd </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>intelephense</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>--stdio</span><span style=color:#5fb3b3>'},
</span><span style=color:#6699cc>  </span><span style=color:#99c794>root_dir </span><span style=color:#5fb3b3>= </span><span>root_dir</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#99c794>settings </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>intelephense </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>      </span><span style=color:#99c794>files </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>        </span><span style=color:#99c794>maxSize </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>1000000</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>      </span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>}
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>})
</span></code></pre><p>Basically, each dot is a nested "lua table" we need to add.<p>If there was another setting with the same namespace <code>intelephense.files</code>, we just add it to the existing table.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>start</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>  </span><span style=color:#99c794>cmd </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>intelephense</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>--stdio</span><span style=color:#5fb3b3>'},
</span><span style=color:#6699cc>  </span><span style=color:#99c794>root_dir </span><span style=color:#5fb3b3>= </span><span>root_dir</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#99c794>settings </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>intelephense </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>      </span><span style=color:#99c794>files </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>        </span><span style=color:#99c794>maxSize </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>1000000</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>        </span><span style=color:#99c794>anotherOptionExample </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>      </span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>}
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=where-to-look-if-something-goes-wrong>Where to look if something goes wrong?</h3><p>If Neovim wasn't able to start the language server, you can take a look at the log file, execute this command inside Neovim:<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>:</span><span>lua vim</span><span style=color:#5fb3b3>.</span><span>cmd</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>edit</span><span style=color:#5fb3b3>(</span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>get_log_path</span><span style=color:#5fb3b3>())
</span></code></pre><p>Look for the lines that start with <code>[ERROR]</code>. Maybe there is an error message with some useful information.<p>If you want the logs to have more details, increase the log level. Add this in your <code>init.lua</code> file.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set_log_level</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>debug</span><span style=color:#5fb3b3>')
</span></code></pre><h2 id=about-the-diagnostics>About the diagnostics</h2><p>So the diagnostics signs, the thing Neovim uses to tell us there is an error in our source code... by default the space needed to render that sign is hidden and when there is a sign the whole screen shifts to the right. That behavior can be configured in the <code>init.lua</code> file.<p>If you set the option <code>signcolumn</code> to the string <code>yes</code>, Neovim will reserve the space for the sign. You will have a whitespace reserved for any type of signs in the gutter.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>opt</span><span style=color:#5fb3b3>.</span><span>signcolumn </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>yes</span><span style=color:#5fb3b3>'
</span></code></pre><p>If you set <code>signcolumn</code> to the string <code>no</code>, Neovim will hide the column altogether. Don't do that unless you are fully aware of the consequences. There is a better way to hide the diagnostic signs.<h3 id=vim-diagnostic>vim.diagnostic</h3><p>There is a lua module dedicated specifically to diagnostics: <a href=https://neovim.io/doc/user/diagnostic.html rel=noopener target=_blank>vim.diagnostic</a>. This has a <a href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.config() rel=noopener target=_blank>.config()</a> function we can use to configure the interface of the diagnostics.<p>We can add the following to our <code>init.lua</code>.<ul><li>Hide diagnostic signs</ul><p>This is the "safe" way to disable the diagnostics sign.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>config</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>  </span><span style=color:#99c794>signs </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>})
</span></code></pre><ul><li>Disable virtual text</ul><p>Yes, there's also an option to hide the virtual text that contains the error message.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>config</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>  </span><span style=color:#99c794>virtual_text </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>})
</span></code></pre><p>If you have <strong>Neovim v0.10 or greater</strong> you can read the diagnostic message under the cursor with the keybinding <code>&LTC-w>d</code> (control + w then d). This will trigger the function <a href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.open_float() rel=noopener target=_blank>vim.diagnostic.open_float()</a>.<p>When using <strong>Neovim v0.9.5 or lower</strong> you'll have to create that keybinding yourself.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTC-w>d</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.diagnostic.open_float()&LTcr></span><span style=color:#5fb3b3>')
</span></code></pre><p>Now, I would love to explain all the options <code>vim.diagnostic.config()</code> supports but we don't have time for that. If you want to know more you can <a href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.config() rel=noopener target=_blank>read the documentation</a>.<h2 id=what-else-do-we-get-for-free>What else do we get for free?</h2><p>These are things Neovim does when a language server active in the buffer.<p><strong>Since Neovim v0.8</strong><ul><li><p>There is an LSP powered <code>tagfunc</code>. That means we can jump to the definition of a function or class using the keybinding <code>&LTC-]></code> (control + ]). And can jump back to where we were using <code>&LTC-t></code>.</p><li><p>The <code>formatexpr</code> option is set to a function that uses the language server. This means the <code>gq</code> operator can format a piece of code. We can enter visual mode, select a piece of text, press <code>gq</code> and Neovim will request the language server to format the code.</p><li><p>The <code>omnifunc</code> option is also set. This one enables smart code completions. In insert mode the keybinding <code>&LTC-x>&LTC-o></code> (control + x then control + o) will trigger the completion menu with suggestions that the language server think are relevant.</p></ul><p><strong>Since Neovim v0.9</strong><ul><li>Semantic highlight is supported. Some language servers can provide information about the tokens in the source code, this allows for a more accurate syntax highlight.</ul><p><strong>Since Neovim v0.10</strong><ul><li><p>In normal mode, if we don't have a custom keybinding for <code>K</code> then it will display the available documentation for the symbol under the cursor.</p><li><p>In normal mode, <code>&LTC-w>d</code> opens a floating window showing the diagnostics in the line under the cursor.</p><li><p>In normal mode, <code>[d</code> and <code>]d</code> can be used to move the cursor to the previous and next diagnostic of the current file.</p></ul><p><strong>Since Neovim v0.11</strong><blockquote><p>v0.11 is still under development. Everything in this section is subject to change.</blockquote><ul><li><p>In normal mode, <code>grn</code> renames all references of the symbol under the cursor.</p><li><p>In normal mode, <code>gra</code> shows a list of code actions available in the line under the cursor.</p><li><p>In normal mode, <code>grr</code> lists all the references of the symbol under the cursor.</p><li><p>In insert mode, <code>&LTCtrl-s></code> displays the function signature of the symbol under the cursor.</p></ul><h2 id=let-s-get-some-easy-wins>Let's get some easy wins</h2><p>Here's a list of features we can use without too much effort, pretty much the only thing we have to do is call a lua function.<ul><li>Jump to declaration<li>Lists implementations<li>Jump to type definition<li>List all references<li>Display a function's signature information<li>Rename all references to the symbol under the cursor<li>Format current file (or selected range)<li>List and execute a code action</ul><p>All of these can be used in custom keybindings.<h3 id=custom-keybindings>Custom keybindings</h3><p>Is very common for people to follow the same patterns Neovim's defaults have, that is only enable features when the language server is active. So let me introduce you to the <code>LspAttach</code> event, this is triggered everytime Neovim enables a language server in a buffer. And with the function <code>nvim_create_autocmd</code> we can tell Neovim we want to execute a callback function everytime this event happens.<blockquote><p>You can find more details about autocommands here: <a href=https://neovim.io/doc/user/lua-guide.html#lua-guide-autocommands rel=noopener target=_blank>lua-guide-autocommands</a>.</blockquote><p>So this is one way to setup custom keybindings.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- you can add this in your init.lua
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>LspAttach</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>LSP actions</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  callback </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>local </span><span style=color:#6699cc>bufmap </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>mode</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>lhs</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>rhs</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>local </span><span>opts </span><span style=color:#5fb3b3>= {</span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= </span><span>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>}
</span><span style=color:#6699cc>      </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set</span><span style=color:#5fb3b3>(</span><span>mode</span><span style=color:#5fb3b3>, </span><span>lhs</span><span style=color:#5fb3b3>, </span><span>rhs</span><span style=color:#5fb3b3>, </span><span>opts</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- You can find details of these function in the help page
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- see for example, :help vim.lsp.buf.hover()
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Trigger code completion
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTC-Space></span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTC-x>&LTC-o></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Display documentation of the symbol under the cursor
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>K</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.hover()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Jump to the definition
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gd</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.definition()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Jump to declaration
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gD</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.declaration()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Lists all the implementations for the symbol under the cursor
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gi</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.implementation()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Jumps to the definition of the type symbol
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>go</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.type_definition()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Lists all the references 
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gr</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.references()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Displays a function's signature information
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTC-k></span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.signature_help()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Renames all references to the symbol under the cursor
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTF2></span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.rename()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Format current file
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTF3></span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.format()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Selects a code action available at the current cursor position
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTF4></span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.code_action()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#5fb3b3>})
</span></code></pre><h2 id=fair-warning>Fair warning</h2><p>Not every language server implements the entire LSP specification. The features of LSP servers may not be consistent between servers.<p>For example, intelephense can show diagnostics in real time, there is no need to save the file to get new diagnostics. But <a href=https://github.com/rust-lang/rust-analyzer rel=noopener target=_blank>rust-analyzer</a>, the language server for rust, can only update diagnostics after saving the file.<p>Here's another example: <a href=https://github.com/astral-sh/ruff-lsp rel=noopener target=_blank>ruff-lsp</a>, a language server for python. It describes itself as a linter and code formatter. As far as I can tell <code>ruff-lsp</code> does not provide code completions or semantic highlights.<p>What I want say is this: read the documentation of the language server so you know what it can do.<h2 id=bonus-content>Bonus content</h2><p>At this point I'd say you have all the essential knowledge needed to be productive. What follows are tips, configurations, and features you can implement by adding some boilerplate code in your Neovim configuration.<h3 id=configure-a-language-server-for-multiple-filetypes>Configure a language server for multiple filetypes</h3><p>Sometimes a language server can support multiple filetypes. An example of this is <a href=https://github.com/typescript-language-server/typescript-language-server rel=noopener target=_blank>tsserver</a>, the language server for javascript and typescript. In this case a filetype plugin can still work but there is an easier way to go about it.<p>One option to consider is a "global plugin." In there we can configure the language server in the callback function of a <code>FileType</code> autocommand.<p>If you want follow along, install tsserver using this command in the terminal.<pre class=language-sh data-lang=sh style=background:#2b2c2f;color:#cccece><code class=language-sh data-lang=sh><span style=color:#6699cc>npm install</span><span style=color:#5fb3b3> -</span><span style=color:#f99157>g</span><span style=color:#6699cc> typescript typescript-language-server
</span></code></pre><p>For this we need to create a <code>plugin</code> folder inside Neovim's configuration folder. So, we navigate to Neovim's config folder, open Neovim, then execute this command to create the plugin folder.<pre class=language-vim data-lang=vim style=background:#2b2c2f;color:#cccece><code class=language-vim data-lang=vim><span>:call </span><span style=color:#6699cc>mkdir</span><span>(</span><span style=color:#99c794>'./plugin'</span><span>, </span><span style=color:#99c794>'p'</span><span>)
</span></code></pre><p>Next we create a lua script, it can have any name we want. We can call it <code>tsserver.lua</code>.<pre class=language-vim data-lang=vim style=background:#2b2c2f;color:#cccece><code class=language-vim data-lang=vim><span>:edit plugin/tsserver.</span><span style=color:#6699cc>lua</span><span> | write
</span></code></pre><p>In <code>ts_ls.lua</code> we are going to adapt the configuration in <a href=https://github.com/neovim/nvim-lspconfig/blob/16666f1bc40f69ce05eb1883fd8c0d076284d8a5/lua/lspconfig/configs/ts_ls.lua rel=noopener target=_blank>nvim-lspconfig's source code</a>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- plugin/tsserver.lua
</span><span>
</span><span style=color:#c594c5>local function </span><span style=color:#6699cc>start_tsserver</span><span style=color:#5fb3b3>()
</span><span>  </span><span style=color:#c594c5>local </span><span>root_files </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>package.json</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>tsconfig.json</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>jsconfig.json</span><span style=color:#5fb3b3>'}
</span><span>  </span><span style=color:#c594c5>local </span><span>paths </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>fs</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>find</span><span style=color:#5fb3b3>(</span><span>root_files</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>stop </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>env</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>HOME</span><span style=color:#5fb3b3>})
</span><span>  </span><span style=color:#c594c5>local </span><span>root_dir </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>fs</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>dirname</span><span style=color:#5fb3b3>(</span><span>paths</span><span style=color:#5fb3b3>[</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>])
</span><span>
</span><span>  </span><span style=color:#c594c5>if </span><span>root_dir </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>nil </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#5f6364>-- root directory was not found
</span><span>    </span><span style=color:#c594c5>return
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>start</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>    </span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>tsserver</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>    </span><span style=color:#99c794>cmd </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>typescript-language-server</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>--stdio</span><span style=color:#5fb3b3>'},
</span><span style=color:#6699cc>    </span><span style=color:#99c794>root_dir </span><span style=color:#5fb3b3>= </span><span>root_dir</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>init_options </span><span style=color:#5fb3b3>= {</span><span style=color:#99c794>hostInfo </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>neovim</span><span style=color:#5fb3b3>'},
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>})
</span><span style=color:#c594c5>end
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>FileType</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>pattern </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>javascriptreact</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>javascript.jsx</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>typescript</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>typescriptreact</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>typescript.tsx</span><span style=color:#5fb3b3>'},
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Start typescript LSP</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span style=color:#99c794>callback </span><span style=color:#5fb3b3>= </span><span>start_tsserver</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>})
</span></code></pre><p>This will work exactly like a filetype plugin, except here we are executing one lua function and not an entire file. The advantage of the autocommand is we can define multipe filetypes in the <code>pattern</code> property.<p>By the way, this doesn't have to be a global plugin, we can setup the autocommand in the <code>init.lua</code> file.<h3 id=add-borders-to-floating-windows>Add borders to floating windows</h3><p>Sadly, there is no way to add borders to all floating windows, this means we have to enable it for each feature.<p>We can add the following to our <code>init.lua</code> file.<ul><li>Diagnostic details</ul><pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>config</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>  </span><span style=color:#99c794>float </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>border </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>rounded</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>})
</span></code></pre><ul><li>Documentation window</ul><p>The one used by the function <a href=https://neovim.io/doc/user/lsp.html#vim.lsp.buf.hover() rel=noopener target=_blank>vim.lsp.buf.hover()</a>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span>handlers</span><span style=color:#5fb3b3>['</span><span style=color:#99c794>textDocument/hover</span><span style=color:#5fb3b3>'] = </span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>with</span><span style=color:#5fb3b3>(
</span><span style=color:#6699cc>  </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>handlers</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>hover</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>border </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>rounded</span><span style=color:#5fb3b3>'}
</span><span style=color:#5fb3b3>)
</span></code></pre><ul><li>Signature help</ul><p>The one used by the function <a href=https://neovim.io/doc/user/lsp.html#vim.lsp.buf.signature_help() rel=noopener target=_blank>vim.lsp.buf.signature_help()</a>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span>handlers</span><span style=color:#5fb3b3>['</span><span style=color:#99c794>textDocument/signatureHelp</span><span style=color:#5fb3b3>'] = </span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>with</span><span style=color:#5fb3b3>(
</span><span style=color:#6699cc>  </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>handlers</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>signature_help</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>border </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>rounded</span><span style=color:#5fb3b3>'}
</span><span style=color:#5fb3b3>)
</span></code></pre><h3 id=format-on-save>Format on save</h3><p>The only thing we will do here is trigger the function <a href=https://neovim.io/doc/user/lsp.html#vim.lsp.buf.format() rel=noopener target=_blank>vim.lsp.buf.format()</a> before Neovim saves a file. And of course, we only do it when there is an active language server.<p>Important note: most language servers with formatting capabilities have their own style settings. For example, we can have 2 space indent in our Neovim config but maybe the language server formats the code with 4 space indent. So it's a good idea to check the documentation of the language server to see how to configure that.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- or a global plugin
</span><span>
</span><span style=color:#c594c5>local </span><span>fmt_group </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_augroup</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>autoformat_cmds</span><span style=color:#5fb3b3>', {</span><span style=color:#99c794>clear </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>})
</span><span>
</span><span style=color:#c594c5>local function </span><span style=color:#6699cc>setup_autoformat</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>)
</span><span>  </span><span style=color:#c594c5>local </span><span>id </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>tbl_get</span><span style=color:#5fb3b3>(</span><span>event</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>data</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>client_id</span><span style=color:#5fb3b3>')
</span><span>  </span><span style=color:#c594c5>local </span><span>client </span><span style=color:#5fb3b3>= </span><span>id </span><span style=color:#5fb3b3>and </span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>get_client_by_id</span><span style=color:#5fb3b3>(</span><span>id</span><span style=color:#5fb3b3>)
</span><span>  </span><span style=color:#c594c5>if </span><span>client </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>nil </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#c594c5>return
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_clear_autocmds</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>group </span><span style=color:#5fb3b3>= </span><span>fmt_group</span><span style=color:#5fb3b3>, </span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= </span><span>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>})
</span><span>
</span><span>  </span><span style=color:#c594c5>local </span><span style=color:#6699cc>buf_format </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>e</span><span style=color:#5fb3b3>)
</span><span>    vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span>buf</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>format</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>      </span><span style=color:#99c794>bufnr </span><span style=color:#5fb3b3>= </span><span>e</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>      </span><span style=color:#99c794>async </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>      </span><span style=color:#99c794>timeout_ms </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>10000</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>})
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>BufWritePre</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= </span><span>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>group </span><span style=color:#5fb3b3>= </span><span>fmt_group</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Format current buffer</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>    </span><span style=color:#99c794>callback </span><span style=color:#5fb3b3>= </span><span>buf_format</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>})
</span><span style=color:#c594c5>end
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>LspAttach</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Setup format on save</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span style=color:#99c794>callback </span><span style=color:#5fb3b3>= </span><span>setup_autoformat</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=change-diagnostics-sign-text>Change diagnostics sign text</h3><p>When using <strong>Neovim v0.9.5 or lower</strong> we need to call the function <a href=https://neovim.io/doc/user/builtin.html#sign_define() rel=noopener target=_blank>vim.fn.sign_define()</a>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- or a global plugin
</span><span>
</span><span style=color:#c594c5>local function </span><span style=color:#6699cc>sign_define</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>args</span><span style=color:#5fb3b3>)
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>sign_define</span><span style=color:#5fb3b3>(</span><span>args</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>name</span><span style=color:#5fb3b3>, {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>texthl </span><span style=color:#5fb3b3>= </span><span>args</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>name</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= </span><span>args</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>text</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>numhl </span><span style=color:#5fb3b3>= ''
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>})
</span><span style=color:#c594c5>end
</span><span>
</span><span style=color:#6699cc>sign_define</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>DiagnosticSignError</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>✘</span><span style=color:#5fb3b3>'})
</span><span style=color:#6699cc>sign_define</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>DiagnosticSignWarn</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>▲</span><span style=color:#5fb3b3>'})
</span><span style=color:#6699cc>sign_define</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>DiagnosticSignHint</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>⚑</span><span style=color:#5fb3b3>'})
</span><span style=color:#6699cc>sign_define</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>DiagnosticSignInfo</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>»</span><span style=color:#5fb3b3>'})
</span></code></pre><p>When using <strong>Neovim v0.10 or greater</strong> we should do this with <code>vim.diagnostic.config()</code>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- or a global plugin
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>config</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>  </span><span style=color:#99c794>signs </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>      </span><span style=color:#5fb3b3>[</span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>severity</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>ERROR</span><span style=color:#5fb3b3>] = '</span><span style=color:#99c794>✘</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>      </span><span style=color:#5fb3b3>[</span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>severity</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>WARN</span><span style=color:#5fb3b3>] = '</span><span style=color:#99c794>▲</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>      </span><span style=color:#5fb3b3>[</span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>severity</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>HINT</span><span style=color:#5fb3b3>] = '</span><span style=color:#99c794>⚑</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>      </span><span style=color:#5fb3b3>[</span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>severity</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>INFO</span><span style=color:#5fb3b3>] = '</span><span style=color:#99c794>»</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=disable-diagnostics-in-insert-mode>Disable diagnostics in insert mode</h3><p>This is already the default behavior but there is a problem... not really a problem, just a minor detail: the diagnostics only disappear after we start typing something.<p>This is the code <strong>I use</strong> to disable diagnostics right after going into insert mode (or select mode).<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- or a global plugin
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>ModeChanged</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>pattern </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>n:i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>v:s</span><span style=color:#5fb3b3>'},
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Disable diagnostics in insert and select mode</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  callback </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>e</span><span style=color:#5fb3b3>) </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>disable</span><span style=color:#5fb3b3>(</span><span>e</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>end
</span><span style=color:#5fb3b3>})
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>ModeChanged</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>pattern </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>i:n</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Enable diagnostics when leaving insert mode</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  callback </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>e</span><span style=color:#5fb3b3>) </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>enable</span><span style=color:#5fb3b3>(</span><span>e</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>end
</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=disable-semantic-highlights>Disable semantic highlights</h3><p>Neovim's documentation suggest that we "clear" the highlight groups of the <code>@lsp</code> namespace. So, we can do this.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- this should be executed before setting the colorscheme
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>ColorScheme</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Clear LSP highlight groups</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  callback </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>for </span><span>_</span><span style=color:#5fb3b3>, </span><span>group </span><span style=color:#c594c5>in </span><span style=color:#6699cc>ipairs</span><span style=color:#5fb3b3>(</span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>getcompletion</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>@lsp</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>highlight</span><span style=color:#5fb3b3>')) </span><span style=color:#c594c5>do
</span><span style=color:#6699cc>      </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_set_hl</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>0</span><span style=color:#5fb3b3>, </span><span>group</span><span style=color:#5fb3b3>, {})
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>})
</span></code></pre><p>The <code>ColorScheme</code> autocommand should be created before setting up the colorscheme. This way Neovim can clear the highlights even if we change the colorscheme in the middle of a coding session.<h3 id=highlight-symbol-under-cursor>Highlight symbol under cursor</h3><p>What we want to do here is call the function <a href=https://neovim.io/doc/user/lsp.html#vim.lsp.buf.document_highlight() rel=noopener target=_blank>vim.lsp.buf.document_highlight()</a> when the cursor spends some amount of time on top of a symbol. And then clear the highlight when the cursor moves.<p>Note, for this to work properly the colorscheme needs to support the following highlight groups:<ul><li>LspReferenceRead<li>LspReferenceText<li>LspReferenceWrite</ul><p>If the colorscheme does not support these highlight groups, we can "link" them to an existing group. Here's an example using the <code>Search</code> highlight group.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_set_hl</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>0</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>LspReferenceRead</span><span style=color:#5fb3b3>', {</span><span style=color:#99c794>link </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Search</span><span style=color:#5fb3b3>'})
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_set_hl</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>0</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>LspReferenceText</span><span style=color:#5fb3b3>', {</span><span style=color:#99c794>link </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Search</span><span style=color:#5fb3b3>'})
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_set_hl</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>0</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>LspReferenceWrite</span><span style=color:#5fb3b3>', {</span><span style=color:#99c794>link </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Search</span><span style=color:#5fb3b3>'})
</span></code></pre><pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- or a global plugin
</span><span>
</span><span style=color:#5f6364>-- time it takes to trigger the `CursorHold` event
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>opt</span><span style=color:#5fb3b3>.</span><span>updatetime </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>400
</span><span>
</span><span style=color:#c594c5>local function </span><span style=color:#6699cc>highlight_symbol</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>)
</span><span>  </span><span style=color:#c594c5>local </span><span>id </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>tbl_get</span><span style=color:#5fb3b3>(</span><span>event</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>data</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>client_id</span><span style=color:#5fb3b3>')
</span><span>  </span><span style=color:#c594c5>local </span><span>client </span><span style=color:#5fb3b3>= </span><span>id </span><span style=color:#5fb3b3>and </span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>get_client_by_id</span><span style=color:#5fb3b3>(</span><span>id</span><span style=color:#5fb3b3>)
</span><span>  </span><span style=color:#c594c5>if </span><span>client </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>nil </span><span style=color:#5fb3b3>or not </span><span>client</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>supports_method</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>textDocument/documentHighlight</span><span style=color:#5fb3b3>') </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#c594c5>return
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  </span><span style=color:#c594c5>local </span><span>group </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_augroup</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>highlight_symbol</span><span style=color:#5fb3b3>', {</span><span style=color:#99c794>clear </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>})
</span><span>
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_clear_autocmds</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= </span><span>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>, </span><span style=color:#99c794>group </span><span style=color:#5fb3b3>= </span><span>group</span><span style=color:#5fb3b3>})
</span><span>
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>({'</span><span style=color:#99c794>CursorHold</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>CursorHoldI</span><span style=color:#5fb3b3>'}, {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>group </span><span style=color:#5fb3b3>= </span><span>group</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= </span><span>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>callback </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>document_highlight</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>})
</span><span>
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>({'</span><span style=color:#99c794>CursorMoved</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>CursorMovedI</span><span style=color:#5fb3b3>'}, {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>group </span><span style=color:#5fb3b3>= </span><span>group</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= </span><span>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>callback </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>clear_references</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>})
</span><span style=color:#c594c5>end
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>LspAttach</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Setup highlight symbol</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span style=color:#99c794>callback </span><span style=color:#5fb3b3>= </span><span>highlight_symbol</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=simple-tab-complete>Simple tab complete</h3><p>In this one we will use the <code>Tab</code> (and shift tab) key to navigate between the items in the completion menu. When the completion menu is not visible and the cursor is in a whitespace character, it will insert a tab character. Else, it will trigger the completion menu.<p>When the language server can provide code completion it'll use that. Otherwise, it will try to suggest words found in the current buffer.<p>Note that you can use the Enter key or <code>&LTC-y></code> to confirm the current item in the completion menu<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- or a global plugin
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>opt</span><span style=color:#5fb3b3>.</span><span>completeopt </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>menuone</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>noselect</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>noinsert</span><span style=color:#5fb3b3>'}
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>opt</span><span style=color:#5fb3b3>.</span><span>shortmess</span><span style=color:#5fb3b3>:</span><span style=color:#6699cc>append</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>c</span><span style=color:#5fb3b3>')
</span><span>
</span><span style=color:#c594c5>local function </span><span style=color:#6699cc>tab_complete</span><span style=color:#5fb3b3>()
</span><span>  </span><span style=color:#c594c5>if </span><span>vim</span><span style=color:#5fb3b3>.</span><span>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>pumvisible</span><span style=color:#5fb3b3>() == </span><span style=color:#f99157>1 </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#5f6364>-- navigate to next item in completion menu
</span><span>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTDown></span><span style=color:#5fb3b3>'
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  </span><span style=color:#c594c5>local </span><span>c </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>col</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>') - </span><span style=color:#f99157>1
</span><span>  </span><span style=color:#c594c5>local </span><span>is_whitespace </span><span style=color:#5fb3b3>= </span><span>c </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>0 </span><span style=color:#5fb3b3>or </span><span>vim</span><span style=color:#5fb3b3>.</span><span>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>getline</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>'):</span><span style=color:#6699cc>sub</span><span style=color:#5fb3b3>(</span><span>c</span><span style=color:#5fb3b3>, </span><span>c</span><span style=color:#5fb3b3>):</span><span style=color:#6699cc>match</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>%s</span><span style=color:#5fb3b3>')
</span><span>
</span><span>  </span><span style=color:#c594c5>if </span><span>is_whitespace </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#5f6364>-- insert tab
</span><span>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTTab></span><span style=color:#5fb3b3>'
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  </span><span style=color:#c594c5>local </span><span>lsp_completion </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>bo</span><span style=color:#5fb3b3>.</span><span>omnifunc </span><span style=color:#5fb3b3>== '</span><span style=color:#99c794>v:lua.vim.lsp.omnifunc</span><span style=color:#5fb3b3>'
</span><span>
</span><span>  </span><span style=color:#c594c5>if </span><span>lsp_completion </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#5f6364>-- trigger lsp code completion
</span><span>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTC-x>&LTC-o></span><span style=color:#5fb3b3>'
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  </span><span style=color:#5f6364>-- suggest words in current buffer
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTC-x>&LTC-n></span><span style=color:#5fb3b3>'
</span><span style=color:#c594c5>end
</span><span>
</span><span style=color:#c594c5>local function </span><span style=color:#6699cc>tab_prev</span><span style=color:#5fb3b3>()
</span><span>  </span><span style=color:#c594c5>if </span><span>vim</span><span style=color:#5fb3b3>.</span><span>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>pumvisible</span><span style=color:#5fb3b3>() == </span><span style=color:#f99157>1 </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#5f6364>-- navigate to previous item in completion menu
</span><span>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTUp></span><span style=color:#5fb3b3>'
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  </span><span style=color:#5f6364>-- insert tab
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTTab></span><span style=color:#5fb3b3>'
</span><span style=color:#c594c5>end
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTTab></span><span style=color:#5fb3b3>', </span><span>tab_complete</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>expr </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>})
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTS-Tab></span><span style=color:#5fb3b3>', </span><span>tab_prev</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>expr </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=expand-snippets>Expand snippets</h3><p><strong>Neovim v0.11</strong> introduced a new module called <a href=https://neovim.io/doc/user/lsp.html#lsp-completion rel=noopener target=_blank>vim.lsp.completion</a>, this will extend the behavior of the builtin completion so it can support "additional text edits" a language server can provide. Additional edits can be things like adding missing import statements or expanding code snippets.<p>Right now you have to opt-in to the features <code>vim.lsp.completion</code> provides. So, when a language server is active you have to call the <a href=https://neovim.io/doc/user/lsp.html#vim.lsp.completion.enable() rel=noopener target=_blank>vim.lsp.completion.enable()</a> function.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- or a global plugin
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>opt</span><span style=color:#5fb3b3>.</span><span>completeopt </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>menuone</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>noinsert</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>noselect</span><span style=color:#5fb3b3>'}
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>LspAttach</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Enable vim.lsp.completion</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  callback </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>local </span><span>client_id </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>tbl_get</span><span style=color:#5fb3b3>(</span><span>event</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>data</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>client_id</span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>if </span><span>client_id </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>nil </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>return
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- warning: this api is unstable
</span><span style=color:#6699cc>    </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>completion</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>enable</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>true</span><span style=color:#5fb3b3>, </span><span>client_id</span><span style=color:#5fb3b3>, </span><span>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>autotrigger </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>})
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- warning: this api is unstable
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Trigger lsp completion manually using Ctrl + Space
</span><span style=color:#6699cc>    </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTC-Space></span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.completion.trigger()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#5fb3b3>})
</span></code></pre><p>Notice in the last argument to <code>.enable()</code> there is a property called <code>autotrigger</code>. <code>false</code> is the default value so I just leave it like that. If you set it to <code>true</code> Neovim will trigger the completion menu when it finds a trigger character. Trigger characters change depending on the language server. In lua for example, the completion will be triggered automatically after a <code>.</code> or <code>:</code> character.<p>If you are using <strong>Neovim v0.10</strong> you don't have access to <code>vim.lsp.completion</code> but you do have access to the module <code>vim.snippet</code>. You can use that to implement your own snippet expand autocommand.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- or a global plugin
</span><span>
</span><span style=color:#5f6364>-- note: this doesn't support "additional text edits" like
</span><span style=color:#5f6364>-- adding missing import statements.
</span><span style=color:#c594c5>local function </span><span style=color:#6699cc>expand_snippet</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>)
</span><span>  </span><span style=color:#c594c5>local </span><span>comp </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>v</span><span style=color:#5fb3b3>.</span><span>completed_item
</span><span>  </span><span style=color:#c594c5>local </span><span>kind </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span>protocol</span><span style=color:#5fb3b3>.</span><span>CompletionItemKind
</span><span>  </span><span style=color:#c594c5>local </span><span>item </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>tbl_get</span><span style=color:#5fb3b3>(</span><span>comp</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>user_data</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>nvim</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>lsp</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>completion_item</span><span style=color:#5fb3b3>')
</span><span>
</span><span>  </span><span style=color:#5f6364>-- Check that we were given a snippet
</span><span>  </span><span style=color:#c594c5>if </span><span style=color:#5fb3b3>(
</span><span>    </span><span style=color:#5fb3b3>not </span><span>item
</span><span>    </span><span style=color:#5fb3b3>or not </span><span>item</span><span style=color:#5fb3b3>.</span><span>insertTextFormat
</span><span>    </span><span style=color:#5fb3b3>or </span><span>item</span><span style=color:#5fb3b3>.</span><span>insertTextFormat </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>1
</span><span>    </span><span style=color:#5fb3b3>or not (
</span><span>      item</span><span style=color:#5fb3b3>.</span><span>kind </span><span style=color:#5fb3b3>== </span><span>kind</span><span style=color:#5fb3b3>.</span><span>Snippet
</span><span>      </span><span style=color:#5fb3b3>or </span><span>item</span><span style=color:#5fb3b3>.</span><span>kind </span><span style=color:#5fb3b3>== </span><span>kind</span><span style=color:#5fb3b3>.</span><span>Keyword
</span><span>    </span><span style=color:#5fb3b3>)
</span><span>  </span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#c594c5>return
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  </span><span style=color:#5f6364>-- Remove the inserted text
</span><span>  </span><span style=color:#c594c5>local </span><span>cursor </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_win_get_cursor</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>0</span><span style=color:#5fb3b3>)
</span><span>  </span><span style=color:#c594c5>local </span><span>line </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_get_current_line</span><span style=color:#5fb3b3>()
</span><span>  </span><span style=color:#c594c5>local </span><span>lnum </span><span style=color:#5fb3b3>= </span><span>cursor</span><span style=color:#5fb3b3>[</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>] - </span><span style=color:#f99157>1
</span><span>  </span><span style=color:#c594c5>local </span><span>start_col </span><span style=color:#5fb3b3>= </span><span>cursor</span><span style=color:#5fb3b3>[</span><span style=color:#f99157>2</span><span style=color:#5fb3b3>] - #</span><span>comp</span><span style=color:#5fb3b3>.</span><span>word
</span><span>
</span><span>  </span><span style=color:#c594c5>if </span><span>start_col </span><span style=color:#5fb3b3>< </span><span style=color:#f99157>0 </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#c594c5>return
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  </span><span style=color:#c594c5>local </span><span>set_text </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span>nvim_buf_set_text
</span><span>  </span><span style=color:#c594c5>local </span><span>ok </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>pcall</span><span style=color:#5fb3b3>(</span><span>set_text</span><span style=color:#5fb3b3>, </span><span>bufnr</span><span style=color:#5fb3b3>, </span><span>lnum</span><span style=color:#5fb3b3>, </span><span>start_col</span><span style=color:#5fb3b3>, </span><span>lnum</span><span style=color:#5fb3b3>, #</span><span>line</span><span style=color:#5fb3b3>, {''})
</span><span>
</span><span>  </span><span style=color:#c594c5>if </span><span style=color:#5fb3b3>not </span><span>ok </span><span style=color:#c594c5>then
</span><span>    </span><span style=color:#c594c5>return
</span><span>  </span><span style=color:#c594c5>end
</span><span>
</span><span>  </span><span style=color:#5f6364>-- Insert snippet
</span><span>  </span><span style=color:#c594c5>local </span><span>snip_text </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>tbl_get</span><span style=color:#5fb3b3>(</span><span>item</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>textEdit</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>newText</span><span style=color:#5fb3b3>') or </span><span>item</span><span style=color:#5fb3b3>.</span><span>insertText
</span><span>  </span><span style=color:#6699cc>assert</span><span style=color:#5fb3b3>(</span><span>snip_text</span><span style=color:#5fb3b3>, "</span><span style=color:#99c794>Language server indicated it had a snippet, but no snippet text could be found!</span><span style=color:#5fb3b3>")
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>snippet</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>expand</span><span style=color:#5fb3b3>(</span><span>snip_text</span><span style=color:#5fb3b3>)
</span><span style=color:#c594c5>end
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>CompleteDone</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Expand LSP snippet</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span style=color:#99c794>callback </span><span style=color:#5fb3b3>= </span><span>expand_snippet
</span><span style=color:#5fb3b3>})
</span></code></pre><p><code>vim.snippet</code> also supports snippet placeholders. This means we can jump to different places in the current active snippet. In <strong>Neovim v0.11</strong> the default keybindings to navigate between snippets are <code>Tab</code> and <code>Shift + Tab</code>.<p>If you are using <strong>Neovim v0.10</strong>, here are some keybindings that you can use.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span>
</span><span style=color:#5f6364>-- Control + f: Jump to next snippet placeholder
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set</span><span style=color:#5fb3b3>({'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'}, '</span><span style=color:#99c794>&LTC-f></span><span style=color:#5fb3b3>', </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>if </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>snippet</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>active</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>direction </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>1</span><span style=color:#5fb3b3>}) </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTcmd>lua vim.snippet.jump(1)&LTcr></span><span style=color:#5fb3b3>'
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTC-f></span><span style=color:#5fb3b3>'
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>expr </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>})
</span><span>
</span><span style=color:#5f6364>-- Control + b: Jump to previous snippet placeholder
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set</span><span style=color:#5fb3b3>({'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'}, '</span><span style=color:#99c794>&LTC-b></span><span style=color:#5fb3b3>', </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>if </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>snippet</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>active</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>direction </span><span style=color:#5fb3b3>= -</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>}) </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTcmd>lua vim.snippet.jump(-1)&LTcr></span><span style=color:#5fb3b3>'
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTC-b></span><span style=color:#5fb3b3>'
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>expr </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>})
</span><span>
</span><span style=color:#5f6364>-- Control + l: Exit current snippet
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set</span><span style=color:#5fb3b3>({'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'}, '</span><span style=color:#99c794>&LTC-l></span><span style=color:#5fb3b3>', </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>if </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>snippet</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>active</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTcmd>lua vim.snippet.exit()&LTcr></span><span style=color:#5fb3b3>'
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>&LTC-l></span><span style=color:#5fb3b3>'
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>expr </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=enable-inlay-hints>Enable inlay hints</h3><blockquote><p>Neovim v0.10 or greater is required.</blockquote><p>For this we can use the function <a href=https://neovim.io/doc/user/lsp.html#vim.lsp.inlay_hint.enable() rel=noopener target=_blank>vim.lsp.inlay_hint.enable()</a>.<p>Note that some language servers may have inlay hints disabled by default. The settings needed to enable hints should be in the documentation of the language server.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>-- You can add this in your init.lua
</span><span style=color:#5f6364>-- or a global plugin
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>LspAttach</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Enable inlay hints</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  callback </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>event</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>local </span><span>id </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>tbl_get</span><span style=color:#5fb3b3>(</span><span>event</span><span style=color:#5fb3b3>, '</span><span style=color:#99c794>data</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>client_id</span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>local </span><span>client </span><span style=color:#5fb3b3>= </span><span>id </span><span style=color:#5fb3b3>and </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>get_client_by_id</span><span style=color:#5fb3b3>(</span><span>id</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>if </span><span>client </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>nil </span><span style=color:#5fb3b3>or not </span><span>client</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>supports_method</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>textDocument/inlayHint</span><span style=color:#5fb3b3>') </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>return
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>inlay_hint</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>enable</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>true</span><span style=color:#5fb3b3>, {</span><span style=color:#99c794>bufnr </span><span style=color:#5fb3b3>= </span><span>event</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>buf</span><span style=color:#5fb3b3>})
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>})
</span></code></pre><h2 id=conclusion>Conclusion</h2><p>Hopefully I showed is not difficult to "connect" a language server with Neovim. Think about it, 1 shell commmand and 9 lines of lua code is all it takes to get intelephense working in Neovim.<p>The hard part is gathering all the context inside your head. What does LSP even mean? What's a language server? Filetype plugin? hardly know her. But once you know about the moving pieces and where to find the information you need, it gets easier.<p>One last thing, don't ignore the basics. Take your time and learn lua, read <a href=https://neovim.io/doc/user/lua-guide.html rel=noopener target=_blank>Neovim's lua guide</a> and learn how to navigate Neovim's documentation with the <code>:help</code> command.<hr><p>If you have a question you can reach out to me on social media:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Thank you for reading. If you find this article useful and want to support my efforts, buy me a coffee ☕</p><a href=https://ko-fi.com/vonheikemen style=display:flex;justify-content:center target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=height:60px!important;width:217px!important> </a></div></div>