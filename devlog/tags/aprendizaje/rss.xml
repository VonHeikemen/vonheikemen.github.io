<?xml version="1.0" encoding="UTF-8"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Devlog</title><link>https://vonheikemen.github.io/devlog/</link><description/><generator>Zola</generator><language>en</language><atom:link href="https://vonheikemen.github.io/devlog/tags/aprendizaje/rss.xml" rel="self" type="application/rss+xml"/><lastBuildDate>Tue, 10 Mar 2020 00:00:00 +0000</lastBuildDate><item><title>Un poco del paradigma funcional en tu javascript: Aplicación parcial</title><pubDate>Tue, 10 Mar 2020 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/es/web-development/functional-programming-for-your-everyday-javascript-partial-application/</link><guid>https://vonheikemen.github.io/devlog/es/web-development/functional-programming-for-your-everyday-javascript-partial-application/</guid><description>&lt;p>Hoy vamos a resolver un misterio, el misterio de porque algunas personas crean funciones que aceptan una (otra) función como primer parámetro. Ya deben estar pensando que la respuesta es aplicación parcial y tienen razón en cierta parte, pero la aplicación parcial sólo es el medio para un fin, la verdadera razón de esto es para hacer posible una &amp;quot;mejor&amp;quot; composición de funciones. Pero antes de adentrarnos en los detalles técnicos de la aplicación parcial vamos a explorar la manera en la que hacemos las cosas actualmente.&lt;/p>
&lt;h2 id="como-hacemos-las-cosas">Como hacemos las cosas&lt;/h2>
&lt;p>Cuando creamos una función usualmente ordenamos los parámetros basados en un sistema de prioridad/importancia, donde el más importante va primero. Como resultado, cuando trabajamos sobre un dato este es el primero en la lista, le siguen los parámetros de configuración y por último dejamos los parámetros opcionales que podemos omitir.&lt;/p>
&lt;p>Pongamos a prueba esa teoría. Digamos que queremos crear una función que pueda extraer unas propiedades específicas de un objeto plano. Pensemos en lo que necesitamos. ¿El objeto, eso en lo primero que pensaron? Es natural, no queremos omitirlo por accidente cuando ejecutemos la función. Eso deja la lista de propiedades como último parámetro. &lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">keys&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= {};
&lt;/span>&lt;span style="color:#c594c5;">for&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">key of keys&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">] = &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">];
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;blockquote>
&lt;p>Nota: No somos lo únicos que pensamos de esta manera, echen un vistazo a &lt;a href="https://lodash.com/docs/#pick">pick de lodash&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>Ahora digamos que tenemos un objeto &lt;code>user&lt;/code> y queremos esconder cualquier información &amp;quot;sensible&amp;quot;. Lo haríamos de esta manera.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">user &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#cccece;">id&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">7&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">name&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Tom&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Keen&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">email&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">noreply@example.com&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">password&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">hudson&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;
};
&lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">user&lt;/span>&lt;span style="color:#5fb3b3;">, [&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;span style="color:#5f6364;">// { name: &amp;quot;Tom&amp;quot;, lastname: &amp;quot;Keen&amp;quot; }
&lt;/span>&lt;/pre>
&lt;p>Funciona bien, ¿Pero qué pasa cuando necesitamos trabajar con un arreglo de usuarios?&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">users &lt;/span>&lt;span style="color:#5fb3b3;">= [
{
&lt;/span>&lt;span style="color:#cccece;">id&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">7&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">name&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Tom&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Keen&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">email&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">noreply@example.com&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">password&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">hudson&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;
},
{
&lt;/span>&lt;span style="color:#cccece;">id&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">30&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">name&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Smokey&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Putnum&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">email&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">noreply@example.com&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">password&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">carnival&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;
},
{
&lt;/span>&lt;span style="color:#cccece;">id&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">69&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">name&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Lady&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Luck&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">email&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">noreply@example.com&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">password&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">norestforthewicked&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;
}
];
&lt;/span>&lt;/pre>
&lt;p>Nos vemos forzados a recorrer el arreglo y llamar la función.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">users&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">user&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">user&lt;/span>&lt;span style="color:#5fb3b3;">, [&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
});
&lt;/span>&lt;span style="color:#5f6364;">/*
[
{&amp;quot;name&amp;quot;: &amp;quot;Tom&amp;quot;, &amp;quot;lastname&amp;quot;: &amp;quot;Keen&amp;quot;},
{&amp;quot;name&amp;quot;: &amp;quot;Smokey&amp;quot;, &amp;quot;lastname&amp;quot;: &amp;quot;Putnum&amp;quot;},
{&amp;quot;name&amp;quot;: &amp;quot;Lady&amp;quot;, &amp;quot;lastname&amp;quot;: &amp;quot;Luck&amp;quot;}
]
*/
&lt;/span>&lt;/pre>
&lt;p>No está tan mal. ¿Saben qué? Esa función parece útil. Vamos ponerla en otro lugar y le daremos un nombre.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">public_info&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">user&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">user&lt;/span>&lt;span style="color:#5fb3b3;">, [&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
}
&lt;/span>&lt;span style="color:#cccece;">users&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">public_info&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>¿Qué está pasando en realidad? Lo que estamos haciendo es vincular el segundo parámetro de la función con el valor &lt;code>['name', 'lastname']&lt;/code> y obligamos a &lt;code>pick&lt;/code> a esperar por el objeto &lt;code>user&lt;/code> para ser ejecutado.&lt;/p>
&lt;p>Llevemos este ejemplo más allá. Vamos a fingir que &lt;code>Async/Await&lt;/code> no existe y que el arreglo &lt;code>users&lt;/code> viene de una promesa (de una instancia de &lt;code>Promise&lt;/code>) tal vez de una petición http usando &lt;code>fetch&lt;/code>. ¿Qué hacemos?&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">url&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">users&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">users&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">user&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">user&lt;/span>&lt;span style="color:#5fb3b3;">, [&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
})
});
&lt;/span>&lt;/pre>
&lt;p>Eso sí se ve mal. Tal vez una función con flechas puedan mejorar la situación.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">url&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">users &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">users&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">user &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">user&lt;/span>&lt;span style="color:#5fb3b3;">, [&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;])));
&lt;/span>&lt;/pre>
&lt;p>¿Está mejor? Una pregunta para otro día. Pero ya nos preparamos para esto, tenemos la función &lt;code>public_info&lt;/code>, vamos a usarla. &lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">url&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">users &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">users&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">public_info&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;/pre>
&lt;p>Es aceptable, me gusta. Y si queremos podemos crear otra función que vincule &lt;code>public_info&lt;/code> con &lt;code>.map&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">user_list&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">users&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">users&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">public_info&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Ahora tenemos.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">url&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">user_list&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>Veamos cómo llegamos a este punto.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">keys&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// código...
&lt;/span>&lt;span style="color:#5fb3b3;">}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">public_info&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">user&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">user&lt;/span>&lt;span style="color:#5fb3b3;">, [&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">user_list&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">users&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">users&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">public_info&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#6699cc;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">url&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">user_list&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>¿Y si les digo que hay otra manera de crear &lt;code>public_info&lt;/code> y &lt;code>user_list&lt;/code>? ¿Y si se pudiera crear así?&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">public_info &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">([&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">user_list &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">public_info&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">url&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">user_list&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>O poner todo en una línea si eso prefieren.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">url&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">pick&lt;/span>&lt;span style="color:#5fb3b3;">([&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">lastname&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;])));
&lt;/span>&lt;/pre>
&lt;p>Podemos hacerlo pero primero tenemos que cambiar ligeramente la forma en la que pensamos en las funciones.&lt;/p>
&lt;h2 id="pensando-diferente">Pensando diferente&lt;/h2>
&lt;p>En lugar de pensar en prioridades deberíamos empezar a pensar en dependencias y datos. Al crear una función pensemos ¿qué parámetro es el que cambia con más frecuencia? Ese debería ser el último parámetro. &lt;/p>
&lt;p>Hagamos una función que tome los primeros elementos de algo. ¿Qué necesitamos? Necesitamos ese &amp;quot;algo&amp;quot; y también el necesitamos el número de elementos que vamos a tomar. De esos dos ¿cuál cambia con más frecuencia? Es el dato, ese &amp;quot;algo&amp;quot;.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">take&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">count&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">slice&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">count&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>En una situación normal esta es la forma de usarla.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">take&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, [&amp;#39;&lt;/span>&lt;span style="color:#99c794;">first&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">second&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">rest&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;span style="color:#5f6364;">// [&amp;quot;first&amp;quot;, &amp;quot;second&amp;quot;]
&lt;/span>&lt;/pre>
&lt;p>Pero con un poco de magia (la cual será revelada pronto) podemos reusarla de la siguiente manera.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">first_two &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">take&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">first_two&lt;/span>&lt;span style="color:#5fb3b3;">([&amp;#39;&lt;/span>&lt;span style="color:#99c794;">first&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">second&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">rest&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>
&lt;p>Este patrón se vuelve más conveniente cuando hay funciones (callbacks) involucradas. Vamos a &amp;quot;revertir&amp;quot; los parámetros de &lt;code>Array.filter&lt;/code> y veamos qué podemos hacer.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">func&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">func&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Hagamos algo sencillo, vamos a excluir de un arreglo todos los valores que puedan ser interpretados como falsos.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Boolean&lt;/span>&lt;span style="color:#5fb3b3;">, [&lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&amp;#39;, &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">that&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [ true, &amp;quot;that&amp;quot; ]
&lt;/span>&lt;/pre>
&lt;p>Se ve bien, y puede ser incluso mejor se le añadimos algo de contexto.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">exclude_falsey &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Boolean&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">exclude_falsey&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&amp;#39;, &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">that&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>
&lt;p>Espero que a estas alturas puedan ver las posibilidades que este patrón puede ofrecer. Existen librerías (como &lt;a href="https://ramdajs.com/docs/">Ramda&lt;/a>) que usan esta técnica para construir funciones complejas usando como bases funciones pequeñas de un sólo propósito.&lt;/p>
&lt;p>Ya basta de hablar, ahora veamos como podemos lograr implementar esto.&lt;/p>
&lt;h2 id="este-es-el-camino">Este es el camino&lt;/h2>
&lt;p>Como todo en javascript hay mil maneras de lograr la misma meta, algunas son más convenientes que otras, y en ocasiones se requiere de magia para implementarlo. Empecemos.&lt;/p>
&lt;h3 id="el-vinculo-magico-de-bind">El vínculo mágico de bind&lt;/h3>
&lt;p>Resulta que no necesitamos hacer nada extraordinario para vincular valores a los parámetros de una función porque cada una ya cuenta con el método &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">bind&lt;/a>. Puede que la sintaxis no parezca tan conveniente como la mostré en los ejemplo pero está bastante cerca. Sólo se debe tener en cuenta que el primer parámetro de &lt;code>Function.bind&lt;/code> es el &amp;quot;contexto&amp;quot;, es decir el valor que tiene la palabra clave &lt;code>this&lt;/code> dentro de una función. Este es su uso básico. &lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">exclude_falsey &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">filter&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#fac863;">Boolean&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">exclude_falsey&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&amp;#39;, &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">that&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>&lt;h3 id="la-magia-interior">La magia interior&lt;/h3>
&lt;p>Este requiere de un poco de trabajo e involucra otra palabra clave, &lt;code>arguments&lt;/code>. Lo que haremos será aprovechar el hecho de que &lt;code>arguments&lt;/code> es una estructura parecida a un arreglo que tiene una propiedad &lt;code>.length&lt;/code> con la cual podremos contar el número de parámetros que la función ha recibido, si es menos de los que necesitamos devolveremos nuevamente la función. ¿Suena confuso?&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">func&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// Aquí empezamos a contar.
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// si .length es 1 eso significa que tenemos `func`
// también significa que no tenemos `data`
// asi que devolvemos una función que
// recuerda el valor de `func` y espera por `data`
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">func&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">func&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Ahora es posible hacer esto.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">exclude_falsey &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Boolean&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">exclude_falsey&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&amp;#39;, &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">that&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>
&lt;p>Y también.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Boolean&lt;/span>&lt;span style="color:#5fb3b3;">, [&lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&amp;#39;, &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">that&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>
&lt;p>¿No es genial?&lt;/p>
&lt;h3 id="un-enfoque-simple">¿Un enfoque simple?&lt;/h3>
&lt;p>Y por supuesto que siempre tenemos la opción de implementar &lt;code>bind&lt;/code> nosotros mismos. Con la ayuda del operador de propagación (los &lt;code>...&lt;/code>) podemos recoger los argumentos por pasos y simplemente aplicarlos a la función cuando sea momento de llamarla.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">func&lt;/span>&lt;span style="color:#5fb3b3;">, ...&lt;/span>&lt;span style="color:#f99157;">first_args&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">rest&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">func&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#cccece;">first_args&lt;/span>&lt;span style="color:#5fb3b3;">, ...&lt;/span>&lt;span style="color:#cccece;">rest&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>El primer paso es obtener la función y recoger una lista de parámetros, luego devolvemos una función que recolecta otra lista de parámetros y finalmente llamamos la función &lt;code>func&lt;/code> con todo lo que tenemos.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">exclude_falsey &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">filter&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#fac863;">Boolean&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">exclude_falsey&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&amp;#39;, &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">that&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>
&lt;p>Lo interesante de esto es que si revierten el orden de &lt;code>first_args&lt;/code> con &lt;code>rest&lt;/code> pueden crear una función que vincula los argumentos en el orden opuesto.&lt;/p>
&lt;h3 id="no-mas-magia">No más magia&lt;/h3>
&lt;p>Con este pueda que tenga sentimientos encontrados pero la verdad es que esta la forma más simple.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">func&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">func&lt;/span>&lt;span style="color:#5fb3b3;">);
}
}
&lt;/span>&lt;/pre>
&lt;p>Lo que es equivalente a esto.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">filter &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">func &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#f99157;">data &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">func&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>La idea es tomar un parámetro a la vez en funciones separadas. Basicamente, sigan devolviendo funciones hasta que tengan todos los parámetros que necesitan. Esto es lo que algunos llaman &amp;quot;currying&amp;quot;. ¿Cómo se usa?&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">exclude_falsey &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Boolean&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">exclude_falsey&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&amp;#39;, &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">that&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>
&lt;p>Ese es un caso. Este es el otro.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">filter &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Boolean&lt;/span>&lt;span style="color:#5fb3b3;">) ([&lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&amp;#39;, &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">that&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>
&lt;p>¿Ven ese par de paréntesis extra? Esa es la segunda función. Necesitan colocar un par por cada parámetro que tenga la función.&lt;/p>
&lt;h3 id="curry-automatico">Curry automático&lt;/h3>
&lt;p>Volviendo al tema de la magia, pueden &amp;quot;automatizar&amp;quot; el proceso de curry usando una función.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">curry&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">arity&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// Adivina cuantos parámetros se necesitan
// Esto no funciona todo el tiempo.
&lt;/span>&lt;span style="color:#cccece;">arity &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">fn&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#5f6364;">// Ignora `fn` y `arity`, pon el resto es `rest``
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">rest &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Array&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">prototype&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">slice&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">call&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// ¿Tenemos lo que necesitamos?
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">arity &lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt;= &lt;/span>&lt;span style="color:#cccece;">rest&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">fn&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">apply&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">rest&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#5f6364;">// Ejecuta `curry.bind` con `fn`, `arity` y `rest` como parámetros
// retorna una función que espera el resto
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">curry&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">apply&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">curry&lt;/span>&lt;span style="color:#5fb3b3;">, [&lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">arity&lt;/span>&lt;span style="color:#5fb3b3;">, ...&lt;/span>&lt;span style="color:#cccece;">rest&lt;/span>&lt;span style="color:#5fb3b3;">]);
}
&lt;/span>&lt;/pre>
&lt;p>Con esto ya pueden transformar funciones ya existentes o crear nuevas que soporten el &amp;quot;curry&amp;quot; desde el inicio.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">curried_filter &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">curry&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">filter&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">exclude_falsey &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">curried_filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Boolean&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">exclude_falsey&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&amp;#39;, &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">that&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>
&lt;p>Ó.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">filter &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">curry&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">func&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">func&lt;/span>&lt;span style="color:#5fb3b3;">);
});
&lt;/span>&lt;/pre>
&lt;p>Eso es todo, amigos. Espero hayan disfrutado la lectura.&lt;/p>
&lt;h2 id="fuentes">Fuentes&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.youtube.com/watch?v=m3svKOdZijA">Hey Underscore, You're Doing It Wrong! (video)&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://benalman.com/news/2012/09/partial-application-in-javascript/">Partial Application in JavaScript&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Un poco del paradigma funcional en tu javascript: Los poderes de map</title><pubDate>Sat, 22 Feb 2020 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/es/web-development/functional-programming-for-your-everyday-javascript-the-power-of-map/</link><guid>https://vonheikemen.github.io/devlog/es/web-development/functional-programming-for-your-everyday-javascript-the-power-of-map/</guid><description>&lt;p>En esta ocasión vamos a dar un vistazo dentro del mundo de los &lt;code>functors&lt;/code> y descubrir qué los hace tan especiales. Functor es uno de esos términos que aparece cuando la gente a habla del paradigma funcional en la programación pero cuando llega el momento de explicar qué es, lo que ocurre es que mencionan otros términos abstractos o sólo cuantan los detalles necesarios que necesitan saber. Ya que no tengo ningún conocimiento formal de teoría de categorías no voy a fingir qué sé exactamente lo que son, lo que haré será dicerles lo suficiente para que puedan reconocerlos y cómo pueden usarlos.&lt;/p>
&lt;h2 id="que-es-un-functor">¿Qué es un functor?&lt;/h2>
&lt;p>Estoy convencido de qué el término es difícil de entender porque se necesita conocimientos de otro tipo de estructura para poder comprenderlos en su totalidad. Otra cosa que contribuye a la confusión es el hecho de que la teoría no sé traduce de la manera más clara en código. Pero bueno, aún así intentaré responder la pregunta, empezando con lo abstracto. &lt;/p>
&lt;p>Pueden pensar en ellos como la relación que existe entre dos conjuntos. Tengan paciencia, esto empezará a tener sentido en un momento. Imaginen dos arreglos.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">favorite_numbers &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">42&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">69&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">73&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">increased_numbers &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">43&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">70&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">74&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;/pre>
&lt;p>Bien, tenemos el conjunto &lt;code>favorite_numbers&lt;/code> y el conjunto &lt;code>increased_numbers&lt;/code>, son dos arreglos diferentes almacenados en dos variables separadas pero todos sabemos que hay una conexión entre ellos, lo que debemos tener en cuenta es que podemos expresar esa relación con código. Imaginen que el arreglo &lt;code>increased_numbers&lt;/code> no existe pero aún necesitamos esos números, para hacer que aparezcan nuevamente sólo necesitamos la ayuda de nuestro viejo amigo &lt;code>map&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">increased_numbers &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">favorite_numbers&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>&lt;code>map&lt;/code> va a recorrer todo el arreglo y por cada número va a incrementarlo y colocarlo en nuevo arreglo, lo que trae a &lt;code>increased_numbers&lt;/code> devuelta. Aunque hemos creado este arreglo nuevamente, este no salió de la nada, nosotros no inventamos los números &lt;code>43&lt;/code>, &lt;code>70&lt;/code> y &lt;code>74&lt;/code>. Lo que hicimos fue describir la relación que hay entre esos números y &lt;code>favorite_numbers&lt;/code>. &lt;/p>
&lt;p>¿Eso es todo? ¿Un functor es un arreglo? La respuesta a eso es un rotundo no. Los arreglos son simplemente una manera muy conveniente de representar un uso común. Esto deja una pregunta en el aire.&lt;/p>
&lt;h2 id="como-los-reconocemos">¿Cómo los reconocemos?&lt;/h2>
&lt;p>A menudo veo que otras personas los describen como cajas. No creo que estén totalmente errados porque utilizar un contenedor es una de las maneras más simples en las que se puede implementar un functor. La analogía de la caja es especialmente curiosa en javascript porque podemos usar corchetes para crear un arreglo. Vean.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Un valor
&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#5f6364;">// Una caja
&lt;/span>&lt;span style="color:#5fb3b3;">[];
&lt;/span>&lt;span style="color:#5f6364;">// Miren, un valor en una caja
&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;/pre>
&lt;p>Volviendo a la pregunta, ¿Cómo los reconocemos? Okey, resulta pasa y acontece que hay reglas.&lt;/p>
&lt;h3 id="las-reglas">Las reglas&lt;/h3>
&lt;p>De nuevo usaré arreglos con números sólo por lo conveniente pero estas reglas deben aplicar a todas aquellas estructuras que deseen ser parte del club functor.&lt;/p>
&lt;h4 id="identidad">Identidad&lt;/h4>
&lt;p>Dada la función &lt;code>identity&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">identity&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">x&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">x&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>&lt;code>value&lt;/code> and &lt;code>value.map(identity)&lt;/code> deben ser equivalentes.&lt;/p>
&lt;p>Por ejemplo.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">]; &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [1,2,3]
&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [1,2,3]
&lt;/span>&lt;/pre>
&lt;p>¿Qué? ¿Qué importancia tiene eso? ¿Qué nos dice?&lt;/p>
&lt;p>Buenas preguntas. Esto nos dice que la función &lt;code>map&lt;/code> debe preservar la forma de la estructura. En nuestro ejemplo si aplicamos &lt;code>map&lt;/code> a un arreglo de tres elementos debemos recibir un nuevo arreglo con tres elementos. Si fuera un arreglo con cien elementos deberíamos recibir un nuevo arreglo con cien elementos. Ya entienden.&lt;/p>
&lt;h4 id="composicion">Composición&lt;/h4>
&lt;p>Dadas dos funciones &lt;code>fx&lt;/code> y &lt;code>gx&lt;/code> lo siguiente debe ser cierto.&lt;/p>
&lt;p>&lt;code>value.map(fx).map(gx)&lt;/code> y &lt;code>value.map(arg =&amp;gt; gx(fx(arg)))&lt;/code> deben ser equivalentes.&lt;/p>
&lt;p>Otro ejemplo.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">* &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">;
}
[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [4]
&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">))); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [4]
&lt;/span>&lt;/pre>
&lt;p>Si ya saben como funciona &lt;code>Array.map&lt;/code> esto debería ser obvio. Aquí se presenta la oportunidad de optimizar el código para el desempeño o legibilidad. En el caso de los arreglos, múltiples llamadas a &lt;code>map&lt;/code> puede tener un gran impacto en el desempeño a medida que vaya creaciendo el número de elementos en la lista.&lt;/p>
&lt;p>Eso es todo. Esas dos reglas son lo único que deben tener en cuenta para reconocer un functor.&lt;/p>
&lt;h2 id="tiene-que-ser-map">¿Tiene que ser .map?&lt;/h2>
&lt;p>Supongo que ahora desean saber qué otro tipo de cosas siguen estas reglas que mencioné. Resulta que hay otra estructura bastante popular que sigue estas reglas y esa es &lt;code>Promise&lt;/code>. Vean.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Un valor
&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#5f6364;">// Una caja
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#5f6364;">// Miren, un valor en una caja
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Identidad
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 1 (eventualmente)
// Composición
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 4
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">))); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 4
&lt;/span>&lt;/pre>
&lt;p>Si somos honestos aquí, &lt;code>Promise.then&lt;/code> se comporta más como &lt;code>Array.flatMap&lt;/code> y no como &lt;code>.map&lt;/code> pero ignoremos eso.&lt;/p>
&lt;p>Bien, tenemos &lt;code>Array&lt;/code> y tenemos &lt;code>Promise&lt;/code> ambos actúan como contenedores y tienen métodos que siguen las reglas. ¿Pero qué pasaría si no existiera &lt;code>Array.map&lt;/code>? ¿Significa que &lt;code>Array&lt;/code> no es un functor? ¿Perdemos todos los beneficios?&lt;/p>
&lt;p>Vamos a dar un paso atrás. ¿Si &lt;code>Array.map&lt;/code> no existe &lt;code>Array&lt;/code> no es un &lt;code>functor&lt;/code>? No lo sé. ¿Perdemos todos los beneficios? No, aún podemos tratar los arreglos como un functor, lo que perdemos es la conviniencia de la sintaxis &lt;code>.map&lt;/code>. Aún podemos crear nuestro propio &lt;code>map&lt;/code> fuera de la estructura.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">List &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">arr&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= [];
&lt;/span>&lt;span style="color:#c594c5;">for &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">data &lt;/span>&lt;span style="color:#5fb3b3;">of &lt;/span>&lt;span style="color:#cccece;">arr&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">push&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
}
};
&lt;/span>&lt;/pre>
&lt;p>¿Ven? No está tan mal. Y funciona.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Identidad
&lt;/span>&lt;span style="color:#fac863;">List&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">, [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">]); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [1]
// Composición
&lt;/span>&lt;span style="color:#fac863;">List&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#fac863;">List&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">, [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">])); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [4]
&lt;/span>&lt;span style="color:#fac863;">List&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">)), [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">]); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [4]
&lt;/span>&lt;/pre>
&lt;p>¿Están pensando lo que yo? Probablemente no. Esto es lo que estoy pensando, si podemos crear &lt;code>map&lt;/code> para los arreglos entonces nada evita que hagamos uno para los objetos, después de todo, los objetos también son un conjunto de valores.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">Obj &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">ob&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= {};
&lt;/span>&lt;span style="color:#c594c5;">for &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">] of &lt;/span>&lt;span style="color:#fac863;">Object&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">entries&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">ob&lt;/span>&lt;span style="color:#5fb3b3;">)) {
&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">] = &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
}
};
&lt;/span>&lt;span style="color:#5f6364;">// ¿Por qué solo map?
// Basado en esto ya pueden ver cómo crear `filter` y `reduce`
&lt;/span>&lt;/pre>
&lt;p>Vamos a probar.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Identidad
&lt;/span>&lt;span style="color:#fac863;">Obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">, {&lt;/span>&lt;span style="color:#6699cc;">some&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">}); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; {some: 1, prop: 2}
// Composición
&lt;/span>&lt;span style="color:#fac863;">Obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#fac863;">Obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">, {&lt;/span>&lt;span style="color:#6699cc;">some&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">})); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; {some: 4, prop: 6}
&lt;/span>&lt;span style="color:#fac863;">Obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">)), {&lt;/span>&lt;span style="color:#6699cc;">some&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">}); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; {some: 4, prop: 6}
&lt;/span>&lt;/pre>&lt;h2 id="hazlo-tu-mismo">Hazlo tú mismo&lt;/h2>
&lt;p>Toda esta charla de arreglos y objetos es útil pero ahora pienso que sabemos lo suficiente para crear nuestro propio functor, las reglas parecen ser bastante sencillas. Vamos a hacer algo vagamente útil. ¿Alguna vez han escuchado de los Observables? Bien, vamos a hacer algo parecido. Vamos a crear una versión más simple de &lt;a href="https://mithril.js.org/stream.html">mithril-stream&lt;/a>, será divertido.&lt;/p>
&lt;p>Lo que queremos hacer es manejar un flujo de datos a través del tiempo. La interfaz de nuestra función será esta.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Crear instancia con valor inicial
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">num_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Crear un flujo dependendiente
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">increased &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Obtener el valor actual
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 0
// Colocar un nuevo valor en el flujo
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">42&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
// La fuente se actualiza
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
// El dependiente se actualiza
&lt;/span>&lt;span style="color:#6699cc;">increased&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 43
&lt;/span>&lt;/pre>
&lt;p>Empecemos con la función que obtiene y actualiza el valor.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">state&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#6699cc;">stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// Si tenemos un parametro actualizamos el estado
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt; &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">state &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#5f6364;">// retorna el estado actual
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">state&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">stream&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>Ahora esto debería funcionar.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Inicializamos
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">num_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">42&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Obtenemos el valor
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
// Actualizamos
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">73&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Revisamos
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 73
&lt;/span>&lt;/pre>
&lt;p>Ya sabemos que queremos un método &lt;code>map&lt;/code> pero ¿Cuál es el efecto que debe tener? Lo que queremos es que la función (el callback) escuche los cambios de la fuente. Empecemos con eso, lo que haremos será almacenar las funciones proporcionadas a &lt;code>map&lt;/code> en un arreglo y las ejecutaremos justo después de que se produzca el cambio.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function Stream(state) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> let listeners = [];
&lt;/span>&lt;span style="color:#5fb3b3;">+
&lt;/span>&lt;span style="color:#cccece;"> let stream = function(value) {
if(arguments.length &amp;gt; 0) {
state = value;
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> listeners.forEach(fn =&amp;gt; fn(value));
&lt;/span>&lt;span style="color:#cccece;"> }
return state;
}
return stream;
}
&lt;/span>&lt;/pre>
&lt;p>Ahora creamos el método &lt;code>map&lt;/code>, pero no debe ser un método cualquiera, debemos seguir las reglas.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Identidad: Cuando &lt;code>map&lt;/code> es ejecutado necesita preservar la forma de la estructura. Esto significa que debemos retornar otro &lt;code>stream&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Composición: Ejecutar &lt;code>map&lt;/code> varias veces debe ser equivalente a la composición de funciones proporciondas a esas llamadas.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">state&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">listeners &lt;/span>&lt;span style="color:#5fb3b3;">= [];
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#6699cc;">stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt; &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">state &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#cccece;">listeners&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">forEach&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">state&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#fac863;">stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// Crea una nueva instancia con el valor transformado.
// Esto ejecutara `fn` cuando se llame a `map`
// esto no siempre será lo mejor si `fn` tiene algún
// efecto fuera de su ámbito. Tengan cuidado.
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">target &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">state&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#5f6364;">// Transforma el valor y actualiza el nuevo flujo
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">listener &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">target&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#5f6364;">// Actualiza los dependientes de la fuente
&lt;/span>&lt;span style="color:#cccece;">listeners&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">push&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">listener&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">target&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">stream&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>Probemos las reglas. Comenzamos con identidad.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Los `Stream` son como una cascada
// el primero es el más importante
// este es el que activa los demás
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">num_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Crea el dependendiente
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">identity_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Actualiza la fuente
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">42&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Revisa
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
&lt;/span>&lt;span style="color:#6699cc;">identity_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
&lt;/span>&lt;/pre>
&lt;p>Ahora la composición.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Crea la fuente
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">num_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Crea los dependientes
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">map_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">composed_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">)));
&lt;/span>&lt;span style="color:#5f6364;">// Actualiza
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Revisa
&lt;/span>&lt;span style="color:#6699cc;">map_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 4
&lt;/span>&lt;span style="color:#6699cc;">composed_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 4
&lt;/span>&lt;/pre>
&lt;p>Nuestro trabajo está hecho. ¿Pero de verdad sirve? ¿Se puede hacer algo con eso? Bueno, sí, pueden usarlo para manejar eventos. Así.&lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="dyoMJRw"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="an fmap example">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/dyoMJRw">an fmap example&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;script async src="https://static.codepen.io/assets/embed/ei.js">&lt;/script>
&lt;h3 id="mas-ejemplos">Más ejemplos&lt;/h3>
&lt;p>Ahora ya deben tener un buen entendimiento de los functors, pero si quieren seguir viendo más pueden revisar estos artículos.&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://vonheikemen.github.io/devlog/es/web-development/functional-programming-for-your-everyday-javascript-using-a-maybe/">Manejar ausencia de valores&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://jrsinclair.com/articles/2018/how-to-deal-with-dirty-side-effects-in-your-pure-functional-javascript/">Manejo de efectos secundarios&lt;/a> (inglés)&lt;/li>
&lt;/ul>
&lt;h2 id="conclusion">Conclusión&lt;/h2>
&lt;p>Lo único que queda por responser es &amp;quot;¿Qué beneficios tienen los functors?&amp;quot;&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Este patrón nos permite enfocarnos en un problema a la vez. La función &lt;code>map&lt;/code> se encarga de obtener los datos necesarios y en el &lt;code>callback&lt;/code> nos podemos enfocar en cómo procesarlos.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Reutilización. Este estilo de programación promueve el uso y creación de funciones de generales que sólo se encargan de una tarea, en muchos casos estas pueden ser compartidas incluso entre proyectos.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Extensión a través de la composición. Hay gente que tiene sentimientos encontrados en este caso, especialmente si hablamos de aplicarlo a los arreglos. Pero lo que quiero decir es que los functors promueven el uso de cadenas de funciones para implementar un procedimiento.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="fuentes">Fuentes&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://dev.to/techgirl1908/why-is-map-called-map-2l03">Why is map called map?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/fantasyland/fantasy-land">Fantasy land&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/fantasyland/static-land">Static land&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/thefrontside/funcadelic.js">funcadelic.js&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://jrsinclair.com/articles/2018/how-to-deal-with-dirty-side-effects-in-your-pure-functional-javascript/">How to deal with dirty side effects in your pure functional JavaScript&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://jrsinclair.com/articles/2020/whats-more-fantastic-than-fantasy-land-static-land/">What’s more fantastic than fantasy land? An Introduction to Static land&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://medium.com/@lettier/your-easy-guide-to-monads-applicatives-functors-862048d61610">Your easy guide to Monads, Applicatives, &amp;amp; Functors&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Observables hechos en casa</title><pubDate>Sun, 24 Nov 2019 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/es/web-development/homemade-observables/</link><guid>https://vonheikemen.github.io/devlog/es/web-development/homemade-observables/</guid><description>&lt;p>En esta ocasión implementaremos nuestros propios observables. Al terminar espero que tengan un mejor entendimiento de cómo este patrón es usado en librerías como RxJS.&lt;/p>
&lt;h2 id="los-observables">Los Observables&lt;/h2>
&lt;h3 id="que-son">¿Qué son?&lt;/h3>
&lt;p>Empecemos con &lt;strong>mi&lt;/strong> definición de observable.&lt;/p>
&lt;blockquote>
&lt;p>Un Observable es una función que sigue una convención y es usada para conectar una fuente que emite datos a un consumidor.&lt;/p>
&lt;/blockquote>
&lt;p>En nuestro caso la fuente puede ser cualquier cosa produzca valores. Y, un consumidor es el que recibe datos.&lt;/p>
&lt;h3 id="datos-curiosos">Datos curiosos&lt;/h3>
&lt;h4 id="los-observables-no-hacen-nada-por-si-solos">Los Observables no hacen nada por sí solos&lt;/h4>
&lt;p>Quiero decir que estos no producen ningún efecto o comienzan a trabajar hasta que es absolutamente necesario. No hacen nada hasta que te suscribes a ellos.&lt;/p>
&lt;h4 id="pueden-emitir-datos">Pueden emitir datos&lt;/h4>
&lt;p>Dependendiendo de la fuente, pueden recibir un número infinito de valores.&lt;/p>
&lt;h4 id="pueden-ser-sincronos-o-asincronos">Pueden ser síncronos o asíncronos&lt;/h4>
&lt;p>Todo dependerá de su implementación. Se puede crear un observable que reciba valores de un evento que puede ocurrir en cualquier momento, también se pueden crear para procesar una colección de datos de manera síncrona.&lt;/p>
&lt;h3 id="algunas-reglas">Algunas reglas&lt;/h3>
&lt;p>Ya mencioné que se debe seguir una convención. Bueno, ahora vamos a definir algunas reglas arbitrarias que nuestra implementación va a seguir. Estas son importantes porque crearemos un pequeño ecosistema con nuestros observables.&lt;/p>
&lt;ol>
&lt;li>Deberán tener un método &lt;code>subscribe&lt;/code>.&lt;/li>
&lt;li>Nuestro &amp;quot;constructor&amp;quot; de observables aceptará un parámetro, será el suscriptor (&lt;code>subscriber&lt;/code>) el cual será una función.&lt;/li>
&lt;li>El suscriptor aceptará un parámetro, este será un objeto que llamaremos &lt;code>observer&lt;/code>.&lt;/li>
&lt;li>El objeto &lt;code>observer&lt;/code> puede implementar los siguientes métodos: &lt;code>next&lt;/code>, &lt;code>error&lt;/code> y &lt;code>complete&lt;/code>.&lt;/li>
&lt;/ol>
&lt;p>Empecemos.&lt;/p>
&lt;h3 id="el-codigo">El código&lt;/h3>
&lt;h3 id="constructor">Constructor&lt;/h3>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">subscriber&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">subscriber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">)
};
}
&lt;/span>&lt;span style="color:#5f6364;">// Se los juro, esto funciona
&lt;/span>&lt;/pre>
&lt;p>Tal vez es menos mágico de lo que pensaron. Lo que vemos aquí es que el constructor &lt;strong>Observable&lt;/strong> sólo es una forma de posponer el trabajo hasta que se ejecuta &lt;code>subscribe&lt;/code>. La función &lt;code>subscriber&lt;/code> es la que hace el trabajo pesado, eso es bueno porque podemos hacer lo que sea ahí, es lo que hace que nuestros observable sean útiles.&lt;/p>
&lt;p>Hasta ahora no he explicado el rol de &lt;code>observer&lt;/code> o &lt;code>subscriber&lt;/code>. Es mejor explicarlo con un ejemplo.&lt;/p>
&lt;h2 id="un-ejemplo">Un ejemplo&lt;/h2>
&lt;p>Digamos que queremos convertir un arreglo en un Observable. ¿Cómo lo hacemos?&lt;/p>
&lt;p>Pensemos en lo que sabemos hasta ahora:&lt;/p>
&lt;ul>
&lt;li>Podemos colocar la lógica dentro de la función &lt;code>subscriber&lt;/code>.&lt;/li>
&lt;li>Podemos contar con que nuestro objeto &lt;code>observer&lt;/code> tendrá uno de estos tres métodos &lt;code>next&lt;/code>, &lt;code>error&lt;/code> y &lt;code>complete&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>Podemos usar los métodos de &lt;code>observer&lt;/code> como canales de cómunicación. La función &lt;code>next&lt;/code> recibirá los valores que nos de la fuente. Utilizaremos &lt;code>error&lt;/code> cuando algo salga mal, algo así como el método &lt;code>catch&lt;/code> que tienen las promesas. Por último, utilizaremos &lt;code>complete&lt;/code> cuando la fuente deje de producir valores.&lt;/p>
&lt;p>La función para convertir un arreglo a observable puede ser así.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">arr&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">try &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#cccece;">arr&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">forEach&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">();
} &lt;/span>&lt;span style="color:#c594c5;">catch &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">e&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">error&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">e&lt;/span>&lt;span style="color:#5fb3b3;">);
}
});
}
&lt;/span>&lt;span style="color:#5f6364;">// Así la usamos
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">arrayStream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">4&lt;/span>&lt;span style="color:#5fb3b3;">]);
&lt;/span>&lt;span style="color:#cccece;">arrayStream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">({
&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">error&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">err &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">error&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">err&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">info&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">Listo&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
});
&lt;/span>&lt;span style="color:#5f6364;">// Y ahora a ver qué pasa en la cónsola.
&lt;/span>&lt;/pre>&lt;h3 id="tengan-cuidado">Tengan cuidado&lt;/h3>
&lt;p>Justo ahora nuestros observables básicamente son como un pueblo sin ley, podemos hacer todo tipo de cosas indebidas como seguir enviando valores después de llamar el método &lt;code>complete&lt;/code>. En un mundo ideal nuestros observables deberían darnos algunas garantías. &lt;/p>
&lt;ul>
&lt;li>Los métodos del objeto &lt;code>observer&lt;/code> deberían ser opcionales.&lt;/li>
&lt;li>Los métodos &lt;code>complete&lt;/code> y &lt;code>error&lt;/code> deberían llamar una función para dejar de observar, una función &lt;code>unsubscribe&lt;/code> (si esta existe).&lt;/li>
&lt;li>Si ejecutas &lt;code>unsubscribe&lt;/code> yo no podrás ejecutar los demás métodos.&lt;/li>
&lt;li>Si se ejecuta &lt;code>complete&lt;/code> o &lt;code>error&lt;/code> se dejarán de recibir valores.&lt;/li>
&lt;/ul>
&lt;h3 id="un-ejemplo-interactivo">Un ejemplo interactivo&lt;/h3>
&lt;p>Ya podemos empezar a hacer cosas interesantes con lo que tenemos hasta ahora. En este ejemplo hice una función que nos permite crear un observable de un evento. &lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="wxNYPV"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="Observables - basics">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/wxNYPV">Observables - basics&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;script async src="https://static.codepen.io/assets/embed/ei.js">&lt;/script>
&lt;h2 id="composicion">Composición&lt;/h2>
&lt;p>Ahora que sabemos cómo crearlos veamos cómo podemos manipularlos para extender sus capacidades.&lt;/p>
&lt;p>Esta vez lo que haremos será crear funciones complementarias y modificar nuestra implementación.&lt;/p>
&lt;h3 id="todo-esta-en-los-operadores">Todo está en los operadores&lt;/h3>
&lt;p>Los operadores son funciones que nos permitirán agregar características a nuestros observables mediante una cadena de funciones. Cada una de estas funciones aceptará un observable como parámetro, lo convertirá en su fuente y devolverá un nuevo observable.&lt;/p>
&lt;p>Sigamos con la temática del arreglo y hagamos un operador &lt;strong>map&lt;/strong> que intente imitar el comportamiento del método nativo map que tienen los arreglos. Nuestro operador hará lo siguiente: tomará un valor, aplicará una función sobre ese valor y emitirá el resultado.&lt;/p>
&lt;p>Hagamos el intento:&lt;/p>
&lt;p>Primer paso, vamos a recibir la función y la fuente de datos, luego devolveremos un observable.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">source$&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// continuará
&lt;/span>&lt;span style="color:#5fb3b3;">});
}
&lt;/span>&lt;/pre>
&lt;p>Ahora viene lo interesante, la fuente que recibimos es un observable y eso significa que podemos suscribirnos para recibir valores.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function map(transformFn, source$) {
return Observable(function(observer) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> return source$.subscribe(function(value) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> // continuará
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> });
&lt;/span>&lt;span style="color:#cccece;"> });
}
&lt;/span>&lt;/pre>
&lt;p>Lo siguiente será pasar el resultado de la transformación a &lt;code>observer&lt;/code> para que puedan &amp;quot;verlo&amp;quot; cuando se suscriban a este nuevo observable.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function map(transformFn, source$) {
return Observable(function(observer) {
return source$.subscribe(function(value) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> var newValue = transformFn(value);
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> observer.next(newValue);
&lt;/span>&lt;span style="color:#cccece;"> });
});
}
&lt;/span>&lt;/pre>
&lt;p>Hay otra forma de hacer esto. Si usamos funciones de una expresión (Arrow functions como se les conoce por ahí) sería algo así.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">source$&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#cccece;">source$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)
))
);
}
&lt;/span>&lt;/pre>
&lt;p>Ya podemos empezar a usarlo pero justo ahora tendríamos que hacerlo de esta manera.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">arr&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">arr&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">forEach&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">();
});
}
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">thisArray &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">4&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">plusOne &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">array$ &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">plusOne&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thisArray&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#cccece;">array$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;/pre>
&lt;p>Eso no es muy cómodo. Y si queremos seguir usando más funciones &lt;code>map&lt;/code> tendríamos que &amp;quot;envolverlas&amp;quot;, no me parece bien. Nos ocuparemos de eso ahora.&lt;/p>
&lt;h3 id="la-cadena">La cadena&lt;/h3>
&lt;p>Crearemos otro método que nos permitirá usar una cadena de operadores que extenderan un observable fuente. Esta función tomará una lista de funciones, cada función en la lista usará el observable retornado por la anterior.&lt;/p>
&lt;p>Primero veamos como podría hacerse esto en una función aislada.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">aFunctionArray&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">initialSource&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">reducerFn &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">source&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">source&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
};
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">finalResult &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">aFunctionArray&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reduce&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">reducerFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">initialSource&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">finalResult&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>Aquí usamos &lt;code>reduce&lt;/code> para recorrer el arreglo de funciones y por cada elemento se ejecuta &lt;code>reducerFn&lt;/code>. Dentro de &lt;code>reducerFn&lt;/code> en el primer recorrido &lt;code>source&lt;/code> tendrá el valor de &lt;code>initialSource&lt;/code> y en el resto &lt;code>source&lt;/code> será lo que &lt;code>reducerFn&lt;/code> retorne. &lt;code>finalResult&lt;/code> simplemente es el último resultado de &lt;code>reducerFn&lt;/code>.&lt;/p>
&lt;p>Con algunos ajustes a nuestro constructor podemos agregar esta función. También he reducido la implementación del método &lt;code>pipe&lt;/code> con algo de ayuda.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Observable &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">subscriber&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">observable &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">subscriber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">SafeObserver&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">fns&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">fns&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reduce&lt;/span>&lt;span style="color:#5fb3b3;">((&lt;/span>&lt;span style="color:#f99157;">source&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">source&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">observable&lt;/span>&lt;span style="color:#5fb3b3;">);
}
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">observable&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>Aún tenemos que hacer una cosa para asegurarnos que los operadores sean compatibles con el método &lt;code>pipe&lt;/code>. Justo ahora el operador &lt;code>map&lt;/code> espera tanto &lt;code>transformFn&lt;/code> como &lt;code>source&lt;/code>, eso no funcionará cuando usemos &lt;code>pipe&lt;/code>. Tendremos que dividirlo en dos funciones, una que reciba el parámetro inicial y otra que acepte la fuente. &lt;/p>
&lt;p>Tenemos opciones.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Opción 1
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// En lugar de devolver el observable
// regresamos una función que espera `source`
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">source$ &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#cccece;">source$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)
))
);
}
&lt;/span>&lt;span style="color:#5f6364;">// Opción 2
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">source$&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">source$ &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">undefined&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// en caso de no recibir `source`
// devolvemos una función una que recuerde `transformFn`
// y que espere `source`
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">placeholder &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">placeholder&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#cccece;">source$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)
))
);
}
&lt;/span>&lt;/pre>
&lt;p>Y ya finalmente podemos extender nuestros observables así.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">thisArray &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">4&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">plusOne &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">timesTwo &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">* &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">array$ &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thisArray&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">plusOne&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timesTwo&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">`&lt;/span>&lt;span style="color:#99c794;">number: &lt;/span>&lt;span style="color:#5fb3b3;">${&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">}`),
&lt;/span>&lt;span style="color:#5f6364;">// y otros...
&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#cccece;">array$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;/pre>
&lt;p>Estamos listos para crear más operadores.&lt;/p>
&lt;h2 id="otro-ejercicio">Otro ejercicio&lt;/h2>
&lt;p>Digamos que tenemos una función que muestra la hora en la cónsola cada segundo, y se detiene después de cinco segundos (sólo porque sí).&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">startTimer&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">interval &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">setInterval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">minutes &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Math&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">floor&lt;/span>&lt;span style="color:#5fb3b3;">((&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">/ &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">) % &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">().&lt;/span>&lt;span style="color:#6699cc;">padStart&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">0&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">seconds &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Math&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">floor&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">% &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">().&lt;/span>&lt;span style="color:#6699cc;">padStart&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">0&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">timeString &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">minutes &lt;/span>&lt;span style="color:#5fb3b3;">+ &amp;#39;&lt;/span>&lt;span style="color:#99c794;">:&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39; + &lt;/span>&lt;span style="color:#cccece;">seconds&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString &lt;/span>&lt;span style="color:#5fb3b3;">=== &amp;#39;&lt;/span>&lt;span style="color:#99c794;">00:05&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;) {
&lt;/span>&lt;span style="color:#6699cc;">clearInterval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">interval&lt;/span>&lt;span style="color:#5fb3b3;">);
}
}, &lt;/span>&lt;span style="color:#f99157;">1000&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Ahora bien, esa función no tiene nada de malo. Digo, hace su trabajo, es predecible y todo lo que necesitas saber está a plena vista. Pero recien aprendimos algo nuevo y queremos aplicarlo. Convertiremos esto en un observable.&lt;/p>
&lt;p>Primero lo primero, vamos a extraer la lógica que maneja el formateo y el cálculo del tiempo.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">paddedNumber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">().&lt;/span>&lt;span style="color:#6699cc;">padStart&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">0&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">readableTime&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">time&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">minutes &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Math&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">floor&lt;/span>&lt;span style="color:#5fb3b3;">((&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">/ &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">) % &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">seconds &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Math&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">floor&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">% &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">paddedNumber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">minutes&lt;/span>&lt;span style="color:#5fb3b3;">) + &amp;#39;&lt;/span>&lt;span style="color:#99c794;">:&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39; + &lt;/span>&lt;span style="color:#6699cc;">paddedNumber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">seconds&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Veamos qué hacemos con el tiempo. &lt;code>setInterval&lt;/code> es un buen candidato para convertirse una fuente, recibe un &amp;quot;callback&amp;quot; en el cual podemos producir valores y también tiene un mecanismo de &amp;quot;limpieza&amp;quot;. Es un buen observable.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">interval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">delay&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">counter &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">callback &lt;/span>&lt;span style="color:#5fb3b3;">= () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">counter&lt;/span>&lt;span style="color:#5fb3b3;">++);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">_interval &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">setInterval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">callback&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">delay&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">setUnsubscribe&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">clearInterval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">_interval&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">unsubscribe&lt;/span>&lt;span style="color:#5fb3b3;">;
});
}
&lt;/span>&lt;/pre>
&lt;p>Tenemos una forma reusable de crear y destruir un &lt;code>interval&lt;/code>.&lt;/p>
&lt;p>Puede que hayan notado que le pasamos un número a &lt;code>observer&lt;/code>, no lo llamamos &amp;quot;segundos&amp;quot; porque &lt;code>delay&lt;/code> puede ser cualquier número. Aquí no estamos siguiendo el tiempo, estamos contando las veces que &lt;code>callback&lt;/code> es ejecutado. ¿Por qué? Porque queremos que nuestros constructores sean genéricos. Siempre podremos modificar su comportamiento con operadores.&lt;/p>
&lt;p>Así usamos nuestro nuevo constructor.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// fingiremos que las demás funciones están por aquí
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">time$ &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">interval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1000&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">plusOne&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">readableTime&lt;/span>&lt;span style="color:#5fb3b3;">)
);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">unsubscribe &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">time$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">timeString&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString &lt;/span>&lt;span style="color:#5fb3b3;">=== &amp;#39;&lt;/span>&lt;span style="color:#99c794;">00:05&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;) {
&lt;/span>&lt;span style="color:#6699cc;">unsubscribe&lt;/span>&lt;span style="color:#5fb3b3;">();
}
});
&lt;/span>&lt;/pre>
&lt;p>Está mejor. Pero ese &lt;code>if&lt;/code> me molesta. Como que no debería estar ahí. ¿Saben que podemos hacer? Crear otro operador, uno que cancele la suscripción después de que &lt;code>interval&lt;/code> emita cinco valores.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">take&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">total&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">source$ &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// tendremos nuestro propio contador porque no confío
// en los valores que emiten otros observables
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">count &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">unsubscribeSource &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">source$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">count&lt;/span>&lt;span style="color:#5fb3b3;">++;
&lt;/span>&lt;span style="color:#5f6364;">// pasamos cada valor a `observer`
// la función subscribe aún recibirá cada valor original
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">count &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#cccece;">total&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// indicamos que el flujo a terminado y lo &amp;quot;destruimos&amp;quot;
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#6699cc;">unsubscribeSource&lt;/span>&lt;span style="color:#5fb3b3;">();
}
});
});
}
&lt;/span>&lt;/pre>
&lt;p>Ya tenemos un contador que se autodestruye. Finalmente.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// las otras funciones siguen ahí
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">time$ &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">interval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1000&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">plusOne&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">readableTime&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">take&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">5&lt;/span>&lt;span style="color:#5fb3b3;">)
);
&lt;/span>&lt;span style="color:#cccece;">time$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">({
&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">timeString &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">info&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;quot;&lt;/span>&lt;span style="color:#99c794;">Time&amp;#39;s up&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;)
});
&lt;/span>&lt;/pre>&lt;h2 id="patio-de-juegos">Patio de juegos&lt;/h2>
&lt;p>Hice un par de ejemplos en codepen para poder hacer experimentos con estas cosas. &lt;a href="https://codepen.io/VonHeikemen/pen/OwQYxG">Este de aquí&lt;/a> contiene todos el código relacionado con &lt;code>Observable&lt;/code> y algo más.&lt;/p>
&lt;p>Y este de aquí es el del ejercicio.&lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="VGZXZa"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="Observables - boring timer">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/VGZXZa">Observables - boring timer&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;h2 id="conclusion">Conclusión&lt;/h2>
&lt;p>Los Observables nos permiten hacer muchas cosas y con un algo de creatividad puedes convertir lo que sea en un observable. En serio, una promesa (Promise), una petición AJAX, un evento en el DOM, un arreglo... otro observable. Todo lo que se pueden imaginar puede ser una fuente de datos que pueden envolver en un observable. También nos dan habilidad de ensamblar soluciones utilizando funciones genéricas y otras más específicas.&lt;/p>
&lt;p>Aún así no son la solución perfecta para todo. Tendrán que decidir si la complejidad que traen vale la pena. Como en el ejemplo del intervalo, perdimos la simplicidad de &lt;code>startTimer&lt;/code> por la &amp;quot;flexibilidad&amp;quot; de los observables.&lt;/p>
&lt;h2 id="fuentes">Fuentes&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://medium.com/@benlesh/learning-observable-by-building-observable-d5da57405d87">Learning Observable By Building Observable&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://medium.com/@kevinkreuzer/observables-just-powerful-functions-a033c355b22c">Observables, just powerful functions?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://netbasal.com/whos-afraid-of-observables-bde0dc4f48cc">Who’s Afraid of Observables?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://netbasal.com/understanding-mergemap-and-switchmap-in-rxjs-13cf9c57c885">Understanding mergeMap and switchMap in RxJS&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://netbasal.com/javascript-observables-under-the-hood-2423f760584">JavaScript — Observables Under The Hood&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/zenparsing/zen-observable">Github repository - zen-observable&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dev.to/supermanitu/understanding-observables">Understanding Observables&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Un vistazo a las máquinas de estados finitos</title><pubDate>Thu, 14 Nov 2019 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/es/web-development/taking-a-look-at-finite-state-machine/</link><guid>https://vonheikemen.github.io/devlog/es/web-development/taking-a-look-at-finite-state-machine/</guid><description>&lt;h2 id="maquinas-de-que-quien">¿Máquinas de qué-- quién?&lt;/h2>
&lt;p>Las máquinas de estados finitos son una manera de modelar el comportamiento de un sistema. La idea es que tu &amp;quot;sistema&amp;quot; sólo puede encontrarse en un estado a la vez, y una entrada (evento) puede activar la transición a otro estado.&lt;/p>
&lt;h2 id="que-tipo-de-problemas-resuelven">¿Qué tipo de problemas resuelven?&lt;/h2>
&lt;p>Estados inválidos. ¿Cuántas veces han tenido que usar una variable con un booleano o un atributo como &amp;quot;disabled&amp;quot; para evitar que un usuario haga algo indebido? Al marcar las reglas de comportamiento por adelantado podemos evitar este tipo de cosas.&lt;/p>
&lt;h2 id="como-se-hace-eso-en-javascript">¿Cómo se hace eso en javascript?&lt;/h2>
&lt;p>Me alegra que preguntaran. La verdadera razón por la escribo esto es para mostrar una librería que vi el otro día. Vamos a usar &lt;a href="https://thisrobot.life/">robot3&lt;/a> para crear un máquina de frases semi-famosas.&lt;/p>
&lt;p>Lo que haremos será mostrar una &amp;quot;carta&amp;quot; con una frase y debajo de tendremos un botón que podremos usar para mostrar otra frase.&lt;/p>
&lt;p>Haremos esto un paso a la vez. Primero preparemos los posibles estados de la aplicación.&lt;/p>
&lt;p>Nuestra carta estará en estado &lt;code>idle&lt;/code> (algo así como 'esperando') o &lt;code>loading&lt;/code> (cargando) Crearemos nuestra máquina a partir de eso.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">import &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#cccece;">createMachine&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">state&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">interpret
&lt;/span>&lt;span style="color:#5fb3b3;">} &lt;/span>&lt;span style="color:#c594c5;">from &lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;&lt;/span>&lt;span style="color:#99c794;">https://unpkg.com/robot3@0.2.9/machine.js&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">mr_robot &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">createMachine&lt;/span>&lt;span style="color:#5fb3b3;">({
&lt;/span>&lt;span style="color:#6699cc;">idle&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#6699cc;">state&lt;/span>&lt;span style="color:#5fb3b3;">(),
&lt;/span>&lt;span style="color:#6699cc;">loading&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#6699cc;">state&lt;/span>&lt;span style="color:#5fb3b3;">()
});
&lt;/span>&lt;/pre>
&lt;p>Aquí cada &lt;code>estado&lt;/code> es un índice del &amp;quot;objeto de configuración&amp;quot; que le pasamos a &lt;code>createMachine&lt;/code>, vean que cada uno de estos índices deben ser el resultado de llamar la función &lt;code>state&lt;/code>.&lt;/p>
&lt;p>Ahora necesitamos transiciones. El estado &lt;code>idle&lt;/code> cambiará a estado &lt;code>loading&lt;/code> si ocurre un evento &lt;code>fetch&lt;/code> (buscar), &lt;code>loading&lt;/code> volverá a &lt;code>idle&lt;/code> cuando el evento &lt;code>done&lt;/code> (terminado) sea despachado.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> import {
createMachine,
state,
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> transition,
&lt;/span>&lt;span style="color:#cccece;"> interpret
} from &amp;#39;https://unpkg.com/robot3@0.2.9/machine.js&amp;#39;;
const mr_robot = createMachine({
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> idle: state(),
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> loading: state()
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> idle: state(transition(&amp;#39;fetch&amp;#39;, &amp;#39;loading&amp;#39;)),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> loading: state(transition(&amp;#39;done&amp;#39;, &amp;#39;idle&amp;#39;))
&lt;/span>&lt;span style="color:#cccece;"> });
&lt;/span>&lt;/pre>
&lt;p>&lt;code>transition&lt;/code> es lo que conecta los estados. El primer parámetro que recibe es el nombre del evento que lo activará, el segundo parámetro es el &amp;quot;evento destino&amp;quot; al cual cambiará. El resto de los parámetros consiste en una de funciones que serán ejecutadas cuando ocurra la transición.&lt;/p>
&lt;p>Luce bien y todo pero... uhm... ¿cómo hacemos pruebas? Por sí sola la máquina no hace nada. Necesitamos que nuestra máquina sea interpretada y para ello se la pasamos a la función &lt;code>interpret&lt;/code>, esta función nos devuelve un &amp;quot;servicio&amp;quot; con el cual podemos despachar eventos. Para asegurarnos que de verdad estamos haciendo algo vamos a usar el segundo parámetro de &lt;code>interpret&lt;/code> el cual será una función que &amp;quot;escuchará&amp;quot; los cambios de estado.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">handler &lt;/span>&lt;span style="color:#5fb3b3;">= ({ &lt;/span>&lt;span style="color:#f99157;">machine &lt;/span>&lt;span style="color:#5fb3b3;">}) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">machine&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">current&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#5fb3b3;">{ &lt;/span>&lt;span style="color:#cccece;">send &lt;/span>&lt;span style="color:#5fb3b3;">} = &lt;/span>&lt;span style="color:#6699cc;">interpret&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">mr_robot&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">handler&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>Ahora veamos si está viva.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">send&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#6699cc;">send&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#6699cc;">send&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#6699cc;">send&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">done&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#5f6364;">// Deberían ver en la cónsola
// loading (3)
// idle
&lt;/span>&lt;/pre>
&lt;p>Despachar &lt;code>fetch&lt;/code> hace que el estado actual se convierta en &lt;code>loading&lt;/code> y despachar&lt;code>done&lt;/code> lo regresa a &lt;code>idle&lt;/code>. Veo que no están impresionados. Bien. Intentemos algo más. Agregemos otro estado &lt;code>end&lt;/code> y hagamos que &lt;code>loading&lt;/code> cambie a ese, luego despachamos &lt;code>done&lt;/code> y vemos qué pasa.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const mr_robot = createMachine({
idle: state(transition(&amp;#39;fetch&amp;#39;, &amp;#39;loading&amp;#39;)),
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> loading: state(transition(&amp;#39;done&amp;#39;, &amp;#39;idle&amp;#39;))
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> loading: state(transition(&amp;#39;done&amp;#39;, &amp;#39;end&amp;#39;)),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> end: state()
&lt;/span>&lt;span style="color:#cccece;"> });
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">send&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">done&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#5f6364;">// Deberían ver en la cónsola
// idle
&lt;/span>&lt;/pre>
&lt;p>Enviar &lt;code>done&lt;/code> mientras el estado es &lt;code>idle&lt;/code> no activa el estado &lt;code>loading&lt;/code>, se queda en &lt;code>idle&lt;/code> porque ese estado no tiene un evento &lt;code>done&lt;/code>. Y ahora...&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// El curso normal de eventos.
&lt;/span>&lt;span style="color:#6699cc;">send&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#6699cc;">send&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">done&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#5f6364;">// Deberían ver en la cónsola
// loading
// end
// Intenten con `fetch`
&lt;/span>&lt;span style="color:#6699cc;">send&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#5f6364;">// Ahora...
// end
&lt;/span>&lt;/pre>
&lt;p>Si enviamos &lt;code>fetch&lt;/code> (o cualquier otro evento) mientras el estado es &lt;code>end&lt;/code> resultará en &lt;code>end&lt;/code> siempre. ¿Por qué? Porque no hay a dónde ir, &lt;code>end&lt;/code> no tiene transiciones.&lt;/p>
&lt;p>Espero que les haya sido útil, si no fue así me disculpo por tanto &lt;code>console.log&lt;/code>. &lt;/p>
&lt;p>Volvamos a nuestra máquina. Esto es lo que tenemos hasta ahora.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> &lt;/span>&lt;span style="color:#c594c5;">import &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#cccece;">createMachine&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">state&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">transition&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">interpret
&lt;/span>&lt;span style="color:#5fb3b3;">} &lt;/span>&lt;span style="color:#c594c5;">from &lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;&lt;/span>&lt;span style="color:#99c794;">https://unpkg.com/robot3@0.2.9/machine.js&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">mr_robot &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">createMachine&lt;/span>&lt;span style="color:#5fb3b3;">({
&lt;/span>&lt;span style="color:#6699cc;">idle&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#6699cc;">state&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">transition&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">fetch&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">loading&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)),
&lt;/span>&lt;span style="color:#6699cc;">loading&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#6699cc;">state&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">transition&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">done&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">idle&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;))
});
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">handler &lt;/span>&lt;span style="color:#5fb3b3;">= ({ &lt;/span>&lt;span style="color:#f99157;">machine &lt;/span>&lt;span style="color:#5fb3b3;">}) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">machine&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">current&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#5fb3b3;">{ &lt;/span>&lt;span style="color:#cccece;">send &lt;/span>&lt;span style="color:#5fb3b3;">} = &lt;/span>&lt;span style="color:#6699cc;">interpret&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">mr_robot&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">handler&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>Pero aún no es suficiente, ahora debemos extraer datos de alguna parte cuando el estado sea &lt;code>loading&lt;/code>. Vamos a fingir que buscamos los datos en nuestra función.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">get_quote&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#5f6364;">// crea un retraso de 3 a 5 segundos.
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">delay &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">random_number&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">5&lt;/span>&lt;span style="color:#5fb3b3;">) * &lt;/span>&lt;span style="color:#f99157;">1000&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">promise &lt;/span>&lt;span style="color:#5fb3b3;">= new &lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">res &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">setTimeout&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">res&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">&amp;lt;quote&amp;gt;&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;), &lt;/span>&lt;span style="color:#cccece;">delay&lt;/span>&lt;span style="color:#5fb3b3;">);
});
&lt;/span>&lt;span style="color:#5f6364;">// nomás pa&amp;#39; ver
&lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">res &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">res&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">res&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>Para integrar esta función a nuestra máquina vamos a usar la función &lt;code>invoke&lt;/code>, esta nos ayuda a manejar &amp;quot;funciones asíncronas&amp;quot; (una función que devuelve una promesa) cuando se active el estado, luego cuando la promesa se resuelve envía el evento &lt;code>done&lt;/code> (si algo falla envía el evento &lt;code>error&lt;/code>).&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> import {
createMachine,
state,
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> invoke,
&lt;/span>&lt;span style="color:#cccece;"> transition,
interpret
} from &amp;#39;https://unpkg.com/robot3@0.2.9/machine.js&amp;#39;;
const mr_robot = createMachine({
idle: state(transition(&amp;#39;fetch&amp;#39;, &amp;#39;loading&amp;#39;)),
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> loading: state(transition(&amp;#39;done&amp;#39;, &amp;#39;idle&amp;#39;)),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> loading: invoke(get_quote, transition(&amp;#39;done&amp;#39;, &amp;#39;idle&amp;#39;)),
&lt;/span>&lt;span style="color:#cccece;"> });
&lt;/span>&lt;/pre>
&lt;p>Si prueban &lt;code>send('fetch')&lt;/code> deberían ver en la cónsola.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">loading
// Esperen unos segundos...
&amp;lt;quote&amp;gt;
idle
&lt;/span>&lt;/pre>
&lt;p>Espero que estas alturas se estén preguntando ¿Y dónde guardamos los datos? &lt;code>createMachine&lt;/code> nos deja definir un &amp;quot;contexto&amp;quot; que estará disponible para nosotros en las función que apliquemos en las transiciones.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">context &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">ev &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">({
&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">: {},
});
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const mr_robot = createMachine({
idle: state(transition(&amp;#39;fetch&amp;#39;, &amp;#39;loading&amp;#39;)),
loading: invoke(get_quote, transition(&amp;#39;done&amp;#39;, &amp;#39;idle&amp;#39;)),
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> });
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> }, context);
&lt;/span>&lt;/pre>
&lt;p>Ahora agregaremos una función a nuestra transición &lt;code>loading&lt;/code>. Será el lugar donde modificaremos el context. Esta función es llamada &lt;code>reduce&lt;/code> y luce así.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">reduce&lt;/span>&lt;span style="color:#5fb3b3;">((&lt;/span>&lt;span style="color:#f99157;">ctx&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">ev&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">({ ...&lt;/span>&lt;span style="color:#cccece;">ctx&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">data&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">data &lt;/span>&lt;span style="color:#5fb3b3;">}))
&lt;/span>&lt;/pre>
&lt;p>Recibe el context actual, una carga (aquí la llamamos &lt;code>ev&lt;/code>) y lo que sea que devuelva se convertirá en tu nuevo contexto. &lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> import {
createMachine,
state,
invoke,
transition,
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> reduce,
&lt;/span>&lt;span style="color:#cccece;"> interpret
} from &amp;#39;https://unpkg.com/robot3@0.2.9/machine.js&amp;#39;;
const mr_robot = createMachine({
idle: state(transition(&amp;#39;fetch&amp;#39;, &amp;#39;loading&amp;#39;)),
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> loading: invoke(get_quote, transition(&amp;#39;done&amp;#39;, &amp;#39;idle&amp;#39;)),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> loading: invoke(
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> get_quote,
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> transition(
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> &amp;#39;done&amp;#39;,
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> &amp;#39;idle&amp;#39;,
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> reduce((ctx, ev) =&amp;gt; ({ ...ctx, data: ev.data }))
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> )
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> ),
&lt;/span>&lt;span style="color:#cccece;"> }, context);
&lt;/span>&lt;/pre>
&lt;p>Hora de probar. ¿Cómo lo hacemos? Modificamos el callback de &lt;code>interpret&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">handler &lt;/span>&lt;span style="color:#5fb3b3;">= ({ &lt;/span>&lt;span style="color:#f99157;">machine&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">context &lt;/span>&lt;span style="color:#5fb3b3;">}) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">JSON&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">stringify&lt;/span>&lt;span style="color:#5fb3b3;">({
&lt;/span>&lt;span style="color:#6699cc;">state&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">machine&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">current&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">context
&lt;/span>&lt;span style="color:#5fb3b3;">}));
}
&lt;/span>&lt;/pre>
&lt;p>Deberían ver esto.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">{&amp;#39;state&amp;#39;:&amp;#39;loading&amp;#39;,&amp;#39;context&amp;#39;:{&amp;#39;data&amp;#39;:{}}}
// esperen unos segundos...
{&amp;#39;state&amp;#39;:&amp;#39;idle&amp;#39;,&amp;#39;context&amp;#39;:{&amp;#39;data&amp;#39;:&amp;#39;&amp;lt;quote&amp;gt;&amp;#39;}}
&lt;/span>&lt;/pre>
&lt;p>Estamos listos. Mostremos algo en el navegador.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">main &lt;/span>&lt;span style="color:#bb80b3;">id&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">app&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; &lt;/span>&lt;span style="color:#bb80b3;">class&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">card&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">section &lt;/span>&lt;span style="color:#bb80b3;">id&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">card&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; &lt;/span>&lt;span style="color:#bb80b3;">class&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">card__content&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">div &lt;/span>&lt;span style="color:#bb80b3;">class&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">card__body&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">div &lt;/span>&lt;span style="color:#bb80b3;">class&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">card__quote&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&lt;/span>&lt;span style="color:#cccece;">
quote
&lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">div&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">div &lt;/span>&lt;span style="color:#bb80b3;">class&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">card__author&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&lt;/span>&lt;span style="color:#cccece;">
-- author
&lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">div&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">div&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">div &lt;/span>&lt;span style="color:#bb80b3;">class&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">card__footer&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">button &lt;/span>&lt;span style="color:#bb80b3;">id&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">load_btn&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; &lt;/span>&lt;span style="color:#bb80b3;">class&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">btn btn--new&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&lt;/span>&lt;span style="color:#cccece;">
More
&lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">button&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">a &lt;/span>&lt;span style="color:#bb80b3;">href&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">#&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; &lt;/span>&lt;span style="color:#bb80b3;">target&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">_blank&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; &lt;/span>&lt;span style="color:#bb80b3;">class&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">btn btn--tweet&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&lt;/span>&lt;span style="color:#cccece;">
Tweet
&lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">a&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">div&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">section&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">main&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#eb606b;">body &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">display&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">flex&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">justify-content&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">center&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">align-items&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">center&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">min-height&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">95vh&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">background&lt;/span>&lt;span style="color:#5fb3b3;">: #ddd;
&lt;/span>&lt;span style="color:#fac863;">font-size&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">1em&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">color&lt;/span>&lt;span style="color:#5fb3b3;">: #212121;
}
.&lt;/span>&lt;span style="color:#bb80b3;">card &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">width&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">600px&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">background&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">white&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">box-shadow&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">0 2px 5px 0 &lt;/span>&lt;span style="color:#6699cc;">rgba&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">0.16&lt;/span>&lt;span style="color:#5fb3b3;">)&lt;/span>&lt;span style="color:#cccece;">, &lt;/span>&lt;span style="color:#f99157;">0 2px 10px 0 &lt;/span>&lt;span style="color:#6699cc;">rgba&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">0.12&lt;/span>&lt;span style="color:#5fb3b3;">);
}
.&lt;/span>&lt;span style="color:#bb80b3;">card__content &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">color&lt;/span>&lt;span style="color:#5fb3b3;">: #212121;
&lt;/span>&lt;span style="color:#fac863;">padding&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">20px&lt;/span>&lt;span style="color:#5fb3b3;">;
}
.&lt;/span>&lt;span style="color:#bb80b3;">card__content--loader &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">height&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">95px&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">display&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">flex&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">align-items&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">center&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">justify-content&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">center
&lt;/span>&lt;span style="color:#5fb3b3;">}
.&lt;/span>&lt;span style="color:#bb80b3;">card__body &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">padding-bottom&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">15px&lt;/span>&lt;span style="color:#5fb3b3;">;
}
.&lt;/span>&lt;span style="color:#bb80b3;">card__author &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">padding-top&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">10px&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">font-style&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">italic&lt;/span>&lt;span style="color:#5fb3b3;">;
}
.&lt;/span>&lt;span style="color:#bb80b3;">card__footer &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">width&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">100%&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">display&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">flex&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">justify-content&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">space-between&lt;/span>&lt;span style="color:#5fb3b3;">;
}
.&lt;/span>&lt;span style="color:#bb80b3;">btn &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">color&lt;/span>&lt;span style="color:#5fb3b3;">: #fff;
&lt;/span>&lt;span style="color:#fac863;">cursor&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">pointer&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">margin-top&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">10px&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">margin-left&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">10px&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">border-radius&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">0.4rem&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">text-decoration&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">none&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">display&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">inline-block&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">padding&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">.3rem .9rem&lt;/span>&lt;span style="color:#5fb3b3;">;
}
.&lt;/span>&lt;span style="color:#bb80b3;">btn--new &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">background-color&lt;/span>&lt;span style="color:#5fb3b3;">: #2093be;
&lt;/span>&lt;span style="color:#fac863;">border&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">0.1rem solid &lt;/span>&lt;span style="color:#5fb3b3;">#2093be;
}
.&lt;/span>&lt;span style="color:#bb80b3;">btn--tweet &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">background-color&lt;/span>&lt;span style="color:#5fb3b3;">: #0074d9;
&lt;/span>&lt;span style="color:#fac863;">border&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">0.1rem solid &lt;/span>&lt;span style="color:#5fb3b3;">#0074d9;
}
.&lt;/span>&lt;span style="color:#bb80b3;">btn&lt;/span>&lt;span style="color:#5fb3b3;">:&lt;/span>&lt;span style="color:#cccece;">hover &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">background&lt;/span>&lt;span style="color:#5fb3b3;">: #3cb0fd;
&lt;/span>&lt;span style="color:#fac863;">border&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">0.1rem solid &lt;/span>&lt;span style="color:#5fb3b3;">#3cb0fd;
&lt;/span>&lt;span style="color:#fac863;">text-decoration&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">none&lt;/span>&lt;span style="color:#5fb3b3;">;
}
.&lt;/span>&lt;span style="color:#bb80b3;">hide &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">display&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">none&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>La última pieza del rompecabezas, los efectos secundarios. Necesitamos agregar otra función a la transición &lt;code>loading&lt;/code> para poder actualizar el DOM. Podríamos usar &lt;code>reduce&lt;/code> nuevamente pero es de mala educación hacer eso en algo que se llame &lt;code>reduce&lt;/code>. Utilizaremos otra función, una llamada &lt;code>action&lt;/code>.&lt;/p>
&lt;p>Pero primero debemos preprarnos. Modificaremos el contexto con las dependencias necesarias. (Este paso es innecesario, esto es sólo por mi alergia a las variables globales)&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const context = ev =&amp;gt; ({
data: {},
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> dom: {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> quote: document.querySelector(&amp;#39;.card__quote&amp;#39;),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> author: document.querySelector(&amp;#39;.card__author&amp;#39;),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> load_btn: window.load_btn,
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> tweet_btn: document.querySelector(&amp;#39;.btn--tweet&amp;#39;),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> card: window.card
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> }
&lt;/span>&lt;span style="color:#cccece;"> });
&lt;/span>&lt;/pre>
&lt;p>Ahora sí, efectos secundarios. En este punto deberían asegurarse que &lt;code>get_quote&lt;/code> devuelva un objeto con las propiedades &lt;code>quote&lt;/code> y &lt;code>author&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">update_card&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#f99157;">dom&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">data &lt;/span>&lt;span style="color:#5fb3b3;">}) {
&lt;/span>&lt;span style="color:#cccece;">dom&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">load_btn&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">textContent &lt;/span>&lt;span style="color:#5fb3b3;">= &amp;#39;&lt;/span>&lt;span style="color:#99c794;">More&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
&lt;/span>&lt;span style="color:#cccece;">dom&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">quote&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">textContent &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">quote&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#cccece;">dom&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">author&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">textContent &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">author&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">web_intent &lt;/span>&lt;span style="color:#5fb3b3;">= &amp;#39;&lt;/span>&lt;span style="color:#99c794;">https://twitter.com/intent/tweet?text=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">tweet &lt;/span>&lt;span style="color:#5fb3b3;">= `${&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">quote&lt;/span>&lt;span style="color:#5fb3b3;">}&lt;/span>&lt;span style="color:#99c794;"> -- &lt;/span>&lt;span style="color:#5fb3b3;">${&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">author&lt;/span>&lt;span style="color:#5fb3b3;">}`;
&lt;/span>&lt;span style="color:#cccece;">dom&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">tweet_btn&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">setAttribute&lt;/span>&lt;span style="color:#5fb3b3;">(
&amp;#39;&lt;/span>&lt;span style="color:#99c794;">href&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#cccece;">web_intent &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#6699cc;">encodeURIComponent&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">tweet&lt;/span>&lt;span style="color:#5fb3b3;">)
);
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">show_loading&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#f99157;">dom &lt;/span>&lt;span style="color:#5fb3b3;">}) {
&lt;/span>&lt;span style="color:#cccece;">dom&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">load_btn&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">textContent &lt;/span>&lt;span style="color:#5fb3b3;">= &amp;#39;&lt;/span>&lt;span style="color:#99c794;">Loading...&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
}
&lt;/span>&lt;/pre>
&lt;p>Juntamos todo.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> import {
createMachine,
state,
invoke,
transition,
reduce,
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> action,
&lt;/span>&lt;span style="color:#cccece;"> interpret
} from &amp;#39;https://unpkg.com/robot3@0.2.9/machine.js&amp;#39;;
const mr_robot = createMachine({
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> idle: state(transition(&amp;#39;fetch&amp;#39;, &amp;#39;loading&amp;#39;)),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> idle: state(transition(&amp;#39;fetch&amp;#39;, &amp;#39;loading&amp;#39;, action(show_loading))),
&lt;/span>&lt;span style="color:#cccece;"> loading: invoke(
get_quote,
transition(
&amp;#39;done&amp;#39;,
&amp;#39;idle&amp;#39;,
reduce((ctx, ev) =&amp;gt; ({ ...ctx, data: ev.data })),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> action(update_card)
&lt;/span>&lt;span style="color:#cccece;"> )
),
}, context);
&lt;/span>&lt;/pre>
&lt;p>Funciona. Pero se ve mal cuando carga por primera vez. Hagamos otra transición de carga, una que esconda la carta mientras se carga la primera frase.&lt;/p>
&lt;p>Empecemos por el HTML.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> &amp;lt;main id=&amp;quot;app&amp;quot; class=&amp;quot;card&amp;quot;&amp;gt;
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> &amp;lt;section class=&amp;quot;card__content card__content--loader&amp;quot;&amp;gt;
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> &amp;lt;p&amp;gt;Loading&amp;lt;/p&amp;gt;
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> &amp;lt;/section&amp;gt;
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> &amp;lt;section id=&amp;quot;card&amp;quot; class=&amp;quot;card__content&amp;quot;&amp;gt;
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> &amp;lt;section id=&amp;quot;card&amp;quot; class=&amp;quot;hide card__content&amp;quot;&amp;gt;
&lt;/span>&lt;span style="color:#cccece;"> &amp;lt;div class=&amp;quot;card__body&amp;quot;&amp;gt;
&amp;lt;div class=&amp;quot;card__quote&amp;quot;&amp;gt;
quote
&amp;lt;/div&amp;gt;
&amp;lt;div class=&amp;quot;card__author&amp;quot;&amp;gt;
-- author
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class=&amp;quot;card__footer&amp;quot;&amp;gt;
&amp;lt;button id=&amp;quot;load_btn&amp;quot; class=&amp;quot;btn btn--new&amp;quot;&amp;gt;
More
&amp;lt;/button&amp;gt;
&amp;lt;a href=&amp;quot;#&amp;quot; target=&amp;quot;_blank&amp;quot; class=&amp;quot;btn btn--tweet&amp;quot;&amp;gt;
Tweet
&amp;lt;/a&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/section&amp;gt;
&amp;lt;/main&amp;gt;
&lt;/span>&lt;/pre>
&lt;p>Creamos otro estado, &lt;code>empty&lt;/code>. Podemos reusar la lógica del estado &lt;code>loading&lt;/code> para esto. Creamos una función que crea transiciones.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">load_quote &lt;/span>&lt;span style="color:#5fb3b3;">= (...&lt;/span>&lt;span style="color:#f99157;">args&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#6699cc;">invoke&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#cccece;">get_quote&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">transition&lt;/span>&lt;span style="color:#5fb3b3;">(
&amp;#39;&lt;/span>&lt;span style="color:#99c794;">done&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;,
&amp;#39;&lt;/span>&lt;span style="color:#99c794;">idle&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;,
&lt;/span>&lt;span style="color:#6699cc;">reduce&lt;/span>&lt;span style="color:#5fb3b3;">((&lt;/span>&lt;span style="color:#f99157;">ctx&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">ev&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">({ ...&lt;/span>&lt;span style="color:#cccece;">ctx&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">data&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">data &lt;/span>&lt;span style="color:#5fb3b3;">})),
...&lt;/span>&lt;span style="color:#cccece;">args
&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">transition&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">error&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">idle&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
);
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const mr_robot = createMachine({
idle: state(transition(&amp;#39;fetch&amp;#39;, &amp;#39;loading&amp;#39;, action(show_loading))),
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> loading: invoke(
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> get_quote,
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> transition(
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> &amp;#39;done&amp;#39;,
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> &amp;#39;idle&amp;#39;,
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> reduce((ctx, ev) =&amp;gt; ({ ...ctx, data: ev.data })),
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> action(update_card)
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> )
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> ),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> loading: load_quote(action(update_card))
&lt;/span>&lt;span style="color:#cccece;"> }, context);
&lt;/span>&lt;/pre>
&lt;p>Ahora la usamos para esconder el esqueleto de la carta en la primera carga y muestre la frase cuando esté lista.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const context = ev =&amp;gt; ({
data: {},
dom: {
quote: document.querySelector(&amp;#39;.card__quote&amp;#39;),
author: document.querySelector(&amp;#39;.card__author&amp;#39;),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> loader: document.querySelector(&amp;#39;.card__content--loader&amp;#39;),
&lt;/span>&lt;span style="color:#cccece;"> load_btn: window.load_btn,
tweet_btn: document.querySelector(&amp;#39;.btn--tweet&amp;#39;),
card: window.card
}
});
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">hide_loader&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#f99157;">dom &lt;/span>&lt;span style="color:#5fb3b3;">}) {
&lt;/span>&lt;span style="color:#cccece;">dom&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">loader&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">classList&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">add&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">hide&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#cccece;">dom&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">card&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">classList&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">remove&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">hide&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
}
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const mr_robot = createMachine({
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> empty: load_quote(action(update_card), action(hide_loader)),
&lt;/span>&lt;span style="color:#cccece;"> idle: state(transition(&amp;#39;fetch&amp;#39;, &amp;#39;loading&amp;#39;, action(show_loading))),
loading: load_quote(action(update_card))
}, context);
&lt;/span>&lt;span style="color:#5fb3b3;">-
-&lt;/span>&lt;span style="color:#ec5f67;"> const handler = ({ machine, context }) =&amp;gt; {
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> console.log(JSON.stringify({
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> state: machine.current,
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> context
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> }));
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> }
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> const handler = () =&amp;gt; {};
&lt;/span>&lt;span style="color:#cccece;">
const { send } = interpret(mr_robot, handler);
&lt;/span>&lt;span style="color:#5fb3b3;">+
+&lt;/span>&lt;span style="color:#99c794;"> const fetch_quote = () =&amp;gt; send(&amp;#39;fetch&amp;#39;);
&lt;/span>&lt;span style="color:#5fb3b3;">+
+&lt;/span>&lt;span style="color:#99c794;"> window.load_btn.addEventListener(&amp;#39;click&amp;#39;, fetch_quote);
&lt;/span>&lt;/pre>
&lt;p>Veamos cómo quedó.&lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="OJJvQzR"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="Finite Random Quote Machine">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/OJJvQzR">Finite Random Quote Machine&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;script async src="https://static.codepen.io/assets/embed/ei.js">&lt;/script>
&lt;h2 id="entonces-esto-de-la-maquina-de-estados-finitos-fue-util">¿Entonces esto de la máquina de estados finitos fue útil?&lt;/h2>
&lt;p>Eso espero. ¿Notaron que nos permitió hacer un montón de pruebas y planear el comportamiento incluso antes de crear el HTML? Me parece que eso es genial.&lt;/p>
&lt;p>¿Intentaron darle click al botón 'loading' mientras cargaba? ¿Causó llamadas repetidas a &lt;code>get_quote&lt;/code>? Eso es porque hicimos que fuera (casi) imposible que el evento &lt;code>fetch&lt;/code> ocurriera durante &lt;code>loading&lt;/code>.&lt;/p>
&lt;p>No sólo eso, el comportamiento de la máquina y sus efectos en el mundo exterior están separados. Esto puede ser bueno o malo para ustedes pero eso depende de su tendencia filosófica.&lt;/p>
&lt;h2 id="quieren-saber-mas">¿Quieren saber más?&lt;/h2>
&lt;p>(me perdonan que todo estos sean en inglés.)&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://xstate.js.org/docs/about/concepts.html">XState (concepts)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://thisrobot.life/">robot3 - docs&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.freecodecamp.org/news/state-machines-basics-of-computer-science-d42855debc66/">Understanding State Machines&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Un poco del paradigma funcional en tu javascript: Usando un Maybe</title><pubDate>Tue, 29 Oct 2019 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/es/web-development/functional-programming-for-your-everyday-javascript-using-a-maybe/</link><guid>https://vonheikemen.github.io/devlog/es/web-development/functional-programming-for-your-everyday-javascript-using-a-maybe/</guid><description>&lt;p>¿Alguna vez han escuchado de las estructuras llamadas &amp;quot;monads&amp;quot; y lo geniales que son? Tal vez sí, pero aún no las entienden completamente. Bueno... aquí no intentaré definirlas y tampoco les diré si son geniales o no, lo que haré es mostrarles un ejemplo de cómo sería si las usaran en sus javascripts (específicamente el monad &lt;code>Maybe&lt;/code>).&lt;/p>
&lt;p>Haremos algo gracioso, resolveremos un problema trivial usando métodos innecesariamente complicados.&lt;/p>
&lt;p>Supongamos que tenemos un diccionario guardado en un archivo .json o en un objeto plano en nuestro script.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">{
&amp;quot;&lt;/span>&lt;span style="color:#99c794;">accident&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#cccece;">: &lt;/span>&lt;span style="color:#5fb3b3;">[&amp;quot;&lt;/span>&lt;span style="color:#99c794;">An unexpected, unfortunate mishap, failure or loss with the potential for harming human life, property or the environment.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">An event that happens suddenly or by chance without an apparent cause.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;],
&amp;quot;&lt;/span>&lt;span style="color:#99c794;">accumulator&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#cccece;">: &lt;/span>&lt;span style="color:#5fb3b3;">[&amp;quot;&lt;/span>&lt;span style="color:#99c794;">A rechargeable device for storing electrical energy in the form of chemical energy, consisting of one or more separate secondary cells.&lt;/span>&lt;span style="color:#5fb3b3;">\\&lt;/span>&lt;span style="color:#99c794;">n(Source: CED)&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;],
&amp;quot;&lt;/span>&lt;span style="color:#99c794;">acid&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#cccece;">: &lt;/span>&lt;span style="color:#5fb3b3;">[&amp;quot;&lt;/span>&lt;span style="color:#99c794;">A compound capable of transferring a hydrogen ion in solution.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Being harsh or corrosive in tone.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Having an acid, sharp or tangy taste.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">A powerful hallucinogenic drug manufactured from lysergic acid.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Having a pH less than 7, or being sour, or having the strength to neutralize alkalis, or turning a litmus paper red.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;],
&lt;/span>&lt;span style="color:#5f6364;">// ... más palabras y significados
&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#99c794;">Paris&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#cccece;">: &lt;/span>&lt;span style="color:#5fb3b3;">[&amp;quot;&lt;/span>&lt;span style="color:#99c794;">The capital and largest city of France.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;]
}
&lt;/span>&lt;/pre>
&lt;p>Queremos crear un formulario que le permita a un usuario buscar uno de estos términos y luego muestre su signicado. Parece simple ¿Qué podría salir mal?&lt;/p>
&lt;p>Y porque todo el mundo adora HTML empezaremos por ahí.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">form &lt;/span>&lt;span style="color:#bb80b3;">id&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">search_form&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">label &lt;/span>&lt;span style="color:#bb80b3;">for&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">search_input&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&lt;/span>&lt;span style="color:#cccece;">Search a word&lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">label&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">input &lt;/span>&lt;span style="color:#bb80b3;">id&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">search_input&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; &lt;/span>&lt;span style="color:#bb80b3;">type&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">text&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">button &lt;/span>&lt;span style="color:#bb80b3;">type&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">submit&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&lt;/span>&lt;span style="color:#cccece;">Submit&lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">button&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">form&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">div &lt;/span>&lt;span style="color:#bb80b3;">id&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">result&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">div&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&lt;/span>&lt;/pre>
&lt;p>En nuestro primer intento sólo intentaremos obtener uno de esos valores basado en la consulta del usuario.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
// haz magia y tráeme los datos
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">entries &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">data&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">format&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">results&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">results&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">join&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">&amp;lt;br&amp;gt;&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
}
&lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">search_form&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">addEventListener&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">submit&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">ev&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">preventDefault&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">input &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">target&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">innerHTML &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">format&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">]);
});
&lt;/span>&lt;/pre>
&lt;p>Naturalmente lo primero que haremos es probar con acid. Ahora contemplen los resultados.&lt;/p>
&lt;blockquote>
&lt;p>A compound capable of transferring a hydrogen ion in solution.
Being harsh or corrosive in tone.
Having an acid, sharp or tangy taste.
A powerful hallucinogenic drug manufactured from lysergic acid.
Having a pH less than 7, or being sour, or having the strength to neutralize alkalis, or turning a litmus paper red.&lt;/p>
&lt;/blockquote>
&lt;p>Ahora buscaremos &amp;quot;paris&amp;quot;, estoy seguro que está ahí. ¿Qué obtuvimos? Nada. No exactamente, tenemos.&lt;/p>
&lt;blockquote>
&lt;p>TypeError: results is undefined&lt;/p>
&lt;/blockquote>
&lt;p>Pero tambíen tenemos un botón impredecible que se congela en ocasiones. ¿Pero qué queremos? ¿Qué queremos en realidad? Seguridad, objetos que no hagan estallar nuestra aplicación, queremos objetos confiables.&lt;/p>
&lt;p>Entonces lo que haremos será implementar una especie de contenedor que nos permita describir el flujo de ejecución sin tener que preocuparnos por el valor que este contenga. ¿Suena bien, no? Déjenme mostrarles lo que quiero decir con un poco de javascript. Intenten esto.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">is_even &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">% &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">odd_arr &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">4&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">5&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">is_even&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">());
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">empty_arr &lt;/span>&lt;span style="color:#5fb3b3;">= [].&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">is_even&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">());
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">({&lt;/span>&lt;span style="color:#cccece;">odd_arr&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">empty_arr&lt;/span>&lt;span style="color:#5fb3b3;">});
&lt;/span>&lt;/pre>
&lt;p>¿Generó un error el arreglo vacío? (si lo hizo díganme). ¿No es genial? ¿No se siente bien saber que los métodos del arreglo harán lo correcto incluso si no tienen nada con qué trabajar? Eso es lo que queremos.&lt;/p>
&lt;p>Tal vez se estén preguntando ¿No puedo simplemente poner un &lt;code>if&lt;/code> y ya? Bueno... sí, ¿pero eso qué tiene de divertido? Todos saben que hacer una cadena de funciones se ve genial, y somos fánaticos de la &amp;quot;programación funcional,&amp;quot; así que haremos lo que los conocedores de ese paradigma harían: &lt;strong>esconderemos todo dentro de una función&lt;/strong>. &lt;/p>
&lt;p>Entonces lo que haremos será esconder un par de &lt;code>if&lt;/code>, si el valor que debemos evaluar es indefinido devolveremos un contenedor que sabrá qué hacer sin importar lo que pase.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// maybe.js
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">the_thing &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">null
&lt;/span>&lt;span style="color:#5fb3b3;">|| &lt;/span>&lt;span style="color:#cccece;">the_thing &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">undefined
&lt;/span>&lt;span style="color:#5fb3b3;">|| &lt;/span>&lt;span style="color:#cccece;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">is_nothing
&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">();
}
&lt;/span>&lt;span style="color:#5f6364;">// No queremos estructuras anidadas.
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Just&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Pero estos contenedores no serán los típicos &lt;code>Maybe&lt;/code> que se ven en un lenguaje propio del paradigma funcional. Nosotros haremos trampa en el nombre de la conveniencia y los efectos secundarios. Sus métodos estaran inspirados por el tipo de dato &lt;code>Option&lt;/code> que tiene Rust. Aquí es donde está la magia.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// maybe.js
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Just&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">thing&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#6699cc;">and_then&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">or_else&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">tap&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">predicate_fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#6699cc;">predicate_fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">)
? &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">)
: &lt;/span>&lt;span style="color:#6699cc;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">(),
&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_nothing&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">inspect&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">`&lt;/span>&lt;span style="color:#99c794;">Just(&lt;/span>&lt;span style="color:#5fb3b3;">${&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">}&lt;/span>&lt;span style="color:#99c794;">)&lt;/span>&lt;span style="color:#5fb3b3;">`,
};
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#cccece;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">and_then&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">or_else&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(),
&lt;/span>&lt;span style="color:#cccece;">tap&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">filter&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_nothing&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">inspect&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">`&lt;/span>&lt;span style="color:#99c794;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">`,
};
}
&lt;/span>&lt;/pre>
&lt;p>¿Qué hacen estos métodos?&lt;/p>
&lt;ul>
&lt;li>&lt;code>map&lt;/code>: Aplica la función &lt;code>fun&lt;/code> a &lt;code>the_thing&lt;/code> y vuelve a colocarlo en un &lt;code>Maybe&lt;/code> para mantener la forma del objeto, esto para que podamos encadenar más funciones.&lt;/li>
&lt;li>&lt;code>and_then&lt;/code>: Este sólo está ahí para los casos de emergencia. Aplica la función &lt;code>fun&lt;/code> y que el destino decida el resto.&lt;/li>
&lt;li>&lt;code>or_else&lt;/code>: Este sería el complemento &lt;code>else&lt;/code> para nuestro &lt;code>map&lt;/code> y &lt;code>and_then&lt;/code>. Es el otro camino. El &amp;quot;¿qué pasa si no hay nada ahí?&amp;quot;&lt;/li>
&lt;li>&lt;code>tap&lt;/code>: Está ahí para cuando necesitemos una función que afecta algo que está fuera de su ámbito (o tal vez es sólo para colocar un &lt;code>console.log&lt;/code>).&lt;/li>
&lt;li>&lt;code>filter&lt;/code>: Si la función que proporcionas devuelve &lt;code>true&lt;/code> o algo parecido entonces &amp;quot;te dejará pasar.&amp;quot; &lt;/li>
&lt;li>&lt;code>unwrap_or&lt;/code>: Este es el que saca el valor del contenedor. Usarán esto cuando se cansen de encadenar funciones y estén listos para volver al mundo imperativo.&lt;/li>
&lt;/ul>
&lt;p>Volvamos a nuestro formulario para aplicar todo esto. Crearemos una función &lt;code>search&lt;/code> que puede o no devolvernos un resultado a la consulta del usuario. Si lo hace encadenamos otras funciones que se ejecutarán en un &amp;quot;contexto seguro.&amp;quot;&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">search &lt;/span>&lt;span style="color:#5fb3b3;">= (&lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">input&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">]);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">search_word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">word &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">format&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">word not found&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;/pre>
&lt;p>Ahora reemplazamos la antigua función.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> window.search_form.addEventListener(&amp;#39;submit&amp;#39;, function(ev) {
ev.preventDefault();
let input = ev.target[0];
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> window.result.innerHTML = format(entries[input.value]);
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> window.result.innerHTML = search_word(input.value);
&lt;/span>&lt;span style="color:#cccece;"> });
&lt;/span>&lt;/pre>
&lt;p>Probemos. Buscaremos &amp;quot;accident.&amp;quot;&lt;/p>
&lt;blockquote>
&lt;p>An unexpected, unfortunate mishap, failure or loss with the potential for harming human life, property or the environment.
An event that happens suddenly or by chance without an apparent cause.&lt;/p>
&lt;/blockquote>
&lt;p>Ahora Paris. Busquemos &amp;quot;paris.&amp;quot;&lt;/p>
&lt;blockquote>
&lt;p>word not found&lt;/p>
&lt;/blockquote>
&lt;p>No congeló el botón, eso es bueno. Pero yo sé que Paris está ahí. Si revisan verán que está &amp;quot;Paris.&amp;quot; Sólo tendremos que colocar en mayúscula la primera letra para que el usuario no tenga que hacerlo. Primero intentaremos buscar la palabra exacta y luego intentamos del otro modo.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">create_search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">exact&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">input &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">exact &lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#cccece;">input &lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#6699cc;">capitalize&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">]);
}
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">capitalize&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">str&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">charAt&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">toUpperCase&lt;/span>&lt;span style="color:#5fb3b3;">() + &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">slice&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Modificamos la función &lt;code>search&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> const search = (data, input) =&amp;gt; Maybe(data[input]);
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> const search = create_search(entries, true);
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> const search_name = create_search(entries, false);
&lt;/span>&lt;span style="color:#5fb3b3;">-
-&lt;/span>&lt;span style="color:#ec5f67;"> const search_word = word =&amp;gt; search(entries, word)
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> const search_word = word =&amp;gt; search(word)
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> .or_else(() =&amp;gt; search_name(word))
&lt;/span>&lt;span style="color:#cccece;"> .map(format)
.unwrap_or(&amp;#39;word not found&amp;#39;);
&lt;/span>&lt;/pre>
&lt;p>Bien. Esto es lo que tenemos hasta ahora en &lt;code>main.js&lt;/code> si quieren ver todo el panorama.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">entries &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">data&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">create_search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">exact&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">input &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">exact &lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#cccece;">input &lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#6699cc;">capitalize&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">]);
}
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">capitalize&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">str&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">charAt&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">toUpperCase&lt;/span>&lt;span style="color:#5fb3b3;">() + &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">slice&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">format&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">results&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">results&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">join&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">&amp;lt;br&amp;gt;&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
}
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">search &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">create_search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">search_name &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">create_search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">search_word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">word &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">or_else&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">search_name&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">format&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">word not found&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">search_form&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">addEventListener&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">submit&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">ev&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">preventDefault&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">input &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">target&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">innerHTML &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">search_word&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
});
&lt;/span>&lt;/pre>
&lt;p>¿Pero es todo lo que queremos? No, claro que no, también queremos encontrar el amor, pero ya que javascript no puede hacer eso, nos conformaremos con agregar una funcionalidad de &amp;quot;sugerencia.&amp;quot; Quiero que cuando escriba &amp;quot;accu&amp;quot; y presione el botón, que salga un dialogo que me diga &amp;quot;Did you mean accumulator?&amp;quot; (en inglés porque no me pagan lo suficiente para traducir los mensajes del sistema) &lt;/p>
&lt;p>Para esto necesitaremos ayuda, instalaremos una dependencia, una que encuentre resultados similares: &lt;a href="https://github.com/wouter2203/fuzzy-search#readme">fuzzy-search&lt;/a>. Agreguemos lo siguiente.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">import &lt;/span>&lt;span style="color:#cccece;">FuzzySearch &lt;/span>&lt;span style="color:#c594c5;">from &lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;&lt;/span>&lt;span style="color:#99c794;">https://unpkg.com/fuzzy-search@3.0.1/src/FuzzySearch.js&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">fzf &lt;/span>&lt;span style="color:#5fb3b3;">= new &lt;/span>&lt;span style="color:#cccece;">FuzzySearch&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#fac863;">Object&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">keys&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">),
[],
{&lt;/span>&lt;span style="color:#6699cc;">caseSensitive&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">sort&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">}
);
&lt;/span>&lt;/pre>
&lt;p>Pero volvemos a la misma situación, esta no sería una operación segura porque en el momento que intentemos sacar un resultado de un arreglo vacío todo se cae. ¿Entonces qué hacemos? Escondemos todo debajo de una función.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">suggest&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">word&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">matches &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">fzf&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">matches&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">]);
}
&lt;/span>&lt;/pre>
&lt;p>FuzzySearch está listo, ahora agregaremos un grandioso dialogo de confirmación.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">confirm_word&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value &lt;/span>&lt;span style="color:#5fb3b3;">&amp;amp;&amp;amp; &lt;/span>&lt;span style="color:#6699cc;">confirm&lt;/span>&lt;span style="color:#5fb3b3;">(`&lt;/span>&lt;span style="color:#99c794;">Did you mean &lt;/span>&lt;span style="color:#5fb3b3;">${&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">}`)) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
}
&lt;/span>&lt;/pre>
&lt;p>Combinemos las nuevas funciones con &lt;code>search&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">suggest_word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">suggest&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">confirm_word&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">search&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>Agregamos la nueva funcionalidad a &lt;code>search_word&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const search_word = word =&amp;gt; search(word)
.or_else(() =&amp;gt; search_name(word))
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> .or_else(suggest_word(word))
&lt;/span>&lt;span style="color:#cccece;"> .map(format)
.unwrap_or(&amp;#39;word not found&amp;#39;);
&lt;/span>&lt;/pre>
&lt;p>Funciona. Pero ahora digamos que somos alérgicos a los &lt;code>if&lt;/code>, sin mencionar que es de mala educación devolver &lt;code>undefined&lt;/code> de una función. Podemos ser mejores.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function confirm_word(value) {
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> if(value &amp;amp;&amp;amp; confirm(`Did you mean ${value}`)) {
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> return value;
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> }
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> return confirm(`Did you mean ${value}`);
&lt;/span>&lt;span style="color:#cccece;"> }
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const suggest_word = value =&amp;gt; () =&amp;gt; suggest(value)
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> .map(confirm_word)
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> .filter(confirm_word)
&lt;/span>&lt;span style="color:#cccece;"> .map(search);
&lt;/span>&lt;/pre>
&lt;p>Algo me molesta. Cuando busco &amp;quot;accu,&amp;quot; el dialogo aparece, confirmo la sugerencia y el resultado aparece. Pero &amp;quot;accu&amp;quot; sigue ahí en el formulario, es incómodo. Haremos el formulario se actualice con la palabra correcta.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">update_input &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">search_form&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const suggest_word = value =&amp;gt; () =&amp;gt; suggest(value)
.filter(confirm_word)
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> .tap(update_input)
&lt;/span>&lt;span style="color:#cccece;"> .map(search);
&lt;/span>&lt;/pre>
&lt;p>¿Quieren verlo en acción? Aquí tienen.&lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="JjjNvLE"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="Maybe I got your word">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/JjjNvLE">Maybe I got your word&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;script async src="https://static.codepen.io/assets/embed/ei.js">&lt;/script>
&lt;h2 id="bonus-track">Bonus track&lt;/h2>
&lt;blockquote>
&lt;p>&lt;em>Advertencia&lt;/em>: El objetivo de todo esto ya fue logrado, que vieran ese ejemplo en codepen. Lo que sigue es un experimento para ver si podía agregar soporte de operaciones asíncronas en la función &lt;code>Maybe&lt;/code>. Si ya están cansados vayan directo al final y vean el último ejemplo.&lt;/p>
&lt;/blockquote>
&lt;p>Ahora quizá estén pensando: muy bonito y todo pero en el &amp;quot;mundo real&amp;quot; hacemos peticiones a servidores, consultamos bases de datos, hacemos todo tipo de cosas asíncronas, ¿puedo usar eso en este contexto? &lt;/p>
&lt;p>Bien. Entiendo. La implementación actual sólo contempla tareas normales. Tendrían que romper la cadena de &lt;code>Maybe&lt;/code>s en el momento que aparezca una promesa (&lt;code>Promise&lt;/code>)&lt;/p>
&lt;p>Podemos crear un nuevo &lt;code>Just&lt;/code> que esté consciente de que contiene una promesa. Es perfectamente posible, ¿un &lt;code>AsyncJust&lt;/code>? ¿&lt;code>JustAsync&lt;/code>? Suena horrible. &lt;/p>
&lt;p>Por si no lo saben, una promesa en javascript (me refiero a una instancia de la clase &lt;code>Promise&lt;/code>) es un tipo de dato que se utiliza para coordinar eventos futuros. Lo hace usando un método llamado &lt;code>then&lt;/code> el cual acepta una función (lo que llaman callback) y también tiene un método &lt;code>catch&lt;/code> para cuando las cosas salen mal. Pero si controlamos lo que va dentro del &lt;code>then&lt;/code> podemos mantener la misma interface del &lt;code>Maybe&lt;/code>.&lt;/p>
&lt;p>¿Qué tan buenos son siguiendo un montón de callbacks?&lt;/p>
&lt;p>Aquí está. Lo llamaré &lt;code>Future&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// no me juzguen
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">map_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">))),
&lt;/span>&lt;span style="color:#6699cc;">and_then&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">map_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">))),
&lt;/span>&lt;span style="color:#6699cc;">or_else&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#6699cc;">tap&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">))),
&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">filter_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">))),
&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_nothing&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_future&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">inspect&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">`&lt;/span>&lt;span style="color:#99c794;">&amp;lt;Promise&amp;gt;&lt;/span>&lt;span style="color:#5fb3b3;">`
};
}
&lt;/span>&lt;/pre>
&lt;p>Si apartamos todo el ruido tal vez se pueda entender mejor.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">
&lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#cccece;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">and_then: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">or_else: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">tap: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">))&lt;/span>&lt;span style="color:#cccece;">)&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">unwrap_or: &lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">filter: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">}
&lt;/span>&lt;/pre>
&lt;ul>
&lt;li>&lt;code>map&lt;/code>/&lt;code>and_then&lt;/code>: estos son iguales porque no puedes escaparte de una promesa.&lt;/li>
&lt;li>&lt;code>or_else&lt;/code>: toma la función proporcionada y la pasa al método &lt;code>catch&lt;/code>, esto para imitar el comportamiento de un &lt;code>else&lt;/code>.&lt;/li>
&lt;li>&lt;code>tap&lt;/code>: usa el método &lt;code>then&lt;/code> para &amp;quot;echarle un vistazo&amp;quot; al valor dentro de la promesa. Este método es conviniente para colocar esas funciones &amp;quot;impuras&amp;quot; que tienen efecto sobre el mundo exterior.&lt;/li>
&lt;li>&lt;code>unwrap_or&lt;/code>: Esto devuelve la promesa para que puedan usar &lt;code>await&lt;/code>. Si todo sale bien obtendrán el valor original de la promesa, sino devolverá el primer parámetro que fue proporcionado.&lt;/li>
&lt;li>&lt;code>filter&lt;/code>: este es un caso especial de &lt;code>map&lt;/code>, es por eso que existe &lt;code>filter_future&lt;/code>. &lt;/li>
&lt;li>Casi todos estos métodos devuelven un nuevo &lt;code>Future&lt;/code> porque &lt;code>promise.then&lt;/code> siempre devuelve una nueva promesa.&lt;/li>
&lt;/ul>
&lt;p>Pero lo que hace que &lt;code>Future&lt;/code> sea raro es lo que pasa dentro de &lt;code>map&lt;/code>. ¿Recuerdan &lt;code>map_future&lt;/code>?&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fun&lt;/span>&lt;span style="color:#5fb3b3;">) { &lt;/span>&lt;span style="color:#5f6364;">// `fun` es el callback proporcionado
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#5f6364;">/* Evaluemos el valor original de la promesa */
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">promise_content &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#5f6364;">// Necesitamos decidir si podemos confiar
// en el valor original
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_content&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#cccece;">is_nothing&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reject&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">return&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#5f6364;">// Si es un Just obtenemos su contenido
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_content&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">promise_content &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">();
}
&lt;/span>&lt;span style="color:#5f6364;">/* Evaluemos el valor que devuelve el callback */
// Usaremos Maybe otra vez
// porque tengo problemas de confianza.
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_content&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// Si llegamos hasta aquí todo está bien.
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">();
}
&lt;/span>&lt;span style="color:#5f6364;">// en este punto debería revisar si result
// tiene un Future pero de ser así
// lo están usando mal, así que por ahora
// no hago nada.
// Algo anda muy mal.
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reject&lt;/span>&lt;span style="color:#5fb3b3;">();
}
}
&lt;/span>&lt;/pre>
&lt;p>Ahora &lt;code>filter_future&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">filter_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">predicate_fun&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">predicate_fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// ¿Acaso devolviste una promesa?
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">then&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// Lo hiciste. Es por eso que no te pasan cosas buenas.
// veamos dentro de la promesa.
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">return_result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">the_real_result &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">the_real_result
&lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#cccece;">val
&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reject&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#5f6364;">// mantenemos la cadena viva.
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">return_result&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#cccece;">val &lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reject&lt;/span>&lt;span style="color:#5fb3b3;">();
}
}
&lt;/span>&lt;/pre>
&lt;p>Lo último que me gustaría hacer es crear una función que convierta un valor regular en un &lt;code>Future&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#fac863;">Future&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">from_val &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;/pre>
&lt;p>Ahora lo que tenemos que hacer para agregar soporte dentro de &lt;code>Maybe&lt;/code> es esto.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function Maybe(the_thing) {
if(the_thing === null
|| the_thing === undefined
|| the_thing.is_nothing
) {
return Nothing();
}
&lt;/span>&lt;span style="color:#5fb3b3;">-
-&lt;/span>&lt;span style="color:#ec5f67;"> if(the_thing.is_just) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> if(the_thing.is_future || the_thing.is_just) {
&lt;/span>&lt;span style="color:#cccece;"> return the_thing;
}
return Just(the_thing);
}
&lt;/span>&lt;/pre>
&lt;p>Pero la pregunta del millón sigue ahí. ¿Funciona?&lt;/p>
&lt;p>Hice una &amp;quot;&lt;a href="https://github.com/VonHeikemen/maybe-type-in-js">versión para terminal&lt;/a>&amp;quot; de esta aplicación. También modifiqué el ejemplo de codepen: agregué las funciones relacionadas con &lt;code>Future&lt;/code>, el dialogo de confirmación ahora sí es un dialogo (&lt;a href="https://github.hubspot.com/vex/">este&lt;/a>) y la función del evento 'submit' la marqué con &lt;code>async&lt;/code> para poder usar &lt;code>await&lt;/code>.&lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="oNNwagG"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="Maybe I will promise you a word">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/oNNwagG">Maybe I will promise you a word&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;h3 id="bonus-bonus-edit">Bonus bonus edit&lt;/h3>
&lt;p>Antes mencioné que haríamos trampa con esta implementación. &lt;a href="https://codepen.io/VonHeikemen/pen/QWWYJwZ">Así sería&lt;/a> con una implementación más apegada a las ideas del paradigma funcional.&lt;/p></description></item></channel></rss>