<?xml version="1.0" encoding="UTF-8"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Devlog</title><link>https://vonheikemen.github.io/devlog/</link><description/><generator>Zola</generator><language>en</language><atom:link href="https://vonheikemen.github.io/devlog/tags/functional-programming/rss.xml" rel="self" type="application/rss+xml"/><lastBuildDate>Mon, 30 Mar 2020 00:00:00 +0000</lastBuildDate><item><title>Functional programming for your everyday javascript: Composition techniques</title><pubDate>Mon, 30 Mar 2020 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-composition-techniques/</link><guid>https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-composition-techniques/</guid><description>&lt;p>Today we are going to talk about function composition. The art of creating big things with &amp;quot;simple&amp;quot; pieces. It will be even better if you don't know anything about functional programming, this will be an introduction to common concepts and patterns used in that paradigm that can be implemented in javascript. What I'm about to show you is not a magical formula to make your code more readable or bug free, that's not how any of this works. I do believe that it can help solve some problems, but in order to do that in the best way you need to keep a few things in mind. So, before I show you any implementation we are going to talk about some concepts and a little bit about philosophy. &lt;/p>
&lt;h2 id="what-you-need-to-know">What you need to know&lt;/h2>
&lt;h3 id="what-is-function-composition">What is function composition?&lt;/h3>
&lt;p>It's a mechanism that allows us to combine two or more function into a new function.&lt;/p>
&lt;p>It looks like a simple idea, haven't we all at some point in our lives combined a couple of functions? But do we really think about composition when we create them? What will help us make functions already designed to be combined?&lt;/p>
&lt;h3 id="philosophy">Philosophy&lt;/h3>
&lt;p>Function composition is more effective if you follow certain principles.&lt;/p>
&lt;ul>
&lt;li>The function should only have one purpose, one responsibility.&lt;/li>
&lt;li>Always think the returned value will be consumed by another function.&lt;/li>
&lt;/ul>
&lt;p>You've probably heard this before, it's a fragment of the &lt;a href="https://en.wikipedia.org/wiki/Unix_philosophy#Origin">unix philosophy&lt;/a>. Ever wondered how come &lt;code>bash&lt;/code>, despite having a weird syntax and many limitations, is so popular? Those two principle are a big part. A lot of the software designed for that environment is specially made to be a reusable component, and when you &amp;quot;connect&amp;quot; two or more the result is another program that can be connected with other unknown programs.&lt;/p>
&lt;p>For some it might seem silly or even excessive to have many little functions that do just one thing, specially if what they do looks useless, but I can prove to you that every function can be valuable in the right context.&lt;/p>
&lt;p>I'll try to setup a situation where we can put in practice these principles.&lt;/p>
&lt;blockquote>
&lt;p>Note: I apologize in advance for the bad use of &lt;code>cat&lt;/code> and &lt;code>grep&lt;/code>, I'll do it just to prove a point about composition.&lt;/p>
&lt;/blockquote>
&lt;p>Say that we want to extract the value of variable named &lt;code>HOST&lt;/code> that's inside a &lt;code>.env&lt;/code> file. Let's try to do this in &lt;code>bash&lt;/code>.&lt;/p>
&lt;p>This is the file.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">ENV=development
HOST=http://locahost:5000
&lt;/span>&lt;/pre>
&lt;p>To show the content of the file in the screen we use &lt;code>cat&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">cat .env
&lt;/span>&lt;/pre>
&lt;p>To filter that content and search the line we want we use &lt;code>grep&lt;/code>, provide the pattern of the thing we want and the content of the file.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">cat .env &lt;/span>&lt;span style="color:#5fb3b3;">| &lt;/span>&lt;span style="color:#6699cc;">grep &lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#99c794;">HOST=.*&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;
&lt;/span>&lt;/pre>
&lt;p>To get the value we use &lt;code>cut&lt;/code>, this is going to take the result provided by &lt;code>grep&lt;/code> and it's going to divide it using a delimiter, then it will give us the section of the string we tell it.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">cat .env &lt;/span>&lt;span style="color:#5fb3b3;">| &lt;/span>&lt;span style="color:#6699cc;">grep &lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#99c794;">HOST=.*&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; | &lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;"> --&lt;/span>&lt;span style="color:#f99157;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; --&lt;/span>&lt;span style="color:#f99157;">fields&lt;/span>&lt;span style="color:#5fb3b3;">=&lt;/span>&lt;span style="color:#6699cc;">2
&lt;/span>&lt;/pre>
&lt;p>That should give us.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">http://locahost:5000
&lt;/span>&lt;/pre>
&lt;p>If we put that chain of commands in a script or a function inside our &lt;code>.bashrc&lt;/code> we will effectively have a command that can be used in the same way by yet other commands that we don't even know about. That is the kind of flexibility and power that we want to have.&lt;/p>
&lt;p>I hope by now you know what kind of things you need to consider when you create a function but there is just one more thing I would like to tell you.&lt;/p>
&lt;h3 id="functions-are-things">Functions are things&lt;/h3>
&lt;p>Let's turn around and put our attention on javascript. Have you ever heard the phrase &amp;quot;first-class function&amp;quot;? It means that functions can be treated just like any other value. Let's compare with arrays.&lt;/p>
&lt;ul>
&lt;li>You can assign them to variables&lt;/li>
&lt;/ul>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">numbers &lt;/span>&lt;span style="color:#5fb3b3;">= [&amp;#39;&lt;/span>&lt;span style="color:#99c794;">99&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">104&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;];
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">repeat_twice &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">str&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">repeat&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">);
};
&lt;/span>&lt;/pre>
&lt;ul>
&lt;li>Pass them around as arguments to a function&lt;/li>
&lt;/ul>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">array&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">array&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fn&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">repeat_twice&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">numbers&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;ul>
&lt;li>Return them from other functions&lt;/li>
&lt;/ul>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">unary&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">arg&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">);
}
}
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">safer_parseint &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">unary&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">parseInt&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">safer_parseint&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">numbers&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>Why am I showing you this? You have to be aware of this particular thing about javascript because we are going to create many helper functions, like &lt;code>unary&lt;/code>, that manipulate other functions. It may take a while to get use to the idea of treating functions like data but it's something you should definitely put in practice, is just one those patterns that you see a lot in functional programming.&lt;/p>
&lt;h2 id="composition-in-practice">Composition in practice&lt;/h2>
&lt;p>Let's get back to our example with the &lt;code>.env&lt;/code>. We'll recreate what we did with &lt;code>bash&lt;/code>. First we'll take a very direct approach, then we'll explore the flaws of our implementation and try to fix them.&lt;/p>
&lt;p>So, we've done this before, we know what to do. Let's start by creating a function for each step.&lt;/p>
&lt;ul>
&lt;li>Get the content of the file.&lt;/li>
&lt;/ul>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">fs &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">require&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">fs&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">get_env&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">fs&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">readFileSync&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">utf-8&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
}
&lt;/span>&lt;/pre>
&lt;ul>
&lt;li>Filter the content based on a pattern.&lt;/li>
&lt;/ul>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">search_host&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">content&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">exp &lt;/span>&lt;span style="color:#5fb3b3;">= new &lt;/span>&lt;span style="color:#fac863;">RegExp&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">lines &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">content&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">split&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;\n&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">lines&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">find&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">line &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">exp&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">test&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">line&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;/pre>
&lt;ul>
&lt;li>Get the value.&lt;/li>
&lt;/ul>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">get_value&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">str&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">split&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">];
}
&lt;/span>&lt;/pre>
&lt;p>We're ready. Let's see what we can do to make these functions work together.&lt;/p>
&lt;h3 id="natural-composition">Natural composition&lt;/h3>
&lt;p>I've already mentioned that our first try would be direct, the functions are ready and now the only thing we need to do is execute them in sequence.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">get_value&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">search_host&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">get_env&lt;/span>&lt;span style="color:#5fb3b3;">()));
&lt;/span>&lt;/pre>
&lt;p>This is the perfect setup for function composition, the output of a function becomes the input of the next one, which is the same thing the &lt;code>|&lt;/code> symbol does in &lt;code>bash&lt;/code>. But unlike &lt;code>bash&lt;/code>, in here the data flow goes from right to left.&lt;/p>
&lt;p>Now let's imagine that we have two more functions that do something with the value of &lt;code>HOST&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">test&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">ping&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">get_value&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">search_host&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">get_env&lt;/span>&lt;span style="color:#5fb3b3;">()))));
&lt;/span>&lt;/pre>
&lt;p>Okay, now things are starting to get a little awkward, it's still on a manageable level but the amount of parenthesis in it bothers me. This would be the perfect time to put all those things in a function and group them in a more readable way but let's not do that yet, first we get help.&lt;/p>
&lt;h3 id="automatic-composition">Automatic composition&lt;/h3>
&lt;p>This is where our new found knowledge about functions starts being useful. To solve our parenthesis problem we are going to &amp;quot;automate&amp;quot; the function calls, we'll make a function that takes a list of functions, calls them one by one and makes sure the output of one becomes the input of the next. &lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">compose&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">fns&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return function &lt;/span>&lt;span style="color:#6699cc;">_composed&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">args&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// Index of the last function
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">last &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">fns&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">- &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#5f6364;">// Call the last function
// with arguments of `_composed`
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">current_value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">fns&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">last&lt;/span>&lt;span style="color:#5fb3b3;">--](...&lt;/span>&lt;span style="color:#cccece;">args&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// loop through the rest in the opposite direction
&lt;/span>&lt;span style="color:#c594c5;">for &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">i &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">last&lt;/span>&lt;span style="color:#5fb3b3;">; &lt;/span>&lt;span style="color:#cccece;">i &lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;= &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">; &lt;/span>&lt;span style="color:#cccece;">i&lt;/span>&lt;span style="color:#5fb3b3;">--) {
&lt;/span>&lt;span style="color:#cccece;">current_value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">fns&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">i&lt;/span>&lt;span style="color:#5fb3b3;">](&lt;/span>&lt;span style="color:#cccece;">current_value&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">current_value&lt;/span>&lt;span style="color:#5fb3b3;">;
};
}
&lt;/span>&lt;/pre>
&lt;p>Now we can do this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">compose&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">get_value&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">search_host&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">get_env&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// get_host is `_composed`
&lt;/span>&lt;span style="color:#6699cc;">get_host&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;/pre>
&lt;p>Our parenthesis problem is gone, we can add more functions without hurting the readability.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">compose&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#cccece;">test&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">ping&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">get_value&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">search_host&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">get_env
&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">get_host&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;/pre>
&lt;p>Just like in our first try, in here the data flows from right to left. If you want to flip the order you'd do it like this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">fns&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return function &lt;/span>&lt;span style="color:#6699cc;">_piped&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">args&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// call the first function
// with the arguments of `_piped`
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">current_value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">fns&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">](...&lt;/span>&lt;span style="color:#cccece;">args&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// loop through the rest in the original order
&lt;/span>&lt;span style="color:#c594c5;">for &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">i &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">; &lt;/span>&lt;span style="color:#cccece;">i &lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt; &lt;/span>&lt;span style="color:#cccece;">fns&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length&lt;/span>&lt;span style="color:#5fb3b3;">; &lt;/span>&lt;span style="color:#cccece;">i&lt;/span>&lt;span style="color:#5fb3b3;">++) {
&lt;/span>&lt;span style="color:#cccece;">current_value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">fns&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">i&lt;/span>&lt;span style="color:#5fb3b3;">](&lt;/span>&lt;span style="color:#cccece;">current_value&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">current_value&lt;/span>&lt;span style="color:#5fb3b3;">;
};
}
&lt;/span>&lt;/pre>
&lt;p>Behold.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">get_env&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">search_host&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">get_value&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">get_host&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;/pre>
&lt;p>All of this is great, but like I said before what we got here is the perfect setup. Our composition can only handle functions that take one parameter, and doesn't support flow control. That's not a bad thing, we should design our code so we can make this kind of composition more common but as we all know...&lt;/p>
&lt;h3 id="it-s-not-always-easy">It's not always easy&lt;/h3>
&lt;p>Even in our example the only reason we were able to compose those functions was because we included everything we needed inside in the code, and we completely ignored the error handling. But not all is lost, there are ways to get over the limitations.&lt;/p>
&lt;p>Before we move on I would like to change the example code, I'll make it look more like the &lt;code>bash&lt;/code> implementation.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">fs &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">require&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">fs&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">cat&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">filepath&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">fs&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">readFileSync&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">filepath&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">utf-8&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">pattern&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">content&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">exp &lt;/span>&lt;span style="color:#5fb3b3;">= new &lt;/span>&lt;span style="color:#fac863;">RegExp&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">pattern&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">lines &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">content&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">split&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;\n&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">lines&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">find&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">line &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">exp&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">test&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">line&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#f99157;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">fields &lt;/span>&lt;span style="color:#5fb3b3;">}, &lt;/span>&lt;span style="color:#f99157;">str&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">split&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">)[&lt;/span>&lt;span style="color:#cccece;">fields &lt;/span>&lt;span style="color:#5fb3b3;">- &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">];
}
&lt;/span>&lt;/pre>
&lt;p>They are not exactly like their &lt;code>bash&lt;/code> counterparts but they do the job. But now if we wanted to put them together it would have to be like this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({&lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">}, &lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)));
&lt;/span>&lt;/pre>
&lt;p>It works but I'd say that is barely acceptable, I can still understand what is going on but I wouldn't want to add a single thing to that chain. If we want to use &lt;code>pipe&lt;/code> we'll have to overcome our first obstacle.&lt;/p>
&lt;h4 id="functions-with-multiple-inputs">Functions with multiple inputs&lt;/h4>
&lt;p>The solution to this is &lt;strong>partial application&lt;/strong> and lucky for us javascript has a great support for the things we want to do. Our goal is simple, we are going to pass some of the parameters a function needs but without calling it. We want to be able to do this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;),
&lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">})
);
&lt;/span>&lt;span style="color:#6699cc;">get_host&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;/pre>
&lt;p>To make this possible we are going to rely on a technique called &lt;strong>currying&lt;/strong>, this consists on turning a multiple parameter function into several one parameter functions. The way we do this is by taking one parameter at a time, just keep returning functions until we get everything we need. We will do this to &lt;code>grep&lt;/code> and &lt;code>cut&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> function grep(pattern, content) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> function grep(pattern) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> return function(content) {
&lt;/span>&lt;span style="color:#cccece;"> const exp = new RegExp(pattern);
const lines = content.split(&amp;#39;\n&amp;#39;);
return lines.find(line =&amp;gt; exp.test(line));
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> }
&lt;/span>&lt;span style="color:#cccece;"> }
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> function cut({ delimiter, fields }, str) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> function cut({ delimiter, fields }) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> return function(str) {
&lt;/span>&lt;span style="color:#cccece;"> return str.split(delimiter)[fields - 1];
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> }
&lt;/span>&lt;span style="color:#cccece;"> }
&lt;/span>&lt;/pre>
&lt;p>In situations where is not possible to make a normal function support currying we can use the &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">bind&lt;/a> method in the &lt;code>Function&lt;/code> prototype.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">grep&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;),
&lt;/span>&lt;span style="color:#cccece;">cut&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, { &lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">})
);
&lt;/span>&lt;/pre>
&lt;p>Lastly, if everything else looks too complex you always have the possibility to create an arrow function inline.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#f99157;">content &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#cccece;">content&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#f99157;">str &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">}, &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">)
);
&lt;/span>&lt;/pre>
&lt;p>That should be enough to solve any kind of problem you face when you deal with multiple parameters. Let's move on.&lt;/p>
&lt;h4 id="functions-with-multiple-outputs">Functions with multiple outputs&lt;/h4>
&lt;p>Multiple outputs? I mean functions whose return value can have more than one type. This happens when we have functions that respond differently depending on how we use them or in what context. We have that kind of functions in our example. Let's take a look at &lt;code>cat&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">cat&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">filepath&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">fs&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">readFileSync&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">filepath&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">utf-8&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
}
&lt;/span>&lt;/pre>
&lt;p>Inside &lt;code>cat&lt;/code> we have &lt;code>readFileSync&lt;/code>, that's the one that reads the file in our system, an action that can fail for many reasons. It means that &lt;code>cat&lt;/code> can return a &lt;code>String&lt;/code> if everything goes well but can also throw an error if anything goes wrong. We need to handle both cases.&lt;/p>
&lt;p>Unfortunately for us exceptions are not the only thing we need to worry about, we also need to deal with the absence of values. In &lt;code>grep&lt;/code> we have this line.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">lines&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">find&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">line &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">exp&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">test&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">line&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;/pre>
&lt;p>The &lt;code>find&lt;/code> method is the one that evaluates each line of the file. As you can imagine that can fail, maybe it just doesn't find what we are looking for. Unlike &lt;code>readFileSync&lt;/code>, &lt;code>find&lt;/code> doesn't throw an error, it just returns &lt;code>undefined&lt;/code>. It's not like &lt;code>undefined&lt;/code> is bad, it's that we don't have any use for it. Assuming that the result will always be a &lt;code>String&lt;/code> is what can cause an error.&lt;/p>
&lt;p>How do we handle all this?&lt;/p>
&lt;p>&lt;strong>Functors&lt;/strong> &amp;amp;&amp;amp; &lt;strong>Monads&lt;/strong> (sorry for the big words). Giving an appropiate explanation of those two would take too much time so we are just going to focus on the practical aspects. For the time being you can think of them as data types that need to obey some laws (you can find some of them here: &lt;a href="https://github.com/fantasyland/fantasy-land#fantasy-land-specification">Fantasy land&lt;/a>).&lt;/p>
&lt;p>Where do we start? With functors.&lt;/p>
&lt;ul>
&lt;li>Functors&lt;/li>
&lt;/ul>
&lt;p>Let's create a data type that is capable of calling a function in the right context at the right time. You have seen one before: arrays. Try this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">add_one &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">number &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">41&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">empty &lt;/span>&lt;span style="color:#5fb3b3;">= [];
&lt;/span>&lt;span style="color:#cccece;">number&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [42]
&lt;/span>&lt;span style="color:#cccece;">empty&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; []
&lt;/span>&lt;/pre>
&lt;p>See? &lt;code>map&lt;/code> called &lt;code>add_one&lt;/code> just once, on the &lt;code>number&lt;/code> array. It didn't do anything on the &lt;code>empty&lt;/code> array, didn't halt the execution of the script by throwing an error, it just returned an array. That's the behavior that we want.&lt;/p>
&lt;p>We will make that on our own. Let's create a data type called &lt;code>Result&lt;/code>, it will represent an action that may or may not be successful. It will have a &lt;code>map&lt;/code> method that will only execute the provided callback when the action had the expected outcome.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">Result &lt;/span>&lt;span style="color:#5fb3b3;">= {};
&lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Ok &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fn &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Ok&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)),
};
}
&lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Err &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Err&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">),
};
}
&lt;/span>&lt;/pre>
&lt;p>We have our functor but now you might be wondering is that it? How does that help? We are taking it one step at a time. Let's use it with &lt;code>cat&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">cat&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">filepath&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">try &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Ok&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fs&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">readFileSync&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">filepath&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">utf-8&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;));
} &lt;/span>&lt;span style="color:#c594c5;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">e&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Err&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">e&lt;/span>&lt;span style="color:#5fb3b3;">);
}
}
&lt;/span>&lt;/pre>
&lt;p>What do we gain with this? Give it a chance.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>You still have the same question on your mind, I can see it. Now try to add the other functions.&lt;/p>
&lt;blockquote>
&lt;p>Note: I'm going to assume that you can use currying to achieve partial application.&lt;/p>
&lt;/blockquote>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">}))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>See that? That chain of &lt;code>map&lt;/code>s looks a lot like &lt;code>compose&lt;/code> or &lt;code>pipe&lt;/code>. We did it, we got our composition back, and now with error handling (kinda).&lt;/p>
&lt;p>I want to do something. That pattern, the one with the &lt;code>try/catch&lt;/code>, I want to put that in a function.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">make_safe &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return function&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">args&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">try &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Ok&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#cccece;">args&lt;/span>&lt;span style="color:#5fb3b3;">));
} &lt;/span>&lt;span style="color:#c594c5;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">e&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Err&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">e&lt;/span>&lt;span style="color:#5fb3b3;">);
}
}
}
&lt;/span>&lt;/pre>
&lt;p>Now we can transform &lt;code>cat&lt;/code> without even touching its code.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">safer_cat &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">make_safe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">safer_cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">}))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>You may want to do something in case something goes wrong, right? Let's make that possible.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const Result = {};
Result.Ok = function(value) {
return {
map: fn =&amp;gt; Result.Ok(fn(value)),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> catchMap: () =&amp;gt; Result.Ok(value),
&lt;/span>&lt;span style="color:#cccece;"> };
}
Result.Err = function(value) {
return {
map: () =&amp;gt; Result.Err(value),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> catchMap: fn =&amp;gt; Result.Err(fn(value)),
&lt;/span>&lt;span style="color:#cccece;"> };
}
&lt;/span>&lt;/pre>
&lt;p>Now we can make mistakes and be confident we are doing something about it.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">safer_cat &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">make_safe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">show_error &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">e &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">error&lt;/span>&lt;span style="color:#5fb3b3;">(`&lt;/span>&lt;span style="color:#99c794;">Whoops:&lt;/span>&lt;span style="color:#5fb3b3;">\n${&lt;/span>&lt;span style="color:#cccece;">e&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">message&lt;/span>&lt;span style="color:#5fb3b3;">}`);
&lt;/span>&lt;span style="color:#6699cc;">safer_cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">what?&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">}))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">catchMap&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">show_error&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>Yes, I know, all of this is cute and useful but at some point you'll want to take the value out of the &lt;code>Result&lt;/code>. I get it, javascript is not a language where this pattern is a common thing, you may want to go &amp;quot;back to normal&amp;quot;. Let's add a function that can let us extract the value out in either case.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const Result = {};
Result.Ok = function(value) {
return {
map: fn =&amp;gt; Result.Ok(fn(value)),
catchMap: () =&amp;gt; Result.Ok(value),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> cata: (error, success) =&amp;gt; success(value)
&lt;/span>&lt;span style="color:#cccece;"> };
}
Result.Err = function(value) {
return {
map: () =&amp;gt; Result.Err(value),
catchMap: fn =&amp;gt; Result.Err(fn(value)),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> cata: (error, success) =&amp;gt; error(value)
&lt;/span>&lt;span style="color:#cccece;"> };
}
&lt;/span>&lt;/pre>
&lt;p>With this we can choose what to do at the end of every action.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">constant &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">identity &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">safer_cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">what?&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">}))
.&lt;/span>&lt;span style="color:#6699cc;">cata&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">constant&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;quot;&lt;/span>&lt;span style="color:#99c794;">This ain&amp;#39;t right&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;), &lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">)
&lt;/span>&lt;span style="color:#5f6364;">// ....
&lt;/span>&lt;/pre>
&lt;blockquote>
&lt;p>Note: If you're asking why &lt;code>cata&lt;/code>, it comes from &lt;strong>catamorphism&lt;/strong>, another one of those terms people use in functional programming.&lt;/p>
&lt;/blockquote>
&lt;p>Now let's create a data type that can handle the problem we have with &lt;code>grep&lt;/code>. In this case what we want to do is handle the absence of a value.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">Maybe &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value &lt;/span>&lt;span style="color:#5fb3b3;">== &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">();
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Just&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Just &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fn &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Just&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#6699cc;">catchMap&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Just&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">cata&lt;/span>&lt;span style="color:#5fb3b3;">: (&lt;/span>&lt;span style="color:#f99157;">nothing&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">just&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">just&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)
};
}
&lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Nothing &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">(),
&lt;/span>&lt;span style="color:#6699cc;">catchMap&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fn &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(),
&lt;/span>&lt;span style="color:#6699cc;">cata&lt;/span>&lt;span style="color:#5fb3b3;">: (&lt;/span>&lt;span style="color:#f99157;">nothing&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">just&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">nothing&lt;/span>&lt;span style="color:#5fb3b3;">()
};
}
&lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">wrap_fun &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return function&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">args&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#cccece;">args&lt;/span>&lt;span style="color:#5fb3b3;">));
}
}
&lt;/span>&lt;/pre>
&lt;p>We're going to use it to wrap &lt;code>grep&lt;/code> with a &lt;code>Maybe&lt;/code>, to test this we'll use the original &lt;code>cat&lt;/code> to take the content from the file.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">maybe_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">wrap_fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;));
&lt;/span>&lt;span style="color:#6699cc;">maybe_host&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">catchMap&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">Nothing()&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;));
&lt;/span>&lt;/pre>
&lt;p>That should show &lt;code>http://localhost:5000&lt;/code>. And if we change the pattern &lt;code>^HOST=&lt;/code> it should show &lt;code>Nothing()&lt;/code>.&lt;/p>
&lt;p>So, we created safer versions of &lt;code>cat&lt;/code> and &lt;code>grep&lt;/code> but you should see what happens when they get together.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">safer_cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">maybe_host&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">res &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#cccece;">res &lt;/span>&lt;span style="color:#5fb3b3;">}));
.&lt;/span>&lt;span style="color:#6699cc;">catchMap&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">what?&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;))
&lt;/span>&lt;/pre>
&lt;p>You get this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">{
res: {
map: [Function: map],
catchMap: [Function: catchMap],
cata: [Function: cata]
}
}
&lt;/span>&lt;/pre>
&lt;p>Wait, what's happening? Well, we have a &lt;code>Maybe&lt;/code> trapped inside a &lt;code>Result&lt;/code>. Maybe you didn't see that one coming but other people did, and they have the solution.&lt;/p>
&lt;ul>
&lt;li>Monads&lt;/li>
&lt;/ul>
&lt;p>It turns out that monads are functors with extra powers. The thing we care about right now is that they solve the nesting issue. Let's make some adjustments.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> Result.Ok = function(value) {
return {
map: fn =&amp;gt; Result.Ok(fn(value)),
catchMap: () =&amp;gt; Result.Ok(value),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> flatMap: fn =&amp;gt; fn(value),
&lt;/span>&lt;span style="color:#cccece;"> cata: (error, success) =&amp;gt; success(value)
};
}
Result.Err = function(value) {
return {
map: () =&amp;gt; Result.Err(value),
catchMap: fn =&amp;gt; Result.Err(fn(value)),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> flatMap: () =&amp;gt; Result.Err(value),
&lt;/span>&lt;span style="color:#cccece;"> cata: (error, success) =&amp;gt; error(value)
};
}
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> Maybe.Just = function(value) {
return {
map: fn =&amp;gt; Maybe.Just(fn(value)),
catchMap: () =&amp;gt; Maybe.Just(value),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> flatMap: fn =&amp;gt; fn(value),
&lt;/span>&lt;span style="color:#cccece;"> cata: (nothing, just) =&amp;gt; just(value),
};
}
Maybe.Nothing = function() {
return {
map: () =&amp;gt; Maybe.Nothing(),
catchMap: fn =&amp;gt; fn(),
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> flatMap: () =&amp;gt; Maybe.Nothing(),
&lt;/span>&lt;span style="color:#cccece;"> cata: (nothing, just) =&amp;gt; nothing(),
};
}
&lt;/span>&lt;/pre>
&lt;p>The &lt;code>flatMap&lt;/code> method behaves just like &lt;code>map&lt;/code> but with the added benefit that it lets us get rid of those extra &amp;quot;layers&amp;quot; that mess around with our composition. Make sure to use &lt;code>flatMap&lt;/code> with functions that return other monads because this is not the safest implementation.&lt;/p>
&lt;blockquote>
&lt;p>Note: Yes, arrays are also monads. They have a &lt;code>map&lt;/code> method and &lt;code>flatMap&lt;/code> method and they obey all the laws.&lt;/p>
&lt;/blockquote>
&lt;p>Let's test &lt;code>maybe_host&lt;/code> again.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> &lt;/span>&lt;span style="color:#6699cc;">safer_cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
.&lt;/span>&lt;span style="color:#6699cc;">flatMap&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">maybe_host&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">res &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#cccece;">res &lt;/span>&lt;span style="color:#5fb3b3;">}));
.&lt;/span>&lt;span style="color:#6699cc;">catchMap&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">what?&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;))
&lt;/span>&lt;/pre>
&lt;p>That should give us.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">{ res: &amp;#39;HOST=http://localhost:5000&amp;#39; }
&lt;/span>&lt;/pre>
&lt;p>We're ready to compose everything back together.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">safer_cat &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">make_safe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">maybe_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">wrap_fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;));
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">wrap_fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({&lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">}));
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">safer_cat&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
.&lt;/span>&lt;span style="color:#6699cc;">flatMap&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">maybe_host&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">flatMap&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">get_value&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">cata&lt;/span>&lt;span style="color:#5fb3b3;">(
() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;&lt;/span>&lt;span style="color:#99c794;">http://127.0.0.1:3000&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;,
&lt;/span>&lt;span style="color:#f99157;">host &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">host
&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// ....
&lt;/span>&lt;/pre>
&lt;p>And if we want to use &lt;code>pipe&lt;/code> or &lt;code>compose&lt;/code>?&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">chain &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">fn &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#f99157;">m &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">m&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">flatMap&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fn&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">unwrap_or &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">fallback &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#f99157;">fm &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#cccece;">fm&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">cata&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">fallback&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">safer_cat &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">make_safe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">maybe_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">wrap_fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">grep&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">^HOST=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;));
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">wrap_fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">cut&lt;/span>&lt;span style="color:#5fb3b3;">({&lt;/span>&lt;span style="color:#6699cc;">delimiter&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">=&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#6699cc;">fields&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">}));
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_host &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#cccece;">safer_cat&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">chain&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">maybe_host&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">chain&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">get_value&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">http://127.0.0.1:3000&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
);
&lt;/span>&lt;span style="color:#6699cc;">get_host&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">.env&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;/pre>
&lt;p>You can check out the whole code here: &lt;a href="https://gist.github.com/VonHeikemen/0e6d4950bfe91229ee06eee2e3c74515">link&lt;/a>.&lt;/p>
&lt;h2 id="still-want-to-learn-more">Still want to learn more?&lt;/h2>
&lt;p>There are many things that I didn't mention because it would take too much time but if you want to learn more about it, I have prepare some material.&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-partial-application/">Partial application&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-the-power-of-map/">The power of map (more about functors)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-using-a-maybe/">Using a Maybe&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://vonheikemen.github.io/devlog/web-development/dealing-with-side-effects-and-pure-functions-in-javascript/">Pure functions and side effects&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="conclusion">Conclusion&lt;/h2>
&lt;p>A lot of people talk about the nice things about composition, how it makes code more declarative and clean, but they never show you the tough parts. I hope I've done that, show the tough parts and how to overcome them. Composing functions it's truly an art, it takes practice and time to get use to some ideas (like the idea of functions being things).&lt;/p>
&lt;h2 id="sources">Sources&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.youtube.com/watch?v=vDe-4o8Uwl8">The Power of Composition (video)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.youtube.com/watch?v=SfWR3dKnFIo">Oh Composable World! (video)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.youtube.com/watch?v=7BsfMMYvGaU">Mary had a little lambda (video)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dev.to/joelnet/functional-javascript---functors-monads-and-promises-1pol">Functional JavaScript - Functors, Monads, and Promises&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Functional programming for your everyday javascript: The power of map</title><pubDate>Sun, 16 Feb 2020 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-the-power-of-map/</link><guid>https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-the-power-of-map/</guid><description>&lt;p>This time we are going to take a look inside the world of &lt;code>functors&lt;/code> and what makes them so special. Functors is one of those terms that you hear every now and then when people talk about functional programming but when the time comes to explain it they either bombard you with more abstract terms or tell you just the details you need to know. Since I have no knowledge of category theory I'm not going to pretend that I know exactly what a functor is, I'm just going show enough for you to know how you can spot them in the wild and how you can use them to your advantage.&lt;/p>
&lt;h2 id="seriously-what-is-a-functor">Seriously, what is a functor?&lt;/h2>
&lt;p>I'm convinced that the term is difficult to understand because one, you need to some other terms in order to get the whole picture and two, the theory behind it doesn't really translate very well in code. But it wouldn't hurt to have at least a clue of what they are.&lt;/p>
&lt;p>You can think of them as a relation that exist between two sets of values. I know it's vague, this will make sense in a second. Say we have two arrays.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">favorite_numbers &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">42&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">69&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">73&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">increased_numbers &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">43&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">70&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">74&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;/pre>
&lt;p>Nice, we have a set &lt;code>favorite_numbers&lt;/code> and a set &lt;code>increased_numbers&lt;/code>, they are two separate arrays in different variables but we all know that there is a connection between those two, but more importantly we can express that connection with code. Imagine that the array &lt;code>increased_numbers&lt;/code> doesn't exist but we still need those numbers, to make them appear again all we need is our good old friend &lt;code>map&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">increased_numbers &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">favorite_numbers&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>&lt;code>map&lt;/code> will go through every number, increase it and put it in a new array which brings &lt;code>increased_numbers&lt;/code> back into existence. Even though &lt;code>increased_numbers&lt;/code> is something we made, we didn't create it out nowhere, we didn't magically invent &lt;code>43&lt;/code>, &lt;code>70&lt;/code> and &lt;code>74&lt;/code>. All we did was describe a relation between those numbers and our &lt;code>favorite_numbers&lt;/code>.&lt;/p>
&lt;p>So, is that the whole history? Are functors just arrays? The answer to that is a big no. Arrays are just a freakishly convenient way to illustrate a common use of functors. This leaves a question in the air.&lt;/p>
&lt;h2 id="how-do-you-recognize-them">How do you recognize them?&lt;/h2>
&lt;p>I often hear other people describing functors as boxes. I for one don't think they're wrong because using a container data structure is one of easiest ways to implement a functor. The box analogy is specially funny 'cause in javascript we use brackets to create arrays, so you can actually create a functor by putting a value in a box. See.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// A value
&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#5f6364;">// A box
&lt;/span>&lt;span style="color:#5fb3b3;">[];
&lt;/span>&lt;span style="color:#5f6364;">// Look, a value in a box.
&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#5f6364;">// I regret nothing.
&lt;/span>&lt;/pre>
&lt;p>Going back to the original question, how do we recognize them? Okay, so it turns out that there are rules.&lt;/p>
&lt;h3 id="da-rules">Da rules&lt;/h3>
&lt;p>Again I'll be using array of numbers just because is convenient but this rules must apply to any structure that wants to be in the functor club.&lt;/p>
&lt;h4 id="identity">Identity&lt;/h4>
&lt;p>Given the &lt;code>identity&lt;/code> function.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">identity&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">x&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">x&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>&lt;code>value&lt;/code> and &lt;code>value.map(identity)&lt;/code> must be equivalent.&lt;/p>
&lt;p>For example.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">]; &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [1,2,3]
&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [1,2,3]
&lt;/span>&lt;/pre>
&lt;p>Why is this important? What does this tell us?&lt;/p>
&lt;p>Valid questions. This tells us that the &lt;code>map&lt;/code> function must preserve the shape of the data structure. In our example, if we map an array of three elements we must receive a new array of three elements. If we had an array of a hundred elements, using &lt;code>.map(identity)&lt;/code> should return an array of a hundred elements. You get the point.&lt;/p>
&lt;h4 id="composition">Composition&lt;/h4>
&lt;p>Given two functions &lt;code>fx&lt;/code> and &lt;code>gx&lt;/code> the following must be true.&lt;/p>
&lt;p>&lt;code>value.map(fx).map(gx)&lt;/code> and &lt;code>value.map(arg =&amp;gt; gx(fx(arg)))&lt;/code> must be equivalent.&lt;/p>
&lt;p>Example time.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">* &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">;
}
[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [4]
&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">))); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [4]
&lt;/span>&lt;/pre>
&lt;p>If you know how &lt;code>Array.map&lt;/code> works this feels like 'well duh!'. This actually gives you a chance to optimize your code for readability or performance. In the case of arrays, multiple calls to &lt;code>map&lt;/code> can have a big impact on performance when the number of elements in the list grows.&lt;/p>
&lt;p>And that's it. Those two rules are all you need to know to spot a functor.&lt;/p>
&lt;h2 id="does-it-always-has-to-be-map">Does it always has to be .map?&lt;/h2>
&lt;p>I guess by now you wish to know what other things out there follow those rules that I just mentioned, if not I'll tell you anyway. There is another popular structure that also follows the rules and that is &lt;code>Promise&lt;/code>. Let's see.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// A value
&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#5f6364;">// A box
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#5f6364;">// Look, a value in a box
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Identity rule
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 1 (in the future)
// Composition
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 4
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">))); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 4
&lt;/span>&lt;/pre>
&lt;p>To be fair, &lt;code>Promise.then&lt;/code> behaves more like &lt;code>Array.flatMap&lt;/code> than &lt;code>Array.map&lt;/code> but we will ignore that.&lt;/p>
&lt;p>Fine, we have &lt;code>Array&lt;/code> and we have &lt;code>Promise&lt;/code> both are containers of some sort and both have methods that follow the rules. But what if they didn't have those methods, what if &lt;code>Array.map&lt;/code> didn't exist? Would that mean that &lt;code>Array&lt;/code> is no longer a functor? Do we lose all the benefits?&lt;/p>
&lt;p>Let's take a step back. If &lt;code>Array.map&lt;/code> doesn't exists then &lt;code>Array&lt;/code> is no longer a functor? I don't know, I'm not an FP lawyer. Do we lose all the benefits? No, we could still treat arrays as functors, we just lose the super convenient &lt;code>.map&lt;/code> syntax. We can create our own &lt;code>map&lt;/code> outside of the structure.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">List &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">arr&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= [];
&lt;/span>&lt;span style="color:#c594c5;">for &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">data &lt;/span>&lt;span style="color:#5fb3b3;">of &lt;/span>&lt;span style="color:#cccece;">arr&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">push&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
}
};
&lt;/span>&lt;/pre>
&lt;p>See? Is not that bad. And it works.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Identity rule
&lt;/span>&lt;span style="color:#fac863;">List&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">, [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">]); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [1]
// Composition
&lt;/span>&lt;span style="color:#fac863;">List&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#fac863;">List&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">, [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">])); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [4]
&lt;/span>&lt;span style="color:#fac863;">List&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">)), [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">]); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; [4]
&lt;/span>&lt;/pre>
&lt;p>Are you thinking what I'm thinking? Probably not. This is what I'm thinking, if we can map arrays without a &lt;code>.map&lt;/code> then nothing can stop us from doing the same thing with plain objects, because after all, objects can also hold sets of values.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">Obj &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">ob&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= {};
&lt;/span>&lt;span style="color:#c594c5;">for &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">] of &lt;/span>&lt;span style="color:#fac863;">Object&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">entries&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">ob&lt;/span>&lt;span style="color:#5fb3b3;">)) {
&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">] = &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
}
};
&lt;/span>&lt;span style="color:#5f6364;">// Why stop at `map`?
// Based on this you can also create a `filter` and `reduce`
&lt;/span>&lt;/pre>
&lt;p>Let's see it.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Identity rule
&lt;/span>&lt;span style="color:#fac863;">Obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">, {&lt;/span>&lt;span style="color:#6699cc;">some&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">}); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; {some: 1, prop: 2}
// Composition
&lt;/span>&lt;span style="color:#fac863;">Obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#fac863;">Obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">, {&lt;/span>&lt;span style="color:#6699cc;">some&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">})); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; {some: 4, prop: 6}
&lt;/span>&lt;span style="color:#fac863;">Obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">)), {&lt;/span>&lt;span style="color:#6699cc;">some&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">}); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; {some: 4, prop: 6}
&lt;/span>&lt;/pre>&lt;h2 id="do-it-yourself">Do It Yourself&lt;/h2>
&lt;p>All this talk about arrays and plain objects is useful but now I feel like we know enough to make our own functor, the rules seem to be very simple. Let's do something vaguely useful. Have you ever heard of Observables? Good, because we are going to something like that. We'll make a simpler version of &lt;a href="https://mithril.js.org/stream.html">mithril-stream&lt;/a>, it'll be fun.&lt;/p>
&lt;p>The goal here to handle a stream of values over time. The API of our utility will be this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Set initial state
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">num_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Create a dependent stream
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">increased &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Get the value from a stream
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 0
// Push a value to the stream
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">42&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
// The source stream updates
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
// The dependent stream also updates
&lt;/span>&lt;span style="color:#6699cc;">increased&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 43
&lt;/span>&lt;/pre>
&lt;p>Let's start with the getter and setter function.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">state&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#6699cc;">stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// If we get an argument we update the state
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt; &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">state &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#5f6364;">// return current state
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">state&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">stream&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>This should work.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Initial state
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">num_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">42&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Get state
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
// Update
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">73&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Check
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 73
&lt;/span>&lt;/pre>
&lt;p>We know we want a &lt;code>map&lt;/code> method but what is the effect we want? We want the callback to listen to the changes of the source stream. Let's start with the listener part, we want to store an array of listeners and execute each one right after the state changes.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function Stream(state) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> let listeners = [];
&lt;/span>&lt;span style="color:#5fb3b3;">+
&lt;/span>&lt;span style="color:#cccece;"> let stream = function(value) {
if(arguments.length &amp;gt; 0) {
state = value;
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> listeners.forEach(fn =&amp;gt; fn(value));
&lt;/span>&lt;span style="color:#cccece;"> }
return state;
}
return stream;
}
&lt;/span>&lt;/pre>
&lt;p>Now we go for the &lt;code>map&lt;/code> method, but is not going to be just any method, we need to follow the rules:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Identity: When &lt;code>map&lt;/code> is called it needs to preserve the shape of the structure. This means that we need to return a new stream.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Composition: Calling &lt;code>map&lt;/code> multiple times must be equivalent of composing the callbacks supplied to those &lt;code>map&lt;/code>s.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">state&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">listeners &lt;/span>&lt;span style="color:#5fb3b3;">= [];
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#6699cc;">stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt; &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">state &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#cccece;">listeners&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">forEach&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">state&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#fac863;">stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// Create new instance with transformed state.
// This will execute the callback when calling `map`
// this might not be what you want if you use a
// function that has side effects. Just beware.
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">target &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">state&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#5f6364;">// Transform the value and update stream
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">listener &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">target&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#5f6364;">// Update the source listeners
&lt;/span>&lt;span style="color:#cccece;">listeners&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">push&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">listener&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">target&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">stream&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>Let's test the rules. We begin with identity.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Streams are like a cascade
// the first is the most important
// this is the one that triggers all the listeners
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">num_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Create dependent stream
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">identity_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">identity&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// update the source
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">42&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Check
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
&lt;/span>&lt;span style="color:#6699cc;">identity_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 42
&lt;/span>&lt;/pre>
&lt;p>Now let's check the composition rule.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Create source stream
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">num_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Create dependents
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">map_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">composed_stream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">times_two&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">add_one&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">)));
&lt;/span>&lt;span style="color:#5f6364;">// Update source
&lt;/span>&lt;span style="color:#6699cc;">num_stream&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Check
&lt;/span>&lt;span style="color:#6699cc;">map_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 4
&lt;/span>&lt;span style="color:#6699cc;">composed_stream&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; 4
&lt;/span>&lt;/pre>
&lt;p>Our job is done. But is this any useful? Can you do something with it? Well yes, you could use it in event handlers to manipulate user input. Like this.&lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="dyoMJRw"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="an fmap example">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/dyoMJRw">an fmap example&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;script async src="https://static.codepen.io/assets/embed/ei.js">&lt;/script>
&lt;h3 id="more-examples">More examples&lt;/h3>
&lt;p>I think by now you understand really well what functors do, but if you still want to see more examples you can check out this articles. &lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-using-a-maybe/">Handling the absence of a value&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://jrsinclair.com/articles/2018/how-to-deal-with-dirty-side-effects-in-your-pure-functional-javascript/">Handling side effects&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="conclusion">Conclusion&lt;/h2>
&lt;p>The only question that remains is &amp;quot;what is the benefit of using functors?&amp;quot;&lt;/p>
&lt;p>I'll do my best here:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>This pattern allows you to focus on one problem at time. The &lt;code>map&lt;/code> function handles how you get the data and in the callback you can focus only on processing the data.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Reusability. This style of programming really encourage the creation of single purpose function that a lot of the times can become useful even across projects.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Extensibility through composition. People have mixed feelings about this one, specially if we are talking about arrays. This is another thing that functors encourage, that is using chains of functions to implement a procedure.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="sources">Sources&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://dev.to/techgirl1908/why-is-map-called-map-2l03">Why is map called map?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/fantasyland/fantasy-land">Fantasy land&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/fantasyland/static-land">Static land&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/thefrontside/funcadelic.js">funcadelic.js&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://jrsinclair.com/articles/2018/how-to-deal-with-dirty-side-effects-in-your-pure-functional-javascript/">How to deal with dirty side effects in your pure functional JavaScript&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://jrsinclair.com/articles/2020/whats-more-fantastic-than-fantasy-land-static-land/">Whats more fantastic than fantasy land? An Introduction to Static land&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://medium.com/@lettier/your-easy-guide-to-monads-applicatives-functors-862048d61610">Your easy guide to Monads, Applicatives, &amp;amp; Functors&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Dealing with side effects and pure functions in javascript</title><pubDate>Sun, 05 Jan 2020 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/web-development/dealing-with-side-effects-and-pure-functions-in-javascript/</link><guid>https://vonheikemen.github.io/devlog/web-development/dealing-with-side-effects-and-pure-functions-in-javascript/</guid><description>&lt;p>Have you ever heard the term &amp;quot;pure function&amp;quot;? What about &amp;quot;side effects&amp;quot;? If you have then probably you've heard that side effects are evil and should be avoided at all cost (just like &lt;code>var&lt;/code>.) Here is the problem, if you write javascript you probably want to cause those side effects (specially if you get paid to write javascript) So the solution here is not to avoid all the side effects but to control them. I going to show you a few things that you can do to make your pure functions and your side effects get along just fine.&lt;/p>
&lt;p>Before we start let us just do a little recap on some terms, so we can all be in the same page.&lt;/p>
&lt;h2 id="concepts">Concepts&lt;/h2>
&lt;h3 id="pure-function">Pure function&lt;/h3>
&lt;p>For the sake of simplicity let us say that a pure function is a function whose output is only determined by its input and has no observable effect on the outside world. The main benefit they provide (in my opinion) is predictability, if you give them the same input values they will always return you the same output. Lets look at some examples.&lt;/p>
&lt;p>This one is pure.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">increment&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">number&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">number &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>This one isn't&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#fac863;">Math&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">random&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;/pre>
&lt;p>And these are tricky.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">A_CONSTANT &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">increment&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">number&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">number &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#cccece;">A_CONSTANT&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#fac863;">module&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#fac863;">exports &lt;/span>&lt;span style="color:#5fb3b3;">={
&lt;/span>&lt;span style="color:#cccece;">increment
&lt;/span>&lt;span style="color:#5fb3b3;">};
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">a_constant&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">increment&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">number&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">number &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#6699cc;">a_constant&lt;/span>&lt;span style="color:#5fb3b3;">();
}
&lt;/span>&lt;/pre>&lt;h3 id="side-effects">Side effects&lt;/h3>
&lt;p>I will call a side effect to anything that compromises the purity of a function. The list includes but is not limited to:&lt;/p>
&lt;ul>
&lt;li>Changing (mutate) an external variable in any way.&lt;/li>
&lt;li>Showing things in the screen.&lt;/li>
&lt;li>Writing to a file.&lt;/li>
&lt;li>Making an http request.&lt;/li>
&lt;li>Spawn a process.&lt;/li>
&lt;li>Saving data in a database.&lt;/li>
&lt;li>Calling other functions with side-effects.&lt;/li>
&lt;li>DOM manipulation.&lt;/li>
&lt;li>Randomness.&lt;/li>
&lt;/ul>
&lt;p>So, any action that can change the &amp;quot;state of the world&amp;quot; is a side effect.&lt;/p>
&lt;h2 id="how-do-we-use-those-things-together">How do we use those things together?&lt;/h2>
&lt;p>You're probably still thinking about that side effect list, is basically everything javascript is good for and yet some people still tell you to avoid them. Don't fear I come bearing suggestions.&lt;/p>
&lt;h3 id="good-old-function-composition">Good old function composition&lt;/h3>
&lt;p>Another way of saying it will be: good old separation of concerns. This is the non complicated way. If there is a way to break apart a computation from a side effect then put the computation on a function and give the output to the function/block that has the side effect.&lt;/p>
&lt;p>It could be as simple as doing something like this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">some_process&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">data &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">get_data_somehow&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">clean_data &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">computation&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">save&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">clean_data&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>Now, &lt;code>some_process&lt;/code> still isn't pure but that's okay, we are writing javascript we don't need everything to be pure, what we need is to keep our sanity. By splitting the side effects from the pure computation we have created three independent functions that solve only one problem at a time. You could even take it one step further and use a helper function like &lt;a href="https://ramdajs.com/docs/#pipe">pipe&lt;/a> to get rid of those intermediate variables and compose those functions directly.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">some_process &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">get_data_somehow&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">computation&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">save&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>But now we have created another problem, what happens when we want to make a side effect in the middle of one those? What do we do? Well if a helper function created the problem then I say use another helper function to get out of it. Something like this would work.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">tap&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return function &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">arg&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">;
}
}
&lt;/span>&lt;/pre>
&lt;p>This will allow you to place a function with a side effect in the middle of chain of functions while keeping data flow.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">some_process &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#cccece;">get_data_somehow&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">tap&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">computation&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">tap&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">a_side_effect&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">save
&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>There is argument to be made against these type of things, some people would argue that now all your logic is scattered all over the place and that you have to move around to actually know what the function does. I really don't mind, it's a matter of preference.&lt;/p>
&lt;p>Let's get back to business, did you see &lt;code>tap&lt;/code>'s signature? Look at it: &lt;code>tap(fn)&lt;/code>. It takes a callback as a parameter lets see how we can use that to our advantage.&lt;/p>
&lt;h3 id="make-someone-else-handle-the-problem">Make someone else handle the problem&lt;/h3>
&lt;p>As we all know life isn't always so simple, sometimes we just can't make that sweet pipeline of functions. In some situations we need to do some side-effect in the middle of a process and when that happens we can always cheat. In javascript we can treat functions as values which lets us do funny things like passing functions as parameters to other functions. This way the function can have the flexibility to execute a side effect when we need to while maintaining some of the predictability that we know and love.&lt;/p>
&lt;p>Say for example that you have a function that is already pure and does something to a collection of data but now for some reason you need log the original and the transformed values right after the transformation happens. What you can do is add a function as a parameter and call it in the right moment.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">transform&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">onchange&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Array&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">isArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">) ? [] : {};
&lt;/span>&lt;span style="color:#c594c5;">for&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">key &lt;/span>&lt;span style="color:#5fb3b3;">in &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">] = &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">] + &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#6699cc;">onchange&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">], &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">]);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>This technically fulfills some of the requirements of a pure function, the output (and behavior) of the function is still determined by its input, it just so happens that one of those inputs is a function that can trigger any side effect. Again, the goal in here is not to fight against the nature of javascript and have everything be 100% pure, we want to control when the side effect happens. So in this case the one who controls whether or not to have side effects is the caller of the function. One extra benefit of this is that if you want to use that function in a unit test to prove that it still works as expected the only thing you'll need to do is supply its arguments, you don't have grab any mocking library to test it. &lt;/p>
&lt;p>You may be wondering why put the callback as the first parameter, this is really about personal preference. If you put the &lt;code>thing&lt;/code> that changes the most frequently in the last position you make it easier to do partial application, that is binding the values of the parameters without executing the function. For example you could use &lt;code>transform.bind&lt;/code> to create a specialized function which already has the &lt;code>onchange&lt;/code> callback.&lt;/p>
&lt;h3 id="lazy-effects">Lazy effects&lt;/h3>
&lt;p>The idea here is to delay the inevitable. Instead of performing the side effect right away what you do is provide a way for the caller of your function to execute the side-effect when they see fit. You can do this in a couple of ways.&lt;/p>
&lt;h4 id="using-function-wrappers">Using function wrappers&lt;/h4>
&lt;p>As I mentioned before in javascript you can treat functions as values and one thing you can do with values is returning them from functions. I'm talking about functions that return functions. We already saw how useful that can be and if you think about is not that crazy, how many times have you seen something like this?&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Stuff&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">thing&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// setup
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">some_method&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#5f6364;">// code...
&lt;/span>&lt;span style="color:#5fb3b3;">},
&lt;/span>&lt;span style="color:#6699cc;">other&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#5f6364;">// code...
&lt;/span>&lt;span style="color:#5fb3b3;">}
}
}
&lt;/span>&lt;/pre>
&lt;p>This is an old school &amp;quot;constructor.&amp;quot; Before, in the good ol' days of ES5, this was one way of emulating classes. Is a regular function that returns an object, and is we all know objects can have methods. What we want to do is little bit like that, we want convert the block that contains the side effect into a function and return it.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">some_process&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">config&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">/*
* do some pure computation with config
*/
&lt;/span>&lt;span style="color:#c594c5;">return function &lt;/span>&lt;span style="color:#6699cc;">_effect&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#5f6364;">/*
* do whatever you want in here
*/
&lt;/span>&lt;span style="color:#5fb3b3;">}
}
&lt;/span>&lt;/pre>
&lt;p>This way we give the caller of our function the opportunity to use the side effect when they want, and they can even pass it around and compose it with other functions. Interestingly enough this is not a very common pattern, maybe because there are other ways to achieve the same goal.&lt;/p>
&lt;h4 id="using-data-structures">Using data structures&lt;/h4>
&lt;p>Another way to create lazy effects is to wrap a side effect inside a data structure. What we want to do is to treat our effects as regular data, have the ability to manipulate them and even chain other effects in safe way (I mean without executing them). You've probably seen this before, one example that I can think of is Observables. Take a look at this code that uses rxjs.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// taken from:
// https://www.learnrxjs.io/operators/creation/create.html
/*
Increment value every 1s, emit even numbers.
*/
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">evenNumbers &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">create&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">interval &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">setInterval&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value &lt;/span>&lt;span style="color:#5fb3b3;">% &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">++;
}, &lt;/span>&lt;span style="color:#f99157;">1000&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">clearInterval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">interval&lt;/span>&lt;span style="color:#5fb3b3;">);
});
&lt;/span>&lt;/pre>
&lt;p>The result of &lt;code>Observable.create&lt;/code> not only delays the execution of &lt;code>setInterval&lt;/code> but also gives you the ability to call &lt;code>evenNumbers.pipe&lt;/code> to chain other observables that can also have other side effects. Now of course Observables and rxjs aren't the only way, we can create our own effect type. If we want to create one all we need is a function to execute the effect and another one that lets us compose effects.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Effect&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">effect&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">run&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">args&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">effect&lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#cccece;">args&lt;/span>&lt;span style="color:#5fb3b3;">);
},
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Effect&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">effect&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">)));
}
};
}
&lt;/span>&lt;/pre>
&lt;p>It may not look like much but this is actually enough to be useful. You can start composing your effects without triggering any changes to the environment. You can now do stuff like this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">persist &lt;/span>&lt;span style="color:#5fb3b3;">= (&lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(`&lt;/span>&lt;span style="color:#99c794;">saving &lt;/span>&lt;span style="color:#5fb3b3;">${&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">}&lt;/span>&lt;span style="color:#99c794;"> to a database...&lt;/span>&lt;span style="color:#5fb3b3;">`);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#f99157;">true &lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">;
};
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">show_message &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">result &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">result
&lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">we good&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
: &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">we not good&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">save &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">Effect&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">persist&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">show_message&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#cccece;">save&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">run&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">some stuff&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#5f6364;">// saving some stuff to a database...
// we good
&lt;/span>&lt;span style="color:#cccece;">save&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">run&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&amp;#39;);
&lt;/span>&lt;span style="color:#5f6364;">// saving to a database...
// we not good
&lt;/span>&lt;/pre>
&lt;p>If you have used &lt;code>Array.map&lt;/code> to compose data transformations you'll be feeling right at home when using &lt;code>Effect&lt;/code>, all you have to do is provide the functions with the side effect and at the of the chain the resulting &lt;code>Effect&lt;/code> will know what to do when you are ready to call it.&lt;/p>
&lt;p>I've only scratched the surface of what you can do with &lt;code>Effect&lt;/code>, if you want to learn more try to search the term &lt;code>functor&lt;/code> and &lt;code>IO Monad&lt;/code>, I promise you is going to be fun. &lt;/p>
&lt;h2 id="what-now">What now?&lt;/h2>
&lt;p>Now you click on the link in the end of the post, it's a really good article (basically a better version of this one). &lt;/p>
&lt;p>I hope now you are confident enough to start writing pure functions in your code and combine them with the convenient side effects that javascript lets you do.&lt;/p>
&lt;h2 id="sources">Sources&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://jrsinclair.com/articles/2018/how-to-deal-with-dirty-side-effects-in-your-pure-functional-javascript/">How to deal with dirty side effects in your pure functional JavaScript&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Lenses A.K.A. composable getters and setters</title><pubDate>Wed, 27 Nov 2019 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/web-development/lenses-a-k-a-composable-getters-and-setters/</link><guid>https://vonheikemen.github.io/devlog/web-development/lenses-a-k-a-composable-getters-and-setters/</guid><description>&lt;p>This time around we will figure out what are lenses, how do they look like in javascript and hopefully will build a mostly adequate implementation.&lt;/p>
&lt;p>Let us first take a step back and ask.&lt;/p>
&lt;h2 id="what-are-getters-and-setters">What are getters and setters?&lt;/h2>
&lt;p>This are functions that have one goal, they get or set value. But of course that is not the only thing they are good for. Most use cases I've seen involve triggering a side-effect when a value changes or put some validations to prevent undesired behavior.&lt;/p>
&lt;p>In javascript you could make them explicit by doing something like this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Some&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">thing &lt;/span>&lt;span style="color:#5fb3b3;">= &amp;#39;&lt;/span>&lt;span style="color:#99c794;">stuff&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">get_thing&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#5f6364;">// you can do anything in here
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">;
},
&lt;/span>&lt;span style="color:#6699cc;">set_thing&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// same in here.
&lt;/span>&lt;span style="color:#cccece;">thing &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
}
}
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">obj &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">Some&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">get_thing&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;#39;stuff&amp;#39;
&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">set_thing&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">other stuff&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">get_thing&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;#39;other stuff&amp;#39;
&lt;/span>&lt;/pre>
&lt;p>Or you could make then implicit.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">some &lt;/span>&lt;span style="color:#5fb3b3;">= {};
&lt;/span>&lt;span style="color:#fac863;">Object&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">defineProperty&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">some&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">thing&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, {
&lt;/span>&lt;span style="color:#6699cc;">get&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;&lt;/span>&lt;span style="color:#99c794;">thing&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
},
&lt;/span>&lt;span style="color:#6699cc;">set&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;quot;&lt;/span>&lt;span style="color:#99c794;">can&amp;#39;t touch this&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;);
}
});
&lt;/span>&lt;span style="color:#cccece;">some&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">thing &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;#39;thing&amp;#39;
&lt;/span>&lt;span style="color:#cccece;">some&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">thing &lt;/span>&lt;span style="color:#5fb3b3;">= &amp;#39;&lt;/span>&lt;span style="color:#99c794;">what?&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
&lt;/span>&lt;span style="color:#5f6364;">//
// can&amp;#39;t touch this
//
&lt;/span>&lt;span style="color:#cccece;">some&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">thing &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;#39;thing&amp;#39;
&lt;/span>&lt;/pre>
&lt;p>But what is so wrong in there that some people feel the need to use something like lenses?&lt;/p>
&lt;p>Let's start with that second example. I can tell you that some people don't like magical things, just the thought of a function being executed without their knowledge is bad enough.&lt;/p>
&lt;p>The first example is bit more interesting. Let's see it again.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">get_thing&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;#39;stuff&amp;#39;
&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">set_thing&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">other stuff&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">get_thing&lt;/span>&lt;span style="color:#5fb3b3;">(); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;#39;other stuff&amp;#39;
&lt;/span>&lt;/pre>
&lt;p>You use &lt;code>get_thing&lt;/code> you get &lt;code>stuff&lt;/code>, so far so good. But here is the problem you use it again in exactly the same way and yet you get &lt;code>other stuff&lt;/code>. You kinda have to keep track of the last call to &lt;code>set_thing&lt;/code> in order to know what you would get. We don't have the ability to predict the result from &lt;code>get_thing&lt;/code>, you can't be 100% sure what it will do without looking around (or knowing) others parts of the code.&lt;/p>
&lt;h2 id="is-there-a-better-way">Is there a better way?&lt;/h2>
&lt;p>I wouldn't say better. Let us just try lenses, you can decide later if you like them or not.&lt;/p>
&lt;p>What do we need? Lenses are a functional programing thing so the first thing we will do is create helper functions. This will be the first version of getters and setters.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Getter
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">key&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">obj &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">];
}
&lt;/span>&lt;span style="color:#5f6364;">// Setter
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">assoc&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">key&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">Object&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">assign&lt;/span>&lt;span style="color:#5fb3b3;">({}, &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">, {[&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">]: &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">});
}
&lt;/span>&lt;/pre>
&lt;p>Now for the &amp;quot;constructor.&amp;quot;&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">getter&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">setter&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{ &lt;/span>&lt;span style="color:#cccece;">getter&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">setter &lt;/span>&lt;span style="color:#5fb3b3;">};
}
&lt;/span>&lt;span style="color:#5f6364;">// That is it.
&lt;/span>&lt;/pre>
&lt;p>You'll notice that &lt;code>Lens&lt;/code> does absolutely nothing, I'm doing that on purpose. You can already tell that most of the work is in the getter and setter. Your lens are going to be as robust as your getter and setter implementations.&lt;/p>
&lt;p>Now we need to make them do something, we will make three little functions. &lt;/p>
&lt;p>&lt;code>view&lt;/code>: gets a value&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">lens&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">getter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>&lt;code>over&lt;/code>: transforms a value using a callback&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">over&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">lens&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">setter&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">lens&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">getter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#cccece;">obj
&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>&lt;code>set&lt;/code>: replaces a value&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">always&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">set&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">val&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// don&amp;#39;t you love reusability?
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">over&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">always&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>It's time for a test drive.&lt;/p>
&lt;p>Let's say we have an object named &lt;code>alice&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">alice &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#cccece;">name&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">Alice Jones&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;,
&lt;/span>&lt;span style="color:#cccece;">address&lt;/span>&lt;span style="color:#5fb3b3;">: [&amp;#39;&lt;/span>&lt;span style="color:#99c794;">22 Walnut St&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">San Francisco&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">CA&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;],
&lt;/span>&lt;span style="color:#cccece;">pets&lt;/span>&lt;span style="color:#5fb3b3;">: { &lt;/span>&lt;span style="color:#cccece;">dog&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">joker&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;#39;&lt;/span>&lt;span style="color:#99c794;">batman&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39; }
};
&lt;/span>&lt;/pre>
&lt;p>We'll start with something simple, inspect the values. This is how you would do it.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;), &lt;/span>&lt;span style="color:#6699cc;">assoc&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)),
&lt;/span>&lt;span style="color:#cccece;">alice
&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;Alice Jones&amp;quot;
&lt;/span>&lt;/pre>
&lt;p>I see you're not impressed and that's fine. I just wrote a lot characters just to get a name. But here is the thing, these are standalone functions. We can always compose and create new ones. Let's start with that &lt;code>Lens(prop, assoc)&lt;/code> bit, we will put that in a function because we will use it a lot.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">key&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#6699cc;">assoc&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;/pre>
&lt;p>And now...&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;), &lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;Alice Jones&amp;quot;
&lt;/span>&lt;/pre>
&lt;p>You could even take it one step further and make a function that just expects the object that holds the data.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">get_name &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">obj &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;), &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// or with partial application
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_name &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">view&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;));
&lt;/span>&lt;span style="color:#5f6364;">// or using a curry utility.
// view = curry(view);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">get_name &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;));
&lt;/span>&lt;span style="color:#5f6364;">// and you can also do this with `set` and `over`
&lt;/span>&lt;/pre>
&lt;p>Enough of that. Going back to our test, let's try &lt;code>over&lt;/code>. Let's transform the name to uppercase.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">upper &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">str &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">toUpperCase&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">uppercase_alice &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">over&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;), &lt;/span>&lt;span style="color:#cccece;">upper&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// see?
&lt;/span>&lt;span style="color:#6699cc;">get_name&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">uppercase_alice&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;ALICE JONES&amp;quot;
// sanity check
&lt;/span>&lt;span style="color:#6699cc;">get_name&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;Alice Jones&amp;quot;
&lt;/span>&lt;/pre>
&lt;p>It's &lt;code>set&lt;/code>'s turn.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">alice_smith &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">set&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">name&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;), &amp;#39;&lt;/span>&lt;span style="color:#99c794;">Alice smith&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">get_name&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">alice_smith&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;Alice smith&amp;quot;
// sanity check
&lt;/span>&lt;span style="color:#6699cc;">get_name&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;Alice Jones&amp;quot;
&lt;/span>&lt;/pre>
&lt;p>That's all nice but the name is just one property, what about nested object keys or arrays? Ah, you see now that is where it gets awkward with our current implementation. Right now you could do the following.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">dog &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#f99157;">obj &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">dog&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)(&lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">pets&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#f99157;">obj &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">assoc&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">dog&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)(&lt;/span>&lt;span style="color:#6699cc;">assoc&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">pets&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">))
);
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dog&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;joker&amp;quot;
// or bring a `compose` utility
&lt;/span>&lt;span style="color:#cccece;">dog &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">compose&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;quot;&lt;/span>&lt;span style="color:#99c794;">dog&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;), &lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;quot;&lt;/span>&lt;span style="color:#99c794;">pets&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;)),
&lt;/span>&lt;span style="color:#6699cc;">compose&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">assoc&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;quot;&lt;/span>&lt;span style="color:#99c794;">dog&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;), &lt;/span>&lt;span style="color:#6699cc;">assoc&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;quot;&lt;/span>&lt;span style="color:#99c794;">pets&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;))
);
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dog&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;joker&amp;quot;
&lt;/span>&lt;/pre>
&lt;p>I hear you. Don't worry, I wouldn't let you write stuff like that. It is because of situations like this one that people say stuff like &amp;quot;just use &lt;a href="https://ramdajs.com/">Ramda&lt;/a>&amp;quot; (and those people are right) But what makes ramda so special?&lt;/p>
&lt;h2 id="making-it-special">Making it special&lt;/h2>
&lt;p>If you go to ramda's documentation and search &amp;quot;lens&amp;quot; you'll see that they have a &lt;code>lensProp&lt;/code> function which is basically our &lt;code>Lprop&lt;/code>. And if you go to the source you'll see something like this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">lensProp&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">k&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">prop&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">k&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#6699cc;">assoc&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">k&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;/pre>
&lt;p>Look at that. But now the comments on their source and documentation suggest that it also works with just one property. Let's go back to our &amp;quot;lens&amp;quot; search on their site. Now we will check that curious &lt;code>lensPath&lt;/code> function. It is exactly what we want. Once again we check out the source.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">lensPath&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">p&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">p&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#6699cc;">assocPath&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">p&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;span style="color:#5f6364;">// Welcome to functional programming, y&amp;#39;all.
&lt;/span>&lt;/pre>
&lt;p>The secret sauce it's made of other functions that don't have any specific ties to lenses. Isn't that just nice?&lt;/p>
&lt;p>What is in that &lt;code>path&lt;/code> function? Let's check it out. I'll show you a slightly different version, but it works just the same.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">keys&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// this is for currying
// they do this by wrapping `path`
// with a helper function
// but this is what happens
// they return a function that remembers `keys`
// and expects `obj`
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">this&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">keys&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">idx &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">while &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">idx &lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt; &lt;/span>&lt;span style="color:#cccece;">keys&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// we don&amp;#39;t like null
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">== &lt;/span>&lt;span style="color:#f99157;">null&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#5f6364;">// this is how we get the nested keys
&lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">keys&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">idx&lt;/span>&lt;span style="color:#5fb3b3;">]];
&lt;/span>&lt;span style="color:#cccece;">idx &lt;/span>&lt;span style="color:#5fb3b3;">+= &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>I'll do the same with &lt;code>assocPath&lt;/code>. For this one they make use of some internal helpers but again this is what happens.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">assocPath&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">path&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// again with the currying stuff
// this is why they have a helper function
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">assocPath&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">this&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">);
} &lt;/span>&lt;span style="color:#c594c5;">else if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">arguments&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">assocPath&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">bind&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#ec5f67;">this&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#5f6364;">// check for an empty list
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">path&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">index &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">path&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#5f6364;">// Beware: recursion ahead.
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">path&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">length &lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt; &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">is_empty &lt;/span>&lt;span style="color:#5fb3b3;">=
typeof &lt;/span>&lt;span style="color:#cccece;">obj &lt;/span>&lt;span style="color:#5fb3b3;">!== &amp;#39;&lt;/span>&lt;span style="color:#99c794;">object&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39; || &lt;/span>&lt;span style="color:#cccece;">obj &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">null &lt;/span>&lt;span style="color:#5fb3b3;">|| !&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">hasOwnProperty&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">index&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// if the current object is &amp;quot;empty&amp;quot;
// we need to create a new one
// otherwise we pick the object at `index`
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">next &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">is_empty
&lt;/span>&lt;span style="color:#5fb3b3;">? typeof &lt;/span>&lt;span style="color:#cccece;">path&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">] === &amp;#39;&lt;/span>&lt;span style="color:#99c794;">number&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;
? []
: {}
: &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">index&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#5f6364;">// we start again the process
// but now with a reduced `path`
// and `next` as the new `obj`
&lt;/span>&lt;span style="color:#cccece;">value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">assocPath&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Array&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">prototype&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">slice&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">call&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">next&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#5f6364;">// the base cases
// we either have to copy an array
// or an object
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(typeof &lt;/span>&lt;span style="color:#cccece;">index &lt;/span>&lt;span style="color:#5fb3b3;">=== &amp;#39;&lt;/span>&lt;span style="color:#99c794;">number&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39; &amp;amp;&amp;amp; &lt;/span>&lt;span style="color:#fac863;">Array&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">isArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">)) {
&lt;/span>&lt;span style="color:#5f6364;">// make a &amp;#39;copy&amp;#39; of the array
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">arr &lt;/span>&lt;span style="color:#5fb3b3;">= [].&lt;/span>&lt;span style="color:#6699cc;">concat&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#cccece;">arr&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">index&lt;/span>&lt;span style="color:#5fb3b3;">] = &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">arr&lt;/span>&lt;span style="color:#5fb3b3;">;
} &lt;/span>&lt;span style="color:#c594c5;">else &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#5f6364;">// old school &amp;#39;copy&amp;#39;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= {};
&lt;/span>&lt;span style="color:#c594c5;">for &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">p &lt;/span>&lt;span style="color:#5fb3b3;">in &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">p&lt;/span>&lt;span style="color:#5fb3b3;">] = &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">p&lt;/span>&lt;span style="color:#5fb3b3;">];
}
&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">index&lt;/span>&lt;span style="color:#5fb3b3;">] = &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
}
}
&lt;/span>&lt;/pre>
&lt;p>With our new found knowledge we can create an &lt;code>Lpath&lt;/code> function and improve &lt;code>Lprop&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Lpath&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">keys&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">keys&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#6699cc;">assocPath&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">keys&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">key&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">]), &lt;/span>&lt;span style="color:#6699cc;">assocPath&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">]));
}
&lt;/span>&lt;/pre>
&lt;p>Now we can do more stuff, like playing with &lt;code>alice&lt;/code> pets.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">dog_lens &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">Lpath&lt;/span>&lt;span style="color:#5fb3b3;">([&amp;#39;&lt;/span>&lt;span style="color:#99c794;">pets&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">dog&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dog_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;#39;joker&amp;#39;
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">new_alice &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">over&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dog_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">upper&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dog_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">new_alice&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;#39;JOKER&amp;#39;
&lt;/span>&lt;span style="color:#cccece;">new_alice &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">set&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dog_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">Joker&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dog_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">new_alice&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;#39;Joker&amp;#39;
&lt;/span>&lt;/pre>
&lt;p>All of this works great but there is just one tiny detail, the lenses that the current constructor creates aren't composable. Imagine that we have three lenses from differents files or something and we want to combine them like this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#6699cc;">compose&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">pet_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">imaginary_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>This wouldn't work because &lt;code>compose&lt;/code> expects a list of functions and our lenses are objects. But we can fix this (in a very funny way) with some functional programming trickery.&lt;/p>
&lt;p>Let's start with our lenses constructor. Instead of returning an object we are going to return a &amp;quot;curried&amp;quot; function that takes a callback, an object and returns a &lt;strong>Functor&lt;/strong> (a thing that has &lt;code>map&lt;/code> method and follows &lt;a href="https://github.com/fantasyland/fantasy-land#functor">this rules&lt;/a>)&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">getter&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">setter&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">fn &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#f99157;">obj &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">apply &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">focus &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">setter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">focus&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">functor &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">getter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">functor&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">apply&lt;/span>&lt;span style="color:#5fb3b3;">);
};
}
&lt;/span>&lt;/pre>
&lt;p>What's with the a &lt;code>fn =&amp;gt; obj =&amp;gt;&lt;/code> stuff? That is going to help us with our &lt;code>compose&lt;/code> situation. Now after you provide the &lt;code>getter&lt;/code> and &lt;code>setter&lt;/code> you get a function, and that is what makes &lt;code>compose&lt;/code> happy.&lt;/p>
&lt;p>And &lt;code>functor.map&lt;/code>? That is going to make sure that we can still use a lens as unit (like &lt;code>Lprop('pets')&lt;/code>) but also a part of a chain using &lt;code>compose&lt;/code>.&lt;/p>
&lt;p>In case you are wondering what the good folks at ramda do different, they use their own bulletproof implementation of &lt;code>map&lt;/code>.&lt;/p>
&lt;p>Now we modify &lt;code>view&lt;/code> and &lt;code>over&lt;/code>. Starting with &lt;code>view&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">constant &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">constant&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">) });
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">constant&lt;/span>&lt;span style="color:#5fb3b3;">)(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>That &lt;code>constant&lt;/code> thing might look like is too much, but it does the job. Things can get crazy in those &lt;code>compose&lt;/code> chains, that just makes sure the value you want stays safe.&lt;/p>
&lt;p>What about &lt;code>over&lt;/code>? It will do almost the same thing, except that in this case we do need to use the &lt;code>setter&lt;/code> function.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">over&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">identity &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">setter &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">identity&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">setter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)) });
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">apply &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">identity&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">apply&lt;/span>&lt;span style="color:#5fb3b3;">)(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>And now we should have a mostly adequate &lt;code>Lens&lt;/code> implementation. The whole thing without dependencies (&lt;code>path&lt;/code> and &lt;code>assocPath&lt;/code>) should look like this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">getter&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">setter&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">fn &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#f99157;">obj &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">apply &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">focus &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">setter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">focus&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">functor &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">getter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">functor&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">apply&lt;/span>&lt;span style="color:#5fb3b3;">);
};
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">constant &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">constant&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">) });
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">constant&lt;/span>&lt;span style="color:#5fb3b3;">)(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">over&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">identity &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">({ &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">setter &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">identity&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">setter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)) });
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">apply &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">identity&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">apply&lt;/span>&lt;span style="color:#5fb3b3;">)(&lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">set&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">val&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">obj&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">over&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">always&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">obj&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">key&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">]), &lt;/span>&lt;span style="color:#6699cc;">assocPath&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#cccece;">key&lt;/span>&lt;span style="color:#5fb3b3;">]));
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Lpath&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">keys&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Lens&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">path&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">keys&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#6699cc;">assocPath&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">keys&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">always&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>But can you believe me if I said it works? You shouldn't. Let's make some tests. We'll bring back &lt;code>alice&lt;/code> and add her sister &lt;code>calie&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">alice &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#cccece;">name&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Alice Jones&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">address&lt;/span>&lt;span style="color:#5fb3b3;">: [&amp;quot;&lt;/span>&lt;span style="color:#99c794;">22 Walnut St&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">San Francisco&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">CA&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;],
&lt;/span>&lt;span style="color:#cccece;">pets&lt;/span>&lt;span style="color:#5fb3b3;">: { &lt;/span>&lt;span style="color:#cccece;">dog&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">joker&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">batman&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &lt;/span>&lt;span style="color:#cccece;">imaginary&lt;/span>&lt;span style="color:#5fb3b3;">: { &lt;/span>&lt;span style="color:#cccece;">dragon&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">harley&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; } }
};
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">calie &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#cccece;">name&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">calie Jones&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;,
&lt;/span>&lt;span style="color:#cccece;">address&lt;/span>&lt;span style="color:#5fb3b3;">: [&amp;quot;&lt;/span>&lt;span style="color:#99c794;">22 Walnut St&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">San Francisco&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">CA&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;],
&lt;/span>&lt;span style="color:#cccece;">pets&lt;/span>&lt;span style="color:#5fb3b3;">: { &lt;/span>&lt;span style="color:#cccece;">dog&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">riddler&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &lt;/span>&lt;span style="color:#cccece;">cat&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">ivy&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &lt;/span>&lt;span style="color:#cccece;">imaginary&lt;/span>&lt;span style="color:#5fb3b3;">: { &lt;/span>&lt;span style="color:#cccece;">dragon&lt;/span>&lt;span style="color:#5fb3b3;">: &amp;quot;&lt;/span>&lt;span style="color:#99c794;">hush&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; } },
&lt;/span>&lt;span style="color:#cccece;">friend&lt;/span>&lt;span style="color:#5fb3b3;">: [&lt;/span>&lt;span style="color:#cccece;">alice&lt;/span>&lt;span style="color:#5fb3b3;">]
};
&lt;/span>&lt;/pre>
&lt;p>And because we planned ahead we have some lenses already available.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// some generic lens
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">head_lens &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// specific lens
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">bff_lens &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">compose&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">friend&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;), &lt;/span>&lt;span style="color:#cccece;">head_lens&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">imaginary_lens &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">Lpath&lt;/span>&lt;span style="color:#5fb3b3;">([&amp;#39;&lt;/span>&lt;span style="color:#99c794;">pets&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">imaginary&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;]);
&lt;/span>&lt;/pre>
&lt;p>Say that we want to do something with their &lt;code>dragons&lt;/code>, all we have to do is &lt;code>compose&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">dragon_lens &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">compose&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">imaginary_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">Lprop&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">dragon&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;));
&lt;/span>&lt;span style="color:#5f6364;">// just for fun
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">bff_dragon_lens &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">compose&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">bff_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// demo
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">upper &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">str &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">toUpperCase&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#5f6364;">// view
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">calie&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;hush&amp;quot;
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">bff_dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">calie&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;harley&amp;quot;
// over
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">new_calie &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">over&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">upper&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">calie&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">new_calie&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;HUSH&amp;quot;
&lt;/span>&lt;span style="color:#cccece;">new_calie &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">over&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">bff_dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">upper&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">calie&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">bff_dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">new_calie&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;HARLEY&amp;quot;
// set
&lt;/span>&lt;span style="color:#cccece;">new_calie &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">set&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">fluffykins&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#cccece;">calie&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">new_calie&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;fluffykins&amp;quot;
&lt;/span>&lt;span style="color:#cccece;">new_calie &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">set&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">bff_dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">pumpkin&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#cccece;">calie&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#6699cc;">view&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">bff_dragon_lens&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">new_calie&lt;/span>&lt;span style="color:#5fb3b3;">); &lt;/span>&lt;span style="color:#5f6364;">// =&amp;gt; &amp;quot;pumpkin&amp;quot;
&lt;/span>&lt;/pre>
&lt;p>So we just manipulated a deeply nested object property by composing lenses. If you're not excited then I don't know what to tell you. We just solve a problem by composing functions! &lt;/p>
&lt;p>These things can be hard to sell because they require for you to write in a certain style in order to make the most out of it. And for people who write javascript there are libraries out there that solve the same problem in a more convenient way, or at least in a way that is more suitable for their style. &lt;/p>
&lt;p>Anyway, if you're still interested in seeing lenses in a non trivial context checkout &lt;a href="https://github.com/kwasniew/hyperapp-realworld-example-app">this repository&lt;/a>, it is a &lt;a href="https://github.com/gothinkster/realworld">real world example app&lt;/a> (kinda like medium.com clone) that uses hyperapp to handle the frontend. In it the author chose to use lenses to handle state of the app.&lt;/p>
&lt;h2 id="sources">Sources&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://ramdajs.com/docs/">ramda - docs&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://gist.github.com/branneman/f06bd451f74e5bc1725db23be682d4fe">fp-lenses.js&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.youtube.com/watch?v=IoVaArsh6tM">Lambda World 2018 - Functional Lenses in JavaScript (video)&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Functional programming for your everyday javascript: Using a Maybe</title><pubDate>Mon, 28 Oct 2019 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-using-a-maybe/</link><guid>https://vonheikemen.github.io/devlog/web-development/functional-programming-for-your-everyday-javascript-using-a-maybe/</guid><description>&lt;p>Have you ever heard about monads and how great they are? Maybe you have but you still don't get it. Well... I'm not here to tell you what they are, I won't try to sell them to you either, what I will do is show you an example of how would it be if you use them in your javascripts.&lt;/p>
&lt;p>We'll do something fun, lets solve a fairly trivial problem in an unnecessary complicated way. &lt;/p>
&lt;p>Suppose that we have a dictionary stored in a json file or a plain js object.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">{
&amp;quot;&lt;/span>&lt;span style="color:#99c794;">accident&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#cccece;">: &lt;/span>&lt;span style="color:#5fb3b3;">[&amp;quot;&lt;/span>&lt;span style="color:#99c794;">An unexpected, unfortunate mishap, failure or loss with the potential for harming human life, property or the environment.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">An event that happens suddenly or by chance without an apparent cause.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;],
&amp;quot;&lt;/span>&lt;span style="color:#99c794;">accumulator&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#cccece;">: &lt;/span>&lt;span style="color:#5fb3b3;">[&amp;quot;&lt;/span>&lt;span style="color:#99c794;">A rechargeable device for storing electrical energy in the form of chemical energy, consisting of one or more separate secondary cells.&lt;/span>&lt;span style="color:#5fb3b3;">\\&lt;/span>&lt;span style="color:#99c794;">n(Source: CED)&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;],
&amp;quot;&lt;/span>&lt;span style="color:#99c794;">acid&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#cccece;">: &lt;/span>&lt;span style="color:#5fb3b3;">[&amp;quot;&lt;/span>&lt;span style="color:#99c794;">A compound capable of transferring a hydrogen ion in solution.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Being harsh or corrosive in tone.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Having an acid, sharp or tangy taste.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">A powerful hallucinogenic drug manufactured from lysergic acid.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;, &amp;quot;&lt;/span>&lt;span style="color:#99c794;">Having a pH less than 7, or being sour, or having the strength to neutralize alkalis, or turning a litmus paper red.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;],
&lt;/span>&lt;span style="color:#5f6364;">// ... moar words and meanings
&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#99c794;">Paris&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&lt;/span>&lt;span style="color:#cccece;">: &lt;/span>&lt;span style="color:#5fb3b3;">[&amp;quot;&lt;/span>&lt;span style="color:#99c794;">The capital and largest city of France.&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;]
}
&lt;/span>&lt;/pre>
&lt;p>We want a form that lets a user search one of this words and then shows the meaning(s). This is simple, right? What could possibly go wrong?&lt;/p>
&lt;p>Because everyone loves HTML we'll start with that.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">form &lt;/span>&lt;span style="color:#bb80b3;">id&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">search_form&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">label &lt;/span>&lt;span style="color:#bb80b3;">for&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">search_input&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&lt;/span>&lt;span style="color:#cccece;">Search a word&lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">label&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">input &lt;/span>&lt;span style="color:#bb80b3;">id&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">search_input&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot; &lt;/span>&lt;span style="color:#bb80b3;">type&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">text&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">button &lt;/span>&lt;span style="color:#bb80b3;">type&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">submit&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&lt;/span>&lt;span style="color:#cccece;">Submit&lt;/span>&lt;span style="color:#5fb3b3;">&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">button&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">form&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&amp;lt;&lt;/span>&lt;span style="color:#eb606b;">div &lt;/span>&lt;span style="color:#bb80b3;">id&lt;/span>&lt;span style="color:#5fb3b3;">=&amp;quot;&lt;/span>&lt;span style="color:#99c794;">result&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;&amp;gt;&amp;lt;/&lt;/span>&lt;span style="color:#eb606b;">div&lt;/span>&lt;span style="color:#5fb3b3;">&amp;gt;
&lt;/span>&lt;/pre>
&lt;p>In the first version we will just try get one those values based on the user input.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
// magically retrieve the data from a file or whatever
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">entries &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">data&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">format&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">results&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">results&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">join&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">&amp;lt;br&amp;gt;&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;); &lt;/span>&lt;span style="color:#5f6364;">// I regret nothing
&lt;/span>&lt;span style="color:#5fb3b3;">}
&lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">search_form&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">addEventListener&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">submit&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">ev&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">preventDefault&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">input &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">target&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">innerHTML &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">format&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">]);
});
&lt;/span>&lt;/pre>
&lt;p>Naturally the first thing we try to search is &amp;quot;acid.&amp;quot; And behold here are the results.&lt;/p>
&lt;blockquote>
&lt;p>A compound capable of transferring a hydrogen ion in solution.
Being harsh or corrosive in tone.
Having an acid, sharp or tangy taste.
A powerful hallucinogenic drug manufactured from lysergic acid.
Having a pH less than 7, or being sour, or having the strength to neutralize alkalis, or turning a litmus paper red.&lt;/p>
&lt;/blockquote>
&lt;p>Now we search for &amp;quot;paris&amp;quot;, I'm sure it's there. What did we get? Nothing. Not exactly nothing, we got.&lt;/p>
&lt;blockquote>
&lt;p>TypeError: results is undefined&lt;/p>
&lt;/blockquote>
&lt;p>We also got an unpredictable submit button that sometime works and sometimes doesn't. So what do we want? What do we really, really want? Safety, objects that don't crash our application, we want reliable objects. &lt;/p>
&lt;p>What we will do is implement containers that let us describe the flow of execution without worrying about the value they hold. Sounds good, right? Let me show you what I mean with a little javascript. Try this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">is_even &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">% &lt;/span>&lt;span style="color:#f99157;">2 &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">odd_arr &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">4&lt;/span>&lt;span style="color:#5fb3b3;">,&lt;/span>&lt;span style="color:#f99157;">5&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">is_even&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">());
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">empty_arr &lt;/span>&lt;span style="color:#5fb3b3;">= [].&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">is_even&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">());
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">({&lt;/span>&lt;span style="color:#cccece;">odd_arr&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">empty_arr&lt;/span>&lt;span style="color:#5fb3b3;">});
&lt;/span>&lt;/pre>
&lt;p>Did it throw an exception on the empty array? (if it did let me know). Isn't that nice? Doesn't it feel all warm and fuzzy knowing that the array methods would do the right thing even if there isn't anything to work with? That is what we want.&lt;/p>
&lt;p>You might be wondering couldn't we just write a few &lt;code>if&lt;/code> statements and be done with it? Well... yeah, but where is the fun in that? We all know that chaining functions is cool, and we are fans of functional programming, we do what every functional programming savvy does: &lt;strong>hide things under a function&lt;/strong>.&lt;/p>
&lt;p>So we are going to hide an &lt;code>if&lt;/code> statement (or maybe a couple), if the value we evaluate is undefined-ish we return a wrapper that will know how to behave no matter what happens.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// maybe.js
// (I would like to apologize for the many `thing`s you&amp;#39;ll see)
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">the_thing &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">null
&lt;/span>&lt;span style="color:#5fb3b3;">|| &lt;/span>&lt;span style="color:#cccece;">the_thing &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">undefined
&lt;/span>&lt;span style="color:#5fb3b3;">|| &lt;/span>&lt;span style="color:#cccece;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">is_nothing
&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">();
}
&lt;/span>&lt;span style="color:#5f6364;">// I don&amp;#39;t want nested Maybes
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Just&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">the_thing&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>This wrappers are not going to be your standard by the book &lt;code>Maybe&lt;/code> you see in a proper functional programming language. We will cheat a little in the name of convenience and side effects. Also their methods will be named after the methods in the Option type you find in Rust (I like those names better). Here is where the magic happens.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// maybe.js
// I lied, there will be a lot of cheating and `fun`s.
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Just&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">thing&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#6699cc;">and_then&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">or_else&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">tap&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">predicate_fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#6699cc;">predicate_fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">)
? &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">)
: &lt;/span>&lt;span style="color:#6699cc;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">(),
&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_nothing&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">inspect&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">`&lt;/span>&lt;span style="color:#99c794;">Just(&lt;/span>&lt;span style="color:#5fb3b3;">${&lt;/span>&lt;span style="color:#cccece;">thing&lt;/span>&lt;span style="color:#5fb3b3;">}&lt;/span>&lt;span style="color:#99c794;">)&lt;/span>&lt;span style="color:#5fb3b3;">`,
};
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#cccece;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">and_then&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">or_else&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(),
&lt;/span>&lt;span style="color:#cccece;">tap&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">filter&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#cccece;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_nothing&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">inspect&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">`&lt;/span>&lt;span style="color:#99c794;">Nothing&lt;/span>&lt;span style="color:#5fb3b3;">`,
};
}
&lt;/span>&lt;/pre>
&lt;p>What is the purpose of these methods?&lt;/p>
&lt;ul>
&lt;li>&lt;code>map&lt;/code>: Applies the function &lt;code>fun&lt;/code> to &lt;code>the_thing&lt;/code> and wraps it again on a Maybe to keep the party going... I mean to keep the shape of the object, so you can keep chaining functions.&lt;/li>
&lt;li>&lt;code>and_then&lt;/code>: This is mostly an escape hatch. Apply the function &lt;code>fun&lt;/code> and let fate decide.&lt;/li>
&lt;li>&lt;code>or_else&lt;/code>: It is the &lt;code>else&lt;/code> to your &lt;code>map&lt;/code> and &lt;code>and_then&lt;/code>. The other path. The &amp;quot;what if is not there?&amp;quot;&lt;/li>
&lt;li>&lt;code>tap&lt;/code>: These one is there just for the side effects. If you see it then it's probably affecting something outside of it's scope (or maybe is just the perfect place to put a &lt;code>console.log&lt;/code>).&lt;/li>
&lt;li>filter: It &amp;quot;lets you go through&amp;quot; if the predicate function returns something truthy.&lt;/li>
&lt;li>&lt;code>unwrap_or&lt;/code>: This is how you get &lt;code>the_thing&lt;/code> out. You'll want this when you're done chaining methods and you're ready to get back to the imperative world.&lt;/li>
&lt;/ul>
&lt;p>Lets go back to our form and see it in action. We'll make a function &lt;code>search&lt;/code> that may o may not retrieve a match to the user's query. If it does we'll chain other functions that will be executed in a &amp;quot;safe context.&amp;quot;&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">search &lt;/span>&lt;span style="color:#5fb3b3;">= (&lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">input&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">]);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">search_word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">word &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">format&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">word not found&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;/pre>
&lt;p>And now we replace our unholy old way with the new safe(r) function.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> window.search_form.addEventListener(&amp;#39;submit&amp;#39;, function(ev) {
ev.preventDefault();
let input = ev.target[0];
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> window.result.innerHTML = format(entries[input.value]);
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> window.result.innerHTML = search_word(input.value);
&lt;/span>&lt;span style="color:#cccece;"> });
&lt;/span>&lt;/pre>
&lt;p>Now we test. Search for &amp;quot;accident.&amp;quot;&lt;/p>
&lt;blockquote>
&lt;p>An unexpected, unfortunate mishap, failure or loss with the potential for harming human life, property or the environment.
An event that happens suddenly or by chance without an apparent cause.&lt;/p>
&lt;/blockquote>
&lt;p>Now Paris. Search for &amp;quot;paris.&amp;quot;&lt;/p>
&lt;blockquote>
&lt;p>word not found&lt;/p>
&lt;/blockquote>
&lt;p>It didn't freeze the button, that's good. But I know Paris is there. If you check you'll see that is &amp;quot;Paris.&amp;quot; We'll just capitalize the user input so they don't have to. First we'll try to search the exact input, if that fails we'll try the capitalize way.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">create_search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">exact&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">input &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">exact &lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#cccece;">input &lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#6699cc;">capitalize&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">]);
}
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">capitalize&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">str&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">charAt&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">toUpperCase&lt;/span>&lt;span style="color:#5fb3b3;">() + &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">slice&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Change the search function.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> const search = (data, input) =&amp;gt; Maybe(data[input]);
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> const search = create_search(entries, true);
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> const search_name = create_search(entries, false);
&lt;/span>&lt;span style="color:#5fb3b3;">-
-&lt;/span>&lt;span style="color:#ec5f67;"> const search_word = word =&amp;gt; search(entries, word)
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> const search_word = word =&amp;gt; search(word)
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> .or_else(() =&amp;gt; search_name(word))
&lt;/span>&lt;span style="color:#cccece;"> .map(format)
.unwrap_or(&amp;#39;word not found&amp;#39;);
&lt;/span>&lt;/pre>
&lt;p>Very nice. This what we got so far in main.js if you wanna see the whole picture.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">entries &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">data&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">create_search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">data&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">exact&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">input &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">exact &lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#cccece;">input &lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#6699cc;">capitalize&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">data&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">]);
}
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">capitalize&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">str&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">charAt&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">toUpperCase&lt;/span>&lt;span style="color:#5fb3b3;">() + &lt;/span>&lt;span style="color:#cccece;">str&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">slice&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">format&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">results&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">results&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">join&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">&amp;lt;br&amp;gt;&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
}
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">search &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">create_search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">search_name &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">create_search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">search_word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">word &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">or_else&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">search_name&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">))
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">format&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">word not found&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">search_form&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">addEventListener&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">submit&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;, &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">ev&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">preventDefault&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">input &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">ev&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">target&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">innerHTML &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">search_word&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">input&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
});
&lt;/span>&lt;/pre>
&lt;p>But is that all we want in life? No, of course not, we want love but since javascript can't give us that we'll settle for a little &amp;quot;suggest word&amp;quot; feature. I want to search &amp;quot;accu&amp;quot; and have a confirm dialog telling me &amp;quot;Did you mean accumulator?&amp;quot;&lt;/p>
&lt;p>We'll need help with this one, we'll bring a dependency, one that can perform a fuzzy search on the entries: &lt;a href="https://github.com/wouter2203/fuzzy-search#readme">fuzzy-search&lt;/a>. So we add the following. &lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">import &lt;/span>&lt;span style="color:#cccece;">FuzzySearch &lt;/span>&lt;span style="color:#c594c5;">from &lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;&lt;/span>&lt;span style="color:#99c794;">https://unpkg.com/fuzzy-search@3.0.1/src/FuzzySearch.js&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;;
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">fzf &lt;/span>&lt;span style="color:#5fb3b3;">= new &lt;/span>&lt;span style="color:#cccece;">FuzzySearch&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#fac863;">Object&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">keys&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">entries&lt;/span>&lt;span style="color:#5fb3b3;">),
[],
{&lt;/span>&lt;span style="color:#6699cc;">caseSensitive&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">sort&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">}
);
&lt;/span>&lt;/pre>
&lt;p>But again we can't perform a safe operation 'cause the moment we try to get a match from an empty array the whole thing will fall apart. So what do we do? We hide things under a function.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">suggest&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">word&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">matches &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">fzf&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">search&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">word&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">matches&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">]);
}
&lt;/span>&lt;/pre>
&lt;p>Fuzzy search is ready, now lets throw in a super awesome confirm dialog. You'll love it.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">confirm_word&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value &lt;/span>&lt;span style="color:#5fb3b3;">&amp;amp;&amp;amp; &lt;/span>&lt;span style="color:#6699cc;">confirm&lt;/span>&lt;span style="color:#5fb3b3;">(`&lt;/span>&lt;span style="color:#99c794;">Did you mean &lt;/span>&lt;span style="color:#5fb3b3;">${&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">}`)) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">;
}
}
&lt;/span>&lt;/pre>
&lt;p>We combine the new functions with our &lt;code>search&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// main.js
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">suggest_word &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">suggest&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">confirm_word&lt;/span>&lt;span style="color:#5fb3b3;">)
.&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">search&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;/pre>
&lt;p>Add the feature to &lt;code>search_word&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const search_word = word =&amp;gt; search(word)
.or_else(() =&amp;gt; search_name(word))
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> .or_else(suggest_word(word))
&lt;/span>&lt;span style="color:#cccece;"> .map(format)
.unwrap_or(&amp;#39;word not found&amp;#39;);
&lt;/span>&lt;/pre>
&lt;p>That works! But lets say we are allergic to &lt;code>if&lt;/code> statements and not to mention that it's just rude to return &lt;code>undefined&lt;/code> from a function. We can do better.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function confirm_word(value) {
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> if(value &amp;amp;&amp;amp; confirm(`Did you mean ${value}`)) {
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> return value;
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> }
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> return confirm(`Did you mean ${value}`);
&lt;/span>&lt;span style="color:#cccece;"> }
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const suggest_word = value =&amp;gt; () =&amp;gt; suggest(value)
&lt;/span>&lt;span style="color:#5fb3b3;">-&lt;/span>&lt;span style="color:#ec5f67;"> .map(confirm_word)
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> .filter(confirm_word)
&lt;/span>&lt;span style="color:#cccece;"> .map(search);
&lt;/span>&lt;/pre>
&lt;p>Something bugs me. I search &amp;quot;accu&amp;quot;, the dialog pops in, I confirm the suggestion and the results appears. But &amp;quot;accu&amp;quot; it's still there in the input, it's awkward. Lets update the input with the right word.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">update_input &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">window&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">search_form&lt;/span>&lt;span style="color:#5fb3b3;">[&lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">].&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;/pre>&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> const suggest_word = value =&amp;gt; () =&amp;gt; suggest(value)
.filter(confirm_word)
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> .tap(update_input)
&lt;/span>&lt;span style="color:#cccece;"> .map(search);
&lt;/span>&lt;/pre>
&lt;p>Want to see it in action? There you go.&lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="JjjNvLE"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="Maybe I got your word">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/JjjNvLE">Maybe I got your word&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;script async src="https://static.codepen.io/assets/embed/ei.js">&lt;/script>
&lt;h2 id="bonus-track">Bonus track&lt;/h2>
&lt;blockquote>
&lt;p>&lt;em>Warning&lt;/em>: The main point of the post (which is me showing that codepen example) was already accomplished. What follows is a strange experiment to see if I could make that &lt;code>Maybe&lt;/code> function support asynchronous operations. If you are tired just skip everything and check out the last example code.&lt;/p>
&lt;/blockquote>
&lt;p>Now you might be saying: this is cute and all but in the &amp;quot;real world&amp;quot; we make http requests, query a database, make all sorts of asynchronous stuff, can this still be useful in that context?&lt;/p>
&lt;p>I hear you. Our current implementation just supports normal blocking tasks. You would have to break the chain of &lt;code>Maybes&lt;/code> the moment a &lt;code>Promise&lt;/code> shows up. &lt;/p>
&lt;p>But what if... listen... we make a promise aware &lt;code>Just&lt;/code>. We can do that, an &lt;code>AsyncJust&lt;/code>? &lt;code>JustAsync&lt;/code>? Oh, that's awful.&lt;/p>
&lt;p>If you don't know, a &lt;code>Promise&lt;/code> is a data type that javascript uses to coordinate future events. To do so it uses a method called &lt;code>then&lt;/code> that takes a callback (it also has &lt;code>catch&lt;/code> for when things go wrong) So if we hijack what goes into that &lt;code>then&lt;/code> then we can keep our nice &lt;code>Maybe&lt;/code> interface.&lt;/p>
&lt;p>How good are you following a bunch of callbacks?&lt;/p>
&lt;p>Here I go. Let me show you the &lt;code>Future&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Don&amp;#39;t judge me.
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">map_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">))),
&lt;/span>&lt;span style="color:#6699cc;">and_then&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">map_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">))),
&lt;/span>&lt;span style="color:#6699cc;">or_else&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#6699cc;">tap&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">))),
&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">filter&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_thing&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">filter_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">))),
&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_nothing&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">false&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">is_future&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">true&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#6699cc;">inspect&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">`&lt;/span>&lt;span style="color:#99c794;">&amp;lt;Promise&amp;gt;&lt;/span>&lt;span style="color:#5fb3b3;">`
};
}
&lt;/span>&lt;/pre>
&lt;p>If we remove the noise maybe we could understand better.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// In it&amp;#39;s very core is callbacks all the way.
&lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#cccece;">map&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">and_then: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">or_else: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">tap: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">))&lt;/span>&lt;span style="color:#cccece;">)&lt;/span>&lt;span style="color:#5fb3b3;">,
&lt;/span>&lt;span style="color:#cccece;">unwrap_or: &lt;/span>&lt;span style="color:#f99157;">arg &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">catch&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">arg&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">filter: &lt;/span>&lt;span style="color:#f99157;">fun &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">fun&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#cccece;">}
&lt;/span>&lt;/pre>
&lt;ul>
&lt;li>&lt;code>map&lt;/code>/&lt;code>and_then&lt;/code>: these do the same thing because you can't get out of a &lt;code>Promise&lt;/code>. &lt;/li>
&lt;li>&lt;code>or_else&lt;/code>: puts your callback in the &lt;code>catch&lt;/code> method to mimic an &lt;code>else&lt;/code> behavior.&lt;/li>
&lt;li>&lt;code>tap&lt;/code>: uses &lt;code>then&lt;/code> to peek at the value. Since this is for side effects we return the value again.&lt;/li>
&lt;li>&lt;code>unwrap_or&lt;/code>: It will return the promise so you can use &lt;code>await&lt;/code>. If everything goes well the original value of the &lt;code>Promise&lt;/code> will be returned when you &lt;code>await&lt;/code>, else the provided argument will be returned. Either way the promise doesn't throw an error because the &lt;code>Future&lt;/code> attached the &lt;code>catch&lt;/code> method to it.&lt;/li>
&lt;li>&lt;code>filter&lt;/code>: these one is a special kind of &lt;code>map&lt;/code> that's why &lt;code>filter_future&lt;/code> exists.&lt;/li>
&lt;li>Almost all these methods return a new &lt;code>Future&lt;/code> 'cause &lt;code>promise.then&lt;/code> returns a new &lt;code>Promise&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>What makes the &lt;code>Future&lt;/code> weird is what happens inside &lt;code>map&lt;/code>. Remember &lt;code>map_future&lt;/code>?&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">fun&lt;/span>&lt;span style="color:#5fb3b3;">) { &lt;/span>&lt;span style="color:#5f6364;">// `fun` is the user&amp;#39;s callback
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#5f6364;">/* Evaluate the original value */
&lt;/span>&lt;span style="color:#c594c5;">let &lt;/span>&lt;span style="color:#cccece;">promise_content &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#5f6364;">// It needs to decide if the value of the Promise
// can be trusted
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_content&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#cccece;">is_nothing&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reject&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#c594c5;">return&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;span style="color:#5f6364;">// If it is a Just then unwrap it.
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_content&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">promise_content &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">();
}
&lt;/span>&lt;span style="color:#5f6364;">/* Evaluate the return value of the user&amp;#39;s callback */
// Use Maybe because I have trust issues.
// For the javascript world is undefined and full of errors.
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">Maybe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">promise_content&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">is_just&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// If it gets here it&amp;#39;s all good.
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">unwrap_or&lt;/span>&lt;span style="color:#5fb3b3;">();
}
&lt;/span>&lt;span style="color:#5f6364;">// at this point i should check if result is a Future
// if that happens you are using them in a wrong way
// so for now I don&amp;#39;t do it
// There is something seriously wrong.
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reject&lt;/span>&lt;span style="color:#5fb3b3;">();
}
}
&lt;/span>&lt;/pre>
&lt;p>Now &lt;code>filter_future&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">filter_future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">predicate_fun&lt;/span>&lt;span style="color:#5fb3b3;">) { &lt;/span>&lt;span style="color:#5f6364;">// the user&amp;#39;s function
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">val &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">predicate_fun&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#5f6364;">// Did you just returned a `Promise`?
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#cccece;">then&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// You did! That&amp;#39;s why you can&amp;#39;t have nice things.
// peek inside the user&amp;#39;s promise.
&lt;/span>&lt;span style="color:#c594c5;">const &lt;/span>&lt;span style="color:#6699cc;">return_result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">the_real_result &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">the_real_result
&lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#cccece;">val
&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reject&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#5f6364;">// keep the promise chain alive.
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">then&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">return_result&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">? &lt;/span>&lt;span style="color:#cccece;">val &lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reject&lt;/span>&lt;span style="color:#5fb3b3;">();
}
}
&lt;/span>&lt;/pre>
&lt;p>There is one last thing I would like to do and that is create a helper function to convert a regular value into a &lt;code>Future&lt;/code>.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#fac863;">Future&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">from_val &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">val&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Future&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#fac863;">Promise&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">resolve&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">val&lt;/span>&lt;span style="color:#5fb3b3;">));
}
&lt;/span>&lt;/pre>
&lt;p>All we have to do now to support a &lt;code>Future&lt;/code> in a &lt;code>Maybe&lt;/code> is this.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function Maybe(the_thing) {
if(the_thing === null
|| the_thing === undefined
|| the_thing.is_nothing
) {
return Nothing();
}
&lt;/span>&lt;span style="color:#5fb3b3;">-
-&lt;/span>&lt;span style="color:#ec5f67;"> if(the_thing.is_just) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> if(the_thing.is_future || the_thing.is_just) {
&lt;/span>&lt;span style="color:#cccece;"> return the_thing;
}
return Just(the_thing);
}
&lt;/span>&lt;/pre>
&lt;p>But the million dollar question remains. Does it actually work?&lt;/p>
&lt;p>I have &lt;a href="https://github.com/VonHeikemen/maybe-type-in-js">CLI version&lt;/a> of this. And here is the same codepen example with some tweaks: I added the &lt;code>Future&lt;/code> related functions, the confirm dialog is actually a dialog (&lt;a href="https://github.hubspot.com/vex/">this one&lt;/a>) and the event listener is now an async function that can &lt;code>await&lt;/code> the result.&lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="oNNwagG"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="Maybe I will promise you a word">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/oNNwagG">Maybe I will promise you a word&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;h3 id="bonus-bonus-edit">Bonus bonus edit&lt;/h3>
&lt;p>That is how it looks like when we cheat. If we didn't cheat it would be like &lt;a href="https://codepen.io/VonHeikemen/pen/QWWYJwZ">this&lt;/a>.&lt;/p>
&lt;h2 id="other-resources">Other resources&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.toptal.com/javascript/option-maybe-either-future-monads-js">Option/Maybe, Either, and Future Monads in JavaScript, Python, Ruby, Swift, and Scala&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://jrsinclair.com/articles/2016/marvellously-mysterious-javascript-maybe-monad/">The Marvellously Mysterious JavaScript Maybe Monad&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.youtube.com/watch?v=pgq-Pfg6ul4">Monad Mini-Series: Functors (video)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.youtube.com/watch?v=SfWR3dKnFIo">Oh Composable World! (video)&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>