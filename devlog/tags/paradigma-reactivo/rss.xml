<?xml version="1.0" encoding="UTF-8"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Devlog</title><link>https://vonheikemen.github.io/devlog/</link><description/><generator>Zola</generator><language>en</language><atom:link href="https://vonheikemen.github.io/devlog/tags/paradigma-reactivo/rss.xml" rel="self" type="application/rss+xml"/><lastBuildDate>Sun, 24 Nov 2019 00:00:00 +0000</lastBuildDate><item><title>Observables hechos en casa</title><pubDate>Sun, 24 Nov 2019 00:00:00 +0000</pubDate><link>https://vonheikemen.github.io/devlog/es/web-development/homemade-observables/</link><guid>https://vonheikemen.github.io/devlog/es/web-development/homemade-observables/</guid><description>&lt;p>En esta ocasión implementaremos nuestros propios observables. Al terminar espero que tengan un mejor entendimiento de cómo este patrón es usado en librerías como RxJS.&lt;/p>
&lt;h2 id="los-observables">Los Observables&lt;/h2>
&lt;h3 id="que-son">¿Qué son?&lt;/h3>
&lt;p>Empecemos con &lt;strong>mi&lt;/strong> definición de observable.&lt;/p>
&lt;blockquote>
&lt;p>Un Observable es una función que sigue una convención y es usada para conectar una fuente que emite datos a un consumidor.&lt;/p>
&lt;/blockquote>
&lt;p>En nuestro caso la fuente puede ser cualquier cosa produzca valores. Y, un consumidor es el que recibe datos.&lt;/p>
&lt;h3 id="datos-curiosos">Datos curiosos&lt;/h3>
&lt;h4 id="los-observables-no-hacen-nada-por-si-solos">Los Observables no hacen nada por sí solos&lt;/h4>
&lt;p>Quiero decir que estos no producen ningún efecto o comienzan a trabajar hasta que es absolutamente necesario. No hacen nada hasta que te suscribes a ellos.&lt;/p>
&lt;h4 id="pueden-emitir-datos">Pueden emitir datos&lt;/h4>
&lt;p>Dependendiendo de la fuente, pueden recibir un número infinito de valores.&lt;/p>
&lt;h4 id="pueden-ser-sincronos-o-asincronos">Pueden ser síncronos o asíncronos&lt;/h4>
&lt;p>Todo dependerá de su implementación. Se puede crear un observable que reciba valores de un evento que puede ocurrir en cualquier momento, también se pueden crear para procesar una colección de datos de manera síncrona.&lt;/p>
&lt;h3 id="algunas-reglas">Algunas reglas&lt;/h3>
&lt;p>Ya mencioné que se debe seguir una convención. Bueno, ahora vamos a definir algunas reglas arbitrarias que nuestra implementación va a seguir. Estas son importantes porque crearemos un pequeño ecosistema con nuestros observables.&lt;/p>
&lt;ol>
&lt;li>Deberán tener un método &lt;code>subscribe&lt;/code>.&lt;/li>
&lt;li>Nuestro &amp;quot;constructor&amp;quot; de observables aceptará un parámetro, será el suscriptor (&lt;code>subscriber&lt;/code>) el cual será una función.&lt;/li>
&lt;li>El suscriptor aceptará un parámetro, este será un objeto que llamaremos &lt;code>observer&lt;/code>.&lt;/li>
&lt;li>El objeto &lt;code>observer&lt;/code> puede implementar los siguientes métodos: &lt;code>next&lt;/code>, &lt;code>error&lt;/code> y &lt;code>complete&lt;/code>.&lt;/li>
&lt;/ol>
&lt;p>Empecemos.&lt;/p>
&lt;h3 id="el-codigo">El código&lt;/h3>
&lt;h3 id="constructor">Constructor&lt;/h3>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">subscriber&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">subscriber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">)
};
}
&lt;/span>&lt;span style="color:#5f6364;">// Se los juro, esto funciona
&lt;/span>&lt;/pre>
&lt;p>Tal vez es menos mágico de lo que pensaron. Lo que vemos aquí es que el constructor &lt;strong>Observable&lt;/strong> sólo es una forma de posponer el trabajo hasta que se ejecuta &lt;code>subscribe&lt;/code>. La función &lt;code>subscriber&lt;/code> es la que hace el trabajo pesado, eso es bueno porque podemos hacer lo que sea ahí, es lo que hace que nuestros observable sean útiles.&lt;/p>
&lt;p>Hasta ahora no he explicado el rol de &lt;code>observer&lt;/code> o &lt;code>subscriber&lt;/code>. Es mejor explicarlo con un ejemplo.&lt;/p>
&lt;h2 id="un-ejemplo">Un ejemplo&lt;/h2>
&lt;p>Digamos que queremos convertir un arreglo en un Observable. ¿Cómo lo hacemos?&lt;/p>
&lt;p>Pensemos en lo que sabemos hasta ahora:&lt;/p>
&lt;ul>
&lt;li>Podemos colocar la lógica dentro de la función &lt;code>subscriber&lt;/code>.&lt;/li>
&lt;li>Podemos contar con que nuestro objeto &lt;code>observer&lt;/code> tendrá uno de estos tres métodos &lt;code>next&lt;/code>, &lt;code>error&lt;/code> y &lt;code>complete&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>Podemos usar los métodos de &lt;code>observer&lt;/code> como canales de cómunicación. La función &lt;code>next&lt;/code> recibirá los valores que nos de la fuente. Utilizaremos &lt;code>error&lt;/code> cuando algo salga mal, algo así como el método &lt;code>catch&lt;/code> que tienen las promesas. Por último, utilizaremos &lt;code>complete&lt;/code> cuando la fuente deje de producir valores.&lt;/p>
&lt;p>La función para convertir un arreglo a observable puede ser así.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">arr&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">try &lt;/span>&lt;span style="color:#5fb3b3;">{
&lt;/span>&lt;span style="color:#cccece;">arr&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">forEach&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">();
} &lt;/span>&lt;span style="color:#c594c5;">catch &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">e&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">error&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">e&lt;/span>&lt;span style="color:#5fb3b3;">);
}
});
}
&lt;/span>&lt;span style="color:#5f6364;">// Así la usamos
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">arrayStream &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">([&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">4&lt;/span>&lt;span style="color:#5fb3b3;">]);
&lt;/span>&lt;span style="color:#cccece;">arrayStream&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">({
&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">error&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">err &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">error&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">err&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">info&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;#39;&lt;/span>&lt;span style="color:#99c794;">Listo&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;)
});
&lt;/span>&lt;span style="color:#5f6364;">// Y ahora a ver qué pasa en la cónsola.
&lt;/span>&lt;/pre>&lt;h3 id="tengan-cuidado">Tengan cuidado&lt;/h3>
&lt;p>Justo ahora nuestros observables básicamente son como un pueblo sin ley, podemos hacer todo tipo de cosas indebidas como seguir enviando valores después de llamar el método &lt;code>complete&lt;/code>. En un mundo ideal nuestros observables deberían darnos algunas garantías. &lt;/p>
&lt;ul>
&lt;li>Los métodos del objeto &lt;code>observer&lt;/code> deberían ser opcionales.&lt;/li>
&lt;li>Los métodos &lt;code>complete&lt;/code> y &lt;code>error&lt;/code> deberían llamar una función para dejar de observar, una función &lt;code>unsubscribe&lt;/code> (si esta existe).&lt;/li>
&lt;li>Si ejecutas &lt;code>unsubscribe&lt;/code> yo no podrás ejecutar los demás métodos.&lt;/li>
&lt;li>Si se ejecuta &lt;code>complete&lt;/code> o &lt;code>error&lt;/code> se dejarán de recibir valores.&lt;/li>
&lt;/ul>
&lt;h3 id="un-ejemplo-interactivo">Un ejemplo interactivo&lt;/h3>
&lt;p>Ya podemos empezar a hacer cosas interesantes con lo que tenemos hasta ahora. En este ejemplo hice una función que nos permite crear un observable de un evento. &lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="wxNYPV"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="Observables - basics">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/wxNYPV">Observables - basics&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;script async src="https://static.codepen.io/assets/embed/ei.js">&lt;/script>
&lt;h2 id="composicion">Composición&lt;/h2>
&lt;p>Ahora que sabemos cómo crearlos veamos cómo podemos manipularlos para extender sus capacidades.&lt;/p>
&lt;p>Esta vez lo que haremos será crear funciones complementarias y modificar nuestra implementación.&lt;/p>
&lt;h3 id="todo-esta-en-los-operadores">Todo está en los operadores&lt;/h3>
&lt;p>Los operadores son funciones que nos permitirán agregar características a nuestros observables mediante una cadena de funciones. Cada una de estas funciones aceptará un observable como parámetro, lo convertirá en su fuente y devolverá un nuevo observable.&lt;/p>
&lt;p>Sigamos con la temática del arreglo y hagamos un operador &lt;strong>map&lt;/strong> que intente imitar el comportamiento del método nativo map que tienen los arreglos. Nuestro operador hará lo siguiente: tomará un valor, aplicará una función sobre ese valor y emitirá el resultado.&lt;/p>
&lt;p>Hagamos el intento:&lt;/p>
&lt;p>Primer paso, vamos a recibir la función y la fuente de datos, luego devolveremos un observable.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">source$&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// continuará
&lt;/span>&lt;span style="color:#5fb3b3;">});
}
&lt;/span>&lt;/pre>
&lt;p>Ahora viene lo interesante, la fuente que recibimos es un observable y eso significa que podemos suscribirnos para recibir valores.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function map(transformFn, source$) {
return Observable(function(observer) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> return source$.subscribe(function(value) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> // continuará
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> });
&lt;/span>&lt;span style="color:#cccece;"> });
}
&lt;/span>&lt;/pre>
&lt;p>Lo siguiente será pasar el resultado de la transformación a &lt;code>observer&lt;/code> para que puedan &amp;quot;verlo&amp;quot; cuando se suscriban a este nuevo observable.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;"> function map(transformFn, source$) {
return Observable(function(observer) {
return source$.subscribe(function(value) {
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> var newValue = transformFn(value);
&lt;/span>&lt;span style="color:#5fb3b3;">+&lt;/span>&lt;span style="color:#99c794;"> observer.next(newValue);
&lt;/span>&lt;span style="color:#cccece;"> });
});
}
&lt;/span>&lt;/pre>
&lt;p>Hay otra forma de hacer esto. Si usamos funciones de una expresión (Arrow functions como se les conoce por ahí) sería algo así.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">source$&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#cccece;">source$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)
))
);
}
&lt;/span>&lt;/pre>
&lt;p>Ya podemos empezar a usarlo pero justo ahora tendríamos que hacerlo de esta manera.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">arr&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">arr&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">forEach&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">();
});
}
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">thisArray &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">4&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">plusOne &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">array$ &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">plusOne&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thisArray&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#cccece;">array$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;/pre>
&lt;p>Eso no es muy cómodo. Y si queremos seguir usando más funciones &lt;code>map&lt;/code> tendríamos que &amp;quot;envolverlas&amp;quot;, no me parece bien. Nos ocuparemos de eso ahora.&lt;/p>
&lt;h3 id="la-cadena">La cadena&lt;/h3>
&lt;p>Crearemos otro método que nos permitirá usar una cadena de operadores que extenderan un observable fuente. Esta función tomará una lista de funciones, cada función en la lista usará el observable retornado por la anterior.&lt;/p>
&lt;p>Primero veamos como podría hacerse esto en una función aislada.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">aFunctionArray&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">initialSource&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">reducerFn &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">source&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">result &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">source&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">result&lt;/span>&lt;span style="color:#5fb3b3;">;
};
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">finalResult &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">aFunctionArray&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reduce&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">reducerFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">initialSource&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">finalResult&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>Aquí usamos &lt;code>reduce&lt;/code> para recorrer el arreglo de funciones y por cada elemento se ejecuta &lt;code>reducerFn&lt;/code>. Dentro de &lt;code>reducerFn&lt;/code> en el primer recorrido &lt;code>source&lt;/code> tendrá el valor de &lt;code>initialSource&lt;/code> y en el resto &lt;code>source&lt;/code> será lo que &lt;code>reducerFn&lt;/code> retorne. &lt;code>finalResult&lt;/code> simplemente es el último resultado de &lt;code>reducerFn&lt;/code>.&lt;/p>
&lt;p>Con algunos ajustes a nuestro constructor podemos agregar esta función. También he reducido la implementación del método &lt;code>pipe&lt;/code> con algo de ayuda.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">Observable &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">subscriber&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">observable &lt;/span>&lt;span style="color:#5fb3b3;">= {
&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">subscriber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#6699cc;">SafeObserver&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">)),
&lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#5fb3b3;">(...&lt;/span>&lt;span style="color:#f99157;">fns&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">fns&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">reduce&lt;/span>&lt;span style="color:#5fb3b3;">((&lt;/span>&lt;span style="color:#f99157;">source&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">fn&lt;/span>&lt;span style="color:#5fb3b3;">) &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">fn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">source&lt;/span>&lt;span style="color:#5fb3b3;">), &lt;/span>&lt;span style="color:#cccece;">observable&lt;/span>&lt;span style="color:#5fb3b3;">);
}
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">observable&lt;/span>&lt;span style="color:#5fb3b3;">;
}
&lt;/span>&lt;/pre>
&lt;p>Aún tenemos que hacer una cosa para asegurarnos que los operadores sean compatibles con el método &lt;code>pipe&lt;/code>. Justo ahora el operador &lt;code>map&lt;/code> espera tanto &lt;code>transformFn&lt;/code> como &lt;code>source&lt;/code>, eso no funcionará cuando usemos &lt;code>pipe&lt;/code>. Tendremos que dividirlo en dos funciones, una que reciba el parámetro inicial y otra que acepte la fuente. &lt;/p>
&lt;p>Tenemos opciones.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// Opción 1
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// En lugar de devolver el observable
// regresamos una función que espera `source`
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">source$ &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#cccece;">source$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)
))
);
}
&lt;/span>&lt;span style="color:#5f6364;">// Opción 2
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">source$&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">source$ &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#f99157;">undefined&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// en caso de no recibir `source`
// devolvemos una función una que recuerde `transformFn`
// y que espere `source`
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">placeholder &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">placeholder&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt;
&lt;/span>&lt;span style="color:#cccece;">source$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">transformFn&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">)
))
);
}
&lt;/span>&lt;/pre>
&lt;p>Y ya finalmente podemos extender nuestros observables así.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">thisArray &lt;/span>&lt;span style="color:#5fb3b3;">= [&lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">3&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#f99157;">4&lt;/span>&lt;span style="color:#5fb3b3;">];
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">plusOne &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">timesTwo &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">num &lt;/span>&lt;span style="color:#5fb3b3;">* &lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">array$ &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">fromArray&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">thisArray&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">plusOne&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timesTwo&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#5fb3b3;">`&lt;/span>&lt;span style="color:#99c794;">number: &lt;/span>&lt;span style="color:#5fb3b3;">${&lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">}`),
&lt;/span>&lt;span style="color:#5f6364;">// y otros...
&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#cccece;">array$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;/pre>
&lt;p>Estamos listos para crear más operadores.&lt;/p>
&lt;h2 id="otro-ejercicio">Otro ejercicio&lt;/h2>
&lt;p>Digamos que tenemos una función que muestra la hora en la cónsola cada segundo, y se detiene después de cinco segundos (sólo porque sí).&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">startTimer&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">interval &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">setInterval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">() {
&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">+ &lt;/span>&lt;span style="color:#f99157;">1&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">minutes &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Math&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">floor&lt;/span>&lt;span style="color:#5fb3b3;">((&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">/ &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">) % &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">().&lt;/span>&lt;span style="color:#6699cc;">padStart&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">0&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">seconds &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Math&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">floor&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">% &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">().&lt;/span>&lt;span style="color:#6699cc;">padStart&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">0&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">timeString &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">minutes &lt;/span>&lt;span style="color:#5fb3b3;">+ &amp;#39;&lt;/span>&lt;span style="color:#99c794;">:&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39; + &lt;/span>&lt;span style="color:#cccece;">seconds&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString &lt;/span>&lt;span style="color:#5fb3b3;">=== &amp;#39;&lt;/span>&lt;span style="color:#99c794;">00:05&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;) {
&lt;/span>&lt;span style="color:#6699cc;">clearInterval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">interval&lt;/span>&lt;span style="color:#5fb3b3;">);
}
}, &lt;/span>&lt;span style="color:#f99157;">1000&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Ahora bien, esa función no tiene nada de malo. Digo, hace su trabajo, es predecible y todo lo que necesitas saber está a plena vista. Pero recien aprendimos algo nuevo y queremos aplicarlo. Convertiremos esto en un observable.&lt;/p>
&lt;p>Primero lo primero, vamos a extraer la lógica que maneja el formateo y el cálculo del tiempo.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">paddedNumber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">num&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">num&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">toString&lt;/span>&lt;span style="color:#5fb3b3;">().&lt;/span>&lt;span style="color:#6699cc;">padStart&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">2&lt;/span>&lt;span style="color:#5fb3b3;">, &amp;#39;&lt;/span>&lt;span style="color:#99c794;">0&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;);
}
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">readableTime&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">time&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">minutes &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Math&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">floor&lt;/span>&lt;span style="color:#5fb3b3;">((&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">/ &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">) % &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">seconds &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#fac863;">Math&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">floor&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">time &lt;/span>&lt;span style="color:#5fb3b3;">% &lt;/span>&lt;span style="color:#f99157;">60&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">paddedNumber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">minutes&lt;/span>&lt;span style="color:#5fb3b3;">) + &amp;#39;&lt;/span>&lt;span style="color:#99c794;">:&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39; + &lt;/span>&lt;span style="color:#6699cc;">paddedNumber&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">seconds&lt;/span>&lt;span style="color:#5fb3b3;">);
}
&lt;/span>&lt;/pre>
&lt;p>Veamos qué hacemos con el tiempo. &lt;code>setInterval&lt;/code> es un buen candidato para convertirse una fuente, recibe un &amp;quot;callback&amp;quot; en el cual podemos producir valores y también tiene un mecanismo de &amp;quot;limpieza&amp;quot;. Es un buen observable.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">interval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">delay&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">counter &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#6699cc;">callback &lt;/span>&lt;span style="color:#5fb3b3;">= () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">counter&lt;/span>&lt;span style="color:#5fb3b3;">++);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">_interval &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">setInterval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">callback&lt;/span>&lt;span style="color:#5fb3b3;">, &lt;/span>&lt;span style="color:#cccece;">delay&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">setUnsubscribe&lt;/span>&lt;span style="color:#5fb3b3;">(() &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">clearInterval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">_interval&lt;/span>&lt;span style="color:#5fb3b3;">));
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">unsubscribe&lt;/span>&lt;span style="color:#5fb3b3;">;
});
}
&lt;/span>&lt;/pre>
&lt;p>Tenemos una forma reusable de crear y destruir un &lt;code>interval&lt;/code>.&lt;/p>
&lt;p>Puede que hayan notado que le pasamos un número a &lt;code>observer&lt;/code>, no lo llamamos &amp;quot;segundos&amp;quot; porque &lt;code>delay&lt;/code> puede ser cualquier número. Aquí no estamos siguiendo el tiempo, estamos contando las veces que &lt;code>callback&lt;/code> es ejecutado. ¿Por qué? Porque queremos que nuestros constructores sean genéricos. Siempre podremos modificar su comportamiento con operadores.&lt;/p>
&lt;p>Así usamos nuestro nuevo constructor.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// fingiremos que las demás funciones están por aquí
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">time$ &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">interval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1000&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">plusOne&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">readableTime&lt;/span>&lt;span style="color:#5fb3b3;">)
);
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">unsubscribe &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">time$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">timeString&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">if&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString &lt;/span>&lt;span style="color:#5fb3b3;">=== &amp;#39;&lt;/span>&lt;span style="color:#99c794;">00:05&lt;/span>&lt;span style="color:#5fb3b3;">&amp;#39;) {
&lt;/span>&lt;span style="color:#6699cc;">unsubscribe&lt;/span>&lt;span style="color:#5fb3b3;">();
}
});
&lt;/span>&lt;/pre>
&lt;p>Está mejor. Pero ese &lt;code>if&lt;/code> me molesta. Como que no debería estar ahí. ¿Saben que podemos hacer? Crear otro operador, uno que cancele la suscripción después de que &lt;code>interval&lt;/code> emita cinco valores.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#cccece;">
&lt;/span>&lt;span style="color:#c594c5;">function &lt;/span>&lt;span style="color:#6699cc;">take&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">total&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#c594c5;">return &lt;/span>&lt;span style="color:#f99157;">source$ &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#6699cc;">Observable&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">observer&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// tendremos nuestro propio contador porque no confío
// en los valores que emiten otros observables
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">count &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#f99157;">0&lt;/span>&lt;span style="color:#5fb3b3;">;
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">unsubscribeSource &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#cccece;">source$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#c594c5;">function&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">value&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#cccece;">count&lt;/span>&lt;span style="color:#5fb3b3;">++;
&lt;/span>&lt;span style="color:#5f6364;">// pasamos cada valor a `observer`
// la función subscribe aún recibirá cada valor original
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">value&lt;/span>&lt;span style="color:#5fb3b3;">);
&lt;/span>&lt;span style="color:#c594c5;">if &lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">count &lt;/span>&lt;span style="color:#5fb3b3;">=== &lt;/span>&lt;span style="color:#cccece;">total&lt;/span>&lt;span style="color:#5fb3b3;">) {
&lt;/span>&lt;span style="color:#5f6364;">// indicamos que el flujo a terminado y lo &amp;quot;destruimos&amp;quot;
&lt;/span>&lt;span style="color:#cccece;">observer&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">();
&lt;/span>&lt;span style="color:#6699cc;">unsubscribeSource&lt;/span>&lt;span style="color:#5fb3b3;">();
}
});
});
}
&lt;/span>&lt;/pre>
&lt;p>Ya tenemos un contador que se autodestruye. Finalmente.&lt;/p>
&lt;pre style="background-color:#2b2c2f;">
&lt;span style="color:#5f6364;">// las otras funciones siguen ahí
&lt;/span>&lt;span style="color:#c594c5;">var &lt;/span>&lt;span style="color:#cccece;">time$ &lt;/span>&lt;span style="color:#5fb3b3;">= &lt;/span>&lt;span style="color:#6699cc;">interval&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">1000&lt;/span>&lt;span style="color:#5fb3b3;">).&lt;/span>&lt;span style="color:#6699cc;">pipe&lt;/span>&lt;span style="color:#5fb3b3;">(
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">plusOne&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">map&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">readableTime&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">take&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#f99157;">5&lt;/span>&lt;span style="color:#5fb3b3;">)
);
&lt;/span>&lt;span style="color:#cccece;">time$&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">subscribe&lt;/span>&lt;span style="color:#5fb3b3;">({
&lt;/span>&lt;span style="color:#6699cc;">next&lt;/span>&lt;span style="color:#5fb3b3;">: &lt;/span>&lt;span style="color:#f99157;">timeString &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">log&lt;/span>&lt;span style="color:#5fb3b3;">(&lt;/span>&lt;span style="color:#cccece;">timeString&lt;/span>&lt;span style="color:#5fb3b3;">),
&lt;/span>&lt;span style="color:#6699cc;">complete&lt;/span>&lt;span style="color:#5fb3b3;">: () &lt;/span>&lt;span style="color:#c594c5;">=&amp;gt; &lt;/span>&lt;span style="color:#fac863;">console&lt;/span>&lt;span style="color:#5fb3b3;">.&lt;/span>&lt;span style="color:#6699cc;">info&lt;/span>&lt;span style="color:#5fb3b3;">(&amp;quot;&lt;/span>&lt;span style="color:#99c794;">Time&amp;#39;s up&lt;/span>&lt;span style="color:#5fb3b3;">&amp;quot;)
});
&lt;/span>&lt;/pre>&lt;h2 id="patio-de-juegos">Patio de juegos&lt;/h2>
&lt;p>Hice un par de ejemplos en codepen para poder hacer experimentos con estas cosas. &lt;a href="https://codepen.io/VonHeikemen/pen/OwQYxG">Este de aquí&lt;/a> contiene todos el código relacionado con &lt;code>Observable&lt;/code> y algo más.&lt;/p>
&lt;p>Y este de aquí es el del ejercicio.&lt;/p>
&lt;p
class="codepen"
data-height="600"
data-theme-id="dark"
data-default-tab="js,result"
data-user="VonHeikemen"
data-slug-hash="VGZXZa"
data-preview="true"
style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;"
data-pen-title="Observables - boring timer">
&lt;span>
See the Pen &lt;a href="https://codepen.io/VonHeikemen/pen/VGZXZa">Observables - boring timer&lt;/a> by Heiker (&lt;a href="https://codepen.io/VonHeikemen">@VonHeikemen&lt;/a>) on &lt;a href="https://codepen.io">CodePen&lt;/a>.
&lt;/span>
&lt;/p>
&lt;h2 id="conclusion">Conclusión&lt;/h2>
&lt;p>Los Observables nos permiten hacer muchas cosas y con un algo de creatividad puedes convertir lo que sea en un observable. En serio, una promesa (Promise), una petición AJAX, un evento en el DOM, un arreglo... otro observable. Todo lo que se pueden imaginar puede ser una fuente de datos que pueden envolver en un observable. También nos dan habilidad de ensamblar soluciones utilizando funciones genéricas y otras más específicas.&lt;/p>
&lt;p>Aún así no son la solución perfecta para todo. Tendrán que decidir si la complejidad que traen vale la pena. Como en el ejemplo del intervalo, perdimos la simplicidad de &lt;code>startTimer&lt;/code> por la &amp;quot;flexibilidad&amp;quot; de los observables.&lt;/p>
&lt;h2 id="fuentes">Fuentes&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://medium.com/@benlesh/learning-observable-by-building-observable-d5da57405d87">Learning Observable By Building Observable&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://medium.com/@kevinkreuzer/observables-just-powerful-functions-a033c355b22c">Observables, just powerful functions?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://netbasal.com/whos-afraid-of-observables-bde0dc4f48cc">Who’s Afraid of Observables?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://netbasal.com/understanding-mergemap-and-switchmap-in-rxjs-13cf9c57c885">Understanding mergeMap and switchMap in RxJS&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://netbasal.com/javascript-observables-under-the-hood-2423f760584">JavaScript — Observables Under The Hood&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/zenparsing/zen-observable">Github repository - zen-observable&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dev.to/supermanitu/understanding-observables">Understanding Observables&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>