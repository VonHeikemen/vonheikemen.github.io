<!doctype html><html lang=es><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Se puede usar el cliente LSP de neovim sin plugins? | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="vim, neovim, shell, software, coding, development" name=keywords><meta content="Vamos a descubrir qué necesitamos para usar el cliente LSP de neovim en nuestros proyectos" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2026 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Se puede usar el cliente LSP de neovim sin plugins?</h1><span class=post-date>2022-06-09 | 3 minutos | <a href=https://vonheikemen.github.io/devlog/tools/manage-neovim-lsp-client-without-plugins/> Read in english </a> </span><blockquote>Última actualización: 2022-10-16</blockquote><p>Sí se puede. La complejidad de la configuración dependerá del flujo de trabajo que queremos utilizar. Pero si <code>lua</code> les resulta fácil de leer podrán entender la "estructura" necesaria para obtener una configuración decente.<h2 id=la-base>La base</h2><p>Resulta que sólo necesitamos conocer dos funciones. Una para inicializar el servidor LSP. Una para notificar cada cambio en el texto un archivo.<ul><li><p><code>vim.lsp.start_client()</code>: Crea una instancia de un "cliente" que es la que se encarga de comunicarse con el servidor LSP.</p><li><p><code>vim.lsp.buf_attach_client()</code>: Envía notificaciones al servidor LSP con cada cambio en el texto.</p></ul><p>Este es un ejemplo simple e ineficiente usando un servidor LSP para typescript.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local</span><span style=color:#7e9cd8> launch_tsserver</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>  local config</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    cmd</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'typescript-language-server'</span><span>, </span><span style=color:#98bb6c>'--stdio'</span><span>},</span></span>
<span class=giallo-l><span>    name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'tsserver'</span><span>,</span></span>
<span class=giallo-l><span>    root_dir</span><span style=color:#e6c384> =</span><span> vim.fn.</span><span style=color:#7e9cd8>getcwd</span><span>(),</span></span>
<span class=giallo-l><span>    capabilities</span><span style=color:#e6c384> =</span><span> vim.lsp.protocol.</span><span style=color:#7e9cd8>make_client_capabilities</span><span>(),</span></span>
<span class=giallo-l><span>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  local client_id</span><span style=color:#e6c384> =</span><span> vim.lsp.</span><span style=color:#7e9cd8>start_client</span><span>(config)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> client_id</span><span style=color:#957fb8> then</span></span>
<span class=giallo-l><span>    vim.lsp.</span><span style=color:#7e9cd8>buf_attach_client</span><span>(</span><span style=color:#d27e99>0</span><span>, client_id)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_user_command</span><span>(</span></span>
<span class=giallo-l><span style=color:#98bb6c>  'LaunchTsserver'</span><span>,</span></span>
<span class=giallo-l><span>  launch_tsserver,</span></span>
<span class=giallo-l><span>  {desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Inicializar tsserver'</span><span>}</span></span>
<span class=giallo-l><span>)</span></span></code></pre><p>Con esto creamos el comando <code>LaunchTsserver</code>, al ejecutarlo podremos usar el servidor <code>typescript-language-server</code> y obtener diagnósticos en el archivo actual.<p>¿Por qué es ineficiente? Bueno, porque sólo funciona con un solo archivo. Y cada vez que lo ejecutamos estamos creando un nuevo proceso de <code>typescript-language-server</code>. Lo ideal sería poder compartir el mismo servidor en todo el proyecto.<h2 id=uso-en-proyectos>Uso en proyectos</h2><p>¿Qué nos falta para poder utilizar el servidor LSP de manera eficiente? Necesitamos crear un "autocomando". Debemos indicarle a neovim que queremos vincular una extensión o tipo de archivo con un servidor LSP.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local filetypes</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span style=color:#98bb6c>  'javascript'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>  'javascriptreact'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>  'javascript.jsx'</span></span>
<span class=giallo-l><span style=color:#98bb6c>  'typescript'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>  'typescriptreact'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>  'typescript.tsx'</span><span>,</span></span>
<span class=giallo-l><span>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local</span><span style=color:#7e9cd8> buf_attach</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>  vim.lsp.</span><span style=color:#7e9cd8>buf_attach_client</span><span>(</span><span style=color:#d27e99>0</span><span>, client_id)</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>autocmd_id</span><span style=color:#e6c384> =</span><span> vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'FileType'</span><span>, {</span></span>
<span class=giallo-l><span>  desc</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> string.format</span><span>(</span><span style=color:#98bb6c>'Vincular servidor: %s'</span><span>, client_name),</span></span>
<span class=giallo-l><span>  pattern</span><span style=color:#e6c384> =</span><span> filetypes,</span></span>
<span class=giallo-l><span>  callback</span><span style=color:#e6c384> =</span><span> buf_attach</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>Bien, ahora <code>nvim_create_autocmd</code> nos devolverá un id que podremos usar para eliminar el autocomando cuando sea necesario.<p>Para eliminar el autocomando necesitaremos la función <code>nvim_del_autocmd</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_del_autocmd</span><span>(autocmd_id)</span></span></code></pre><p>¿Pero en qué momento debemos crear este autocomando? Cuando el servidor termine su proceso de inicialización. Podemos usar la función <code>on_init</code> para crearlo y después usamos <code>on_exit</code> para borrarlo.<p>Si aplicamos todo este conocimiento a nuestro ejemplo, la función <code>launch_tsserver</code> quedaría de la siguiente manera.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local</span><span style=color:#7e9cd8> launch_tsserver</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>  local autocmd</span></span>
<span class=giallo-l><span>  local filetypes</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'javascript'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'javascriptreact'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'javascript.jsx'</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'typescript'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'typescriptreact'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'typescript.tsx'</span><span>,</span></span>
<span class=giallo-l><span>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  local config</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    cmd</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'typescript-language-server'</span><span>, </span><span style=color:#98bb6c>'--stdio'</span><span>},</span></span>
<span class=giallo-l><span>    name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'tsserver'</span><span>,</span></span>
<span class=giallo-l><span>    root_dir</span><span style=color:#e6c384> =</span><span> vim.fn.</span><span style=color:#7e9cd8>getcwd</span><span>(),</span></span>
<span class=giallo-l><span>    capabilities</span><span style=color:#e6c384> =</span><span> vim.lsp.protocol.</span><span style=color:#7e9cd8>make_client_capabilities</span><span>(),</span></span>
<span class=giallo-l><span>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  config.</span><span style=color:#7e9cd8>on_init</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>client</span><span style=color:#9cabca>,</span><span> results</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    local</span><span style=color:#7e9cd8> buf_attach</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>      vim.lsp.</span><span style=color:#7e9cd8>buf_attach_client</span><span>(</span><span style=color:#d27e99>0</span><span>, client.id)</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    autocmd</span><span style=color:#e6c384> =</span><span> vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'FileType'</span><span>, {</span></span>
<span class=giallo-l><span>      desc</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> string.format</span><span>(</span><span style=color:#98bb6c>'Vincular servidor: %s'</span><span>, client.name),</span></span>
<span class=giallo-l><span>      pattern</span><span style=color:#e6c384> =</span><span> filetypes,</span></span>
<span class=giallo-l><span>      callback</span><span style=color:#e6c384> =</span><span> buf_attach</span></span>
<span class=giallo-l><span>    })</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>    if</span><span> vim.v.vim_did_enter</span><span style=color:#e6c384> ==</span><span style=color:#d27e99> 1</span><span style=color:#e6c384> and</span></span>
<span class=giallo-l><span>      vim.</span><span style=color:#7e9cd8>tbl_contains</span><span>(filetypes, vim.bo.filetype)</span></span>
<span class=giallo-l><span style=color:#957fb8>    then</span></span>
<span class=giallo-l><span style=color:#7e9cd8>      buf_attach</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  config.on_exit</span><span style=color:#e6c384> =</span><span> vim.</span><span style=color:#7e9cd8>schedule_wrap</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>code</span><span style=color:#9cabca>,</span><span> signal</span><span style=color:#9cabca>,</span><span> client_id</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    vim.api.</span><span style=color:#7e9cd8>nvim_del_autocmd</span><span>(autocmd)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  vim.lsp.</span><span style=color:#7e9cd8>start_client</span><span>(config)</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span></code></pre><h2 id=cuando-definimos-los-atajos>¿Cuándo definimos los atajos?</h2><p>No podemos olvidarnos de los atajos. ¿Cómo debemos proceder? La documentación dice que podemos usar el evento <code>LspAttach</code>, de esta manera podremos definirlos en cualquier lugar de nuestra configuración.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'LspAttach'</span><span>, {</span></span>
<span class=giallo-l><span>  desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Acciones LSP'</span><span>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  callback</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>    local</span><span style=color:#7e9cd8> bufmap</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>mode</span><span style=color:#9cabca>,</span><span> lhs</span><span style=color:#9cabca>,</span><span> rhs</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      local opts</span><span style=color:#e6c384> =</span><span> {buffer</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>}</span></span>
<span class=giallo-l><span>      vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(mode, lhs, rhs, opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Muestra información sobre símbolo debajo del cursor</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'K'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.hover()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar a definición</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gd'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.definition()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar a declaración</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gD'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.declaration()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Mostrar implementaciones</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gi'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.implementation()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar a definición de tipo</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'go'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.type_definition()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Listar referencias</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gr'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.references()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Mostrar argumentos de función</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;C-k>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.signature_help()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Renombrar símbolo</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;F2>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.rename()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Listar "code actions" disponibles en la posición del cursor</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;F4>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.code_action()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'x'</span><span>, </span><span style=color:#98bb6c>'&lt;F4>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.range_code_action()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Mostrar diagnósticos de la línea actual</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gl'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.open_float()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar al diagnóstico anterior</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'[d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.goto_prev()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar al siguiente diagnóstico</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>']d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.goto_next()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h2 id=codigo-completo>Código completo</h2><p>Si aplicamos todos estos cambios a nuestro ejemplo obtendremos esto.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local</span><span style=color:#7e9cd8> launch_tsserver</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>  local autocmd</span></span>
<span class=giallo-l><span>  local filetypes</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'javascript'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'javascriptreact'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'javascript.jsx'</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'typescript'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'typescriptreact'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>    'typescript.tsx'</span><span>,</span></span>
<span class=giallo-l><span>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  local config</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    cmd</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'typescript-language-server'</span><span>, </span><span style=color:#98bb6c>'--stdio'</span><span>},</span></span>
<span class=giallo-l><span>    name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'tsserver'</span><span>,</span></span>
<span class=giallo-l><span>    root_dir</span><span style=color:#e6c384> =</span><span> vim.fn.</span><span style=color:#7e9cd8>getcwd</span><span>(),</span></span>
<span class=giallo-l><span>    capabilities</span><span style=color:#e6c384> =</span><span> vim.lsp.protocol.</span><span style=color:#7e9cd8>make_client_capabilities</span><span>(),</span></span>
<span class=giallo-l><span>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  config.</span><span style=color:#7e9cd8>on_init</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>client</span><span style=color:#9cabca>,</span><span> results</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    local</span><span style=color:#7e9cd8> buf_attach</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>      vim.lsp.</span><span style=color:#7e9cd8>buf_attach_client</span><span>(</span><span style=color:#d27e99>0</span><span>, client.id)</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    autocmd</span><span style=color:#e6c384> =</span><span> vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'FileType'</span><span>, {</span></span>
<span class=giallo-l><span>      desc</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> string.format</span><span>(</span><span style=color:#98bb6c>'Vincular servidor: %s'</span><span>, client.name),</span></span>
<span class=giallo-l><span>      pattern</span><span style=color:#e6c384> =</span><span> filetypes,</span></span>
<span class=giallo-l><span>      callback</span><span style=color:#e6c384> =</span><span> buf_attach</span></span>
<span class=giallo-l><span>    })</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>    if</span><span> vim.v.vim_did_enter</span><span style=color:#e6c384> ==</span><span style=color:#d27e99> 1</span><span style=color:#e6c384> and</span></span>
<span class=giallo-l><span>      vim.</span><span style=color:#7e9cd8>tbl_contains</span><span>(filetypes, vim.bo.filetype)</span></span>
<span class=giallo-l><span style=color:#957fb8>    then</span></span>
<span class=giallo-l><span style=color:#7e9cd8>      buf_attach</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  config.on_exit</span><span style=color:#e6c384> =</span><span> vim.</span><span style=color:#7e9cd8>schedule_wrap</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>code</span><span style=color:#9cabca>,</span><span> signal</span><span style=color:#9cabca>,</span><span> client_id</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    vim.api.</span><span style=color:#7e9cd8>nvim_del_autocmd</span><span>(autocmd)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  vim.lsp.</span><span style=color:#7e9cd8>start_client</span><span>(config)</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_user_command</span><span>(</span></span>
<span class=giallo-l><span style=color:#98bb6c>  'LaunchTsserver'</span><span>,</span></span>
<span class=giallo-l><span>  launch_tsserver,</span></span>
<span class=giallo-l><span>  {desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Inicializar tsserver'</span><span>}</span></span>
<span class=giallo-l><span>)</span></span></code></pre><h2 id=podemos-mejorarlo>¿Podemos mejorarlo?</h2><p>Claro. Casi todo el código puede moverse a una función auxiliar, con eso podremos eliminar todo el ruido.<p>Sólo imaginen algo como esto.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local</span><span style=color:#7e9cd8> launch_tsserver</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>  local config</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> make_config</span><span>({</span></span>
<span class=giallo-l><span>    cmd</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'typescript-language-server'</span><span>, </span><span style=color:#98bb6c>'--stdio'</span><span>},</span></span>
<span class=giallo-l><span>    name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'tsserver'</span><span>,</span></span>
<span class=giallo-l><span>    filetypes</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span style=color:#98bb6c>      'javascript'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>      'javascriptreact'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>      'javascript.jsx'</span></span>
<span class=giallo-l><span style=color:#98bb6c>      'typescript'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>      'typescriptreact'</span><span>,</span></span>
<span class=giallo-l><span style=color:#98bb6c>      'typescript.tsx'</span><span>,</span></span>
<span class=giallo-l><span>    }</span></span>
<span class=giallo-l><span>  })</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  vim.lsp.</span><span style=color:#7e9cd8>start_client</span><span>(config)</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_user_command</span><span>(</span></span>
<span class=giallo-l><span style=color:#98bb6c>  'LaunchTsserver'</span><span>,</span></span>
<span class=giallo-l><span>  launch_tsserver,</span></span>
<span class=giallo-l><span>  {desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Inicializar tsserver'</span><span>}</span></span>
<span class=giallo-l><span>)</span></span></code></pre><p>¿Y qué tiene <code>make_config</code>? Bueno... se los dejo de tarea. Tendrán que implementarla ustedes mismos. Ya les mostré todo el código necesario confío en que pueden hacerlo solos.<p>Si de verdad quieren saber qué haría yo pueden encontrar la respuesta en este repositorio: <a rel="noopener external" href=https://github.com/VonHeikemen/nvim-lsp-sans-plugins target=_blank>VonHeikemen/nvim-lsp-sans-plugins</a><h2 id=conclusion>Conclusión</h2><p>Aprendimos suficiente sobre el cliente LSP que viene incluido en neovim para crear una pequeña configuración. Sabemos cómo reutilizar una instancia de servidor LSP en múltiples archivos. Y en el proceso aprendimos un poco sobre los autocomandos. Ya podemos decir que podemos manejar el cliente LSP de neovim.<h2 id=fuentes>Fuentes</h2><ul><li><a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.start_client() target=_blank>:help vim.lsp.start_client()</a><li><a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.buf_attach_client() target=_blank>:help vim.lsp.buf_attach_client()</a><li><a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig/wiki target=_blank>What is nvim-lspconfig?</a></ul><hr><p>¿Tienen alguna pregunta? Pueden dejar un comentario en cualquiera de estas plataformas:<ul><li><a href=https://dev.to/vonheikemen/se-puede-usar-el-cliente-lsp-de-neovim-sin-plugins-44ha rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/manage-neovim-lsp-client-without-plugins-es rel=noopener target=_blank>Hashnode</a></ul><p>Pueden contactarme por las redes sociales:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Bluesky <a rel="noopener me" href=https://bsky.app/profile/vonheikemen.bsky.social target=_blank> @vonheikemen.bsky.social </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Gracias por su tiempo. Si este artículo les pareció útil y quieren apoyar mis esfuerzos para crear más contenido, pueden dejar una propina en buy me a coffee ☕.</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>