<!doctype html><html lang=es><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Guía de uso del cliente LSP de Neovim | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="neovim, shell, software, coding, development" name=keywords><meta content="Agrega funcionalidades dignas de un IDE a Neovim sin instalar plugins de terceros" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2026 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Guía de uso del cliente LSP de Neovim</h1><span class=post-date>2024-01-13 | 18 minutos | <a href=https://vonheikemen.github.io/devlog/tools/neovim-lsp-client-guide/> Read in english </a> </span><blockquote>Última actualización: 2025-05-23</blockquote><p>El título original para este post era "Cómo agregar funcionalidades como las de un IDE a Neovim sin instalar plugins de terceros." Suena más interesante pero tiene demasiadas palabras. Aún así, es básicamente lo que quiero enseñarles.<p>En esta ocasión quiero explicar cómo configurar un servidor LSP en Neovim v0.11. Y voy a mostrarles cómo funciona porque este nuevo método es simplemente una abstracción sobre funcionalidades que han estado en Neovim durante mucho tiempo. Así podrán construir su propia configuración incluso en versiones anteriores de Neovim.<h2 id=requerimientos>Requerimientos</h2><ol><li>Neovim en su versión v0.8 o mayor<li>Un servidor LSP<li>Paciencia/Energía para escribir un poco de lua por cada servidor LSP que se quiere configurar</ol><p>Si no conocen el lenguaje lua aquí les dejo un par de recursos donde pueden aprender lo básico:<ul><li><a href="https://www.youtube.com/watch?v=NneB6GX1Els" rel="noopener external" target=_blank>Lua crash course (video de 11 min)</a><li><a rel="noopener external" href=https://learnxinyminutes.com/docs/lua/ target=_blank>Learn X in Y minutes: Where X = lua</a><li><a rel="noopener external" href=https://neovim.io/doc/user/lua-guide.html target=_blank>Guía oficial de lua para Neovim</a></ul><h2 id=todo-comienza-con-el-servidor-lsp>Todo comienza con el servidor LSP</h2><p>Un servidor LSP es un programa externo que sigue el <a rel="noopener external" href=https://microsoft.github.io/language-server-protocol/ target=_blank>Protocolo de Servidor de Lenguajes</a> (Language Server Protocol). En este se definen los parámetros que puede recibir un servidor LSP, y también cómo debe responder. El propósito de todo esto es que <a rel="noopener external" href=https://microsoft.github.io/language-server-protocol/implementors/tools/ target=_blank>cualquier herramienta que implemente el protocolo</a> pueda comunicarse con un servidor LSP.<p>Entonces, el servidor LSP es el programa que va a analizar nuestro código y le dice a nuestro editor qué debe hacer.<p><em>¿Qué servidores LSP tenemos disponibles?</em><p>La página web del protocolo <a rel="noopener external" href=https://microsoft.github.io/language-server-protocol/implementors/servers/ target=_blank>tiene una lista de servidores</a>.<h3 id=en-este-caso-en-particular>En este caso en particular...</h3><p>Quiero usar <a rel="noopener external" href=https://gleam.run/ target=_blank>Gleam</a> y <a rel="noopener external" href=https://github.com/LuaLS/lua-language-server target=_blank>LuaLS</a> como ejemplos prácticos.<p>Gleam en realidad es un conjunto de herramientas. Incluye un compilador, un formateador de código y un servidor LSP. Las instrucciones de instalación se encuentran en la documentación oficial: <a rel="noopener external" href=https://gleam.run/getting-started/installing/ target=_blank>Getting started</a>.<p>LuaLS es un servidor LSP para el lenguaje lua. Pueden descargar la versión más reciente desde su repositorio, en la sección <a rel="noopener external" href=https://github.com/LuaLS/lua-language-server/releases/latest target=_blank>github releases</a>. O, pueden <a rel="noopener external" href=https://luals.github.io/wiki/build/ target=_blank>compilarlo con el código fuente</a>.<p>Una vez que tienen un servidor LSP instalado recomiendo verificar si Neovim puede encontrar el ejecutable. Para esto pueden usar la función <a rel="noopener external" href=https://neovim.io/doc/user/builtin.html#exepath() target=_blank>exepath</a>.<p>El ejecutable de Gleam es <code>gleam</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>:</span><span style=color:#7e9cd8>echo exepath</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'gleam'</span><span style=color:#9cabca>)</span></span></code></pre><p>Y el de LuaLS es <code>lua-language-server</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>:</span><span style=color:#7e9cd8>echo exepath</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'lua-language-server'</span><span style=color:#9cabca>)</span></span></code></pre><p>Estos comandos deben mostrar la ubicación del ejecutable en su sistema. De no ser así, significa que algo salió mal durante la instalación del servidor LSP.<h2 id=uso-basico>Uso básico</h2><p>Antes de empezar a escribir código deberíamos aprender cómo usar el servidor LSP. Esta información debería estar en la documentación oficial del servidor que queremos usar.<p>Si no podemos encontrar instrucciones de uso básico en la documentación, podemos ir al repositorio de <a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig target=_blank>nvim-lspconfig</a> y buscamos el directorio <a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig/tree/master/lsp target=_blank>lsp</a>. Ahí podemos encontrar archivos de configuración para un montón de servidores.<p>Justo ahora estamos interesados en Gleam, entonces deberíamos revisar el contenido de <a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig/blob/ac1dfbe3b60e5e23a2cff90e3bd6a3bc88031a57/lsp/gleam.lua#L8 target=_blank>gleam.lua</a>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#957fb8>return</span><span> {</span></span>
<span class=giallo-l><span>    cmd</span><span style=color:#e6c384> =</span><span> { </span><span style=color:#98bb6c>'gleam'</span><span>, </span><span style=color:#98bb6c>'lsp' </span><span>},</span></span>
<span class=giallo-l><span>    filetypes</span><span style=color:#e6c384> =</span><span> { </span><span style=color:#98bb6c>'gleam' </span><span>},</span></span>
<span class=giallo-l><span>    root_markers</span><span style=color:#e6c384> =</span><span> { </span><span style=color:#98bb6c>'gleam.toml'</span><span>, </span><span style=color:#98bb6c>'.git' </span><span>},</span></span>
<span class=giallo-l><span>}</span></span></code></pre><p>Aquí tenemos la información esencial que necesitamos para poder integrar un servidor LSP en Neovim.<p>La propiedad <code>cmd</code> contiene el comando que necesitamos para inicializar el servidor LSP. Recuerden que un servidor LSP es un programa externo. Quiere decir que <code>gleam lsp</code> es un comando válido que podemos ejecutar manualmente en nuestra terminal. Y curiosamente, si hacemos eso nos mostrará este mensaje.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=plain><span class=giallo-l><span>This command is intended to be run by language server clients such</span></span>
<span class=giallo-l><span>as a text editor rather than being run directly in the console.</span></span></code></pre><p>El mensaje dice "este comando fue creado para ser ejecutado por un cliente LSP como por ejemplo un editor de texto, en lugar de ser ejecutado directamente por cónsola."<p>En la propiedad <code>filetypes</code> tenemos la lista de lenguajes que el servidor LSP soporta. Deben tener en cuenta que cada nombre debe ser un "filetype" válido en Neovim.<p>En <code>root_markers</code> tenemos una lista de archivos y directorios. Esta información se usa para determinar la "raíz" de nuestro proyecto. Es decir el directorio principal del proyecto.<h2 id=el-directorio-lsp>El directorio lsp</h2><p>A partir de la versión <strong>v0.11</strong> el directorio <code>lsp</code> forma parte de lo que llamamos <code>runtimepath</code>. Quiere decir que tenemos la posibilidad de crear nuestro propio directorio <code>lsp</code>. Ahí podemos colocar la configuración de los servidores LSP que tenemos instalados, sin necesidad de instalar <code>nvim-lspconfig</code> como un plugin.<p>Imaginen por un momento que nuestra configuración personal de Neovim tiene esta estructura:<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=plain><span class=giallo-l><span>nvim</span></span>
<span class=giallo-l><span>├── init.vim</span></span>
<span class=giallo-l><span>├── .nvim.lua</span></span>
<span class=giallo-l><span>└── lsp</span></span>
<span class=giallo-l><span>    ├── gleam.lua</span></span>
<span class=giallo-l><span>    └── luals-nvim.lua</span></span></code></pre><p>La configuración dentro de <code>nvim/lsp/gleam.lua</code> puede ser exactamente igual a la que tiene <code>nvim-lspconfig</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- nvim/lsp/gleam.lua</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>return</span><span> {</span></span>
<span class=giallo-l><span>  cmd</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam'</span><span>, </span><span style=color:#98bb6c>'lsp'</span><span>},</span></span>
<span class=giallo-l><span>  filetypes</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam'</span><span>},</span></span>
<span class=giallo-l><span>  root_markers</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam.toml'</span><span>, </span><span style=color:#98bb6c>'.git'</span><span>},</span></span>
<span class=giallo-l><span>}</span></span></code></pre><p>Ahora bien, cuando configuramos un servidor LSP tenemos ciertas libertades. Entonces, en <code>luals-nvim</code> voy a mostrar una configuración de LuaLS específicamente creada para Neovim donde hay un script llamado <code>.nvim.lua</code> en el directorio raíz.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- nvim/lsp/luals-nvim.lua</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>return</span><span> {</span></span>
<span class=giallo-l><span>  cmd</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'lua-language-server'</span><span>},</span></span>
<span class=giallo-l><span>  filetypes</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'lua'</span><span>},</span></span>
<span class=giallo-l><span>  root_markers</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'.nvim.lua'</span><span>},</span></span>
<span class=giallo-l><span>  settings</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    Lua</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>      runtime</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>        version</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'LuaJIT'</span><span>,</span></span>
<span class=giallo-l><span>        path</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'lua/?.lua'</span><span>, </span><span style=color:#98bb6c>'lua/?/init.lua'</span><span>},</span></span>
<span class=giallo-l><span>      },</span></span>
<span class=giallo-l><span>      diagnostics</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>        globals</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'vim'</span><span>},</span></span>
<span class=giallo-l><span>      },</span></span>
<span class=giallo-l><span>      telemetry</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>        enable</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>      },</span></span>
<span class=giallo-l><span>      workspace</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>        checkThirdParty</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>        library</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>          vim.env.VIMRUNTIME,</span></span>
<span class=giallo-l><span>        },</span></span>
<span class=giallo-l><span>      },</span></span>
<span class=giallo-l><span>    },</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>}</span></span></code></pre><p>Dentro del directorio <code>lsp</code> los archivos que creamos pueden tener cualquier nombre. Por eso elegí <code>luals-nvim</code> en lugar de algo genérico como <code>lua</code> o <code>luals</code>. Y la configuración que "retornamos" en el script debe contener los mismos parámetros que <a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.config() target=_blank>vim.lsp.config()</a> espera.<p>Noten que en este ejemplo tenemos una propiedad llamada <code>settings</code>. Esa propiedad está reservada para opciones específicas del servidor LSP. Quiere decir que en Neovim no disponemos de una documentación que nos diga cuáles son las opciones que podemos colocar. Debemos ir a la documentación del servidor LSP y ver qué opciones tenemos disponibles.<p>Deben saber que los archivos dentro del directorio <code>lsp</code> no son ejecutados automáticamente. Debemos decirle a Neovim qué servidores LSP queremos usar. Para usar un servidor LSP debemos ejecutar la función <a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.enable() target=_blank>vim.lsp.enable()</a>.<p>En este ejemplo el archivo <code>init.vim</code> puede tener este código:<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span style=color:#727169>" nvim/init.vim</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>set</span><span style=color:#7aa89f> exrc</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>lua </span><span style=color:#7e9cd8>vim.lsp.enable</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'gleam'</span><span style=color:#9cabca>)</span></span></code></pre><p><em>¿Por qué usar init.vim?</em><p>Simplemente quería una excusa para mostrar que se puede ejecutar una función de lua en vimscript. He notado que algunos usuarios de Vim creen que para usar lua deben eliminar toda la configuración que tienen en vimscript. No es así. En vimscript podemos usar el comando <code>lua</code> para ejecutar una línea de código escrita en lua.<p>En fin, al iniciar Neovim este buscará un archivo en el <code>runtimepath</code> que coincida con el patrón <code>lsp/gleam.lua</code>. Luego creará un autocomando usando la lista de lenguajes que suministramos en <code>filetypes</code>. Entonces si abrimos un archivo de tipo <code>gleam</code> Neovim intentará inicializar el servidor LSP.<p><em>¿Y qué pasa con LuaLS?</em><p>La configuración que tenemos para LuaLS sólo es útil para Neovim, lo que nos da una oportunidad para usar una configuración local. En Vim logramos esto usando la opción <a href="https://neovim.io/doc/user/options.html#'exrc'" rel="noopener external" target=_blank>exrc</a>. Cuando habilitamos los archivos <code>exrc</code> Vim/Neovim ejecutará un script que esté en directorio de trabajo actual. En nuestro ejemplo sería <code>.nvim.lua</code>. Esto es una espada de doble filo. Por eso en Neovim la opción <code>exrc</code> tiene un comportamiento diferente. Cuando se detecta una configuración local Neovim nos preguntará si "confiamos" en el archivo, y si aceptamos se ejecutará. La próxima vez que se detecte la misma configuración local se ejecutará automáticamente si el contenido del archivo no ha cambiado.<p>Yo recomendaría crear un alias para habilitar la opción <code>exrc</code> desde la terminal, en lugar de colocarlo directo en su configuración personal. Algo como esto.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=shellscript><span class=giallo-l><span style=color:#957fb8>alias</span><span> code</span><span style=color:#e6c384>=</span><span style=color:#98bb6c>'nvim --cmd "set exrc"'</span></span></code></pre><p>De vuelta a LuaLS. Luego de Neovim termine de ejecutar el archivo <code>init.vim</code> (o <code>init.lua</code>) buscará el script <code>.nvim.lua</code> en el directorio actual. El que está en nuestra configuración tendrá este código.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- nvim/.nvim.lua</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.lsp.</span><span style=color:#7e9cd8>enable</span><span>(</span><span style=color:#98bb6c>'luals-nvim'</span><span>)</span></span></code></pre><p>De esta manera Neovim no intentará usar <code>lsp/luals-nvim.lua</code> si no lo abrimos en el directorio donde está nuestra configuración personal. La desventaja de este método es que debemos abrir Neovim exactamente donde está <code>.nvim.lua</code>.<h2 id=se-puede-configurar-todo-en-un-archivo>¿Se puede configurar todo en un archivo?</h2><p>Si ustedes son la clase de persona que prefiere una configuración simple donde todo está en un sólo archivo, les tengo buenas noticias. No están obligados a usar el directorio <code>lsp</code>.<p>La función <a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.config() target=_blank>vim.lsp.config()</a> puede usarse para extender las configuraciones que se encuentran en el directorio <code>lsp</code>. Pero también la podemos usar para crear configuraciones nuevas, sin necesidad de crear un archivo aparte.<p>Por ejemplo:<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- nvim/init.lua</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.lsp.</span><span style=color:#7e9cd8>config</span><span>(</span><span style=color:#98bb6c>'gleam'</span><span>, {</span></span>
<span class=giallo-l><span>  cmd</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam'</span><span>, </span><span style=color:#98bb6c>'lsp'</span><span>},</span></span>
<span class=giallo-l><span>  filetypes</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam'</span><span>},</span></span>
<span class=giallo-l><span>  root_markers</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam.toml'</span><span>, </span><span style=color:#98bb6c>'.git'</span><span>},</span></span>
<span class=giallo-l><span>})</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.lsp.</span><span style=color:#7e9cd8>enable</span><span>(</span><span style=color:#98bb6c>'gleam'</span><span>)</span></span></code></pre><h2 id=y-si-algo-sale-mal>¿Y si algo sale mal?</h2><p>Si Neovim no fue capaz de iniciar el proceso del servidor LSP pueden revisar el log. Ejecuten este comando en Neovim:<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>:lua vim.cmd.</span><span style=color:#7e9cd8>edit</span><span>(vim.lsp.</span><span style=color:#7e9cd8>get_log_path</span><span>())</span></span></code></pre><p>Cuando algo sale mal habrá unas líneas que comienzan con <code>[ERROR]</code>. Tal vez ahí pueden encontrar alguna información útil.<p>Si quieren un log con más detalles pueden ejecutar esta función.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.lsp.</span><span style=color:#7e9cd8>set_log_level</span><span>(</span><span style=color:#98bb6c>'debug'</span><span>)</span></span></code></pre><p>Y desde <strong>Neovim v0.10</strong> pueden hacer un "chequeo de salud" usando este comando:<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>:checkhealth </span><span style=color:#7aa89f>lsp</span></span></code></pre><h2 id=filetypes>Filetypes</h2><p>En versiones anteriores de Neovim no tenemos disponible <code>vim.lsp.enable()</code>, pero podemos replicar su funcionalidad. Ya sabemos lo que necesitamos sólo nos falta juntar las piezas.<p>Si el servidor LSP que queremos usar sólo soporta un lenguaje de programación entonces podemos crear un "filetype plugin."<p>Para crear un filetype plugin debemos ir a nuestra configuración de Neovim, y ahí debemos crear un directorio llamado <code>ftplugin</code>. Podemos ejecutar este comando en Neovim.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>:call</span><span style=color:#7e9cd8> mkdir</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'./ftplugin'</span><span style=color:#9cabca>,</span><span style=color:#98bb6c> 'p'</span><span style=color:#9cabca>)</span></span></code></pre><p>Luego debemos crear un script con el mismo nombre de un tipo de archivo.<p>Si queremos crear un filetype plugin para Gleam debemos crear un archivo llamado <code>gleam.lua</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>:edit ftplugin/gleam.lua | </span><span style=color:#7aa89f>write</span></span></code></pre><p>En este script vamos a ejecutar la función que "conectará" el servidor LSP con Neovim.<p>Por otro lado, si el servidor LSP soporta varios tipos de archivos tenemos la opción de crear un autocomando en el evento <code>FileType</code>. Algo como esto.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'FileType'</span><span>, {</span></span>
<span class=giallo-l><span>  pattern</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'css'</span><span>, </span><span style=color:#98bb6c>'less'</span><span>, </span><span style=color:#98bb6c>'sass'</span><span>},</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  callback</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span style=color:#727169>    ---</span></span>
<span class=giallo-l><span style=color:#727169>    -- Aquí podemos habilitar el servidor LSP</span></span>
<span class=giallo-l><span style=color:#727169>    ---</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span><span>,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>Aquí la propiedad <code>pattern</code> es donde debemos colocar los tipos de archivos que soporta el servidor LSP. Esta es la misma información que colocamos en la propiedad <code>filetypes</code> cuando configuramos un servidor LSP en Neovim v0.11.<p>Dentro del filetype plugin o el autocomando debemos ejecutar la función que va a inicializar el servidor LSP. Pero primero, debemos conocer la lógica detrás de <code>root_markers</code>.<h2 id=directorio-raiz>Directorio raíz</h2><p>Un servidor LSP necesita saber la ruta de nuestro proyecto. La ubicación exacta dentro de nuestro sistema. Este es un problema que debemos resolver en Neovim.<p>En <strong>Neovim v0.10</strong> podemos usar una función llamada <a rel="noopener external" href=https://neovim.io/doc/user/lua.html#vim.fs.root() target=_blank>vim.fs.root()</a>. A esta función le vamos a dar una lista de nombres de archivos y nos devolverá una ruta que podemos usar.<p>¿Pero qué vamos a buscar? Archivos de configuración, los que usualmente colocamos en la raíz de un proyecto. En proyectos de Gleam siempre hay un archivo <code>gleam.toml</code>. En proyectos de javascript usualmente hay un <code>package.json</code>. En rust está el <code>cargo.toml</code>. Este es el tipo de información que vamos a darle a <code>vim.fs.root()</code> para que nos devuelva la ruta correcta.<p>Entonces en el filetype plugin de Gleam podemos hacer una prueba con <code>vim.fs.root()</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- nvim/ftplugin/gleam.lua</span></span>
<span class=giallo-l><span style=color:#727169>-- NOTA: vim.fs.root() sólo está disponble en Neovim v0.10 o mayor</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local root_markers</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam.toml'</span><span>}</span></span>
<span class=giallo-l><span>local root_dir</span><span style=color:#e6c384> =</span><span> vim.fs.</span><span style=color:#7e9cd8>root</span><span>(</span><span style=color:#d27e99>0</span><span>, root_markers)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#7e9cd8>print</span><span>(root_dir)</span></span></code></pre><p>En <strong>Neovim v0.9</strong> o menor debemos recrear el comportamiento de <code>vim.fs.root()</code>. En este caso podemos usar <a rel="noopener external" href=https://neovim.io/doc/user/lua.html#vim.fs.find() target=_blank>vim.fs.find()</a>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- nvim/ftplugin/gleam.lua</span></span>
<span class=giallo-l><span style=color:#727169>-- NOTA: Este código es para Neovim v0.9.5 o menor</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local root_markers</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam.toml'</span><span>}</span></span>
<span class=giallo-l><span>local buffer</span><span style=color:#e6c384> =</span><span> vim.api.</span><span style=color:#7e9cd8>nvim_buf_get_name</span><span>(</span><span style=color:#d27e99>0</span><span>)</span></span>
<span class=giallo-l><span>local paths</span><span style=color:#e6c384> =</span><span> vim.fs.</span><span style=color:#7e9cd8>find</span><span>(root_markers, {</span></span>
<span class=giallo-l><span>    upward</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>    path</span><span style=color:#e6c384> =</span><span> vim.fn.</span><span style=color:#7e9cd8>fnamemodify</span><span>(buffer, </span><span style=color:#98bb6c>':p:h'</span><span>),</span></span>
<span class=giallo-l><span>})</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local root_dir</span><span style=color:#e6c384> =</span><span> vim.fs.</span><span style=color:#7e9cd8>dirname</span><span>(paths[</span><span style=color:#d27e99>1</span><span>])</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#7e9cd8>print</span><span>(root_dir)</span></span></code></pre><h2 id=creando-el-cliente>Creando el cliente</h2><p>Estamos listos para conectar Neovim con el servidor LSP. Ahora debemos usar la función <a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.start() target=_blank>vim.lsp.start()</a> para inicializar el servidor LSP. Esta es la misma función que <code>vim.lsp.enable()</code> ejecuta por nosotros.<p>Esto es lo que deben saber, la primera vez que ejecutamos <code>vim.lsp.start()</code> Neovim iniciará nuestro servidor LSP como un proceso externo. Cuando se ejecuta nuevamente Neovim simplemente le enviará información al proceso del servidor LSP.<p>Entonces, el filetype plugin para Gleam debería tener este código:<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- nvim/ftplugin/gleam.lua</span></span>
<span class=giallo-l><span style=color:#727169>-- NOTA: vim.fs.root() sólo está disponble en Neovim v0.10 o mayor</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local root_markers</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam.toml'</span><span>}</span></span>
<span class=giallo-l><span>local root_dir</span><span style=color:#e6c384> =</span><span> vim.fs.</span><span style=color:#7e9cd8>root</span><span>(</span><span style=color:#d27e99>0</span><span>, root_markers)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>if</span><span> root_dir</span><span style=color:#957fb8> then</span></span>
<span class=giallo-l><span>  vim.lsp.</span><span style=color:#7e9cd8>start</span><span>({</span></span>
<span class=giallo-l><span>    cmd</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'gleam'</span><span>, </span><span style=color:#98bb6c>'lsp'</span><span>},</span></span>
<span class=giallo-l><span>    root_dir</span><span style=color:#e6c384> =</span><span> root_dir,</span></span>
<span class=giallo-l><span>  })</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span></code></pre><p>Con esta configuración ya podremos utilizar algunas funcionalidades. Por ejemplo, si editamos un archivo Gleam y este tiene un error, Neovim nos dirá en qué línea se encuentra el error.<h2 id=diagnostics>Diagnostics</h2><p>"Diagnostic" es el término que se usa en Neovim para los errores que se encuentran en nuestro código fuente.<p>Un diagnóstico puede tener un signo al inicio de la línea para indicarnos que hay un error. Este es el diagnostic sign. El espacio que necesita este signo está escondido por defecto, y cuando Neovim va a mostrarlo toda la pantalla se mueve a la derecha. Este comportamiento puede configurarse.<p>Si configuramos la opción <code>signcolumn</code> con la cadena de texto <code>yes</code> Neovim reserva el espacio para el signo. Tendremos un espacio en blanco al inicio de la línea en todo momento.<p>En <code>init.vim</code> pueden configurarlo de esta manera.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>set</span><span style=color:#7aa89f> signcolumn</span><span style=color:#e6c384>=</span><span>yes</span></span></code></pre><p>Si usan <code>init.lua</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.o.signcolumn</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'yes'</span></span></code></pre><p>Por otro lado si asignamos la cadena de texto <code>no</code>, Neovim no mostrará ningún signo. No recomiendo esta opción, especialmente si no están al tanto de las consecuencias. Si quieren esconder los signos de diagnósticos hay una alternativa mejor.<h3 id=vim-diagnostic>vim.diagnostic</h3><p>En lua tenemos acceso al módulo <a rel="noopener external" href=https://neovim.io/doc/user/diagnostic.html target=_blank>vim.diagnostic</a>, y dentro de este módulo está una función llamada <a rel="noopener external" href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.config() target=_blank>.config()</a>. Si con esta función podremos configurar el comportamiento de los diagnósticos.<ul><li>Esconder los signos</ul><p>Esta es la forma segura de deshabilitar los signos de los diagnósticos.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.diagnostic.</span><span style=color:#7e9cd8>config</span><span>({</span></span>
<span class=giallo-l><span>  signs</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><ul><li>Texto virtual</ul><p>Tenemos la opción de mostrar un fragmento del mensaje de error al final de la línea. A esto se le conoce como "virtual text." En <strong>Neovim v0.11</strong> está deshabilitado por defecto. Así lo podemos habilitar.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.diagnostic.</span><span style=color:#7e9cd8>config</span><span>({</span></span>
<span class=giallo-l><span>  virtual_text</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>Si tienen <strong>Neovim v0.10 o mayor</strong> pueden leer el diagnóstico completo usando <code>&lt;C-w>d</code> (control + w luego d). Este atajo ejecuta la función <a rel="noopener external" href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.open_float() target=_blank>vim.diagnostic.open_float()</a>.<p>Si están usando <strong>Neovim v0.9.5 o menor</strong> tendrán que crear un atajo de teclado.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;C-w>d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.open_float()&lt;cr>'</span><span>)</span></span></code></pre><p>Ahora bien, me gustaría poder explicarles con más detalle cada opción en <code>vim.diagnostic.config()</code> pero no tenemos tiempo. Si quieren explorar las demás opciones pueden <a rel="noopener external" href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.config() target=_blank>leer la documentación</a>.<h2 id=funcionalidades-gratis>Funcionalidades gratis</h2><p>Hablemos de las funcionalidades que Neovim nos ofrece con la configuración que tenemos hasta ahora, que es básicamente lo mínimo.<p>Cuando un servidor LSP está activo en un archivo Neovim habilita ciertas funcionalidades.<p><strong>Desde Neovim v0.8</strong><ul><li><p>A la opción <code>tagfunc</code> se le asigna una función que usa el servidor LSP activo. En otras palabras, podemos saltar a la definición de una función o clase usando el atajo <code>&lt;C-]></code> (Control + ]). Y podemos volver a la posición anterior usando <code>&lt;C-t></code> (Control + t).</p><li><p>La opción <code>formatexpr</code> se le asigna una función que usa el servidor LSP activo. Esto quiere decir que podemos usar el operador <code>gq</code> para formatear un fragmento de código. Ejemplo: podemos ir al modo visual, seleccionamos un pedazo de código, presionamos <code>gq</code> y Neovim le pedirá al servidor LSP activo que formatee el código.</p><li><p>La opción <code>omnifunc</code> también es configurada. Esta nos permite obtener completado de código. En modo de inserción el atajo <code>&lt;C-x>&lt;C-o></code> (control + x y luego control + o) nos presentará sugerencias que el servidor LSP cree que son relevantes.</p></ul><p><strong>Desde Neovim v0.9</strong><ul><li>Se agrega soporte para el "resaltado semántico." Resulta que algunos servidores proporcionan información acerca de los símbolos que se encuentran en el archivo actual, y Neovim puede usar esta información para crear un resaltado de código más preciso.</ul><p><strong>Desde Neovim v0.10</strong><ul><li><p>Si estamos en modo normal y no tenemos ningún atajo vinculado a <code>K</code>, podremos usarlo para leer la documentación del símbolo que está debajo del cursor.</p><li><p>En modo normal, el atajo <code>&lt;C-w>d</code> muestra los diagnósticos de la línea debajo del cursor.</p><li><p>En modo normal, el atajo <code>]d</code> mueve el cursor hacia siguiente diagnóstico más cercano.</p><li><p>En modo normal, el atajo <code>[d</code> mueve el cursor hacia diagnóstico previo.</p></ul><p><strong>Desde Neovim v0.11</strong><ul><li><p>En modo normal, el atajo <code>grn</code> renombra todas las referencias del símbolo debajo del cursor.</p><li><p>En modo normal, el atajo <code>gra</code> muestra una lista de "code actions" disponibles para la línea actual.</p><li><p>En modo normal, el atajo <code>grr</code> muestra todas las referencias del símbolo debajo del cursor.</p><li><p>En modo normal, el atajo <code>gri</code> muestra la implementación del símbolo debajo del cursor.</p><li><p>En modo normal, el atajo <code>gO</code> muestra lista todos los símbolos que existen en el archivo actual.</p><li><p>En modo de inserción, el atajo <code>&lt;Ctrl-s></code> (Control + s) muestra documentación de los argumentos de la función debajo del cursor.</p></ul><h2 id=atajos>Atajos</h2><p>En <strong>Neovim v0.11</strong> ya tenemos atajos asignados para las funcionalidades que ofrece el editor. Pero en versiones anteriores debemos crear estos atajos nosotros mismos.<p>Este es el código que necesitamos en lua.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- Pueden agregar esto en su archivo `init.lua`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>-- Estos atajos ya forman parte de Neovim v0.10</span></span>
<span class=giallo-l><span>vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'[d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.goto_prev()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span>vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>']d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.goto_next()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span>vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;C-w>d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.open_float()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span>vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;C-w>&lt;C-d>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.open_float()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'LspAttach'</span><span>, {</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  callback</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>event</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    local</span><span style=color:#7e9cd8> bufmap</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>mode</span><span style=color:#9cabca>,</span><span> rhs</span><span style=color:#9cabca>,</span><span> lhs</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(mode, rhs, lhs, {buffer</span><span style=color:#e6c384> =</span><span> event.buf})</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Estos atajos ya forman parte de Neovim v0.11</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'K'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.hover()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'grr'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.references()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gri'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.implementation()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'grn'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.rename()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gra'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.code_action()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gO'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.document_symbol()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>({</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}, </span><span style=color:#98bb6c>'&lt;C-s>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.signature_help()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Estos son atajos extras</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gd'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.definition()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'grt'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.type_definition()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'grd'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.declaration()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>({</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'x'</span><span>}, </span><span style=color:#98bb6c>'gq'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.format({async = true})&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span><span>,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>Y este sería el equivalente en vimscript.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span style=color:#727169>" Pueden agregar esto en su archivo `init.vim`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>" Estos atajos ya forman parte de Neovim v0.10</span></span>
<span class=giallo-l><span style=color:#957fb8>nnoremap</span><span> [d </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.diagnostic.goto_prev</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>nnoremap</span><span> ]d </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.diagnostic.goto_next</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>C-w</span><span style=color:#9cabca>></span><span>d </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.diagnostic.open_float</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>C-w</span><span style=color:#9cabca>>&lt;</span><span style=color:#ffa066>C-d</span><span style=color:#9cabca>> &lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.diagnostic.open_float</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>function</span><span style=color:#e6c384>!</span><span style=color:#7e9cd8> LspAttached</span><span style=color:#9cabca>()</span><span> abort</span></span>
<span class=giallo-l><span style=color:#727169>  " Estos atajos ya forman parte de Neovim v0.11</span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> K </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.hover</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> grr </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.references</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> gri </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.implementation</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> grn </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.rename</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> gra </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.code_action</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> gO </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.document_symbol</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  inoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>> &lt;</span><span style=color:#ffa066>C-s</span><span style=color:#9cabca>> &lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.signature_help</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  snoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>> &lt;</span><span style=color:#ffa066>C-s</span><span style=color:#9cabca>> &lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.signature_help</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>  " Estos son atajos extras</span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span style=color:#7aa89f> gd</span><span style=color:#9cabca> &lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.definition</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> gq </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.format</span><span style=color:#9cabca>(</span><span>{async </span><span style=color:#e6c384>=</span><span style=color:#ffa066> true</span><span>}</span><span style=color:#9cabca>)&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  xnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> gq </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.format</span><span style=color:#9cabca>(</span><span>{async </span><span style=color:#e6c384>=</span><span style=color:#ffa066> true</span><span>}</span><span style=color:#9cabca>)&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> grd </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.declaration</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#957fb8>  nnoremap</span><span style=color:#9cabca> &lt;</span><span style=color:#ffa066>buffer</span><span style=color:#9cabca>></span><span> grt </span><span style=color:#9cabca>&lt;</span><span>cmd</span><span style=color:#9cabca>></span><span>lua </span><span style=color:#7e9cd8>vim.lsp.buf.type_definition</span><span style=color:#9cabca>()&lt;</span><span style=color:#ffa066>cr</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span>endfunction</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>autocmd LspAttach * call</span><span style=color:#7e9cd8> LspAttached</span><span style=color:#9cabca>()</span></span></code></pre><h2 id=advertencia>Advertencia</h2><p>No todos los servidores implementan el protocolo LSP en su totalidad. Y no todas las funcionalidades son consistentes entre servidores.<p>Por ejemplo, Gleam puede mostrar errores en nuestro código en tiempo real, sin necesidad de guardar los cambios en el archivo. Pero <a rel="noopener external" href=https://github.com/rust-lang/rust-analyzer target=_blank>rust-analyzer</a>, el servidor LSP para rust, sólo puede mostrar errores una vez que se guardan cambios en el archivo.<p>Otro ejemplo. <a rel="noopener external" href=https://github.com/astral-sh/ruff-lsp target=_blank>ruff-lsp</a>, un servidor LSP para python, en su descripción menciona que su especialidad es reportar errores y formatear código. Hasta donde pude ver este servidor no ofrece completado de código o resaltado de código semántico.<p>Lo que intento decir es esto: lean la documentación del servidor LSP para que estén informados de las funcionalidades que ofrece.<h2 id=contenido-extra>Contenido extra</h2><p>A estas alturas me atrevería a decir que ya tienen el conocimento esencial para usar el cliente LSP de Neovim y ser productivos. Lo que sigue son consejos, ajustes y funcionalidades que pueden implementar agregando un bloque de código a su configuración personal.<h3 id=formatear-al-guardar>Formatear al guardar</h3><p>Lo que haremos aquí es ejecutar la función <a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.buf.format() target=_blank>vim.lsp.buf.format()</a> antes de que Neovim guarde los cambios a un archivo. Y por supuesto, esto sólo lo haremos cuando hay un servidor LSP activo.<p>Importante: los servidores LSP con capacidades para formatear código tienen su propia configuración. Por ejemplo, puede que nosotros tengamos la indentación configurada a 2 espacios pero el servidor LSP puede formatear el código con 4 espacios. Entonces, siempre es buena idea indagar en la documentación del servidor LSP para saber cómo configurar el estilo del formateo.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- Pueden agregar esto en su archivo `init.lua`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local fmt_group</span><span style=color:#e6c384> =</span><span> vim.api.</span><span style=color:#7e9cd8>nvim_create_augroup</span><span>(</span><span style=color:#98bb6c>'autoformat_cmds'</span><span>, {clear</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>})</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local</span><span style=color:#957fb8> function</span><span style=color:#7e9cd8> setup_autoformat</span><span style=color:#9cabca>(</span><span>event</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>  local id</span><span style=color:#e6c384> =</span><span> vim.</span><span style=color:#7e9cd8>tbl_get</span><span>(event, </span><span style=color:#98bb6c>'data'</span><span>, </span><span style=color:#98bb6c>'client_id'</span><span>)</span></span>
<span class=giallo-l><span>  local client</span><span style=color:#e6c384> =</span><span> id</span><span style=color:#e6c384> and</span><span> vim.lsp.</span><span style=color:#7e9cd8>get_client_by_id</span><span>(id)</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> client</span><span style=color:#e6c384> ==</span><span style=color:#ffa066> nil</span><span style=color:#957fb8> then</span></span>
<span class=giallo-l><span style=color:#957fb8>    return</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  vim.api.</span><span style=color:#7e9cd8>nvim_clear_autocmds</span><span>({group</span><span style=color:#e6c384> =</span><span> fmt_group, buffer</span><span style=color:#e6c384> =</span><span> event.buf})</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  local</span><span style=color:#7e9cd8> buf_format</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>e</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    vim.lsp.buf.</span><span style=color:#7e9cd8>format</span><span>({</span></span>
<span class=giallo-l><span>      bufnr</span><span style=color:#e6c384> =</span><span> e.buf,</span></span>
<span class=giallo-l><span>      async</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>      timeout_ms</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 10000</span><span>,</span></span>
<span class=giallo-l><span>    })</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'BufWritePre'</span><span>, {</span></span>
<span class=giallo-l><span>    buffer</span><span style=color:#e6c384> =</span><span> event.buf,</span></span>
<span class=giallo-l><span>    group</span><span style=color:#e6c384> =</span><span> fmt_group,</span></span>
<span class=giallo-l><span>    desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Formatear archivo'</span><span>,</span></span>
<span class=giallo-l><span>    callback</span><span style=color:#e6c384> =</span><span> buf_format,</span></span>
<span class=giallo-l><span>  })</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'LspAttach'</span><span>, {</span></span>
<span class=giallo-l><span>  desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Configurar formatear al guardar'</span><span>,</span></span>
<span class=giallo-l><span>  callback</span><span style=color:#e6c384> =</span><span> setup_autoformat,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h3 id=cambiar-texto-de-signos-de-diagnosticos>Cambiar texto de signos de diagnósticos</h3><p>Si estamos usando Neovim en su <strong>versión v0.9.5 o menor</strong>, debemos usar la función <a rel="noopener external" href=https://neovim.io/doc/user/builtin.html#sign_define() target=_blank>vim.fn.sign_define()</a>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- Pueden agregar esto en su archivo `init.lua`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local</span><span style=color:#957fb8> function</span><span style=color:#7e9cd8> sign_define</span><span style=color:#9cabca>(</span><span>args</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>  vim.fn.</span><span style=color:#7e9cd8>sign_define</span><span>(args.name, {</span></span>
<span class=giallo-l><span>    texthl</span><span style=color:#e6c384> =</span><span> args.name,</span></span>
<span class=giallo-l><span>    text</span><span style=color:#e6c384> =</span><span> args.text,</span></span>
<span class=giallo-l><span>    numhl</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> ''</span></span>
<span class=giallo-l><span>  })</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#7e9cd8>sign_define</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignError'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '✘'</span><span>})</span></span>
<span class=giallo-l><span style=color:#7e9cd8>sign_define</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignWarn'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '▲'</span><span>})</span></span>
<span class=giallo-l><span style=color:#7e9cd8>sign_define</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignHint'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '⚑'</span><span>})</span></span>
<span class=giallo-l><span style=color:#7e9cd8>sign_define</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignInfo'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '»'</span><span>})</span></span></code></pre><p>Si estamos usando Neovim en su <strong>versión v0.10 o mayor</strong>, debemos usar la función <code>vim.diagnostic.config()</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- Pueden agregar esto en su archivo `init.lua`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.diagnostic.</span><span style=color:#7e9cd8>config</span><span>({</span></span>
<span class=giallo-l><span>  signs</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    text</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>      [vim.diagnostic.severity.ERROR] </span><span style=color:#e6c384>=</span><span style=color:#98bb6c> '✘'</span><span>,</span></span>
<span class=giallo-l><span>      [vim.diagnostic.severity.WARN] </span><span style=color:#e6c384>=</span><span style=color:#98bb6c> '▲'</span><span>,</span></span>
<span class=giallo-l><span>      [vim.diagnostic.severity.HINT] </span><span style=color:#e6c384>=</span><span style=color:#98bb6c> '⚑'</span><span>,</span></span>
<span class=giallo-l><span>      [vim.diagnostic.severity.INFO] </span><span style=color:#e6c384>=</span><span style=color:#98bb6c> '»'</span><span>,</span></span>
<span class=giallo-l><span>    },</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h3 id=deshabilitar-resaltado-semantico>Deshabilitar resaltado semántico</h3><p>La documentación de Neovim sugiere modificar la instancia del cliente LSP. Debemos "eliminar" la propiedad que activa el resaltado semántico.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- Pueden agregar esto en su archivo `init.lua`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'LspAttach'</span><span>, {</span></span>
<span class=giallo-l><span>  desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Deshabilitar resaltado semántico'</span><span>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  callback</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>event</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    local id</span><span style=color:#e6c384> =</span><span> vim.</span><span style=color:#7e9cd8>tbl_get</span><span>(event, </span><span style=color:#98bb6c>'data'</span><span>, </span><span style=color:#98bb6c>'client_id'</span><span>)</span></span>
<span class=giallo-l><span>    local client</span><span style=color:#e6c384> =</span><span> id</span><span style=color:#e6c384> and</span><span> vim.lsp.</span><span style=color:#7e9cd8>get_client_by_id</span><span>(id)</span></span>
<span class=giallo-l><span style=color:#957fb8>    if</span><span> client</span><span style=color:#e6c384> ==</span><span style=color:#ffa066> nil</span><span style=color:#957fb8> then</span></span>
<span class=giallo-l><span style=color:#957fb8>      return</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    client.server_capabilities.semanticTokensProvider</span><span style=color:#e6c384> =</span><span style=color:#ffa066> nil</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span><span>,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h3 id=resaltar-simbolo-debajo-del-cursor>Resaltar símbolo debajo del cursor</h3><p>Para esto vamos a usar la función <a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.buf.document_highlight() target=_blank>vim.lsp.buf.document_highlight()</a>. Cuando el cursor pase una cantidad de tiempo sobre un símbolo vamos a ejecutar esa función. Y luego vamos desactivar el resaltado cuando el cursor se mueva de lugar.<p>Para que esto funcione de manera apropiada el tema del editor debe soportar los siguientes grupos:<ul><li>LspReferenceRead<li>LspReferenceText<li>LspReferenceWrite</ul><p>Si el tema que tenemos no define ningún color para esos grupos podemos hacer un "vinculo" con un grupo que ya existe. Este es un ejemplo que muestra cómo vincular al grupo <code>Search</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_set_hl</span><span>(</span><span style=color:#d27e99>0</span><span>, </span><span style=color:#98bb6c>'LspReferenceRead'</span><span>, {link</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Search'</span><span>})</span></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_set_hl</span><span>(</span><span style=color:#d27e99>0</span><span>, </span><span style=color:#98bb6c>'LspReferenceText'</span><span>, {link</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Search'</span><span>})</span></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_set_hl</span><span>(</span><span style=color:#d27e99>0</span><span>, </span><span style=color:#98bb6c>'LspReferenceWrite'</span><span>, {link</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Search'</span><span>})</span></span></code></pre><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- Pueden agregar esto en su archivo `init.lua`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>-- tiempo en milisegundos para emitir el event `CursorHold`</span></span>
<span class=giallo-l><span>vim.opt.updatetime</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 400</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local</span><span style=color:#957fb8> function</span><span style=color:#7e9cd8> highlight_symbol</span><span style=color:#9cabca>(</span><span>event</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>  local id</span><span style=color:#e6c384> =</span><span> vim.</span><span style=color:#7e9cd8>tbl_get</span><span>(event, </span><span style=color:#98bb6c>'data'</span><span>, </span><span style=color:#98bb6c>'client_id'</span><span>)</span></span>
<span class=giallo-l><span>  local client</span><span style=color:#e6c384> =</span><span> id</span><span style=color:#e6c384> and</span><span> vim.lsp.</span><span style=color:#7e9cd8>get_client_by_id</span><span>(id)</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> client</span><span style=color:#e6c384> ==</span><span style=color:#ffa066> nil</span><span style=color:#e6c384> or not</span><span> client.</span><span style=color:#7e9cd8>supports_method</span><span>(</span><span style=color:#98bb6c>'textDocument/documentHighlight'</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span style=color:#957fb8>    return</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  local group</span><span style=color:#e6c384> =</span><span> vim.api.</span><span style=color:#7e9cd8>nvim_create_augroup</span><span>(</span><span style=color:#98bb6c>'highlight_symbol'</span><span>, {clear</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>})</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  vim.api.</span><span style=color:#7e9cd8>nvim_clear_autocmds</span><span>({buffer</span><span style=color:#e6c384> =</span><span> event.buf, group</span><span style=color:#e6c384> =</span><span> group})</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>({</span><span style=color:#98bb6c>'CursorHold'</span><span>, </span><span style=color:#98bb6c>'CursorHoldI'</span><span>}, {</span></span>
<span class=giallo-l><span>    group</span><span style=color:#e6c384> =</span><span> group,</span></span>
<span class=giallo-l><span>    buffer</span><span style=color:#e6c384> =</span><span> event.buf,</span></span>
<span class=giallo-l><span>    callback</span><span style=color:#e6c384> =</span><span> vim.lsp.buf.document_highlight,</span></span>
<span class=giallo-l><span>  })</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>({</span><span style=color:#98bb6c>'CursorMoved'</span><span>, </span><span style=color:#98bb6c>'CursorMovedI'</span><span>}, {</span></span>
<span class=giallo-l><span>    group</span><span style=color:#e6c384> =</span><span> group,</span></span>
<span class=giallo-l><span>    buffer</span><span style=color:#e6c384> =</span><span> event.buf,</span></span>
<span class=giallo-l><span>    callback</span><span style=color:#e6c384> =</span><span> vim.lsp.buf.clear_references,</span></span>
<span class=giallo-l><span>  })</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'LspAttach'</span><span>, {</span></span>
<span class=giallo-l><span>  desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Resaltar símbolo debajo del cursor'</span><span>,</span></span>
<span class=giallo-l><span>  callback</span><span style=color:#e6c384> =</span><span> highlight_symbol,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h3 id=tab-para-completar>Tab para completar</h3><p>Para mantener una implementación simple vamos a hacer lo siguiente: Si el menú de sugerencias es visible, usaremos Tab y Shift + Tab para navegar entre las sugerencias. Si el cursor está sobre un espacio en blanco, insertaremos el caracter <code>&lt;Tab></code>. Si no, mostraremos el menú de sugerencias.<p>Ahora bien, si tenemos un servidor LSP activo que puede proveer sugerencias usamos eso. De lo contrario le pediremos a Neovim que sugiera palabras que se encuentran en el archivo actual.<p>Nota: recuerden que pueden confirmar una sugerencia usando <code>Enter</code> o <code>&lt;C-y></code> (Control + y).<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- Pueden agregar esto en su archivo `init.lua`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.opt.completeopt</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'menuone'</span><span>, </span><span style=color:#98bb6c>'noselect'</span><span>, </span><span style=color:#98bb6c>'noinsert'</span><span>}</span></span>
<span class=giallo-l><span>vim.opt.</span><span style=color:#7aa89f>shortmess</span><span>:</span><span style=color:#7e9cd8>append</span><span>(</span><span style=color:#98bb6c>'c'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local</span><span style=color:#957fb8> function</span><span style=color:#7e9cd8> tab_complete</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> vim.fn.</span><span style=color:#7e9cd8>pumvisible</span><span>() </span><span style=color:#e6c384>==</span><span style=color:#d27e99> 1</span><span style=color:#957fb8> then</span></span>
<span class=giallo-l><span style=color:#727169>    -- navega al siguiente elemento en la lista</span></span>
<span class=giallo-l><span style=color:#957fb8>    return</span><span style=color:#98bb6c> '&lt;Down>'</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  local c</span><span style=color:#e6c384> =</span><span> vim.fn.</span><span style=color:#7e9cd8>col</span><span>(</span><span style=color:#98bb6c>'.'</span><span>) </span><span style=color:#e6c384>-</span><span style=color:#d27e99> 1</span></span>
<span class=giallo-l><span>  local is_whitespace</span><span style=color:#e6c384> =</span><span> c</span><span style=color:#e6c384> ==</span><span style=color:#d27e99> 0</span><span style=color:#e6c384> or</span><span> vim.fn.</span><span style=color:#7e9cd8>getline</span><span>(</span><span style=color:#98bb6c>'.'</span><span>):</span><span style=color:#7e9cd8>sub</span><span>(c, c):</span><span style=color:#7e9cd8>match</span><span>(</span><span style=color:#98bb6c>'%s'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> is_whitespace</span><span style=color:#957fb8> then</span></span>
<span class=giallo-l><span style=color:#727169>    -- inserta el caracter tab</span></span>
<span class=giallo-l><span style=color:#957fb8>    return</span><span style=color:#98bb6c> '&lt;Tab>'</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>  local lsp_completion</span><span style=color:#e6c384> =</span><span> vim.bo.omnifunc</span><span style=color:#e6c384> ==</span><span style=color:#98bb6c> 'v:lua.vim.lsp.omnifunc'</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> lsp_completion</span><span style=color:#957fb8> then</span></span>
<span class=giallo-l><span style=color:#727169>    -- activa el completado con el servidor LSP</span></span>
<span class=giallo-l><span style=color:#957fb8>    return</span><span style=color:#98bb6c> '&lt;C-x>&lt;C-o>'</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>  -- sugiere palabras en el archivo actual</span></span>
<span class=giallo-l><span style=color:#957fb8>  return</span><span style=color:#98bb6c> '&lt;C-x>&lt;C-n>'</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local</span><span style=color:#957fb8> function</span><span style=color:#7e9cd8> tab_prev</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> vim.fn.</span><span style=color:#7e9cd8>pumvisible</span><span>() </span><span style=color:#e6c384>==</span><span style=color:#d27e99> 1</span><span style=color:#957fb8> then</span></span>
<span class=giallo-l><span style=color:#727169>    -- navega al elemento anterior en la lista</span></span>
<span class=giallo-l><span style=color:#957fb8>    return</span><span style=color:#98bb6c> '&lt;Up>'</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>  -- inserta el caracter tab</span></span>
<span class=giallo-l><span style=color:#957fb8>  return</span><span style=color:#98bb6c> '&lt;Tab>'</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'&lt;Tab>'</span><span>, tab_complete, {expr</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>})</span></span>
<span class=giallo-l><span>vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'&lt;S-Tab>'</span><span>, tab_prev, {expr</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>})</span></span></code></pre><h3 id=expandir-snippets>Expandir snippets</h3><p>En <strong>Neovim v0.11</strong> tenemos acceso a un módulo llamado <a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#lsp-completion target=_blank>vim.lsp.completion</a>, con esto podremos extender las funcionalidades del mecanismo de completado de código. Para ser más específico, Neovim podrá responder a más "comandos de edición" que retorne un servidor LSP. Por ejemplo, podremos expandir snippets de código.<p>Por el momento las funcionalidades de <code>vim.lsp.completion</code> son opcionales, debemos usar la función <a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.completion.enable() target=_blank>vim.lsp.completion.enable()</a> para habilitarlas.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- Pueden agregar esto en su archivo `init.lua`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.opt.completeopt</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'menuone'</span><span>, </span><span style=color:#98bb6c>'noinsert'</span><span>, </span><span style=color:#98bb6c>'noselect'</span><span>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'LspAttach'</span><span>, {</span></span>
<span class=giallo-l><span>  desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Habilitar vim.lsp.completion'</span><span>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  callback</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>event</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    local client_id</span><span style=color:#e6c384> =</span><span> vim.</span><span style=color:#7e9cd8>tbl_get</span><span>(event, </span><span style=color:#98bb6c>'data'</span><span>, </span><span style=color:#98bb6c>'client_id'</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>    if</span><span> client_id</span><span style=color:#e6c384> ==</span><span style=color:#ffa066> nil</span><span style=color:#957fb8> then</span></span>
<span class=giallo-l><span style=color:#957fb8>      return</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    vim.lsp.completion.</span><span style=color:#7e9cd8>enable</span><span>(</span><span style=color:#ffa066>true</span><span>, client_id, event.buf, {autotrigger</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>})</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Activar el menú de sugerencias manualmente</span></span>
<span class=giallo-l><span>    vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'&lt;C-Space>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.completion.trigger()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>Noten que el último argumento en <code>.enable()</code> tiene la propiedad <code>autotrigger</code>. <code>false</code> es el valor por defecto entonces yo lo dejo así. Si cambian ese valor a <code>true</code> Neovim podrá activar el completado de código cuando encuentre un "trigger character". Por ejemplo, con el servidor LSP de lua Neovim mostrará sugerencias cuando se encuentre con el caracter <code>.</code> o <code>:</code>.<h3 id=habilitar-inlay-hints>Habilitar "inlay hints"</h3><p>Inlay hints es parecido al texto virtual. Estos son fragmento de texto que Neovim agrega a lo que estamos editando, pero que en realidad no es parte del archivo. En este caso se usa para mostrar el tipo/clase de una variable o argumento de una función.<p>En este caso debemos usar la función <a rel="noopener external" href=https://neovim.io/doc/user/lsp.html#vim.lsp.inlay_hint.enable() target=_blank>vim.lsp.inlay_hint.enable()</a> en el archivo donde queremos habilitar esta funcionalidad. Como siempre, podemos usar un autocomando con el evento <code>LspAttach</code>.<p>Nota: la mayoría de los servidores que tienen soporte para esta funcionalidad la deshabilitan por defecto. Esto quiere decir que activar los inlay hints en Neovim no es suficiente, también debemos buscar las opciones específicas del servidor LSP y configurarlas en la función <code>vim.lsp.start()</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#727169>-- Pueden agregar esto en su archivo `init.lua`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'LspAttach'</span><span>, {</span></span>
<span class=giallo-l><span>  desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Habilitar inlay hints'</span><span>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  callback</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>event</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    local id</span><span style=color:#e6c384> =</span><span> vim.</span><span style=color:#7e9cd8>tbl_get</span><span>(event, </span><span style=color:#98bb6c>'data'</span><span>, </span><span style=color:#98bb6c>'client_id'</span><span>)</span></span>
<span class=giallo-l><span>    local client</span><span style=color:#e6c384> =</span><span> id</span><span style=color:#e6c384> and</span><span> vim.lsp.</span><span style=color:#7e9cd8>get_client_by_id</span><span>(id)</span></span>
<span class=giallo-l><span style=color:#957fb8>    if</span><span> client</span><span style=color:#e6c384> ==</span><span style=color:#ffa066> nil</span><span style=color:#e6c384> or not</span><span> client.</span><span style=color:#7e9cd8>supports_method</span><span>(</span><span style=color:#98bb6c>'textDocument/inlayHint'</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span style=color:#957fb8>      return</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    vim.lsp.inlay_hint.</span><span style=color:#7e9cd8>enable</span><span>(</span><span style=color:#ffa066>true</span><span>, {bufnr</span><span style=color:#e6c384> =</span><span> event.buf})</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span><span>,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h2 id=conclusion>Conclusión</h2><p>Espero haber demostrado que no es tan difícil usar un servidor LSP en Neovim. La parte que realmente requiere esfuerzo es aprender todo el contexto necesario. ¿Qué significa LSP? ¿Qué es un servidor LSP? ¿Filetype plugin? Pero una vez que tienen conocimiento de todas las piezas involucradas todo se hace más fácil.<p>Una cosa más... por favor no ignoren el "conocimento básico." Dediquen un poco de tiempo para aprender la sintaxis de lua. Aprendan sobre el comando <code>:help</code> en Neovim. Investiguen un poco sobre la API de lua que ofrece Neovim. Les aconsejo leer <a rel="noopener external" href=https://neovim.io/doc/user/lua-guide.html target=_blank>la guía oficial de lua</a> que está en la documentación de Neovim, es buen punto de partida.<hr><p>Si tienen alguna pregunta pueden contactarme por las redes sociales:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Bluesky <a rel="noopener me" href=https://bsky.app/profile/vonheikemen.bsky.social target=_blank> @vonheikemen.bsky.social </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Gracias por su tiempo. Si este artículo les pareció útil y quieren apoyar mis esfuerzos para crear más contenido, pueden dejar una propina en buy me a coffee ☕.</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>