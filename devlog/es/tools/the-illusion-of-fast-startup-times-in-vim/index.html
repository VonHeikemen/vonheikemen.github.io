<!doctype html><html lang=es><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  La ilusión de un inicio rápido en vim | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="vim, neovim, shell, software, coding, development" name=keywords><meta content="Mejorando el tiempo de inicio de vim con un pequeño 'truco'" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2026 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>La ilusión de un inicio rápido en vim</h1><span class=post-date>2021-08-22 | 4 minutos | <a href=https://vonheikemen.github.io/devlog/tools/the-illusion-of-fast-startup-times-in-vim/> Read in english </a> </span><p>"Ilusión" es la palabra clave. Lo que voy a enseñarles no es ningún "truco mágico" que hará vim más rápido. Alejen ese pensamiento de sus mentes. Lo único que haremos hoy será retrasar lo inevitable.<h2 id=que-queremos-lograr>¿Qué queremos lograr?</h2><p>Quiero todos los plugins opcionales se inicialicen luego de que la interfaz esté totalmente cargada.<h2 id=por-que>¿Por qué?</h2><p>En mi caso, cuando veo que el editor ya está listo hay una pequeña ventana de tiempo de 2 o 3 segundos donde mi mente pasa de "¿Qué es lo que voy a hacer?" a "Ah, sí, esa cosa". Durante ese tiempo no estoy haciendo nada y es exactamente ahí donde quiero carguen todos los plugins. De esta manera ejecutamos sólo necesario para que vim pueda funcionar al inicio, y dejamos todo lo demás que es "opcional" en esa ventana de tiempo donde <strong>yo</strong> no estoy haciendo nada con el editor.<h2 id=manos-a-la-obra>Manos a la obra</h2><p>En vim tenemos un <a rel="noopener external" href=https://vimhelp.org/autocmd.txt.html#autocmd-events target=_blank>evento</a> que se llama <code>VimEnter</code>, este nos indica el momento cuando vim termina todo su ritual de inicialización. Pero no es suficiente para mí, yo quiero estar seguro de que todo está listo. Entonces lo que quiero hacer es esperar unos 20 milisegundos después de este evento, el cual debería ser tiempo suficiente para que vim presente la interfaz, y luego cargar los plugins.<p>Necesitamos un "autocomando" y la función <code>timer_start</code>. Hagamos una pequeña prueba. Vamos a imprimir un mensaje 5 segundos luego de que vim inicie. Colocaremos esto en nuestro <code>.vimrc</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>function</span><span style=color:#e6c384>!</span><span style=color:#7e9cd8> s:load_plugins</span><span style=color:#9cabca>(</span><span>t</span><span style=color:#9cabca>)</span><span> abort</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  echom</span><span style=color:#98bb6c> "vim está listo"</span></span>
<span class=giallo-l><span>endfunction</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>augroup</span><span> user_cmds</span></span>
<span class=giallo-l><span>  autocmd</span><span style=color:#e6c384>!</span></span>
<span class=giallo-l><span>  autocmd</span><span style=color:#7aa89f> VimEnter</span><span> * call</span><span style=color:#7e9cd8> timer_start</span><span style=color:#9cabca>(</span><span style=color:#d27e99>5000</span><span style=color:#9cabca>,</span><span style=color:#7e9cd8> function</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'s:load_plugins'</span><span style=color:#9cabca>))</span></span>
<span class=giallo-l><span style=color:#957fb8>augroup</span><span> END</span></span></code></pre><p>La próxima vez que inicien vim, deberían ver el mensaje <code>vim está listo</code> después de unos segundos. Si no vieron el mensaje o desapareció rápidamente, pueden revisar con el commando <code>:messages</code>.<p>Una vez que estamos seguros que nuestra función es ejecutada cambiamos el tiempo de <code>5000</code> a <code>20</code>. Y en <code>s:load_plugins</code> ya podemos colocar los comandos necesarios para cargar los plugins.<p>Esta siguiente parte va a depender de su manejador de plugins. Vamos a usar la funcionalidad nativa conocida como <a rel="noopener external" href=https://vimhelp.org/repeat.txt.html#packages target=_blank>packages</a>. Si no están seguros si la usan o no, revisen la documentación de su manejador plugins.<p>La última pieza del rompecabezas es el comando <code>packadd</code>, es el mecanismo que utiliza vim para cargar un plugin "opcional". Entonces nuestro código debería quedar así.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=viml><span class=giallo-l><span>function</span><span style=color:#e6c384>!</span><span style=color:#7e9cd8> s:load_plugins</span><span style=color:#9cabca>(</span><span>t</span><span style=color:#9cabca>)</span><span> abort</span></span>
<span class=giallo-l><span style=color:#727169>  " lista de plugins</span></span>
<span class=giallo-l><span>  packadd vim-surround</span></span>
<span class=giallo-l><span>  packadd vim-obsession</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>  "(opcional) ejecutar scripts en el directorio `after`</span></span>
<span class=giallo-l><span>  runtime</span><span style=color:#e6c384>!</span><span> OPT after</span><span style=color:#c0a36e>/plugin/</span><span>*.vim</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>  "(opcional) emitimos un 'evento' propio</span></span>
<span class=giallo-l><span style=color:#727169>  " para indicar que ya todo está listo</span></span>
<span class=giallo-l><span>  doautocmd </span><span style=color:#7aa89f>User</span><span> PluginsLoaded</span></span>
<span class=giallo-l><span>endfunction</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>augroup</span><span> user_cmds</span></span>
<span class=giallo-l><span>  autocmd</span><span style=color:#e6c384>!</span></span>
<span class=giallo-l><span>  autocmd</span><span style=color:#7aa89f> VimEnter</span><span> * call</span><span style=color:#7e9cd8> timer_start</span><span style=color:#9cabca>(</span><span style=color:#d27e99>20</span><span style=color:#9cabca>,</span><span style=color:#7e9cd8> function</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'s:load_plugins'</span><span style=color:#9cabca>))</span></span>
<span class=giallo-l><span style=color:#957fb8>augroup</span><span> END</span></span></code></pre><p>Eso es todo. Pero aún no termino.<h2 id=que-hay-de-lua>¿Qué hay de lua?</h2><p>En <code>neovim</code> (a partir de la versión 0.5) se ha incluido soporte para crear la configuración enteramente en lua, y mucha gente ha migrado su configuración a este lenguaje. En efecto también podemos hacer lo mismo en lua, pero las limitaciones actuales los obligará a escribir mucho vimscript.<p>He aquí lo que necesitan.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> load_plugins</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>  vim.</span><span style=color:#7e9cd8>cmd</span><span style=color:#98bb6c> [[</span></span>
<span class=giallo-l><span style=color:#98bb6c>    packadd vim-surround</span></span>
<span class=giallo-l><span style=color:#98bb6c>    packadd vim-obsession</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#98bb6c>    runtime! OPT after/plugin/*.vim</span></span>
<span class=giallo-l><span style=color:#98bb6c>    doautocmd User PluginsLoaded</span></span>
<span class=giallo-l><span style=color:#98bb6c>  ]]</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.</span><span style=color:#7e9cd8>cmd</span><span style=color:#98bb6c> [[</span></span>
<span class=giallo-l><span style=color:#98bb6c>  augroup user_cmds</span></span>
<span class=giallo-l><span style=color:#98bb6c>    autocmd!</span></span>
<span class=giallo-l><span style=color:#98bb6c>    autocmd VimEnter * lua vim.defer_fn(load_plugins, 20)</span></span>
<span class=giallo-l><span style=color:#98bb6c>  augroup END</span></span>
<span class=giallo-l><span style=color:#98bb6c>]]</span></span></code></pre><p>Aquí estoy creando una función global porque es lo más fácil. Por lo general deberían evitar ese tipo de funciones. Si saben cómo crear y usar un módulo en lua, les sugiero que hagan eso.<h2 id=advertencia>Advertencia</h2><p>Consideren qué plugins van a cargar de esta manera.<p>Vamos a tomar <code>NERDTree</code>(un gestor de archivos) como ejemplo. Si abren un directorio desde la terminal, algo como <code>vim .</code>, <code>NERDTree</code> puede activarse automáticamente para enseñarles los archivos del directorio. Pero si retrasan la carga inicial de <code>NERDTree</code> este no podrá cumplir su función en este caso específico.<p>Ocurre algo similar con los plugins de sintaxis, si los cargan tarde puede que noten cuando vim cambia los colores por defecto a los colores que declara el plugin. No es una experiencia agradable.<h2 id=conclusion>Conclusión</h2><p>Aprendimos sobre el evento <code>VimEnter</code>, que es emitido por vim al finalizar su proceso inicial. Llegamos a conocer las funciones <code>timer_start</code> y <code>vim.defer_fn</code>, que podemos usarlas para ejecutar una función en un momento que nos parezca más conveniente. Finalmente, unimos todas estas piezas para cargar nuestros plugins opcionales en un momento específico donde nosotros como usuarios no estamos interactuando con el editor.<p>Pero también deberíamos tener cuidado porque cargar un plugin fuera del proceso inicial de vim puede tener efectos no deseados. Entonces deberíamos evaluar la situación por plugin, decidir qué debería ser un plugin opcional y qué no.<h2 id=fuentes>Fuentes</h2><ul><li><a rel="noopener external" href=https://vimhelp.org/eval.txt.html#timers target=_blank>:help timers</a><li><a rel="noopener external" href=https://vimhelp.org/autocmd.txt.html#%3Adoautocmd target=_blank>:help :doautocmd</a><li><a rel="noopener external" href=https://vimhelp.org/autocmd.txt.html#User target=_blank>:help User</a><li><a rel="noopener external" href=https://vimhelp.org/repeat.txt.html#%3Apackadd target=_blank>:help :packadd</a><li><a rel="noopener external" href=https://vimhelp.org/repeat.txt.html#%3Aruntime target=_blank>:help :runtime</a><li><a rel="noopener external" href=https://neovim.io/doc/user/lua.html#vim.defer_fn() target=_blank>:help vim.defer_fn</a></ul><hr><p>¿Tienen alguna pregunta? Pueden dejar un comentario en cualquiera de estas plataformas:<ul><li><a href=https://dev.to/vonheikemen/la-ilusion-de-un-inicio-rapido-en-vim-5dmb rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/the-illusion-of-fast-startup-times-in-vim-es rel=noopener target=_blank>Hashnode</a></ul><p>Pueden contactarme por las redes sociales:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Bluesky <a rel="noopener me" href=https://bsky.app/profile/vonheikemen.bsky.social target=_blank> @vonheikemen.bsky.social </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Gracias por su tiempo. Si este artículo les pareció útil y quieren apoyar mis esfuerzos para crear más contenido, pueden dejar una propina en buy me a coffee ☕.</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>