<!doctype html><html lang=es><meta http-equiv=x-ua-compatible content="IE=edge"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><meta http-equiv=permissions-policy content="interest-cohort=()"><title>¿Quieres usar variables de entorno en ese archivo de configuración? Puedes... casi | Devlog</title><link rel=stylesheet href=https://vonheikemen.github.io/devlog/print.css media=print><link rel=stylesheet href=https://vonheikemen.github.io/devlog/styles.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><meta name=keywords content="shell,hoy-aprendi,software,coding,development"><meta name=description content="Presentando al comando envsubst"><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a></ul>© 2020-2022 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>¿Quieres usar variables de entorno en ese archivo de configuración? Puedes... casi</h1><span class=post-date>2021-10-19
| 3 minutos
| <a href=https://vonheikemen.github.io/devlog/tools/embed-env-variables-in-any-config-file/>Read in english</a></span><p>Imaginen que hay una herramienta que utilizan en todas sus máquinas y esta requiere de un archivo de configuración. Probablemente este archivo necesita de un pedazo de información que cambia de acuerdo al sistema operativo, o tal vez según el contexto (computadora personal o de trabajo, un servidor... cosas así). Entonces siempre tenemos que cambiar algún detalle de este archivo. ¿No sería genial si pudíeramos usar variables? Resulta que podemos... casi.<h2 id=les-presento-el-comando-envsubst>Les presento el comando envsubst</h2><p><code>envsubst</code> puede incrustar el valor de una variable de entorno en una cadena de texto que recibe desde la <em>entrada estándar</em>.<p>Esto quiere decir que en nuestra terminal podemos hacer algo así.<pre data-lang=sh style=background-color:#2b2c2f;color:#cccece class=language-sh><code class=language-sh data-lang=sh><span style=color:#69c>echo </span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>there is no place like $HOME</span><span style=color:#5fb3b3>&#39; | </span><span style=color:#69c>envsubst
</span></code></pre><p>Si estamos usando linux deberíamos obtener el mensaje.<pre style=background-color:#2b2c2f;color:#cccece><code><span>there is no place like /home/user
</span></code></pre><p>Básicamente podemos hacer trampa. Tenemos la posibilidad de usar <code>envsubst</code> como un pre-procesador y crear nuestros archivos de configuración a partir de una plantilla.<h2 id=un-caso-de-la-vida-real>Un caso de la vida real</h2><p>Para mí <code>envsubst</code> resuelve un problema que tengo con <code>npm</code>. En mi carpeta de usuario tengo el archivo <code>.npmrc</code> con la siguiente estructura.<pre style=background-color:#2b2c2f;color:#cccece><code><span>prefix=&lt;una-ruta&gt;
</span><span>ignore-scripts=true
</span><span>
</span><span>init-author=&lt;un-nombre&gt; (&lt;un-enlace&gt;)
</span><span>init-license=MIT
</span></code></pre><p>Como podrán imaginar algunos de esos campos pueden variar según la máquina o el contexto, entonces siempre me encuentro cambiando algunas cosas. Pero ahora que sé que existe <code>envsubst</code> puedo tener una sola plantilla en <code>~/templates/npmrc</code> y usarla como una base para todas mis máquinas.<p>¿Cómo haríamos? Lo primero será poner algo en nuestra plantilla.<pre style=background-color:#2b2c2f;color:#cccece><code><span>prefix=$XDG_CONFIG_HOME/npm/packages
</span><span>ignore-scripts=true
</span><span>
</span><span>init-author=$USER_NAME ($CONTACT_LINK)
</span><span>init-license=MIT
</span></code></pre><p>Okey, si sólo queremos probar este es el comando que necesitamos.<pre data-lang=sh style=background-color:#2b2c2f;color:#cccece class=language-sh><code class=language-sh data-lang=sh><span style=color:#69c>envsubst </span><span style=color:#5fb3b3>&lt; </span><span style=color:#ec5f67>~</span><span style=color:#69c>/templates/npmrc
</span></code></pre><p>Cuando usamos <code>&lt;</code> lo que estamos haciendo es tomar el contenido del archivo y enviarlo a <code>envsubst</code> usando la entrada estándar. Esto es lo que se conoce como redirección. Entonces, si tenemos todas las variables definidas <code>envsubst</code> nos mostrará el resultado en pantalla.<pre style=background-color:#2b2c2f;color:#cccece><code><span>prefix=/home/user/.config/npm/packages
</span><span>ignore-scripts=true
</span><span>
</span><span>init-author=Heiker (https://github.com/VonHeikemen)
</span><span>init-license=MIT
</span></code></pre><p>Para finalizar queremos tomar todo eso y redirigirlo a <code>~/.npmrc</code>.<pre data-lang=sh style=background-color:#2b2c2f;color:#cccece class=language-sh><code class=language-sh data-lang=sh><span style=color:#69c>envsubst </span><span style=color:#5fb3b3>&lt; </span><span style=color:#ec5f67>~</span><span style=color:#69c>/templates/npmrc </span><span style=color:#5fb3b3>&gt; </span><span style=color:#ec5f67>~</span><span style=color:#69c>/.npmrc
</span></code></pre><p>Técnicamente ya terminamos pero ya que estamos aquí vamos a explorar otra posibilidad.<p>Como demostramos al principio, la cadena de texto puede venir de cualquier comando, el único requisito que tenemos es que debemos enviar el contenido usando la entrada estándar.<p>Si nos ponemos creativos podemos alojar el contenido de la plantilla en cualquier servidor (como github) y descargarlo usando <code>curl</code>.<pre data-lang=sh style=background-color:#2b2c2f;color:#cccece class=language-sh><code class=language-sh data-lang=sh><span style=color:#69c>curl</span><span style=color:#5fb3b3> -</span><span style=color:#f99157>s </span><span style=color:#5fb3b3>&quot;</span><span style=color:#99c794>https://raw.githubusercontent.com/&lt;user&gt;/&lt;repo&gt;/main/npmrc</span><span style=color:#5fb3b3>&quot; \
</span><span>  </span><span style=color:#5fb3b3>| </span><span style=color:#69c>envsubst </span><span style=color:#5fb3b3>&gt; </span><span style=color:#ec5f67>~</span><span style=color:#69c>/.npmrc
</span></code></pre><p>De esta manera ni siquiera necesitamos que la plantilla esté en nuestra máquina.<h2 id=una-alternativa-multi-plataforma>Una alternativa multi-plataforma</h2><p>Si usan linux es muy probable que ya tengan instalada esta herramienta. En caso de que no sea así pueden intentar descargar esta versión que fue creada usando el lenguaje <code>go</code>.<ul><li><a rel=noopener target=_blank href=https://github.com/a8m/envsubst>github.com/a8m/envsubst</a></ul><p>En su <a rel=noopener target=_blank href=https://github.com/a8m/envsubst/releases>página de descarga</a> están disponibles ejecutables para windows, mac y linux.<h2 id=conclusion>Conclusión</h2><p>Aprendimos sobre el comando <code>envsubst</code> y cómo podemos usarlo para crear un archivo de configuración a partir de una plantilla. Vimos que <code>envsubst</code> recibe una cadena de texto usando la entrada estándar, lo que nos permite recibir nuestra "plantilla" desde un archivo o desde otro comando. Por último vimos cómo usar redirecciones para crear un archivo nuevo a partir del resultado de un comando.<h2 id=fuente>Fuente</h2><ul><li><a rel=noopener target=_blank href=https://www.mankier.com/1/envsubst>man envsubst</a></ul><hr><p>Gracias por su tiempo. Si este artículo les pareció útil y quieren apoyar mis esfuerzos para crear más contenido, pueden dejar una propina en buy me a coffee ☕.</p><a href=https://www.buymeacoffee.com/vonheikemen style=display:flex;justify-content:center target=_blank><img src=https://cdn.buymeacoffee.com/buttons/v2/default-blue.png alt="Buy Me A Coffee" style=height:60px!important;width:217px!important></a></div></div>