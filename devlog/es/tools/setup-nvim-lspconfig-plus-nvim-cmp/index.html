<!doctype html><html lang=es><meta http-equiv=x-ua-compatible content="IE=edge"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><meta http-equiv=permissions-policy content="interest-cohort=()"><title>Configurando nvim-lspconfig + nvim-cmp | Devlog</title><link rel=stylesheet href=https://vonheikemen.github.io/devlog/print.css media=print><link rel=stylesheet href=https://vonheikemen.github.io/devlog/styles.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=me href=https://hachyderm.io/@vonheikemen><link rel=me href=https://twitter.com/VonHeikemen_><meta name=keywords content="vim,neovim,shell,software,coding,development"><meta name=description content="Usando nvim-lspconfig y nvim-cmp para configurar el cliente LSP de Neovim"><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a></ul>© 2020-2023 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Configurando nvim-lspconfig + nvim-cmp</h1><span class=post-date>2022-05-21
| 13 minutos
| <a href=https://vonheikemen.github.io/devlog/tools/setup-nvim-lspconfig-plus-nvim-cmp/>Read in english</a></span><blockquote>Última actualización: 2022-10-17</blockquote><p>Dentro de Neovim se encuentra un "framework" que le permite al editor comunicarse con un servidor LSP. ¿Qué significa eso? Quiere decir que, con la configuración correcta, tendremos acceso a funcionalidades como renombrar una variable, saltar a una definición, listar referencias, etc. Características que podrían encontrar en un IDE.<h2 id=por-que-necesitamos-plugins>¿Por qué necesitamos plugins?</h2><p>Por defecto Neovim nos ofrece las herramientas pero no tiene ninguna opinión de cómo debemos usarlas. Es aquí donde entra <a rel=noopener target=_blank href=https://github.com/neovim/nvim-lspconfig>nvim-lspconfig</a>, este plugin escanea la "carpeta raíz" de nuestro proyecto e intenta determinar qué servidor LSP necesitamos. Pero claro, primero debemos tener instalados los servidores en nuestro sistema y luego debemos configurarlos dentro de Neovim.<p>Y luego tenemos <a rel=noopener target=_blank href=https://github.com/hrsh7th/nvim-cmp>nvim-cmp</a>, un plugin de autocompletado. ¿De verdad lo necesitamos? En realidad no. En mi opinión el autocompletado de Neovim es bastante capaz. ¿Cuál es el problema? Digamos que requiere de mucha intervención manual. Los editores de código modernos nos tienen acostumbrados a un flujo donde todo ocurre de manera automática. <code>nvim-cmp</code> nos permite tener ese autocompletado cómodo e inteligente.<p>Ahora que sabemos el porqué de las cosas pongamos manos a la obra.<h2 id=requisitos>Requisitos</h2><ul><li>Neovim v0.8 o mayor. v0.7 también puede funcionar, pero con algunas modificaciones.<li>Un servidor LSP.<li>Instalar <a rel=noopener target=_blank href=https://github.com/neovim/nvim-lspconfig>nvim-lspconfig</a>.<li>Instalar plugins para el autocompletado:<ul><li><a rel=noopener target=_blank href=https://github.com/hrsh7th/nvim-cmp>nvim-cmp</a><li><a rel=noopener target=_blank href=https://github.com/hrsh7th/cmp-buffer>cmp-buffer</a><li><a rel=noopener target=_blank href=https://github.com/hrsh7th/cmp-path>cmp-path</a><li><a rel=noopener target=_blank href=https://github.com/saadparwaiz1/cmp_luasnip>cmp_luasnip</a><li><a rel=noopener target=_blank href=https://github.com/hrsh7th/cmp-nvim-lsp>cmp-nvim-lsp</a><li><a rel=noopener target=_blank href=https://github.com/L3MON4D3/LuaSnip>LuaSnip</a><li><a rel=noopener target=_blank href=https://github.com/rafamadriz/friendly-snippets>friendly-snippets</a></ul></ul><p>En la documentación de <code>nvim-lspconfig</code> pueden encontrar instrucciones de cómo instalar algunos servidores: <a rel=noopener target=_blank href=https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md>server_configurations.md</a><h2 id=configuracion-lsp>Configuración LSP</h2><p>Lo primero que haremos será declarar las "capacidades" que tiene el editor. Normalmente tendríamos que pasar esta configuración manualmente a cada servidor, pero podemos ahorrarnos ese procedimiento si las agregamos directamente a la variable <code>util.default_config</code> de nvim-lspconfig.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#c594c5>local </span><span>lspconfig </span><span style=color:#5fb3b3>= </span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>lspconfig</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#c594c5>local </span><span>lsp_defaults </span><span style=color:#5fb3b3>= </span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>util</span><span style=color:#5fb3b3>.</span><span>default_config
</span><span>
</span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span>capabilities </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>tbl_deep_extend</span><span style=color:#5fb3b3>(
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>force</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>  </span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span style=color:#69c>capabilities</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>cmp_nvim_lsp</span><span style=color:#5fb3b3>&#39;).</span><span style=color:#69c>default_capabilities</span><span style=color:#5fb3b3>()
</span><span style=color:#5fb3b3>)
</span></code></pre><p>Aquí utilizamos <code>vim.tbl_deep_extend</code> para mezclar de manera segura las capacidades que ofrece <code>lspconfig</code> con las capacidades que agrega <code>nvim-cmp</code>.<p>El siguiente paso será llamar los servidores que tenemos instalados en nuestro sistema. Con <code>lspconfig</code> debemos llamar la función <code>.setup()</code> del servidor que queremos configurar.<p>¿Pero cómo sabemos qué servidores tenemos disponibles? En la documentación de <code>lspconfig</code> pueden encontrar la lista completa, pueden navegar a ella usando el comando <code>:help lspconfig-server-configurations</code>.<p>Para en lenguaje <code>lua</code> tenemos disponible el servidor <code>sumneko_lua</code>. Luego de instalarlo en nuestro sistema podemos configurarlo de la siguiente manera.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>sumneko_lua</span><span style=color:#5fb3b3>.</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>({})
</span></code></pre><p>Si necesitan agregar más opciones a un servidor deben agregar propiedades al argumento de <code>.setup()</code>, así.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>sumneko_lua</span><span style=color:#5fb3b3>.</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>({
</span><span style=color:#69c>  </span><span style=color:#99c794>single_file_support </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  </span><span style=color:#99c794>flags </span><span style=color:#5fb3b3>= {
</span><span style=color:#69c>    </span><span style=color:#99c794>debounce_text_changes </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>150</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>})
</span></code></pre><p>Para conocer las opciones disponibles en la función <code>.setup()</code> revisen la documentación con el comando <code>:help lspconfig-setup</code>.<p>Ahora lo más importante, los atajos de teclado. Para esto utilizaremos un autocomando, esto nos dará la libertad de colocar nuestros atajos en cualquier lugar de nuestra configuración.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#69c>nvim_create_autocmd</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>LspAttach</span><span style=color:#5fb3b3>&#39;, {
</span><span style=color:#69c>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>Acciones LSP</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>  callback </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>    </span><span style=color:#c594c5>local </span><span style=color:#69c>bufmap </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>mode</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>lhs</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>rhs</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>local </span><span>opts </span><span style=color:#5fb3b3>= {</span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>}
</span><span style=color:#69c>      </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#69c>set</span><span style=color:#5fb3b3>(</span><span>mode</span><span style=color:#5fb3b3>, </span><span>lhs</span><span style=color:#5fb3b3>, </span><span>rhs</span><span style=color:#5fb3b3>, </span><span>opts</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>    </span><span style=color:#c594c5>end
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Muestra información sobre símbolo debajo del cursor
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>K</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.hover()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Saltar a definición
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>gd</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.definition()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Saltar a declaración
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>gD</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.declaration()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Mostrar implementaciones
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>gi</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.implementation()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Saltar a definición de tipo
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>go</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.type_definition()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Listar referencias
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>gr</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.references()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Mostrar argumentos de función
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;C-k&gt;</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.signature_help()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Renombrar símbolo
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;F2&gt;</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.rename()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Listar &quot;code actions&quot; disponibles en la posición del cursor
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;F4&gt;</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.code_action()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>x</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;F4&gt;</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.lsp.buf.range_code_action()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Mostrar diagnósticos de la línea actual
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>gl</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.diagnostic.open_float()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Saltar al diagnóstico anterior
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>[d</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.diagnostic.goto_prev()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5f6364>-- Saltar al siguiente diagnóstico
</span><span style=color:#69c>    bufmap</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>]d</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>&lt;cmd&gt;lua vim.diagnostic.goto_next()&lt;cr&gt;</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#69c>  </span><span style=color:#c594c5>end
</span><span style=color:#5fb3b3>})
</span></code></pre><p>Con esto nuestros atajos serán creado cada vez que Neovim vincule un servidor LSP a un archivo.<blockquote><p>Nota: si están usando Neovim v0.7.2 o menor, tienen que crear una función y asignarla a la opción <code>on_attach</code> de cada servidor LSP. En la documentación de lspconfig pueden encontrar un ejemplo, ejecuten el comando <code>:help lspconfig-keybindings</code>.</blockquote><p>Para terminar con esta sección aquí tienen la configuración completa para <code>lspconfig</code>.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5f6364>---
</span><span style=color:#5f6364>-- Configuración global
</span><span style=color:#5f6364>---
</span><span>
</span><span style=color:#c594c5>local </span><span>lspconfig </span><span style=color:#5fb3b3>= </span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>lspconfig</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#c594c5>local </span><span>lsp_defaults </span><span style=color:#5fb3b3>= </span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>util</span><span style=color:#5fb3b3>.</span><span>default_config
</span><span>
</span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span>capabilities </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>tbl_deep_extend</span><span style=color:#5fb3b3>(
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>force</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>  </span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span style=color:#69c>capabilities</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>cmp_nvim_lsp</span><span style=color:#5fb3b3>&#39;).</span><span style=color:#69c>default_capabilities</span><span style=color:#5fb3b3>()
</span><span style=color:#5fb3b3>)
</span><span>
</span><span style=color:#5f6364>---
</span><span style=color:#5f6364>-- Servidores LSP
</span><span style=color:#5f6364>---
</span><span>
</span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>sumneko_lua</span><span style=color:#5fb3b3>.</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>({})
</span></code></pre><h2 id=snippets>Snippets</h2><p>Interrumpimos la programación habitual para configurar nuestro motor de snippets. Esta parte no está relacionada con el cliente LSP.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>luasnip.loaders.from_vscode</span><span style=color:#5fb3b3>&#39;).</span><span style=color:#69c>lazy_load</span><span style=color:#5fb3b3>()
</span></code></pre><p>La función <code>.lazy_load()</code> carga las colecciones de snippets que tengamos en el <code>runtimepath</code>. Es aquí cuando se cargan los snippets de <code>friendly-snippets</code>.<h2 id=autocompletado>Autocompletado</h2><p>Para empezar, la documentación de <code>nvim-cmp</code> recomienda que configuremos la <code>completeopt</code> de la siguiente manera.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>opt</span><span style=color:#5fb3b3>.</span><span>completeopt </span><span style=color:#5fb3b3>= {&#39;</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>menuone</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>noselect</span><span style=color:#5fb3b3>&#39;}
</span></code></pre><p>Para configurar nvim-cmp necesitamos dos módulos <code>cmp</code> y <code>luasnip</code>.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#c594c5>local </span><span>cmp </span><span style=color:#5fb3b3>= </span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>cmp</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#c594c5>local </span><span>luasnip </span><span style=color:#5fb3b3>= </span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>luasnip</span><span style=color:#5fb3b3>&#39;)
</span></code></pre><p><code>cmp</code> es el módulo de nvim-cmp. ¿Qué hay de <code>luasnip</code>? Lo que pasa es que nvim-cmp no "sabe" como expandir un snippet, por eso necesitamos luasnip.<p>Vamos a pasar un buen rato configurando nvim-cmp. Quiero explicarles las opciones que yo uso en mi configuración, pero primero vamos a agregar la función <code>cmp.setup</code>.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#c594c5>local </span><span>select_opts </span><span style=color:#5fb3b3>= {</span><span style=color:#99c794>behavior </span><span style=color:#5fb3b3>= </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>SelectBehavior</span><span style=color:#5fb3b3>.</span><span>Select</span><span style=color:#5fb3b3>}
</span><span>
</span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>({
</span><span style=color:#69c>
</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=snippet-expand>snippet.expand</h3><p>Es una función que recibe la información de un snippet. Aquí es donde <code>nvim-cmp</code> nos da la oportunidad de expandir los snippets con el plugin que queramos. En nuestro caso tenemos <code>luasnip</code>.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>snippet </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#69c>expand </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>args</span><span style=color:#5fb3b3>)
</span><span>    luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>lsp_expand</span><span style=color:#5fb3b3>(</span><span>args</span><span style=color:#5fb3b3>.</span><span style=color:#69c>body</span><span style=color:#5fb3b3>)
</span><span>  </span><span style=color:#c594c5>end
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><h3 id=sources>sources</h3><p>Aquí podemos listar los plugins que nvim-cmp usará para obtener datos.<p>Cada "fuente" es una tabla que debe tener la propiedad <code>name</code>, este nombre no se refiere al nombre del plugin sino al nombre con el que se registró la fuente en <code>nvim-cmp</code>. La documentación de cada fuente debería mostrarles este nombre.<p>Otras propiedades que deben tener en cuenta son <code>priority</code> y <code>keyword_length</code>. Con <code>priority</code> podemos elegir el orden en el que aparecen las sugerencias en la lista de autocompletado. Si no se especifica la propiedad <code>priority</code> entonces el orden de las fuentes dicta la prioridad. Con <code>keyword_length</code> se controla la cantidad de caracteres que se necesitan para empezar a ver datos de la fuente.<p>En mi configuración personal tengo las fuentes configuradas de esta manera.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>sources </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>path</span><span style=color:#5fb3b3>&#39;},
</span><span>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>nvim_lsp</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>3</span><span style=color:#5fb3b3>},
</span><span>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>buffer</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>3</span><span style=color:#5fb3b3>},
</span><span>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>luasnip</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>2</span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><ul><li><code>path</code>: Autocompleta rutas de archivos.<li><code>nvim_lsp</code>: Muestra sugerencias basadas en la respuesta de un servidor LSP.<li><code>buffer</code>: Sugiere palabras que se encuentra en el archivo actual.<li><code>luasnip</code>: Muestra los snippets cargados. Si elegimos un snippet lo expande.</ul><h3 id=window-documentation>window.documentation</h3><p>Controla la apariencia de la ventana donde se muestra la documentación de un item. nvim-cmp ofrece una configuración que podemos usar para obtener una ventana con bordes.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>window </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#99c794>documentation </span><span style=color:#5fb3b3>= </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>config</span><span style=color:#5fb3b3>.</span><span>window</span><span style=color:#5fb3b3>.</span><span style=color:#69c>bordered</span><span style=color:#5fb3b3>()
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><h3 id=formatting-fields>formatting.fields</h3><p>Lista que controla el orden en el que aparecen los elementos de un item.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>formatting </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#99c794>fields </span><span style=color:#5fb3b3>= {&#39;</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>abbr</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>kind</span><span style=color:#5fb3b3>&#39;}
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><p><code>abbr</code> es el contenido de la sugerencia. <code>kind</code> es el tipo de dato, puede ser texto, una clase, una función, etc. <code>menu</code> está vacío por defecto.<h3 id=formatting-format>formatting.format</h3><p>Función que determina el formato del item. Un ejemplo simple que puedo mostrarles es cómo asignarle un ícono al "field" <code>menu</code> basado en el nombre de la fuente.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>formatting </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#99c794>fields </span><span style=color:#5fb3b3>= {&#39;</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>abbr</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>kind</span><span style=color:#5fb3b3>&#39;},
</span><span>  </span><span style=color:#69c>format </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>entry</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>item</span><span style=color:#5fb3b3>)
</span><span>    </span><span style=color:#c594c5>local </span><span>menu_icon </span><span style=color:#5fb3b3>= {
</span><span>      </span><span style=color:#99c794>nvim_lsp </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>λ</span><span style=color:#5fb3b3>&#39;,
</span><span>      </span><span style=color:#99c794>luasnip </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>⋗</span><span style=color:#5fb3b3>&#39;,
</span><span>      </span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>Ω</span><span style=color:#5fb3b3>&#39;,
</span><span>      </span><span style=color:#99c794>path </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>🖫</span><span style=color:#5fb3b3>&#39;,
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>
</span><span>    item</span><span style=color:#5fb3b3>.</span><span>menu </span><span style=color:#5fb3b3>= </span><span>menu_icon</span><span style=color:#5fb3b3>[</span><span>entry</span><span style=color:#5fb3b3>.</span><span>source</span><span style=color:#5fb3b3>.</span><span>name</span><span style=color:#5fb3b3>]
</span><span>    </span><span style=color:#c594c5>return </span><span>item
</span><span>  </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><h3 id=mapping>mapping</h3><p>Lista de atajos de teclado. Aquí necesitamos declarar una lista de pares propiedad/valor. Donde el <code>valor</code> será una función del módulo <code>cmp</code>.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>mapping </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;CR&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>confirm</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>select </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>}),
</span><span style=color:#5fb3b3>}
</span></code></pre><p>En este ejemplo <code>['&lt;CR>']</code> es el atajo que queremos crear. La función del otro lado de la asignación es la acción que queremos ejecutar.<p>Estas son algunas acciones comunes:<ul><li>Navegar entre las sugerencias.</ul><pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;Up&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)</span><span>,
</span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;Down&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)</span><span>,
</span><span>
</span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-p&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)</span><span>,
</span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-n&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)</span><span>,
</span></code></pre><ul><li>Desplaza el texto de la ventana de documentación.</ul><pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-u&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>scroll_docs</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>4</span><span style=color:#5fb3b3>)</span><span>,
</span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-f&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>scroll_docs</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>4</span><span style=color:#5fb3b3>)</span><span>,
</span></code></pre><ul><li>Cancelar el autocompletado.</ul><pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-e&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>abort</span><span style=color:#5fb3b3>()</span><span>,
</span></code></pre><ul><li>Confirma la selección.</ul><pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;CR&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>confirm</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>select </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>})</span><span>,
</span></code></pre><ul><li>Salta al próximo placeholder de un snippet.</ul><pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-d&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>  </span><span style=color:#c594c5>if </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>jumpable</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>then
</span><span style=color:#69c>    </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>jump</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>  </span><span style=color:#c594c5>else
</span><span style=color:#69c>    fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {&#39;</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>&#39;})</span><span>,
</span></code></pre><ul><li>Salta al placeholder anterior de un snippet.</ul><pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-b&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>  </span><span style=color:#c594c5>if </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>jumpable</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>then
</span><span style=color:#69c>    </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>jump</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>  </span><span style=color:#c594c5>else
</span><span style=color:#69c>    fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {&#39;</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>&#39;})</span><span>,
</span></code></pre><ul><li>Autocompletado con tab.</ul><p>Si la lista de sugerencias es visible, navega al siguiente item. Si la línea está "vacía", inserta el caracter <code>Tab</code>. Si el cursor está en medio de una palabra, activa el autocompletado.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;Tab&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>  </span><span style=color:#c594c5>local </span><span>col </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>fn</span><span style=color:#5fb3b3>.</span><span style=color:#69c>col</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>&#39;) - </span><span style=color:#f99157>1
</span><span style=color:#69c>
</span><span style=color:#69c>  </span><span style=color:#c594c5>if </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>visible</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>then
</span><span style=color:#69c>    </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>  </span><span style=color:#c594c5>elseif </span><span>col </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>0 </span><span style=color:#5fb3b3>or </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>fn</span><span style=color:#5fb3b3>.</span><span style=color:#69c>getline</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>&#39;):</span><span style=color:#69c>sub</span><span style=color:#5fb3b3>(</span><span>col</span><span style=color:#5fb3b3>, </span><span>col</span><span style=color:#5fb3b3>):</span><span style=color:#69c>match</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>%s</span><span style=color:#5fb3b3>&#39;) </span><span style=color:#c594c5>then
</span><span style=color:#69c>    fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>  </span><span style=color:#c594c5>else
</span><span style=color:#69c>    </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>complete</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {&#39;</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>&#39;})</span><span>,
</span></code></pre><ul><li>Si la lista de sugerencias es visible, navega al item anterior.</ul><pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;S-Tab&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>  </span><span style=color:#c594c5>if </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>visible</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>then
</span><span style=color:#69c>    </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>  </span><span style=color:#c594c5>else
</span><span style=color:#69c>    fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {&#39;</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>&#39;})</span><span>,
</span></code></pre><h3 id=configuracion-cmp>Configuración cmp</h3><p>He aquí el código completo de la configuración de <code>nvim-cmp</code> y <code>luasnip</code>.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>opt</span><span style=color:#5fb3b3>.</span><span>completeopt </span><span style=color:#5fb3b3>= {&#39;</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>menuone</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>noselect</span><span style=color:#5fb3b3>&#39;}
</span><span>
</span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>luasnip.loaders.from_vscode</span><span style=color:#5fb3b3>&#39;).</span><span style=color:#69c>lazy_load</span><span style=color:#5fb3b3>()
</span><span>
</span><span style=color:#c594c5>local </span><span>cmp </span><span style=color:#5fb3b3>= </span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>cmp</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#c594c5>local </span><span>luasnip </span><span style=color:#5fb3b3>= </span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>luasnip</span><span style=color:#5fb3b3>&#39;)
</span><span>
</span><span style=color:#c594c5>local </span><span>select_opts </span><span style=color:#5fb3b3>= {</span><span style=color:#99c794>behavior </span><span style=color:#5fb3b3>= </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>SelectBehavior</span><span style=color:#5fb3b3>.</span><span>Select</span><span style=color:#5fb3b3>}
</span><span>
</span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>({
</span><span style=color:#69c>  </span><span style=color:#99c794>snippet </span><span style=color:#5fb3b3>= {
</span><span style=color:#69c>    expand </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>args</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>lsp_expand</span><span style=color:#5fb3b3>(</span><span>args</span><span style=color:#5fb3b3>.</span><span style=color:#69c>body</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>    </span><span style=color:#c594c5>end
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>},
</span><span style=color:#69c>  </span><span style=color:#99c794>sources </span><span style=color:#5fb3b3>= {
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>path</span><span style=color:#5fb3b3>&#39;},
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>nvim_lsp</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>3</span><span style=color:#5fb3b3>},
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>buffer</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>3</span><span style=color:#5fb3b3>},
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>luasnip</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>2</span><span style=color:#5fb3b3>},
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>},
</span><span style=color:#69c>  </span><span style=color:#99c794>window </span><span style=color:#5fb3b3>= {
</span><span style=color:#69c>    </span><span style=color:#99c794>documentation </span><span style=color:#5fb3b3>= </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>config</span><span style=color:#5fb3b3>.</span><span style=color:#69c>window</span><span style=color:#5fb3b3>.</span><span style=color:#69c>bordered</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>},
</span><span style=color:#69c>  </span><span style=color:#99c794>formatting </span><span style=color:#5fb3b3>= {
</span><span style=color:#69c>    </span><span style=color:#99c794>fields </span><span style=color:#5fb3b3>= {&#39;</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>abbr</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>kind</span><span style=color:#5fb3b3>&#39;},
</span><span style=color:#69c>    format </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>entry</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>item</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>local </span><span>menu_icon </span><span style=color:#5fb3b3>= {
</span><span style=color:#69c>        </span><span style=color:#99c794>nvim_lsp </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>λ</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>        </span><span style=color:#99c794>luasnip </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>⋗</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>        </span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>Ω</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>        </span><span style=color:#99c794>path </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>🖫</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>      </span><span style=color:#5fb3b3>}
</span><span style=color:#69c>
</span><span style=color:#69c>      </span><span>item</span><span style=color:#5fb3b3>.</span><span style=color:#69c>menu </span><span style=color:#5fb3b3>= </span><span>menu_icon</span><span style=color:#5fb3b3>[</span><span>entry</span><span style=color:#5fb3b3>.</span><span style=color:#69c>source</span><span style=color:#5fb3b3>.</span><span style=color:#69c>name</span><span style=color:#5fb3b3>]
</span><span style=color:#69c>      </span><span style=color:#c594c5>return </span><span>item
</span><span style=color:#69c>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>},
</span><span style=color:#69c>  </span><span style=color:#99c794>mapping </span><span style=color:#5fb3b3>= {
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;Up&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>),
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;Down&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>),
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-p&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>),
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-n&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>),
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-u&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>scroll_docs</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>4</span><span style=color:#5fb3b3>),
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-f&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>scroll_docs</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>4</span><span style=color:#5fb3b3>),
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-e&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>abort</span><span style=color:#5fb3b3>(),
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;CR&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#69c>confirm</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>select </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>}),
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-d&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>if </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>jumpable</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>then
</span><span style=color:#69c>        </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>jump</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>else
</span><span style=color:#69c>        fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>      </span><span style=color:#c594c5>end
</span><span style=color:#69c>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {&#39;</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>&#39;}),
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;C-b&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>if </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>jumpable</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>then
</span><span style=color:#69c>        </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#69c>jump</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>else
</span><span style=color:#69c>        fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>      </span><span style=color:#c594c5>end
</span><span style=color:#69c>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {&#39;</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>&#39;}),
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;Tab&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>local </span><span>col </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>fn</span><span style=color:#5fb3b3>.</span><span style=color:#69c>col</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>&#39;) - </span><span style=color:#f99157>1
</span><span style=color:#69c>
</span><span style=color:#69c>      </span><span style=color:#c594c5>if </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>visible</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>then
</span><span style=color:#69c>        </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>elseif </span><span>col </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>0 </span><span style=color:#5fb3b3>or </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>fn</span><span style=color:#5fb3b3>.</span><span style=color:#69c>getline</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>&#39;):</span><span style=color:#69c>sub</span><span style=color:#5fb3b3>(</span><span>col</span><span style=color:#5fb3b3>, </span><span>col</span><span style=color:#5fb3b3>):</span><span style=color:#69c>match</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>%s</span><span style=color:#5fb3b3>&#39;) </span><span style=color:#c594c5>then
</span><span style=color:#69c>        fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>      </span><span style=color:#c594c5>else
</span><span style=color:#69c>        </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>complete</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>      </span><span style=color:#c594c5>end
</span><span style=color:#69c>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {&#39;</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>&#39;}),
</span><span style=color:#69c>
</span><span style=color:#69c>    </span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>&lt;S-Tab&gt;</span><span style=color:#5fb3b3>&#39;] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>if </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>visible</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>then
</span><span style=color:#69c>        </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)
</span><span style=color:#69c>      </span><span style=color:#c594c5>else
</span><span style=color:#69c>        fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>      </span><span style=color:#c594c5>end
</span><span style=color:#69c>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {&#39;</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>&#39;}),
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>})
</span></code></pre><h2 id=contenido-extra>Contenido extra</h2><p>Técnicamente ya están listos. Si agregaron todo el código que les mostré en su configuración ya deben tener el servidor LSP y el autocompletado funcionando. Pero aún cosas que podemos hacer para mejorar nuestra experiencia.<h3 id=personalizando-los-iconos-de-diagnostico>Personalizando los íconos de diagnóstico</h3><p>Esto lo logramos con la función <code>sign_define</code>. Esta no es una función de lua, es de vimscript, quiere decir que accedemos a ella usando el prefijo <code>vim.fn</code>. Para saber los detalles de esta función usen el comando <code>:help sign_define</code>.<p>En fin, con esto podremos cambiar los "signos de diagnóstico".<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#c594c5>local </span><span style=color:#69c>sign </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>opts</span><span style=color:#5fb3b3>)
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>fn</span><span style=color:#5fb3b3>.</span><span style=color:#69c>sign_define</span><span style=color:#5fb3b3>(</span><span>opts</span><span style=color:#5fb3b3>.</span><span style=color:#69c>name</span><span style=color:#5fb3b3>, {
</span><span style=color:#69c>    </span><span style=color:#99c794>texthl </span><span style=color:#5fb3b3>= </span><span>opts</span><span style=color:#5fb3b3>.</span><span style=color:#69c>name</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>    </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= </span><span>opts</span><span style=color:#5fb3b3>.</span><span style=color:#69c>text</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>    </span><span style=color:#99c794>numhl </span><span style=color:#5fb3b3>= &#39;&#39;
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>})
</span><span style=color:#c594c5>end
</span><span>
</span><span style=color:#69c>sign</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>DiagnosticSignError</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>✘</span><span style=color:#5fb3b3>&#39;})
</span><span style=color:#69c>sign</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>DiagnosticSignWarn</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>▲</span><span style=color:#5fb3b3>&#39;})
</span><span style=color:#69c>sign</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>DiagnosticSignHint</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>⚑</span><span style=color:#5fb3b3>&#39;})
</span><span style=color:#69c>sign</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>DiagnosticSignInfo</span><span style=color:#5fb3b3>&#39;, </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794></span><span style=color:#5fb3b3>&#39;})
</span></code></pre><h3 id=configuracion-global-de-diagnosticos>Configuración global de diagnósticos</h3><p>Para esto debemos usar el módulo <code>vim.diagnostic</code>, específicamente la función <code>.config()</code>. Esta función acepta una tabla como argumento, estas son sus propiedades.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#5fb3b3>{
</span><span>  </span><span style=color:#99c794>virtual_text </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>signs </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>update_in_insert </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>underline </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>severity_sort </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>float </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>}
</span></code></pre><ul><li><p><code>virtual_text</code>: Muestra mensaje de diagnóstico con un "texto virtual" al final de la línea.<li><p><code>signs</code>: Mostrar un "signo" en la línea donde hay un diagnóstico presente.<li><p><code>update_in_insert</code>: Actualizar los diagnósticos mientras se edita el documento en modo de inserción.<li><p><code>underline</code>: Subrayar la localización de un diagnóstico.<li><p><code>severity_sort</code>: Ordenar los diagnósticos de acuerdo a su prioridad.<li><p><code>float</code>: Habilitar ventanas flotantes para mostrar los mensajes de diagnósticos.</ul><p>Cada una estas opciones aceptar una tabla de opciones para personalizar aún más su comportamiento. Pueden encontrar todos esos detalles en la documentación: <code>:help vim.diagnostic.config()</code>.<p>Personalmente prefiero diagnósticos menos llamativos. Uso esta configuración.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#69c>config</span><span style=color:#5fb3b3>({
</span><span style=color:#69c>  </span><span style=color:#99c794>virtual_text </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  </span><span style=color:#99c794>severity_sort </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  </span><span style=color:#99c794>float </span><span style=color:#5fb3b3>= {
</span><span style=color:#69c>    </span><span style=color:#99c794>border </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>rounded</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>    </span><span style=color:#99c794>source </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>always</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>    </span><span style=color:#99c794>header </span><span style=color:#5fb3b3>= &#39;&#39;,
</span><span style=color:#69c>    </span><span style=color:#99c794>prefix </span><span style=color:#5fb3b3>= &#39;&#39;,
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=bordes-en-ventanas-de-ayuda>Bordes en ventanas de ayuda</h3><p>Hay dos métodos que muestran ventanas flotantes con información: <code>vim.lsp.buf.hover()</code> y <code>vim.lsp.buf.signature_help()</code>. Por defecto estas ventanas no tienen ningún estilo, pero podemos cambiar eso si modificamos la configuración del "handler" asociado a estas funciones. Para estos casos tenemos que usar <code>vim.lsp.with()</code>.<p>No quiero aburrirlos con los detalles así que aquí les dejo el código.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span>handlers</span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>textDocument/hover</span><span style=color:#5fb3b3>&#39;] = </span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>with</span><span style=color:#5fb3b3>(
</span><span style=color:#69c>  </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>handlers</span><span style=color:#5fb3b3>.</span><span style=color:#69c>hover</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>border </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>rounded</span><span style=color:#5fb3b3>&#39;}
</span><span style=color:#5fb3b3>)
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span>handlers</span><span style=color:#5fb3b3>[&#39;</span><span style=color:#99c794>textDocument/signatureHelp</span><span style=color:#5fb3b3>&#39;] = </span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>with</span><span style=color:#5fb3b3>(
</span><span style=color:#69c>  </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#69c>handlers</span><span style=color:#5fb3b3>.</span><span style=color:#69c>signature_help</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>border </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>rounded</span><span style=color:#5fb3b3>&#39;}
</span><span style=color:#5fb3b3>)
</span></code></pre><h3 id=instalar-servidores-lsp-de-manera-local>Instalar servidores LSP de manera "local"</h3><p>Tarde o temprano se van a encontrar con este plugin: <a rel=noopener target=_blank href=https://github.com/williamboman/mason.nvim>mason.nvim</a>. Esto les permite manejar completamente sus servidores LSP dentro de Neovim. Podrán instalar, actualizar y eliminar servidores usando Neovim.<p>Los servidores que instalen con este método no estarán disponibles de manera global, se instalarán en la carpeta "data" de Neovim. Ahora bien, algunos servidores al ser instalados con este método requieren de configuraciones extra, es por eso que también necesitamos usar <a rel=noopener target=_blank href=https://github.com/williamboman/mason-lspconfig.nvim>mason-lspconfig</a>.<p>Una vez que tengan todos los plugins necesarios deben configurar mason.nvim de esta manera.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>mason</span><span style=color:#5fb3b3>&#39;).</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>mason-lspconfig</span><span style=color:#5fb3b3>&#39;).</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>()
</span></code></pre><p>Después de invocar estas funciones pueden usar <code>lspconfig</code> como si nada. Pueden fingir que mason.nvim no existe.<p>Aquí les dejo un ejemplo de uso.<pre data-lang=lua style=background-color:#2b2c2f;color:#cccece class=language-lua><code class=language-lua data-lang=lua><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>mason</span><span style=color:#5fb3b3>&#39;).</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>()
</span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>mason-lspconfig</span><span style=color:#5fb3b3>&#39;).</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>()
</span><span>
</span><span style=color:#c594c5>local </span><span>lspconfig </span><span style=color:#5fb3b3>= </span><span style=color:#69c>require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>lspconfig</span><span style=color:#5fb3b3>&#39;)
</span><span style=color:#c594c5>local </span><span>lsp_defaults </span><span style=color:#5fb3b3>= </span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>util</span><span style=color:#5fb3b3>.</span><span>default_config
</span><span>
</span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span>capabilities </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#69c>tbl_deep_extend</span><span style=color:#5fb3b3>(
</span><span style=color:#69c>  </span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>force</span><span style=color:#5fb3b3>&#39;,
</span><span style=color:#69c>  </span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span style=color:#69c>capabilities</span><span style=color:#5fb3b3>,
</span><span style=color:#69c>  require</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>cmp_nvim_lsp</span><span style=color:#5fb3b3>&#39;).</span><span style=color:#69c>default_capabilities</span><span style=color:#5fb3b3>()
</span><span style=color:#5fb3b3>)
</span><span>
</span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>sumneko_lua</span><span style=color:#5fb3b3>.</span><span style=color:#69c>setup</span><span style=color:#5fb3b3>({})
</span></code></pre><p>En está ocasión es todo lo que voy a decir sobre <code>mason.nvim</code>. Si quieren saber más detalles deben revisar su documentación.<h2 id=conclusion>Conclusión</h2><p>Han aprendido porque necesitamos nvim-lspconfig. Saben cómo crear una configuración global para todos sus servidores. Conocen las funciones más comúnes para sus atajos de teclado. Todo lo necesario para aprovechar las bondades que puede darles un servidor LSP.<p>Tuvimos la oportunidad de armar una configuración de <code>nvim-cmp</code> desde cero. Explorando paso a paso las opciones más utilizadas.<p>Finalmente vimos algunas opciones que nos permiten modificar la presentación de los diagnósticos (mensajes de error, advertencia, etc). Aprendimos a modificar los handlers que muestran ventanas flotantes. Y, dimos un vistazo a un método para instalar servidores de manera local.<p>Pueden encontrar todo el código de configuración aquí: <a rel=noopener target=_blank href=https://gist.github.com/VonHeikemen/8fc2aa6da030757a5612393d0ae060bd>nvim-lspconfig + nvim-cmp</a>.<p>Y aquí les dejo una configuración de Neovim completamente funcional: <a rel=noopener target=_blank href=https://github.com/VonHeikemen/nvim-starter/tree/03-lsp>nvim-starter - branch: 03-lsp</a>.<h2 id=fuentes>Fuentes</h2><ul><li><a rel=noopener target=_blank href=https://neovim.io/doc/user/lsp.html>:help lsp.txt</a><li><a rel=noopener target=_blank href=https://github.com/neovim/nvim-lspconfig/blob/9e6bcf5a8915e8423d5cc7f82c5069c11272184d/doc/lspconfig.txt#L240>:help lspconfig-global-defaults</a><li><a rel=noopener target=_blank href=https://github.com/neovim/nvim-lspconfig/blob/9e6bcf5a8915e8423d5cc7f82c5069c11272184d/doc/lspconfig.txt#L481>:help lspconfig-keybindings</a><li><a rel=noopener target=_blank href=https://github.com/hrsh7th/nvim-cmp/blob/6e1e3865158f340d6cd3936937eb56947b5a90f9/doc/cmp.txt#L360>:help cmp-config</a><li><a rel=noopener target=_blank href=https://github.com/hrsh7th/nvim-cmp/blob/6e1e3865158f340d6cd3936937eb56947b5a90f9/doc/cmp.txt#L227>:help cmp-mapping</a><li><a rel=noopener target=_blank href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.config()>:help vim.diagnostic.config()</a></ul><hr><p>¿Tienen alguna pregunta? Pueden dejar un comentario
en cualquiera de estas plataformas:<ul><li><a rel=noopener target=_blank href=https://dev.to/vonheikemen/neovim-lsp-configurando-nvim-lspconfig-nvim-cmp-1m2g>dev.to</a><li><a rel=noopener target=_blank href=https://vonheikemen.hashnode.dev/setup-nvim-lspconfig-nvim-cmp-es>Hashnode</a></ul><p>Pueden contactarme por las redes sociales:<ul><li>Twitter <a rel="noopener me" target=_blank href=https://twitter.com/VonHeikemen_>@VonHeikemen_</a><li>Mastodon <a rel="noopener me" target=_blank href=https://hachyderm.io/@vonheikemen>@vonheikemen@hachyderm.io</a></ul><p>Gracias por su tiempo. Si este artículo les pareció útil y quieren apoyar mis esfuerzos para crear más contenido, pueden dejar una propina en buy me a coffee ☕.</p><a href=https://www.buymeacoffee.com/vonheikemen style=display:flex;justify-content:center target=_blank><img src=https://cdn.buymeacoffee.com/buttons/v2/default-blue.png alt="Buy Me A Coffee" style=height:60px!important;width:217px!important></a></div></div>