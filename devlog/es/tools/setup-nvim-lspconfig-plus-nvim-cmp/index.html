<!doctype html><html lang=es><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Configurando nvim-lspconfig + nvim-cmp | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="vim, neovim, shell, software, coding, development" name=keywords><meta content="Usando nvim-lspconfig y nvim-cmp para configurar el cliente LSP de Neovim" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> ¬© 2020-2026 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Configurando nvim-lspconfig + nvim-cmp</h1><span class=post-date>2022-05-21 | 9 minutos | <a href=https://vonheikemen.github.io/devlog/tools/setup-nvim-lspconfig-plus-nvim-cmp/> Read in english </a> </span><blockquote>√öltima actualizaci√≥n: 2024-10-05</blockquote><p>Dentro de Neovim se encuentra un "framework" que le permite al editor comunicarse con un servidor LSP. ¬øQu√© significa eso? Quiere decir que, con la configuraci√≥n correcta, tendremos acceso a funcionalidades como renombrar una variable, saltar a una definici√≥n, listar referencias, etc. Caracter√≠sticas que podr√≠an encontrar en un IDE.<h2 id=por-que-necesitamos-plugins>¬øPor qu√© necesitamos plugins?</h2><p>Por defecto Neovim nos ofrece las herramientas pero no tiene ninguna opini√≥n de c√≥mo debemos usarlas. Es aqu√≠ donde entra <a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig target=_blank>nvim-lspconfig</a>, este plugin escanea la "carpeta ra√≠z" de nuestro proyecto e intenta determinar qu√© servidor LSP necesitamos. Pero claro, primero debemos tener instalados los servidores en nuestro sistema y luego debemos configurarlos dentro de Neovim.<p>Y luego tenemos <a rel="noopener external" href=https://github.com/hrsh7th/nvim-cmp target=_blank>nvim-cmp</a>, un plugin de autocompletado. ¬øDe verdad lo necesitamos? En realidad no. En mi opini√≥n el autocompletado de Neovim es bastante capaz. ¬øCu√°l es el problema? Digamos que requiere de mucha intervenci√≥n manual. Los editores de c√≥digo modernos nos tienen acostumbrados a un flujo donde todo ocurre de manera autom√°tica. <code>nvim-cmp</code> nos permite tener ese autocompletado c√≥modo e inteligente.<p>Ahora que sabemos el porqu√© de las cosas pongamos manos a la obra.<h2 id=requisitos>Requisitos</h2><ul><li>Neovim v0.8 o mayor. v0.7 tambi√©n puede funcionar, pero con algunas modificaciones.<li>Un servidor LSP.<li>Instalar <a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig target=_blank>nvim-lspconfig</a>.<li>Instalar plugins para el autocompletado: <ul><li><a rel="noopener external" href=https://github.com/hrsh7th/nvim-cmp target=_blank>nvim-cmp</a><li><a rel="noopener external" href=https://github.com/hrsh7th/cmp-buffer target=_blank>cmp-buffer</a><li><a rel="noopener external" href=https://github.com/hrsh7th/cmp-path target=_blank>cmp-path</a><li><a rel="noopener external" href=https://github.com/saadparwaiz1/cmp_luasnip target=_blank>cmp_luasnip</a><li><a rel="noopener external" href=https://github.com/hrsh7th/cmp-nvim-lsp target=_blank>cmp-nvim-lsp</a><li><a rel="noopener external" href=https://github.com/L3MON4D3/LuaSnip target=_blank>LuaSnip</a><li><a rel="noopener external" href=https://github.com/rafamadriz/friendly-snippets target=_blank>friendly-snippets</a></ul></ul><p>En la documentaci√≥n de <code>nvim-lspconfig</code> pueden encontrar instrucciones de c√≥mo instalar algunos servidores: <a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig/blob/master/doc/configs.md target=_blank>configs.md</a><h2 id=configuracion-lsp>Configuraci√≥n LSP</h2><p>Lo que necesitamos hacer es llamar los servidores que tenemos instalados en nuestro sistema. Usamos <code>lspconfig</code> para llamar la funci√≥n <code>.setup()</code> del servidor que queremos configurar.<p>¬øPero c√≥mo sabemos qu√© servidores tenemos disponibles? En la documentaci√≥n de <code>lspconfig</code> pueden encontrar la lista completa, pueden navegar a ella usando el comando <code>:help lspconfig-server-configurations</code>.<p>Por ejemplo, para el lenguaje <code>lua</code> tenemos disponible el servidor <code>lua_ls</code>. Luego de instalarlo en nuestro sistema podemos configurarlo de la siguiente manera.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local lspconfig</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'lspconfig'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>lspconfig.lua_ls.</span><span style=color:#7e9cd8>setup</span><span>({})</span></span></code></pre><p>Ahora bien, al momento de configurar un servidor deben tener en cuenta que vamos a usar nvim-cmp para manejar el autocompletado. Debemos modificar una opci√≥n llamada <code>capabilities</code> en cada servidor que queremos usar. Esta opci√≥n le dice al servidor qu√© capacidades del protocolo LSP soporta Neovim.<p>Tenemos que utilizar el m√≥dulo <code>cmp_nvim_lsp</code> para obtener los valores apropiados para la opci√≥n <code>capabilities</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local lsp_capabilities</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp_nvim_lsp'</span><span>).</span><span style=color:#7e9cd8>default_capabilities</span><span>()</span></span></code></pre><p>Una vez que tenemos la variable <code>lsp_capabilities</code> podemos utilizarla en la funci√≥n <code>.setup()</code> del servidor.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local lspconfig</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'lspconfig'</span><span>)</span></span>
<span class=giallo-l><span>local lsp_capabilities</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp_nvim_lsp'</span><span>).</span><span style=color:#7e9cd8>default_capabilities</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>lspconfig.lua_ls.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l><span>  capabilities</span><span style=color:#e6c384> =</span><span> lsp_capabilities,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>Para conocer las opciones disponibles de <code>.setup()</code> revisen la documentaci√≥n con el comando <code>:help lspconfig-setup</code>.<p>Ahora lo m√°s importante, los atajos de teclado. Para esto utilizaremos un autocomando, esto nos dar√° la libertad de colocar nuestros atajos en cualquier lugar de nuestra configuraci√≥n.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.api.</span><span style=color:#7e9cd8>nvim_create_autocmd</span><span>(</span><span style=color:#98bb6c>'LspAttach'</span><span>, {</span></span>
<span class=giallo-l><span>  desc</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Acciones LSP'</span><span>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  callback</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>()</span></span>
<span class=giallo-l><span>    local</span><span style=color:#7e9cd8> bufmap</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>mode</span><span style=color:#9cabca>,</span><span> lhs</span><span style=color:#9cabca>,</span><span> rhs</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      local opts</span><span style=color:#e6c384> =</span><span> {buffer</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>}</span></span>
<span class=giallo-l><span>      vim.keymap.</span><span style=color:#7e9cd8>set</span><span>(mode, lhs, rhs, opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Muestra informaci√≥n sobre s√≠mbolo debajo del cursor</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'K'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.hover()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar a definici√≥n</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gd'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.definition()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar a declaraci√≥n</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gD'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.declaration()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Mostrar implementaciones</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gi'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.implementation()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar a definici√≥n de tipo</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'go'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.type_definition()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Listar referencias</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gr'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.references()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Mostrar argumentos de funci√≥n</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gs'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.signature_help()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Renombrar s√≠mbolo</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;F2>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.rename()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Listar "code actions" disponibles en la posici√≥n del cursor</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'&lt;F4>'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.lsp.buf.code_action()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Mostrar diagn√≥sticos de la l√≠nea actual</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'gl'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.open_float()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar al diagn√≥stico anterior</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>'[d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.goto_prev()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    -- Saltar al siguiente diagn√≥stico</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    bufmap</span><span>(</span><span style=color:#98bb6c>'n'</span><span>, </span><span style=color:#98bb6c>']d'</span><span>, </span><span style=color:#98bb6c>'&lt;cmd>lua vim.diagnostic.goto_next()&lt;cr>'</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>Con esto nuestros atajos ser√°n creado cada vez que Neovim vincule un servidor LSP a un archivo.<blockquote><p>Nota: si est√°n usando Neovim v0.7.2 o menor, tienen que crear una funci√≥n y asignarla a la opci√≥n <code>on_attach</code> de cada servidor LSP. En la documentaci√≥n de lspconfig pueden encontrar un ejemplo, ejecuten el comando <code>:help lspconfig-keybindings</code>.</blockquote><p>Para terminar con esta secci√≥n aqu√≠ tienen el c√≥digo necesario para configurar un servidor usando <code>lspconfig</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local lspconfig</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'lspconfig'</span><span>)</span></span>
<span class=giallo-l><span>local lsp_capabilities</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp_nvim_lsp'</span><span>).</span><span style=color:#7e9cd8>default_capabilities</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>lspconfig.lua_ls.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l><span>  capabilities</span><span style=color:#e6c384> =</span><span> lsp_capabilities,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h2 id=snippets>Snippets</h2><p>Interrumpimos la programaci√≥n habitual para configurar nuestro motor de snippets. Esta parte no est√° relacionada con el cliente LSP.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'luasnip.loaders.from_vscode'</span><span>).</span><span style=color:#7e9cd8>lazy_load</span><span>()</span></span></code></pre><p>La funci√≥n <code>.lazy_load()</code> carga las colecciones de snippets que tengamos en el <code>runtimepath</code>. Es aqu√≠ cuando se cargan los snippets de <code>friendly-snippets</code>.<h2 id=autocompletado>Autocompletado</h2><p>Para empezar, la documentaci√≥n de <code>nvim-cmp</code> recomienda que configuremos la <code>completeopt</code> de la siguiente manera.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.opt.completeopt</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'menuone'</span><span>, </span><span style=color:#98bb6c>'noselect'</span><span>}</span></span></code></pre><p>Para configurar nvim-cmp necesitamos dos m√≥dulos <code>cmp</code> y <code>luasnip</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local cmp</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp'</span><span>)</span></span>
<span class=giallo-l><span>local luasnip</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'luasnip'</span><span>)</span></span></code></pre><p><code>cmp</code> es el m√≥dulo de nvim-cmp. ¬øQu√© hay de <code>luasnip</code>? Lo que pasa es que nvim-cmp no "sabe" como expandir un snippet, por eso necesitamos luasnip.<p>Vamos a pasar un buen rato configurando nvim-cmp. Quiero explicarles las opciones que yo uso en mi configuraci√≥n, pero primero vamos a agregar la funci√≥n <code>cmp.setup</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local select_opts</span><span style=color:#e6c384> =</span><span> {behavior</span><span style=color:#e6c384> =</span><span> cmp.SelectBehavior.Select}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>cmp.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>})</span></span></code></pre><h3 id=snippet-expand>snippet.expand</h3><p>Es una funci√≥n que recibe la informaci√≥n de un snippet. Aqu√≠ es donde <code>nvim-cmp</code> nos da la oportunidad de expandir los snippets con el plugin que queramos. En nuestro caso tenemos <code>luasnip</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>snippet</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  expand</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>args</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    luasnip.</span><span style=color:#7e9cd8>lsp_expand</span><span>(args.body)</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span>},</span></span></code></pre><h3 id=sources>sources</h3><p>Aqu√≠ podemos listar los plugins que nvim-cmp usar√° para obtener datos.<p>Cada "fuente" es una tabla que debe tener la propiedad <code>name</code>, este nombre no se refiere al nombre del plugin sino al nombre con el que se registr√≥ la fuente en <code>nvim-cmp</code>. La documentaci√≥n de cada fuente deber√≠a mostrarles este nombre.<p>Otras propiedades que deben tener en cuenta son <code>priority</code> y <code>keyword_length</code>. Con <code>priority</code> podemos elegir el orden en el que aparecen las sugerencias en la lista de autocompletado. Si no se especifica la propiedad <code>priority</code> entonces el orden de las fuentes dicta la prioridad. Con <code>keyword_length</code> se controla la cantidad de caracteres que se necesitan para empezar a ver datos de la fuente.<p>En mi configuraci√≥n personal tengo las fuentes configuradas de esta manera.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>sources</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'path'</span><span>},</span></span>
<span class=giallo-l><span>  {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'nvim_lsp'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 1</span><span>},</span></span>
<span class=giallo-l><span>  {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'buffer'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 3</span><span>},</span></span>
<span class=giallo-l><span>  {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'luasnip'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 2</span><span>},</span></span>
<span class=giallo-l><span>},</span></span></code></pre><ul><li><code>path</code>: Autocompleta rutas de archivos.<li><code>nvim_lsp</code>: Muestra sugerencias basadas en la respuesta de un servidor LSP.<li><code>buffer</code>: Sugiere palabras que se encuentra en el archivo actual.<li><code>luasnip</code>: Muestra los snippets cargados. Si elegimos un snippet lo expande.</ul><h3 id=window-documentation>window.documentation</h3><p>Controla la apariencia de la ventana donde se muestra la documentaci√≥n de un item. nvim-cmp ofrece una configuraci√≥n que podemos usar para obtener una ventana con bordes.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>window</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  documentation</span><span style=color:#e6c384> =</span><span> cmp.config.window.</span><span style=color:#7e9cd8>bordered</span><span>()</span></span>
<span class=giallo-l><span>},</span></span></code></pre><h3 id=formatting-fields>formatting.fields</h3><p>Lista que controla el orden en el que aparecen los elementos de un item.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>formatting</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  fields</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'abbr'</span><span>, </span><span style=color:#98bb6c>'kind'</span><span>}</span></span>
<span class=giallo-l><span>},</span></span></code></pre><p><code>abbr</code> es el contenido de la sugerencia. <code>kind</code> es el tipo de dato, puede ser texto, una clase, una funci√≥n, etc. <code>menu</code> est√° vac√≠o por defecto.<h3 id=formatting-format>formatting.format</h3><p>Funci√≥n que determina el formato del item. Un ejemplo simple que puedo mostrarles es c√≥mo asignarle un √≠cono al "field" <code>menu</code> basado en el nombre de la fuente.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>formatting</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  fields</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'abbr'</span><span>, </span><span style=color:#98bb6c>'kind'</span><span>},</span></span>
<span class=giallo-l><span style=color:#7e9cd8>  format</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>entry</span><span style=color:#9cabca>,</span><span> item</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>    local menu_icon</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>      nvim_lsp</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Œª'</span><span>,</span></span>
<span class=giallo-l><span>      luasnip</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '‚ãó'</span><span>,</span></span>
<span class=giallo-l><span>      buffer</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Œ©'</span><span>,</span></span>
<span class=giallo-l><span>      path</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'üñ´'</span><span>,</span></span>
<span class=giallo-l><span>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    item.menu</span><span style=color:#e6c384> =</span><span> menu_icon[entry.source.name]</span></span>
<span class=giallo-l><span style=color:#957fb8>    return</span><span> item</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span><span>,</span></span>
<span class=giallo-l><span>},</span></span></code></pre><h3 id=mapping>mapping</h3><p>Lista de atajos de teclado. Aqu√≠ necesitamos declarar una lista de pares propiedad/valor. Donde el <code>valor</code> ser√° una funci√≥n del m√≥dulo <code>cmp</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>mapping</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>  [</span><span style=color:#98bb6c>'&lt;CR>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>}),</span></span>
<span class=giallo-l><span>}</span></span></code></pre><p>En este ejemplo <code>['&lt;CR>']</code> es el atajo que queremos crear. La funci√≥n del otro lado de la asignaci√≥n es la acci√≥n que queremos ejecutar.<p>Estas son algunas acciones comunes:<ul><li>Navegar entre las sugerencias.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;Up>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts),</span></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;Down>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-p>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts),</span></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-n>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts),</span></span></code></pre><ul><li>Desplaza el texto de la ventana de documentaci√≥n.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-u>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>scroll_docs</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>4</span><span>),</span></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-d>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>scroll_docs</span><span>(</span><span style=color:#d27e99>4</span><span>),</span></span></code></pre><ul><li>Cancelar el autocompletado.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-e>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>abort</span><span>(),</span></span></code></pre><ul><li>Confirma la selecci√≥n.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-y>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>}),</span></span>
<span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;CR>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>}),</span></span></code></pre><ul><li>Salta al pr√≥ximo placeholder de un snippet.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-f>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> luasnip.</span><span style=color:#7e9cd8>jumpable</span><span>(</span><span style=color:#d27e99>1</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>    luasnip.</span><span style=color:#7e9cd8>jump</span><span>(</span><span style=color:#d27e99>1</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span></code></pre><ul><li>Salta al placeholder anterior de un snippet.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;C-b>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> luasnip.</span><span style=color:#7e9cd8>jumpable</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>1</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>    luasnip.</span><span style=color:#7e9cd8>jump</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>1</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span></code></pre><ul><li>Autocompletado con tab.</ul><p>Si la lista de sugerencias es visible, navega al siguiente item. Si la l√≠nea est√° "vac√≠a", inserta el caracter <code>Tab</code>. Si el cursor est√° en medio de una palabra, activa el autocompletado.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;Tab>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>  local col</span><span style=color:#e6c384> =</span><span> vim.fn.</span><span style=color:#7e9cd8>col</span><span>(</span><span style=color:#98bb6c>'.'</span><span>) </span><span style=color:#e6c384>-</span><span style=color:#d27e99> 1</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> cmp.</span><span style=color:#7e9cd8>visible</span><span>() </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>    cmp.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>  elseif</span><span> col</span><span style=color:#e6c384> ==</span><span style=color:#d27e99> 0</span><span style=color:#e6c384> or</span><span> vim.fn.</span><span style=color:#7e9cd8>getline</span><span>(</span><span style=color:#98bb6c>'.'</span><span>):</span><span style=color:#7e9cd8>sub</span><span>(col, col):</span><span style=color:#7e9cd8>match</span><span>(</span><span style=color:#98bb6c>'%s'</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  else</span></span>
<span class=giallo-l><span>    cmp.</span><span style=color:#7e9cd8>complete</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span></code></pre><ul><li>Si la lista de sugerencias es visible, navega al item anterior.</ul><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>[</span><span style=color:#98bb6c>'&lt;S-Tab>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>  if</span><span> cmp.</span><span style=color:#7e9cd8>visible</span><span>() </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>    cmp.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>  else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>  end</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span></code></pre><h3 id=configuracion-cmp>Configuraci√≥n cmp</h3><p>He aqu√≠ el c√≥digo completo de la configuraci√≥n de <code>nvim-cmp</code> y <code>luasnip</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.opt.completeopt</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'menuone'</span><span>, </span><span style=color:#98bb6c>'noselect'</span><span>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'luasnip.loaders.from_vscode'</span><span>).</span><span style=color:#7e9cd8>lazy_load</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local cmp</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp'</span><span>)</span></span>
<span class=giallo-l><span>local luasnip</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'luasnip'</span><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local select_opts</span><span style=color:#e6c384> =</span><span> {behavior</span><span style=color:#e6c384> =</span><span> cmp.SelectBehavior.Select}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>cmp.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l><span>  snippet</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    expand</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>args</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      luasnip.</span><span style=color:#7e9cd8>lsp_expand</span><span>(args.body)</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>  sources</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'path'</span><span>},</span></span>
<span class=giallo-l><span>    {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'nvim_lsp'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 1</span><span>},</span></span>
<span class=giallo-l><span>    {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'buffer'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 3</span><span>},</span></span>
<span class=giallo-l><span>    {name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'luasnip'</span><span>, keyword_length</span><span style=color:#e6c384> =</span><span style=color:#d27e99> 2</span><span>},</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>  window</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    documentation</span><span style=color:#e6c384> =</span><span> cmp.config.window.</span><span style=color:#7e9cd8>bordered</span><span>()</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>  formatting</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    fields</span><span style=color:#e6c384> =</span><span> {</span><span style=color:#98bb6c>'menu'</span><span>, </span><span style=color:#98bb6c>'abbr'</span><span>, </span><span style=color:#98bb6c>'kind'</span><span>},</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    format</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>entry</span><span style=color:#9cabca>,</span><span> item</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      local menu_icon</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>        nvim_lsp</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Œª'</span><span>,</span></span>
<span class=giallo-l><span>        luasnip</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '‚ãó'</span><span>,</span></span>
<span class=giallo-l><span>        buffer</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'Œ©'</span><span>,</span></span>
<span class=giallo-l><span>        path</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'üñ´'</span><span>,</span></span>
<span class=giallo-l><span>      }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>      item.menu</span><span style=color:#e6c384> =</span><span> menu_icon[entry.source.name]</span></span>
<span class=giallo-l><span style=color:#957fb8>      return</span><span> item</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>,</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>  mapping</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;Up>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;Down>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-p>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-n>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-u>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>scroll_docs</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>4</span><span>),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-d>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>scroll_docs</span><span>(</span><span style=color:#d27e99>4</span><span>),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-e>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>abort</span><span>(),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-y>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>}),</span></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;CR>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.mapping.</span><span style=color:#7e9cd8>confirm</span><span>({select</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>}),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-f>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      if</span><span> luasnip.</span><span style=color:#7e9cd8>jumpable</span><span>(</span><span style=color:#d27e99>1</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>        luasnip.</span><span style=color:#7e9cd8>jump</span><span>(</span><span style=color:#d27e99>1</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>        fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      end</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;C-b>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      if</span><span> luasnip.</span><span style=color:#7e9cd8>jumpable</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>1</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>        luasnip.</span><span style=color:#7e9cd8>jump</span><span>(</span><span style=color:#e6c384>-</span><span style=color:#d27e99>1</span><span>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>        fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      end</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;Tab>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>      local col</span><span style=color:#e6c384> =</span><span> vim.fn.</span><span style=color:#7e9cd8>col</span><span>(</span><span style=color:#98bb6c>'.'</span><span>) </span><span style=color:#e6c384>-</span><span style=color:#d27e99> 1</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>      if</span><span> cmp.</span><span style=color:#7e9cd8>visible</span><span>() </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>        cmp.</span><span style=color:#7e9cd8>select_next_item</span><span>(select_opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>      elseif</span><span> col</span><span style=color:#e6c384> ==</span><span style=color:#d27e99> 0</span><span style=color:#e6c384> or</span><span> vim.fn.</span><span style=color:#7e9cd8>getline</span><span>(</span><span style=color:#98bb6c>'.'</span><span>):</span><span style=color:#7e9cd8>sub</span><span>(col, col):</span><span style=color:#7e9cd8>match</span><span>(</span><span style=color:#98bb6c>'%s'</span><span>) </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span style=color:#7e9cd8>        fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      else</span></span>
<span class=giallo-l><span>        cmp.</span><span style=color:#7e9cd8>complete</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      end</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    [</span><span style=color:#98bb6c>'&lt;S-Tab>'</span><span>] </span><span style=color:#e6c384>=</span><span> cmp.</span><span style=color:#7e9cd8>mapping</span><span>(</span><span style=color:#957fb8>function</span><span style=color:#9cabca>(</span><span>fallback</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#957fb8>      if</span><span> cmp.</span><span style=color:#7e9cd8>visible</span><span>() </span><span style=color:#957fb8>then</span></span>
<span class=giallo-l><span>        cmp.</span><span style=color:#7e9cd8>select_prev_item</span><span>(select_opts)</span></span>
<span class=giallo-l><span style=color:#957fb8>      else</span></span>
<span class=giallo-l><span style=color:#7e9cd8>        fallback</span><span>()</span></span>
<span class=giallo-l><span style=color:#957fb8>      end</span></span>
<span class=giallo-l><span style=color:#957fb8>    end</span><span>, {</span><span style=color:#98bb6c>'i'</span><span>, </span><span style=color:#98bb6c>'s'</span><span>}),</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h2 id=contenido-extra>Contenido extra</h2><p>T√©cnicamente ya est√°n listos. Si agregaron todo el c√≥digo que les mostr√© en su configuraci√≥n ya deben tener el servidor LSP y el autocompletado funcionando. Pero a√∫n cosas que podemos hacer para mejorar nuestra experiencia.<h3 id=personalizando-los-iconos-de-diagnostico>Personalizando los √≠conos de diagn√≥stico</h3><p>Esto lo logramos con la funci√≥n <code>sign_define</code>. Esta no es una funci√≥n de lua, es de vimscript, quiere decir que accedemos a ella usando el prefijo <code>vim.fn</code>. Para saber los detalles de esta funci√≥n usen el comando <code>:help sign_define</code>.<p>En fin, con esto podremos cambiar los "signos de diagn√≥stico".<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>local</span><span style=color:#7e9cd8> sign</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>opts</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span>  vim.fn.</span><span style=color:#7e9cd8>sign_define</span><span>(opts.name, {</span></span>
<span class=giallo-l><span>    texthl</span><span style=color:#e6c384> =</span><span> opts.name,</span></span>
<span class=giallo-l><span>    text</span><span style=color:#e6c384> =</span><span> opts.text,</span></span>
<span class=giallo-l><span>    numhl</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> ''</span></span>
<span class=giallo-l><span>  })</span></span>
<span class=giallo-l><span style=color:#957fb8>end</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#7e9cd8>sign</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignError'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '‚úò'</span><span>})</span></span>
<span class=giallo-l><span style=color:#7e9cd8>sign</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignWarn'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '‚ñ≤'</span><span>})</span></span>
<span class=giallo-l><span style=color:#7e9cd8>sign</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignHint'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '‚öë'</span><span>})</span></span>
<span class=giallo-l><span style=color:#7e9cd8>sign</span><span>({name</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'DiagnosticSignInfo'</span><span>, text</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> '¬ª'</span><span>})</span></span></code></pre><h3 id=configuracion-global-de-diagnosticos>Configuraci√≥n global de diagn√≥sticos</h3><p>Para esto debemos usar el m√≥dulo <code>vim.diagnostic</code>, espec√≠ficamente la funci√≥n <code>.config()</code>. Esta funci√≥n acepta una tabla como argumento, estas son sus propiedades.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>{</span></span>
<span class=giallo-l><span>  virtual_text</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>  signs</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>  update_in_insert</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>  underline</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>  severity_sort</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>  float</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>}</span></span></code></pre><ul><li><p><code>virtual_text</code>: Muestra mensaje de diagn√≥stico con un "texto virtual" al final de la l√≠nea.</p><li><p><code>signs</code>: Mostrar un "signo" en la l√≠nea donde hay un diagn√≥stico presente.</p><li><p><code>update_in_insert</code>: Actualizar los diagn√≥sticos mientras se edita el documento en modo de inserci√≥n.</p><li><p><code>underline</code>: Subrayar la localizaci√≥n de un diagn√≥stico.</p><li><p><code>severity_sort</code>: Ordenar los diagn√≥sticos de acuerdo a su prioridad.</p><li><p><code>float</code>: Habilitar ventanas flotantes para mostrar los mensajes de diagn√≥sticos.</p></ul><p>Cada una estas opciones aceptar una tabla de opciones para personalizar a√∫n m√°s su comportamiento. Pueden encontrar todos esos detalles en la documentaci√≥n: <code>:help vim.diagnostic.config()</code>.<p>Personalmente prefiero diagn√≥sticos menos llamativos. Uso esta configuraci√≥n.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.diagnostic.</span><span style=color:#7e9cd8>config</span><span>({</span></span>
<span class=giallo-l><span>  virtual_text</span><span style=color:#e6c384> =</span><span style=color:#ffa066> false</span><span>,</span></span>
<span class=giallo-l><span>  severity_sort</span><span style=color:#e6c384> =</span><span style=color:#ffa066> true</span><span>,</span></span>
<span class=giallo-l><span>  float</span><span style=color:#e6c384> =</span><span> {</span></span>
<span class=giallo-l><span>    border</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'rounded'</span><span>,</span></span>
<span class=giallo-l><span>    source</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'always'</span><span>,</span></span>
<span class=giallo-l><span>  },</span></span>
<span class=giallo-l><span>})</span></span></code></pre><h3 id=bordes-en-ventanas-de-ayuda>Bordes en ventanas de ayuda</h3><p>Hay dos m√©todos que muestran ventanas flotantes con informaci√≥n: <code>vim.lsp.buf.hover()</code> y <code>vim.lsp.buf.signature_help()</code>. Por defecto estas ventanas no tienen ning√∫n estilo, pero podemos cambiar eso si modificamos la configuraci√≥n del "handler" asociado a estas funciones. Para estos casos tenemos que usar <code>vim.lsp.with()</code>.<p>No quiero aburrirlos con los detalles as√≠ que aqu√≠ les dejo el c√≥digo.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span>vim.lsp.handlers[</span><span style=color:#98bb6c>'textDocument/hover'</span><span>] </span><span style=color:#e6c384>=</span><span> vim.lsp.</span><span style=color:#7e9cd8>with</span><span>(</span></span>
<span class=giallo-l><span>  vim.lsp.handlers.hover,</span></span>
<span class=giallo-l><span>  {border</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'rounded'</span><span>}</span></span>
<span class=giallo-l><span>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>vim.lsp.handlers[</span><span style=color:#98bb6c>'textDocument/signatureHelp'</span><span>] </span><span style=color:#e6c384>=</span><span> vim.lsp.</span><span style=color:#7e9cd8>with</span><span>(</span></span>
<span class=giallo-l><span>  vim.lsp.handlers.signature_help,</span></span>
<span class=giallo-l><span>  {border</span><span style=color:#e6c384> =</span><span style=color:#98bb6c> 'rounded'</span><span>}</span></span>
<span class=giallo-l><span>)</span></span></code></pre><h3 id=instalar-servidores-lsp-de-manera-local>Instalar servidores LSP de manera "local"</h3><p>Tarde o temprano se van a encontrar con este plugin: <a rel="noopener external" href=https://github.com/williamboman/mason.nvim target=_blank>mason.nvim</a>. Esto les permite manejar completamente sus servidores LSP dentro de Neovim. Podr√°n instalar, actualizar y eliminar servidores usando Neovim.<p>Los servidores que instalen con este m√©todo no estar√°n disponibles de manera global, se instalar√°n en la carpeta "data" de Neovim. Ahora bien, algunos servidores al ser instalados con este m√©todo requieren de configuraciones extra, es por eso que tambi√©n necesitamos usar <a rel="noopener external" href=https://github.com/williamboman/mason-lspconfig.nvim target=_blank>mason-lspconfig</a>.<p>Una vez que tengan todos los plugins necesarios deben configurar mason.nvim de esta manera.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'mason'</span><span>).</span><span style=color:#7e9cd8>setup</span><span>()</span></span>
<span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'mason-lspconfig'</span><span>).</span><span style=color:#7e9cd8>setup</span><span>()</span></span></code></pre><p>Despu√©s de invocar estas funciones pueden usar <code>lspconfig</code> como si nada. Pueden fingir que mason.nvim no existe.<p>Aqu√≠ les dejo un ejemplo de uso.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=lua><span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'mason'</span><span>).</span><span style=color:#7e9cd8>setup</span><span>()</span></span>
<span class=giallo-l><span style=color:#7e9cd8>require</span><span>(</span><span style=color:#98bb6c>'mason-lspconfig'</span><span>).</span><span style=color:#7e9cd8>setup</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>local lspconfig</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'lspconfig'</span><span>)</span></span>
<span class=giallo-l><span>local lsp_capabilities</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> require</span><span>(</span><span style=color:#98bb6c>'cmp_nvim_lsp'</span><span>).</span><span style=color:#7e9cd8>default_capabilities</span><span>()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>lspconfig.lua_ls.</span><span style=color:#7e9cd8>setup</span><span>({</span></span>
<span class=giallo-l><span>  capabilities</span><span style=color:#e6c384> =</span><span> lsp_capabilities,</span></span>
<span class=giallo-l><span>})</span></span></code></pre><p>En est√° ocasi√≥n es todo lo que voy a decir sobre <code>mason.nvim</code>. Si quieren saber m√°s detalles deben revisar su documentaci√≥n.<h2 id=conclusion>Conclusi√≥n</h2><p>Han aprendido porque necesitamos nvim-lspconfig. Saben c√≥mo crear una configuraci√≥n global para todos sus servidores. Conocen las funciones m√°s com√∫nes para sus atajos de teclado. Todo lo necesario para aprovechar las bondades que puede darles un servidor LSP.<p>Tuvimos la oportunidad de armar una configuraci√≥n de <code>nvim-cmp</code> desde cero. Explorando paso a paso las opciones m√°s utilizadas.<p>Finalmente vimos algunas opciones que nos permiten modificar la presentaci√≥n de los diagn√≥sticos (mensajes de error, advertencia, etc). Aprendimos a modificar los handlers que muestran ventanas flotantes. Y, dimos un vistazo a un m√©todo para instalar servidores de manera local.<p>Pueden encontrar todo el c√≥digo de configuraci√≥n aqu√≠: <a rel="noopener external" href=https://gist.github.com/VonHeikemen/8fc2aa6da030757a5612393d0ae060bd target=_blank>nvim-lspconfig + nvim-cmp</a>.<p>Y aqu√≠ les dejo una configuraci√≥n de Neovim completamente funcional: <a rel="noopener external" href=https://github.com/VonHeikemen/nvim-starter/tree/03-lsp target=_blank>nvim-starter - branch: 03-lsp</a>.<h2 id=fuentes>Fuentes</h2><ul><li><a rel="noopener external" href=https://neovim.io/doc/user/lsp.html target=_blank>:help lsp.txt</a><li><a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig/blob/9e6bcf5a8915e8423d5cc7f82c5069c11272184d/doc/lspconfig.txt#L240 target=_blank>:help lspconfig-global-defaults</a><li><a rel="noopener external" href=https://github.com/neovim/nvim-lspconfig/blob/9e6bcf5a8915e8423d5cc7f82c5069c11272184d/doc/lspconfig.txt#L481 target=_blank>:help lspconfig-keybindings</a><li><a rel="noopener external" href=https://github.com/hrsh7th/nvim-cmp/blob/6e1e3865158f340d6cd3936937eb56947b5a90f9/doc/cmp.txt#L360 target=_blank>:help cmp-config</a><li><a rel="noopener external" href=https://github.com/hrsh7th/nvim-cmp/blob/6e1e3865158f340d6cd3936937eb56947b5a90f9/doc/cmp.txt#L227 target=_blank>:help cmp-mapping</a><li><a rel="noopener external" href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.config() target=_blank>:help vim.diagnostic.config()</a></ul><hr><p>¬øTienen alguna pregunta? Pueden dejar un comentario en cualquiera de estas plataformas:<ul><li><a href=https://dev.to/vonheikemen/neovim-lsp-configurando-nvim-lspconfig-nvim-cmp-1m2g rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/setup-nvim-lspconfig-nvim-cmp-es rel=noopener target=_blank>Hashnode</a></ul><p>Pueden contactarme por las redes sociales:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Bluesky <a rel="noopener me" href=https://bsky.app/profile/vonheikemen.bsky.social target=_blank> @vonheikemen.bsky.social </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Gracias por su tiempo. Si este art√≠culo les pareci√≥ √∫til y quieren apoyar mis esfuerzos para crear m√°s contenido, pueden dejar una propina en buy me a coffee ‚òï.</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>