<!doctype html><html lang=es><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Configurando nvim-lspconfig + nvim-cmp | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="vim, neovim, shell, software, coding, development" name=keywords><meta content="Usando nvim-lspconfig y nvim-cmp para configurar el cliente LSP de Neovim" name=description><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a></ul> ¬© 2020-2023 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Configurando nvim-lspconfig + nvim-cmp</h1><span class=post-date>2022-05-21 | 13 minutos | <a href=https://vonheikemen.github.io/devlog/tools/setup-nvim-lspconfig-plus-nvim-cmp/> Read in english </a> </span><blockquote>√öltima actualizaci√≥n: 2023-02-15</blockquote><p>Dentro de Neovim se encuentra un "framework" que le permite al editor comunicarse con un servidor LSP. ¬øQu√© significa eso? Quiere decir que, con la configuraci√≥n correcta, tendremos acceso a funcionalidades como renombrar una variable, saltar a una definici√≥n, listar referencias, etc. Caracter√≠sticas que podr√≠an encontrar en un IDE.<h2 id=por-que-necesitamos-plugins>¬øPor qu√© necesitamos plugins?</h2><p>Por defecto Neovim nos ofrece las herramientas pero no tiene ninguna opini√≥n de c√≥mo debemos usarlas. Es aqu√≠ donde entra <a href=https://github.com/neovim/nvim-lspconfig rel=noopener target=_blank>nvim-lspconfig</a>, este plugin escanea la "carpeta ra√≠z" de nuestro proyecto e intenta determinar qu√© servidor LSP necesitamos. Pero claro, primero debemos tener instalados los servidores en nuestro sistema y luego debemos configurarlos dentro de Neovim.<p>Y luego tenemos <a href=https://github.com/hrsh7th/nvim-cmp rel=noopener target=_blank>nvim-cmp</a>, un plugin de autocompletado. ¬øDe verdad lo necesitamos? En realidad no. En mi opini√≥n el autocompletado de Neovim es bastante capaz. ¬øCu√°l es el problema? Digamos que requiere de mucha intervenci√≥n manual. Los editores de c√≥digo modernos nos tienen acostumbrados a un flujo donde todo ocurre de manera autom√°tica. <code>nvim-cmp</code> nos permite tener ese autocompletado c√≥modo e inteligente.<p>Ahora que sabemos el porqu√© de las cosas pongamos manos a la obra.<h2 id=requisitos>Requisitos</h2><ul><li>Neovim v0.8 o mayor. v0.7 tambi√©n puede funcionar, pero con algunas modificaciones.<li>Un servidor LSP.<li>Instalar <a href=https://github.com/neovim/nvim-lspconfig rel=noopener target=_blank>nvim-lspconfig</a>.<li>Instalar plugins para el autocompletado: <ul><li><a href=https://github.com/hrsh7th/nvim-cmp rel=noopener target=_blank>nvim-cmp</a><li><a href=https://github.com/hrsh7th/cmp-buffer rel=noopener target=_blank>cmp-buffer</a><li><a href=https://github.com/hrsh7th/cmp-path rel=noopener target=_blank>cmp-path</a><li><a href=https://github.com/saadparwaiz1/cmp_luasnip rel=noopener target=_blank>cmp_luasnip</a><li><a href=https://github.com/hrsh7th/cmp-nvim-lsp rel=noopener target=_blank>cmp-nvim-lsp</a><li><a href=https://github.com/L3MON4D3/LuaSnip rel=noopener target=_blank>LuaSnip</a><li><a href=https://github.com/rafamadriz/friendly-snippets rel=noopener target=_blank>friendly-snippets</a></ul></ul><p>En la documentaci√≥n de <code>nvim-lspconfig</code> pueden encontrar instrucciones de c√≥mo instalar algunos servidores: <a href=https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md rel=noopener target=_blank>server_configurations.md</a><h2 id=configuracion-lsp>Configuraci√≥n LSP</h2><p>Lo primero que haremos ser√° declarar las "capacidades" que tiene el editor. Normalmente tendr√≠amos que pasar esta configuraci√≥n manualmente a cada servidor, pero podemos ahorrarnos ese procedimiento si las agregamos directamente a la variable <code>util.default_config</code> de nvim-lspconfig.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#c594c5>local </span><span>lspconfig </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>lspconfig</span><span style=color:#5fb3b3>')
</span><span style=color:#c594c5>local </span><span>lsp_defaults </span><span style=color:#5fb3b3>= </span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>util</span><span style=color:#5fb3b3>.</span><span>default_config
</span><span>
</span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span>capabilities </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>tbl_deep_extend</span><span style=color:#5fb3b3>(
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>force</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>capabilities</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>cmp_nvim_lsp</span><span style=color:#5fb3b3>').</span><span style=color:#6699cc>default_capabilities</span><span style=color:#5fb3b3>()
</span><span style=color:#5fb3b3>)
</span></code></pre><p>Aqu√≠ utilizamos <code>vim.tbl_deep_extend</code> para mezclar de manera segura las capacidades que ofrece <code>lspconfig</code> con las capacidades que agrega <code>nvim-cmp</code>.<p>El siguiente paso ser√° llamar los servidores que tenemos instalados en nuestro sistema. Con <code>lspconfig</code> debemos llamar la funci√≥n <code>.setup()</code> del servidor que queremos configurar.<p>¬øPero c√≥mo sabemos qu√© servidores tenemos disponibles? En la documentaci√≥n de <code>lspconfig</code> pueden encontrar la lista completa, pueden navegar a ella usando el comando <code>:help lspconfig-server-configurations</code>.<p>Para en lenguaje <code>lua</code> tenemos disponible el servidor <code>lua_ls</code>. Luego de instalarlo en nuestro sistema podemos configurarlo de la siguiente manera.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>lua_ls</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>({})
</span></code></pre><p>Si necesitan agregar m√°s opciones a un servidor deben agregar propiedades al argumento de <code>.setup()</code>, as√≠.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>lua_ls</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>  </span><span style=color:#99c794>single_file_support </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#99c794>flags </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>debounce_text_changes </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>150</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>})
</span></code></pre><p>Para conocer las opciones disponibles en la funci√≥n <code>.setup()</code> revisen la documentaci√≥n con el comando <code>:help lspconfig-setup</code>.<p>Ahora lo m√°s importante, los atajos de teclado. Para esto utilizaremos un autocomando, esto nos dar√° la libertad de colocar nuestros atajos en cualquier lugar de nuestra configuraci√≥n.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>api</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>nvim_create_autocmd</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>LspAttach</span><span style=color:#5fb3b3>', {
</span><span style=color:#6699cc>  </span><span style=color:#99c794>desc </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Acciones LSP</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  callback </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>local </span><span style=color:#6699cc>bufmap </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>mode</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>lhs</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>rhs</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>local </span><span>opts </span><span style=color:#5fb3b3>= {</span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>}
</span><span style=color:#6699cc>      </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>keymap</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>set</span><span style=color:#5fb3b3>(</span><span>mode</span><span style=color:#5fb3b3>, </span><span>lhs</span><span style=color:#5fb3b3>, </span><span>rhs</span><span style=color:#5fb3b3>, </span><span>opts</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Muestra informaci√≥n sobre s√≠mbolo debajo del cursor
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>K</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.hover()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Saltar a definici√≥n
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gd</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.definition()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Saltar a declaraci√≥n
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gD</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.declaration()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Mostrar implementaciones
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gi</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.implementation()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Saltar a definici√≥n de tipo
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>go</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.type_definition()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Listar referencias
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gr</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.references()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Mostrar argumentos de funci√≥n
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gs</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.signature_help()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Renombrar s√≠mbolo
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTF2></span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.rename()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Listar "code actions" disponibles en la posici√≥n del cursor
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTF4></span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.code_action()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>x</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTF4></span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.lsp.buf.range_code_action()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Mostrar diagn√≥sticos de la l√≠nea actual
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>gl</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.diagnostic.open_float()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Saltar al diagn√≥stico anterior
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>[d</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.diagnostic.goto_prev()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5f6364>-- Saltar al siguiente diagn√≥stico
</span><span style=color:#6699cc>    bufmap</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>n</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>]d</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>&LTcmd>lua vim.diagnostic.goto_next()&LTcr></span><span style=color:#5fb3b3>')
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#5fb3b3>})
</span></code></pre><p>Con esto nuestros atajos ser√°n creado cada vez que Neovim vincule un servidor LSP a un archivo.<blockquote><p>Nota: si est√°n usando Neovim v0.7.2 o menor, tienen que crear una funci√≥n y asignarla a la opci√≥n <code>on_attach</code> de cada servidor LSP. En la documentaci√≥n de lspconfig pueden encontrar un ejemplo, ejecuten el comando <code>:help lspconfig-keybindings</code>.</blockquote><p>Para terminar con esta secci√≥n aqu√≠ tienen la configuraci√≥n completa para <code>lspconfig</code>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5f6364>---
</span><span style=color:#5f6364>-- Configuraci√≥n global
</span><span style=color:#5f6364>---
</span><span>
</span><span style=color:#c594c5>local </span><span>lspconfig </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>lspconfig</span><span style=color:#5fb3b3>')
</span><span style=color:#c594c5>local </span><span>lsp_defaults </span><span style=color:#5fb3b3>= </span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>util</span><span style=color:#5fb3b3>.</span><span>default_config
</span><span>
</span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span>capabilities </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>tbl_deep_extend</span><span style=color:#5fb3b3>(
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>force</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>capabilities</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>cmp_nvim_lsp</span><span style=color:#5fb3b3>').</span><span style=color:#6699cc>default_capabilities</span><span style=color:#5fb3b3>()
</span><span style=color:#5fb3b3>)
</span><span>
</span><span style=color:#5f6364>---
</span><span style=color:#5f6364>-- Servidores LSP
</span><span style=color:#5f6364>---
</span><span>
</span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>lua_ls</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>({})
</span></code></pre><h2 id=snippets>Snippets</h2><p>Interrumpimos la programaci√≥n habitual para configurar nuestro motor de snippets. Esta parte no est√° relacionada con el cliente LSP.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>luasnip.loaders.from_vscode</span><span style=color:#5fb3b3>').</span><span style=color:#6699cc>lazy_load</span><span style=color:#5fb3b3>()
</span></code></pre><p>La funci√≥n <code>.lazy_load()</code> carga las colecciones de snippets que tengamos en el <code>runtimepath</code>. Es aqu√≠ cuando se cargan los snippets de <code>friendly-snippets</code>.<h2 id=autocompletado>Autocompletado</h2><p>Para empezar, la documentaci√≥n de <code>nvim-cmp</code> recomienda que configuremos la <code>completeopt</code> de la siguiente manera.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>opt</span><span style=color:#5fb3b3>.</span><span>completeopt </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>menuone</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>noselect</span><span style=color:#5fb3b3>'}
</span></code></pre><p>Para configurar nvim-cmp necesitamos dos m√≥dulos <code>cmp</code> y <code>luasnip</code>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#c594c5>local </span><span>cmp </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>cmp</span><span style=color:#5fb3b3>')
</span><span style=color:#c594c5>local </span><span>luasnip </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>luasnip</span><span style=color:#5fb3b3>')
</span></code></pre><p><code>cmp</code> es el m√≥dulo de nvim-cmp. ¬øQu√© hay de <code>luasnip</code>? Lo que pasa es que nvim-cmp no "sabe" como expandir un snippet, por eso necesitamos luasnip.<p>Vamos a pasar un buen rato configurando nvim-cmp. Quiero explicarles las opciones que yo uso en mi configuraci√≥n, pero primero vamos a agregar la funci√≥n <code>cmp.setup</code>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#c594c5>local </span><span>select_opts </span><span style=color:#5fb3b3>= {</span><span style=color:#99c794>behavior </span><span style=color:#5fb3b3>= </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>SelectBehavior</span><span style=color:#5fb3b3>.</span><span>Select</span><span style=color:#5fb3b3>}
</span><span>
</span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>
</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=snippet-expand>snippet.expand</h3><p>Es una funci√≥n que recibe la informaci√≥n de un snippet. Aqu√≠ es donde <code>nvim-cmp</code> nos da la oportunidad de expandir los snippets con el plugin que queramos. En nuestro caso tenemos <code>luasnip</code>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>snippet </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#6699cc>expand </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>args</span><span style=color:#5fb3b3>)
</span><span>    luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp_expand</span><span style=color:#5fb3b3>(</span><span>args</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>body</span><span style=color:#5fb3b3>)
</span><span>  </span><span style=color:#c594c5>end
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><h3 id=sources>sources</h3><p>Aqu√≠ podemos listar los plugins que nvim-cmp usar√° para obtener datos.<p>Cada "fuente" es una tabla que debe tener la propiedad <code>name</code>, este nombre no se refiere al nombre del plugin sino al nombre con el que se registr√≥ la fuente en <code>nvim-cmp</code>. La documentaci√≥n de cada fuente deber√≠a mostrarles este nombre.<p>Otras propiedades que deben tener en cuenta son <code>priority</code> y <code>keyword_length</code>. Con <code>priority</code> podemos elegir el orden en el que aparecen las sugerencias en la lista de autocompletado. Si no se especifica la propiedad <code>priority</code> entonces el orden de las fuentes dicta la prioridad. Con <code>keyword_length</code> se controla la cantidad de caracteres que se necesitan para empezar a ver datos de la fuente.<p>En mi configuraci√≥n personal tengo las fuentes configuradas de esta manera.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>sources </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>path</span><span style=color:#5fb3b3>'},
</span><span>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>nvim_lsp</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>1</span><span style=color:#5fb3b3>},
</span><span>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>buffer</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>3</span><span style=color:#5fb3b3>},
</span><span>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>luasnip</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>2</span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><ul><li><code>path</code>: Autocompleta rutas de archivos.<li><code>nvim_lsp</code>: Muestra sugerencias basadas en la respuesta de un servidor LSP.<li><code>buffer</code>: Sugiere palabras que se encuentra en el archivo actual.<li><code>luasnip</code>: Muestra los snippets cargados. Si elegimos un snippet lo expande.</ul><h3 id=window-documentation>window.documentation</h3><p>Controla la apariencia de la ventana donde se muestra la documentaci√≥n de un item. nvim-cmp ofrece una configuraci√≥n que podemos usar para obtener una ventana con bordes.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>window </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#99c794>documentation </span><span style=color:#5fb3b3>= </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>config</span><span style=color:#5fb3b3>.</span><span>window</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bordered</span><span style=color:#5fb3b3>()
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><h3 id=formatting-fields>formatting.fields</h3><p>Lista que controla el orden en el que aparecen los elementos de un item.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>formatting </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#99c794>fields </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>abbr</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>kind</span><span style=color:#5fb3b3>'}
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><p><code>abbr</code> es el contenido de la sugerencia. <code>kind</code> es el tipo de dato, puede ser texto, una clase, una funci√≥n, etc. <code>menu</code> est√° vac√≠o por defecto.<h3 id=formatting-format>formatting.format</h3><p>Funci√≥n que determina el formato del item. Un ejemplo simple que puedo mostrarles es c√≥mo asignarle un √≠cono al "field" <code>menu</code> basado en el nombre de la fuente.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>formatting </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#99c794>fields </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>abbr</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>kind</span><span style=color:#5fb3b3>'},
</span><span>  </span><span style=color:#6699cc>format </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>entry</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>item</span><span style=color:#5fb3b3>)
</span><span>    </span><span style=color:#c594c5>local </span><span>menu_icon </span><span style=color:#5fb3b3>= {
</span><span>      </span><span style=color:#99c794>nvim_lsp </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Œª</span><span style=color:#5fb3b3>',
</span><span>      </span><span style=color:#99c794>luasnip </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>‚ãó</span><span style=color:#5fb3b3>',
</span><span>      </span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Œ©</span><span style=color:#5fb3b3>',
</span><span>      </span><span style=color:#99c794>path </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>üñ´</span><span style=color:#5fb3b3>',
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>
</span><span>    item</span><span style=color:#5fb3b3>.</span><span>menu </span><span style=color:#5fb3b3>= </span><span>menu_icon</span><span style=color:#5fb3b3>[</span><span>entry</span><span style=color:#5fb3b3>.</span><span>source</span><span style=color:#5fb3b3>.</span><span>name</span><span style=color:#5fb3b3>]
</span><span>    </span><span style=color:#c594c5>return </span><span>item
</span><span>  </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>}</span><span>,
</span></code></pre><h3 id=mapping>mapping</h3><p>Lista de atajos de teclado. Aqu√≠ necesitamos declarar una lista de pares propiedad/valor. Donde el <code>valor</code> ser√° una funci√≥n del m√≥dulo <code>cmp</code>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>mapping </span><span style=color:#5fb3b3>= {
</span><span>  </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTCR></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>confirm</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>select </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>}),
</span><span style=color:#5fb3b3>}
</span></code></pre><p>En este ejemplo <code>['&LTCR>']</code> es el atajo que queremos crear. La funci√≥n del otro lado de la asignaci√≥n es la acci√≥n que queremos ejecutar.<p>Estas son algunas acciones comunes:<ul><li>Navegar entre las sugerencias.</ul><pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTUp></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)</span><span>,
</span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTDown></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)</span><span>,
</span><span>
</span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-p></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)</span><span>,
</span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-n></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)</span><span>,
</span></code></pre><ul><li>Desplaza el texto de la ventana de documentaci√≥n.</ul><pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-u></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>scroll_docs</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>4</span><span style=color:#5fb3b3>)</span><span>,
</span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-d></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>scroll_docs</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>4</span><span style=color:#5fb3b3>)</span><span>,
</span></code></pre><ul><li>Cancelar el autocompletado.</ul><pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-e></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>abort</span><span style=color:#5fb3b3>()</span><span>,
</span></code></pre><ul><li>Confirma la selecci√≥n.</ul><pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-y></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>confirm</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>select </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>})</span><span>,
</span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTCR></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>confirm</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>select </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>})</span><span>,
</span></code></pre><ul><li>Salta al pr√≥ximo placeholder de un snippet.</ul><pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-f></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>if </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>jumpable</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>    </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>jump</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>    fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'})</span><span>,
</span></code></pre><ul><li>Salta al placeholder anterior de un snippet.</ul><pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-b></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>if </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>jumpable</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>    </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>jump</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>    fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'})</span><span>,
</span></code></pre><ul><li>Autocompletado con tab.</ul><p>Si la lista de sugerencias es visible, navega al siguiente item. Si la l√≠nea est√° "vac√≠a", inserta el caracter <code>Tab</code>. Si el cursor est√° en medio de una palabra, activa el autocompletado.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTTab></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>local </span><span>col </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>col</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>') - </span><span style=color:#f99157>1
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>if </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>visible</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>    </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>elseif </span><span>col </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>0 </span><span style=color:#5fb3b3>or </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>getline</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>'):</span><span style=color:#6699cc>sub</span><span style=color:#5fb3b3>(</span><span>col</span><span style=color:#5fb3b3>, </span><span>col</span><span style=color:#5fb3b3>):</span><span style=color:#6699cc>match</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>%s</span><span style=color:#5fb3b3>') </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>    fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>    </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>complete</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'})</span><span>,
</span></code></pre><ul><li>Si la lista de sugerencias es visible, navega al item anterior.</ul><pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTS-Tab></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>if </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>visible</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>    </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>    fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>  </span><span style=color:#c594c5>end
</span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'})</span><span>,
</span></code></pre><h3 id=configuracion-cmp>Configuraci√≥n cmp</h3><p>He aqu√≠ el c√≥digo completo de la configuraci√≥n de <code>nvim-cmp</code> y <code>luasnip</code>.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>opt</span><span style=color:#5fb3b3>.</span><span>completeopt </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>menuone</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>noselect</span><span style=color:#5fb3b3>'}
</span><span>
</span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>luasnip.loaders.from_vscode</span><span style=color:#5fb3b3>').</span><span style=color:#6699cc>lazy_load</span><span style=color:#5fb3b3>()
</span><span>
</span><span style=color:#c594c5>local </span><span>cmp </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>cmp</span><span style=color:#5fb3b3>')
</span><span style=color:#c594c5>local </span><span>luasnip </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>luasnip</span><span style=color:#5fb3b3>')
</span><span>
</span><span style=color:#c594c5>local </span><span>select_opts </span><span style=color:#5fb3b3>= {</span><span style=color:#99c794>behavior </span><span style=color:#5fb3b3>= </span><span>cmp</span><span style=color:#5fb3b3>.</span><span>SelectBehavior</span><span style=color:#5fb3b3>.</span><span>Select</span><span style=color:#5fb3b3>}
</span><span>
</span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>  </span><span style=color:#99c794>snippet </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    expand </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>args</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp_expand</span><span style=color:#5fb3b3>(</span><span>args</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>body</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>  </span><span style=color:#99c794>sources </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>path</span><span style=color:#5fb3b3>'},
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>nvim_lsp</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>1</span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>buffer</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>3</span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>luasnip</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>keyword_length </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>2</span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>  </span><span style=color:#99c794>window </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>documentation </span><span style=color:#5fb3b3>= </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>config</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>window</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>bordered</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>  </span><span style=color:#99c794>formatting </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>fields </span><span style=color:#5fb3b3>= {'</span><span style=color:#99c794>menu</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>abbr</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>kind</span><span style=color:#5fb3b3>'},
</span><span style=color:#6699cc>    format </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>entry</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>item</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>local </span><span>menu_icon </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>        </span><span style=color:#99c794>nvim_lsp </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Œª</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>        </span><span style=color:#99c794>luasnip </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>‚ãó</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>        </span><span style=color:#99c794>buffer </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>Œ©</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>        </span><span style=color:#99c794>path </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>üñ´</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>      </span><span style=color:#5fb3b3>}
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>      </span><span>item</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>menu </span><span style=color:#5fb3b3>= </span><span>menu_icon</span><span style=color:#5fb3b3>[</span><span>entry</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>source</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>name</span><span style=color:#5fb3b3>]
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>return </span><span>item
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>},
</span><span style=color:#6699cc>  </span><span style=color:#99c794>mapping </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTUp></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>),
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTDown></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>),
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-p></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>),
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-n></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>),
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-u></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>scroll_docs</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>4</span><span style=color:#5fb3b3>),
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-d></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>scroll_docs</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>4</span><span style=color:#5fb3b3>),
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-e></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>abort</span><span style=color:#5fb3b3>(),
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-y></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>confirm</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>select </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>}),
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTCR></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>confirm</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>select </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>}),
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-f></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>if </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>jumpable</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>        </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>jump</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>        fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'}),
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTC-b></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>if </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>jumpable</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>        </span><span>luasnip</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>jump</span><span style=color:#5fb3b3>(-</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>        fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'}),
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTTab></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>local </span><span>col </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>col</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>') - </span><span style=color:#f99157>1
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>if </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>visible</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>        </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_next_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>elseif </span><span>col </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>0 </span><span style=color:#5fb3b3>or </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>getline</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>.</span><span style=color:#5fb3b3>'):</span><span style=color:#6699cc>sub</span><span style=color:#5fb3b3>(</span><span>col</span><span style=color:#5fb3b3>, </span><span>col</span><span style=color:#5fb3b3>):</span><span style=color:#6699cc>match</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>%s</span><span style=color:#5fb3b3>') </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>        fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>        </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>complete</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'}),
</span><span style=color:#6699cc>
</span><span style=color:#6699cc>    </span><span style=color:#5fb3b3>['</span><span style=color:#99c794>&LTS-Tab></span><span style=color:#5fb3b3>'] = </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>mapping</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>fallback</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>if </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>visible</span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>then
</span><span style=color:#6699cc>        </span><span>cmp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>select_prev_item</span><span style=color:#5fb3b3>(</span><span>select_opts</span><span style=color:#5fb3b3>)
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>else
</span><span style=color:#6699cc>        fallback</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>      </span><span style=color:#c594c5>end
</span><span style=color:#6699cc>    </span><span style=color:#c594c5>end</span><span style=color:#5fb3b3>, {'</span><span style=color:#99c794>i</span><span style=color:#5fb3b3>', '</span><span style=color:#99c794>s</span><span style=color:#5fb3b3>'}),
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>})
</span></code></pre><h2 id=contenido-extra>Contenido extra</h2><p>T√©cnicamente ya est√°n listos. Si agregaron todo el c√≥digo que les mostr√© en su configuraci√≥n ya deben tener el servidor LSP y el autocompletado funcionando. Pero a√∫n cosas que podemos hacer para mejorar nuestra experiencia.<h3 id=personalizando-los-iconos-de-diagnostico>Personalizando los √≠conos de diagn√≥stico</h3><p>Esto lo logramos con la funci√≥n <code>sign_define</code>. Esta no es una funci√≥n de lua, es de vimscript, quiere decir que accedemos a ella usando el prefijo <code>vim.fn</code>. Para saber los detalles de esta funci√≥n usen el comando <code>:help sign_define</code>.<p>En fin, con esto podremos cambiar los "signos de diagn√≥stico".<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#c594c5>local </span><span style=color:#6699cc>sign </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>opts</span><span style=color:#5fb3b3>)
</span><span>  vim</span><span style=color:#5fb3b3>.</span><span>fn</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>sign_define</span><span style=color:#5fb3b3>(</span><span>opts</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>name</span><span style=color:#5fb3b3>, {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>texthl </span><span style=color:#5fb3b3>= </span><span>opts</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>name</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= </span><span>opts</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>text</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>    </span><span style=color:#99c794>numhl </span><span style=color:#5fb3b3>= ''
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>})
</span><span style=color:#c594c5>end
</span><span>
</span><span style=color:#6699cc>sign</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>DiagnosticSignError</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>‚úò</span><span style=color:#5fb3b3>'})
</span><span style=color:#6699cc>sign</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>DiagnosticSignWarn</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>‚ñ≤</span><span style=color:#5fb3b3>'})
</span><span style=color:#6699cc>sign</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>DiagnosticSignHint</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>‚öë</span><span style=color:#5fb3b3>'})
</span><span style=color:#6699cc>sign</span><span style=color:#5fb3b3>({</span><span style=color:#99c794>name </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>DiagnosticSignInfo</span><span style=color:#5fb3b3>', </span><span style=color:#99c794>text </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>ÔÑ©</span><span style=color:#5fb3b3>'})
</span></code></pre><h3 id=configuracion-global-de-diagnosticos>Configuraci√≥n global de diagn√≥sticos</h3><p>Para esto debemos usar el m√≥dulo <code>vim.diagnostic</code>, espec√≠ficamente la funci√≥n <code>.config()</code>. Esta funci√≥n acepta una tabla como argumento, estas son sus propiedades.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#5fb3b3>{
</span><span>  </span><span style=color:#99c794>virtual_text </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>signs </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>update_in_insert </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>underline </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>severity_sort </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#99c794>float </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>}
</span></code></pre><ul><li><p><code>virtual_text</code>: Muestra mensaje de diagn√≥stico con un "texto virtual" al final de la l√≠nea.</p><li><p><code>signs</code>: Mostrar un "signo" en la l√≠nea donde hay un diagn√≥stico presente.</p><li><p><code>update_in_insert</code>: Actualizar los diagn√≥sticos mientras se edita el documento en modo de inserci√≥n.</p><li><p><code>underline</code>: Subrayar la localizaci√≥n de un diagn√≥stico.</p><li><p><code>severity_sort</code>: Ordenar los diagn√≥sticos de acuerdo a su prioridad.</p><li><p><code>float</code>: Habilitar ventanas flotantes para mostrar los mensajes de diagn√≥sticos.</p></ul><p>Cada una estas opciones aceptar una tabla de opciones para personalizar a√∫n m√°s su comportamiento. Pueden encontrar todos esos detalles en la documentaci√≥n: <code>:help vim.diagnostic.config()</code>.<p>Personalmente prefiero diagn√≥sticos menos llamativos. Uso esta configuraci√≥n.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>diagnostic</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>config</span><span style=color:#5fb3b3>({
</span><span style=color:#6699cc>  </span><span style=color:#99c794>virtual_text </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>false</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#99c794>severity_sort </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>true</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#99c794>float </span><span style=color:#5fb3b3>= {
</span><span style=color:#6699cc>    </span><span style=color:#99c794>border </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>rounded</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>    </span><span style=color:#99c794>source </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>always</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>},
</span><span style=color:#5fb3b3>})
</span></code></pre><h3 id=bordes-en-ventanas-de-ayuda>Bordes en ventanas de ayuda</h3><p>Hay dos m√©todos que muestran ventanas flotantes con informaci√≥n: <code>vim.lsp.buf.hover()</code> y <code>vim.lsp.buf.signature_help()</code>. Por defecto estas ventanas no tienen ning√∫n estilo, pero podemos cambiar eso si modificamos la configuraci√≥n del "handler" asociado a estas funciones. Para estos casos tenemos que usar <code>vim.lsp.with()</code>.<p>No quiero aburrirlos con los detalles as√≠ que aqu√≠ les dejo el c√≥digo.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span>handlers</span><span style=color:#5fb3b3>['</span><span style=color:#99c794>textDocument/hover</span><span style=color:#5fb3b3>'] = </span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>with</span><span style=color:#5fb3b3>(
</span><span style=color:#6699cc>  </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>handlers</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>hover</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>border </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>rounded</span><span style=color:#5fb3b3>'}
</span><span style=color:#5fb3b3>)
</span><span>
</span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span>handlers</span><span style=color:#5fb3b3>['</span><span style=color:#99c794>textDocument/signatureHelp</span><span style=color:#5fb3b3>'] = </span><span>vim</span><span style=color:#5fb3b3>.</span><span>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>with</span><span style=color:#5fb3b3>(
</span><span style=color:#6699cc>  </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>lsp</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>handlers</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>signature_help</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>{</span><span style=color:#99c794>border </span><span style=color:#5fb3b3>= '</span><span style=color:#99c794>rounded</span><span style=color:#5fb3b3>'}
</span><span style=color:#5fb3b3>)
</span></code></pre><h3 id=instalar-servidores-lsp-de-manera-local>Instalar servidores LSP de manera "local"</h3><p>Tarde o temprano se van a encontrar con este plugin: <a href=https://github.com/williamboman/mason.nvim rel=noopener target=_blank>mason.nvim</a>. Esto les permite manejar completamente sus servidores LSP dentro de Neovim. Podr√°n instalar, actualizar y eliminar servidores usando Neovim.<p>Los servidores que instalen con este m√©todo no estar√°n disponibles de manera global, se instalar√°n en la carpeta "data" de Neovim. Ahora bien, algunos servidores al ser instalados con este m√©todo requieren de configuraciones extra, es por eso que tambi√©n necesitamos usar <a href=https://github.com/williamboman/mason-lspconfig.nvim rel=noopener target=_blank>mason-lspconfig</a>.<p>Una vez que tengan todos los plugins necesarios deben configurar mason.nvim de esta manera.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>mason</span><span style=color:#5fb3b3>').</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>mason-lspconfig</span><span style=color:#5fb3b3>').</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>()
</span></code></pre><p>Despu√©s de invocar estas funciones pueden usar <code>lspconfig</code> como si nada. Pueden fingir que mason.nvim no existe.<p>Aqu√≠ les dejo un ejemplo de uso.<pre class=language-lua data-lang=lua style=background:#2b2c2f;color:#cccece><code class=language-lua data-lang=lua><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>mason</span><span style=color:#5fb3b3>').</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>()
</span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>mason-lspconfig</span><span style=color:#5fb3b3>').</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>()
</span><span>
</span><span style=color:#c594c5>local </span><span>lspconfig </span><span style=color:#5fb3b3>= </span><span style=color:#6699cc>require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>lspconfig</span><span style=color:#5fb3b3>')
</span><span style=color:#c594c5>local </span><span>lsp_defaults </span><span style=color:#5fb3b3>= </span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>util</span><span style=color:#5fb3b3>.</span><span>default_config
</span><span>
</span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span>capabilities </span><span style=color:#5fb3b3>= </span><span>vim</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>tbl_deep_extend</span><span style=color:#5fb3b3>(
</span><span style=color:#6699cc>  </span><span style=color:#5fb3b3>'</span><span style=color:#99c794>force</span><span style=color:#5fb3b3>',
</span><span style=color:#6699cc>  </span><span>lsp_defaults</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>capabilities</span><span style=color:#5fb3b3>,
</span><span style=color:#6699cc>  require</span><span style=color:#5fb3b3>('</span><span style=color:#99c794>cmp_nvim_lsp</span><span style=color:#5fb3b3>').</span><span style=color:#6699cc>default_capabilities</span><span style=color:#5fb3b3>()
</span><span style=color:#5fb3b3>)
</span><span>
</span><span>lspconfig</span><span style=color:#5fb3b3>.</span><span>lua_ls</span><span style=color:#5fb3b3>.</span><span style=color:#6699cc>setup</span><span style=color:#5fb3b3>({})
</span></code></pre><p>En est√° ocasi√≥n es todo lo que voy a decir sobre <code>mason.nvim</code>. Si quieren saber m√°s detalles deben revisar su documentaci√≥n.<h2 id=conclusion>Conclusi√≥n</h2><p>Han aprendido porque necesitamos nvim-lspconfig. Saben c√≥mo crear una configuraci√≥n global para todos sus servidores. Conocen las funciones m√°s com√∫nes para sus atajos de teclado. Todo lo necesario para aprovechar las bondades que puede darles un servidor LSP.<p>Tuvimos la oportunidad de armar una configuraci√≥n de <code>nvim-cmp</code> desde cero. Explorando paso a paso las opciones m√°s utilizadas.<p>Finalmente vimos algunas opciones que nos permiten modificar la presentaci√≥n de los diagn√≥sticos (mensajes de error, advertencia, etc). Aprendimos a modificar los handlers que muestran ventanas flotantes. Y, dimos un vistazo a un m√©todo para instalar servidores de manera local.<p>Pueden encontrar todo el c√≥digo de configuraci√≥n aqu√≠: <a href=https://gist.github.com/VonHeikemen/8fc2aa6da030757a5612393d0ae060bd rel=noopener target=_blank>nvim-lspconfig + nvim-cmp</a>.<p>Y aqu√≠ les dejo una configuraci√≥n de Neovim completamente funcional: <a href=https://github.com/VonHeikemen/nvim-starter/tree/03-lsp rel=noopener target=_blank>nvim-starter - branch: 03-lsp</a>.<h2 id=fuentes>Fuentes</h2><ul><li><a href=https://neovim.io/doc/user/lsp.html rel=noopener target=_blank>:help lsp.txt</a><li><a href=https://github.com/neovim/nvim-lspconfig/blob/9e6bcf5a8915e8423d5cc7f82c5069c11272184d/doc/lspconfig.txt#L240 rel=noopener target=_blank>:help lspconfig-global-defaults</a><li><a href=https://github.com/neovim/nvim-lspconfig/blob/9e6bcf5a8915e8423d5cc7f82c5069c11272184d/doc/lspconfig.txt#L481 rel=noopener target=_blank>:help lspconfig-keybindings</a><li><a href=https://github.com/hrsh7th/nvim-cmp/blob/6e1e3865158f340d6cd3936937eb56947b5a90f9/doc/cmp.txt#L360 rel=noopener target=_blank>:help cmp-config</a><li><a href=https://github.com/hrsh7th/nvim-cmp/blob/6e1e3865158f340d6cd3936937eb56947b5a90f9/doc/cmp.txt#L227 rel=noopener target=_blank>:help cmp-mapping</a><li><a href=https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.config() rel=noopener target=_blank>:help vim.diagnostic.config()</a></ul><hr><p>¬øTienen alguna pregunta? Pueden dejar un comentario en cualquiera de estas plataformas:<ul><li><a href=https://dev.to/vonheikemen/neovim-lsp-configurando-nvim-lspconfig-nvim-cmp-1m2g rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/setup-nvim-lspconfig-nvim-cmp-es rel=noopener target=_blank>Hashnode</a></ul><p>Pueden contactarme por las redes sociales:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Gracias por su tiempo. Si este art√≠culo les pareci√≥ √∫til y quieren apoyar mis esfuerzos para crear m√°s contenido, pueden dejar una propina en buy me a coffee ‚òï.</p><a href=https://www.buymeacoffee.com/vonheikemen style=display:flex;justify-content:center target=_blank> <img alt="Buy Me A Coffee" src=https://cdn.buymeacoffee.com/buttons/v2/default-blue.png style=height:60px!important;width:217px!important> </a></div></div>