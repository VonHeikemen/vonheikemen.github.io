<!doctype html><html lang=es><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Un poco del paradigma funcional en tu javascript: Usando un Maybe | Devlog
</title><link href=https://vonheikemen.github.io/devlog/print.css media=print rel=stylesheet><link href=https://vonheikemen.github.io/devlog/styles.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://hachyderm.io/@vonheikemen rel=me><link href=https://twitter.com/VonHeikemen_ rel=me><meta content="javascript, paradigma-funcional, aprendizaje, software, coding, development" name=keywords><meta content="Veremos cómo afectaría nuestro código si utilizaramos una estructura conocida como Maybe" name=description><link href=https://dev.to/vonheikemen/un-poco-del-paradigma-funcional-en-tu-javascript-usando-un-maybe-4a33 rel=canonical><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/atom.xml>RSS</a></ul> © 2020-2026 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Un poco del paradigma funcional en tu javascript: Usando un Maybe</h1><span class=post-date>2019-10-29 | Originalmente publicado en <a href=https://dev.to/vonheikemen/un-poco-del-paradigma-funcional-en-tu-javascript-usando-un-maybe-4a33> dev.to </a> | 8 minutos | <a href=https://vonheikemen.github.io/devlog/web-development/learn-fp/using-a-maybe/> Read in english </a> </span><p>¿Alguna vez han escuchado de las estructuras llamadas "monads" y lo geniales que son? Tal vez sí, pero aún no las entienden completamente. Bueno... aquí no intentaré definirlas y tampoco les diré si son geniales o no, lo que haré es mostrarles un ejemplo de cómo sería si las usaran en sus javascripts (específicamente el monad <code>Maybe</code>).<p>Haremos algo gracioso, resolveremos un problema trivial usando métodos innecesariamente complicados.<p>Supongamos que tenemos un diccionario guardado en un archivo .json o en un objeto plano en nuestro script.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#9cabca>{</span></span>
<span class=giallo-l><span style=color:#98bb6c>    "accident"</span><span>:</span><span style=color:#9cabca> [</span><span style=color:#98bb6c>"An unexpected, unfortunate mishap, failure or loss with the potential for harming human life, property or the environment."</span><span style=color:#9cabca>,</span><span style=color:#98bb6c> "An event that happens suddenly or by chance without an apparent cause."</span><span style=color:#9cabca>],</span><span> </span></span>
<span class=giallo-l><span style=color:#98bb6c>    "accumulator"</span><span>:</span><span style=color:#9cabca> [</span><span style=color:#98bb6c>"A rechargeable device for storing electrical energy in the form of chemical energy, consisting of one or more separate secondary cells.</span><span style=color:#7fb4ca>\\</span><span style=color:#98bb6c>n(Source: CED)"</span><span style=color:#9cabca>],</span></span>
<span class=giallo-l><span style=color:#98bb6c>    "acid"</span><span>:</span><span style=color:#9cabca> [</span><span style=color:#98bb6c>"A compound capable of transferring a hydrogen ion in solution."</span><span style=color:#9cabca>,</span><span style=color:#98bb6c> "Being harsh or corrosive in tone."</span><span style=color:#9cabca>,</span><span style=color:#98bb6c> "Having an acid, sharp or tangy taste."</span><span style=color:#9cabca>,</span><span style=color:#98bb6c> "A powerful hallucinogenic drug manufactured from lysergic acid."</span><span style=color:#9cabca>,</span><span style=color:#98bb6c> "Having a pH less than 7, or being sour, or having the strength to neutralize  alkalis, or turning a litmus paper red."</span><span style=color:#9cabca>],</span></span>
<span class=giallo-l><span>    </span></span>
<span class=giallo-l><span style=color:#727169>     // ... más palabras y significados</span></span>
<span class=giallo-l><span>    </span></span>
<span class=giallo-l><span style=color:#98bb6c>    "Paris"</span><span>:</span><span style=color:#9cabca> [</span><span style=color:#98bb6c>"The capital and largest city of France."</span><span style=color:#9cabca>]</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span></code></pre><p>Queremos crear un formulario que le permita a un usuario buscar uno de estos términos y luego muestre su signicado. Parece simple ¿Qué podría salir mal?<p>Y porque todo el mundo adora HTML empezaremos por ahí.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=html><span class=giallo-l><span style=color:#9cabca>&lt;</span><span style=color:#e6c384>form</span><span style=color:#957fb8> id</span><span style=color:#9cabca>=</span><span style=color:#98bb6c>"search_form"</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#9cabca>  &lt;</span><span style=color:#e6c384>label</span><span style=color:#957fb8> for</span><span style=color:#9cabca>=</span><span style=color:#98bb6c>"search_input"</span><span style=color:#9cabca>></span><span>Search a word</span><span style=color:#9cabca>&lt;/</span><span style=color:#e6c384>label</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#9cabca>  &lt;</span><span style=color:#e6c384>input</span><span style=color:#957fb8> id</span><span style=color:#9cabca>=</span><span style=color:#98bb6c>"search_input"</span><span style=color:#957fb8> type</span><span style=color:#9cabca>=</span><span style=color:#98bb6c>"text"</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#9cabca>  &lt;</span><span style=color:#e6c384>button</span><span style=color:#957fb8> type</span><span style=color:#9cabca>=</span><span style=color:#98bb6c>"submit"</span><span style=color:#9cabca>></span><span>Submit</span><span style=color:#9cabca>&lt;/</span><span style=color:#e6c384>button</span><span style=color:#9cabca>></span></span>
<span class=giallo-l><span style=color:#9cabca>&lt;/</span><span style=color:#e6c384>form</span><span style=color:#9cabca>></span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#9cabca>&lt;</span><span style=color:#e6c384>div</span><span style=color:#957fb8> id</span><span style=color:#9cabca>=</span><span style=color:#98bb6c>"result"</span><span style=color:#9cabca>>&lt;/</span><span style=color:#e6c384>div</span><span style=color:#9cabca>></span></span></code></pre><p>En nuestro primer intento sólo intentaremos obtener uno de esos valores basado en la consulta del usuario.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// main.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>// haz magia y tráeme los datos</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> entries</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> data</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> format</span><span style=color:#9cabca>(</span><span>results</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> results</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>join</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'&lt;br>'</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>window</span><span style=color:#9cabca>.</span><span>search_form</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>addEventListener</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'submit'</span><span style=color:#9cabca>,</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>ev</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span>  ev</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>preventDefault</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l><span style=color:#957fb8>  let</span><span> input</span><span style=color:#e6c384> =</span><span> ev</span><span style=color:#9cabca>.</span><span style=color:#e6c384>target</span><span style=color:#9cabca>[</span><span style=color:#d27e99>0</span><span style=color:#9cabca>];</span></span>
<span class=giallo-l><span>  window</span><span style=color:#9cabca>.</span><span>result</span><span style=color:#9cabca>.</span><span style=color:#e6c384>innerHTML =</span><span style=color:#7e9cd8> format</span><span style=color:#9cabca>(</span><span>entries</span><span style=color:#9cabca>[</span><span>input</span><span style=color:#9cabca>.</span><span style=color:#e6c384>value</span><span style=color:#9cabca>]);</span></span>
<span class=giallo-l><span style=color:#9cabca>});</span></span></code></pre><p>Naturalmente lo primero que haremos es probar con acid. Ahora contemplen los resultados.<blockquote><p>A compound capable of transferring a hydrogen ion in solution. Being harsh or corrosive in tone. Having an acid, sharp or tangy taste. A powerful hallucinogenic drug manufactured from lysergic acid. Having a pH less than 7, or being sour, or having the strength to neutralize alkalis, or turning a litmus paper red.</blockquote><p>Ahora buscaremos "paris", estoy seguro que está ahí. ¿Qué obtuvimos? Nada. No exactamente, tenemos.<blockquote><p>TypeError: results is undefined</blockquote><p>Pero tambíen tenemos un botón impredecible que se congela en ocasiones. ¿Pero qué queremos? ¿Qué queremos en realidad? Seguridad, objetos que no hagan estallar nuestra aplicación, queremos objetos confiables.<p>Entonces lo que haremos será implementar una especie de contenedor que nos permita describir el flujo de ejecución sin tener que preocuparnos por el valor que este contenga. ¿Suena bien, no? Déjenme mostrarles lo que quiero decir con un poco de javascript. Intenten esto.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>const</span><span style=color:#7e9cd8> is_even</span><span style=color:#e6c384> =</span><span> num</span><span style=color:#957fb8> =></span><span> num</span><span style=color:#e6c384> %</span><span style=color:#d27e99> 2</span><span style=color:#e6c384> ===</span><span style=color:#d27e99> 0</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> odd_arr</span><span style=color:#e6c384> =</span><span style=color:#9cabca> [</span><span style=color:#d27e99>1</span><span style=color:#9cabca>,</span><span style=color:#d27e99>3</span><span style=color:#9cabca>,</span><span style=color:#d27e99>4</span><span style=color:#9cabca>,</span><span style=color:#d27e99>5</span><span style=color:#9cabca>].</span><span style=color:#7e9cd8>filter</span><span style=color:#9cabca>(</span><span>is_even</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#957fb8> =></span><span> val</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>toString</span><span style=color:#9cabca>());</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> empty_arr</span><span style=color:#e6c384> =</span><span style=color:#9cabca> [].</span><span style=color:#7e9cd8>filter</span><span style=color:#9cabca>(</span><span>is_even</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#957fb8> =></span><span> val</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>toString</span><span style=color:#9cabca>());</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>console</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>log</span><span style=color:#9cabca>({</span><span>odd_arr</span><span style=color:#9cabca>,</span><span> empty_arr</span><span style=color:#9cabca>});</span></span></code></pre><p>¿Generó un error el arreglo vacío? (si lo hizo díganme). ¿No es genial? ¿No se siente bien saber que los métodos del arreglo harán lo correcto incluso si no tienen nada con qué trabajar? Eso es lo que queremos.<p>Tal vez se estén preguntando ¿No puedo simplemente poner un <code>if</code> y ya? Bueno... sí, ¿pero eso qué tiene de divertido? Todos saben que hacer una cadena de funciones se ve genial, y somos fánaticos de la "programación funcional," así que haremos lo que los conocedores de ese paradigma harían: <strong>esconderemos todo dentro de una función</strong>.<p>Entonces lo que haremos será esconder un par de <code>if</code>, si el valor que debemos evaluar es indefinido devolveremos un contenedor que sabrá qué hacer sin importar lo que pase.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// maybe.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span>the_thing</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  if</span><span style=color:#9cabca>(</span><span>the_thing</span><span style=color:#e6c384> ===</span><span style=color:#ffa066> null</span><span> </span></span>
<span class=giallo-l><span style=color:#e6c384>     ||</span><span> the_thing</span><span style=color:#e6c384> ===</span><span style=color:#ffa066> undefined</span><span> </span></span>
<span class=giallo-l><span style=color:#e6c384>     ||</span><span> the_thing</span><span style=color:#9cabca>.</span><span style=color:#e6c384>is_nothing</span></span>
<span class=giallo-l><span style=color:#9cabca>  ) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span style=color:#7e9cd8> Nothing</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>  // No queremos estructuras anidadas.</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  if</span><span style=color:#9cabca>(</span><span>the_thing</span><span style=color:#9cabca>.</span><span style=color:#e6c384>is_just</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span> the_thing</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span style=color:#7e9cd8> Just</span><span style=color:#9cabca>(</span><span>the_thing</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span>
<span class=giallo-l></span></code></pre><p>Pero estos contenedores no serán los típicos <code>Maybe</code> que se ven en un lenguaje propio del paradigma funcional. Nosotros haremos trampa en el nombre de la conveniencia y los efectos secundarios. Sus métodos estaran inspirados por el tipo de dato <code>Option</code> que tiene Rust. Aquí es donde está la magia.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// maybe.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> Just</span><span style=color:#9cabca>(</span><span>thing</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span style=color:#9cabca> {</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    map</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>fun</span><span style=color:#9cabca>(</span><span>thing</span><span style=color:#9cabca>)),</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    and_then</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> fun</span><span style=color:#9cabca>(</span><span>thing</span><span style=color:#9cabca>),</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    or_else</span><span style=color:#9cabca>: ()</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span>thing</span><span style=color:#9cabca>),</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    tap</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span style=color:#9cabca> (</span><span style=color:#7e9cd8>fun</span><span style=color:#9cabca>(</span><span>thing</span><span style=color:#9cabca>),</span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span>thing</span><span style=color:#9cabca>)),</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    unwrap_or</span><span style=color:#9cabca>: ()</span><span style=color:#957fb8> =></span><span> thing</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span>    </span></span>
<span class=giallo-l><span style=color:#7e9cd8>    filter</span><span style=color:#9cabca>:</span><span> predicate_fun</span><span style=color:#957fb8> =></span><span> </span></span>
<span class=giallo-l><span style=color:#7e9cd8>      predicate_fun</span><span style=color:#9cabca>(</span><span>thing</span><span style=color:#9cabca>)</span><span> </span></span>
<span class=giallo-l><span style=color:#e6c384>        ?</span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span>thing</span><span style=color:#9cabca>)</span><span> </span></span>
<span class=giallo-l><span style=color:#e6c384>        :</span><span style=color:#7e9cd8> Nothing</span><span style=color:#9cabca>(),</span></span>
<span class=giallo-l><span>    </span></span>
<span class=giallo-l><span>    is_just</span><span style=color:#9cabca>:</span><span style=color:#ffa066> true</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span>    is_nothing</span><span style=color:#9cabca>:</span><span style=color:#ffa066> false</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    inspect</span><span style=color:#9cabca>: ()</span><span style=color:#957fb8> =></span><span style=color:#98bb6c> `Just(</span><span style=color:#9cabca>${</span><span>thing</span><span style=color:#9cabca>}</span><span style=color:#98bb6c>)`</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span style=color:#9cabca>  };</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> Nothing</span><span style=color:#9cabca>() {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span style=color:#9cabca> {</span></span>
<span class=giallo-l><span>    map</span><span style=color:#9cabca>:</span><span> Nothing</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span>    and_then</span><span style=color:#9cabca>:</span><span> Nothing</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    or_else</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> fun</span><span style=color:#9cabca>(),</span></span>
<span class=giallo-l><span>    tap</span><span style=color:#9cabca>:</span><span> Nothing</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    unwrap_or</span><span style=color:#9cabca>:</span><span> arg</span><span style=color:#957fb8> =></span><span> arg</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    filter</span><span style=color:#9cabca>:</span><span> Nothing</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    is_just</span><span style=color:#9cabca>:</span><span style=color:#ffa066> false</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span>    is_nothing</span><span style=color:#9cabca>:</span><span style=color:#ffa066> true</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    inspect</span><span style=color:#9cabca>: ()</span><span style=color:#957fb8> =></span><span style=color:#98bb6c> `Nothing`</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span style=color:#9cabca>  };</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>¿Qué hacen estos métodos?<ul><li><code>map</code>: Aplica la función <code>fun</code> a <code>the_thing</code> y vuelve a colocarlo en un <code>Maybe</code> para mantener la forma del objeto, esto para que podamos encadenar más funciones.<li><code>and_then</code>: Este sólo está ahí para los casos de emergencia. Aplica la función <code>fun</code> y que el destino decida el resto.<li><code>or_else</code>: Este sería el complemento <code>else</code> para nuestro <code>map</code> y <code>and_then</code>. Es el otro camino. El "¿qué pasa si no hay nada ahí?"<li><code>tap</code>: Está ahí para cuando necesitemos una función que afecta algo que está fuera de su ámbito (o tal vez es sólo para colocar un <code>console.log</code>).<li><code>filter</code>: Si la función que proporcionas devuelve <code>true</code> o algo parecido entonces "te dejará pasar."<li><code>unwrap_or</code>: Este es el que saca el valor del contenedor. Usarán esto cuando se cansen de encadenar funciones y estén listos para volver al mundo imperativo.</ul><p>Volvamos a nuestro formulario para aplicar todo esto. Crearemos una función <code>search</code> que puede o no devolvernos un resultado a la consulta del usuario. Si lo hace encadenamos otras funciones que se ejecutarán en un "contexto seguro."<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// main.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span style=color:#7e9cd8> search</span><span style=color:#e6c384> =</span><span style=color:#9cabca> (</span><span>data</span><span style=color:#9cabca>,</span><span> input</span><span style=color:#9cabca>)</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span>data</span><span style=color:#9cabca>[</span><span>input</span><span style=color:#9cabca>]);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span style=color:#7e9cd8> search_word</span><span style=color:#e6c384> =</span><span> word</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> search</span><span style=color:#9cabca>(</span><span>entries</span><span style=color:#9cabca>,</span><span> word</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#9cabca>  .</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>format</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#9cabca>  .</span><span style=color:#7e9cd8>unwrap_or</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'word not found'</span><span style=color:#9cabca>);</span></span></code></pre><p>Ahora reemplazamos la antigua función.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=diff><span class=giallo-l><span> window.search_form.addEventListener('submit', function(ev) {</span></span>
<span class=giallo-l><span>   ev.preventDefault();</span></span>
<span class=giallo-l><span>   let input = ev.target[0];</span></span>
<span class=giallo-l><span style=color:#9cabca>-</span><span style=color:#c34043>  window.result.innerHTML = format(entries[input.value]);</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a>  window.result.innerHTML = search_word(input.value);</span></span>
<span class=giallo-l><span> });</span></span></code></pre><p>Probemos. Buscaremos "accident."<blockquote><p>An unexpected, unfortunate mishap, failure or loss with the potential for harming human life, property or the environment. An event that happens suddenly or by chance without an apparent cause.</blockquote><p>Ahora Paris. Busquemos "paris."<blockquote><p>word not found</blockquote><p>No congeló el botón, eso es bueno. Pero yo sé que Paris está ahí. Si revisan verán que está "Paris." Sólo tendremos que colocar en mayúscula la primera letra para que el usuario no tenga que hacerlo. Primero intentaremos buscar la palabra exacta y luego intentamos del otro modo.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// main.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> create_search</span><span style=color:#9cabca>(</span><span>data</span><span style=color:#9cabca>,</span><span> exact</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> input</span><span style=color:#957fb8> =></span><span style=color:#9cabca> {</span></span>
<span class=giallo-l><span style=color:#957fb8>    const</span><span> word</span><span style=color:#e6c384> =</span><span> exact</span><span style=color:#e6c384> ?</span><span> input</span><span style=color:#e6c384> :</span><span style=color:#7e9cd8> capitalize</span><span style=color:#9cabca>(</span><span>input</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span>data</span><span style=color:#9cabca>[</span><span>word</span><span style=color:#9cabca>]);</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> capitalize</span><span style=color:#9cabca>(</span><span>str</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> str</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>charAt</span><span style=color:#9cabca>(</span><span style=color:#d27e99>0</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>toUpperCase</span><span style=color:#9cabca>()</span><span style=color:#e6c384> +</span><span> str</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>slice</span><span style=color:#9cabca>(</span><span style=color:#d27e99>1</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>Modificamos la función <code>search</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=diff><span class=giallo-l><span style=color:#9cabca>-</span><span style=color:#c34043> const search = (data, input) => Maybe(data[input]);</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a> const search = create_search(entries, true);</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a> const search_name = create_search(entries, false);</span></span>
<span class=giallo-l><span style=color:#9cabca>-</span></span>
<span class=giallo-l><span style=color:#9cabca>-</span><span style=color:#c34043> const search_word = word => search(entries, word)</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a> const search_word = word => search(word)</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a>   .or_else(() => search_name(word))</span></span>
<span class=giallo-l><span>    .map(format)</span></span>
<span class=giallo-l><span>    .unwrap_or('word not found');</span></span></code></pre><p>Bien. Esto es lo que tenemos hasta ahora en <code>main.js</code> si quieren ver todo el panorama.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// main.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> entries</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> data</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> create_search</span><span style=color:#9cabca>(</span><span>data</span><span style=color:#9cabca>,</span><span> exact</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> input</span><span style=color:#957fb8> =></span><span style=color:#9cabca> {</span></span>
<span class=giallo-l><span style=color:#957fb8>    const</span><span> word</span><span style=color:#e6c384> =</span><span> exact</span><span style=color:#e6c384> ?</span><span> input</span><span style=color:#e6c384> :</span><span style=color:#7e9cd8> capitalize</span><span style=color:#9cabca>(</span><span>input</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span>data</span><span style=color:#9cabca>[</span><span>word</span><span style=color:#9cabca>]);</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> capitalize</span><span style=color:#9cabca>(</span><span>str</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> str</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>charAt</span><span style=color:#9cabca>(</span><span style=color:#d27e99>0</span><span style=color:#9cabca>).</span><span style=color:#7e9cd8>toUpperCase</span><span style=color:#9cabca>()</span><span style=color:#e6c384> +</span><span> str</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>slice</span><span style=color:#9cabca>(</span><span style=color:#d27e99>1</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> format</span><span style=color:#9cabca>(</span><span>results</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> results</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>join</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'&lt;br>'</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> search</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> create_search</span><span style=color:#9cabca>(</span><span>entries</span><span style=color:#9cabca>,</span><span style=color:#ffa066> true</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> search_name</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> create_search</span><span style=color:#9cabca>(</span><span>entries</span><span style=color:#9cabca>,</span><span style=color:#ffa066> false</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span style=color:#7e9cd8> search_word</span><span style=color:#e6c384> =</span><span> word</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> search</span><span style=color:#9cabca>(</span><span>word</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#9cabca>  .</span><span style=color:#7e9cd8>or_else</span><span style=color:#9cabca>(()</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> search_name</span><span style=color:#9cabca>(</span><span>word</span><span style=color:#9cabca>))</span></span>
<span class=giallo-l><span style=color:#9cabca>  .</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>format</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#9cabca>  .</span><span style=color:#7e9cd8>unwrap_or</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'word not found'</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>window</span><span style=color:#9cabca>.</span><span>search_form</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>addEventListener</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>'submit'</span><span style=color:#9cabca>,</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>ev</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span>  ev</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>preventDefault</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l><span style=color:#957fb8>  let</span><span> input</span><span style=color:#e6c384> =</span><span> ev</span><span style=color:#9cabca>.</span><span style=color:#e6c384>target</span><span style=color:#9cabca>[</span><span style=color:#d27e99>0</span><span style=color:#9cabca>];</span></span>
<span class=giallo-l><span>  window</span><span style=color:#9cabca>.</span><span>result</span><span style=color:#9cabca>.</span><span style=color:#e6c384>innerHTML =</span><span style=color:#7e9cd8> search_word</span><span style=color:#9cabca>(</span><span>input</span><span style=color:#9cabca>.</span><span style=color:#e6c384>value</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#9cabca>});</span></span></code></pre><p>¿Pero es todo lo que queremos? No, claro que no, también queremos encontrar el amor, pero ya que javascript no puede hacer eso, nos conformaremos con agregar una funcionalidad de "sugerencia." Quiero que cuando escriba "accu" y presione el botón, que salga un dialogo que me diga "Did you mean accumulator?" (en inglés porque no me pagan lo suficiente para traducir los mensajes del sistema)<p>Para esto necesitaremos ayuda, instalaremos una dependencia, una que encuentre resultados similares: <a rel="noopener external" href=https://github.com/wouter2203/fuzzy-search#readme target=_blank>fuzzy-search</a>. Agreguemos lo siguiente.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// main.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#ffa066>import</span><span> FuzzySearch</span><span style=color:#957fb8> from</span><span style=color:#98bb6c> 'https://unpkg.com/fuzzy-search@3.0.1/src/FuzzySearch.js'</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span> fzf</span><span style=color:#e6c384> = new</span><span style=color:#7e9cd8> FuzzySearch</span><span style=color:#9cabca>(</span></span>
<span class=giallo-l><span>  Object</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>keys</span><span style=color:#9cabca>(</span><span>entries</span><span style=color:#9cabca>),</span></span>
<span class=giallo-l><span style=color:#9cabca>  [],</span></span>
<span class=giallo-l><span style=color:#9cabca>  {</span><span>caseSensitive</span><span style=color:#9cabca>:</span><span style=color:#ffa066> false</span><span style=color:#9cabca>,</span><span> sort</span><span style=color:#9cabca>:</span><span style=color:#ffa066> true</span><span style=color:#9cabca>}</span></span>
<span class=giallo-l><span style=color:#9cabca>);</span></span></code></pre><p>Pero volvemos a la misma situación, esta no sería una operación segura porque en el momento que intentemos sacar un resultado de un arreglo vacío todo se cae. ¿Entonces qué hacemos? Escondemos todo debajo de una función.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// main.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> suggest</span><span style=color:#9cabca>(</span><span>word</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8>  const</span><span> matches</span><span style=color:#e6c384> =</span><span> fzf</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>search</span><span style=color:#9cabca>(</span><span>word</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span>matches</span><span style=color:#9cabca>[</span><span style=color:#d27e99>0</span><span style=color:#9cabca>]);</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>FuzzySearch está listo, ahora agregaremos un grandioso dialogo de confirmación.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// main.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> confirm_word</span><span style=color:#9cabca>(</span><span>value</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  if</span><span style=color:#9cabca>(</span><span>value</span><span style=color:#e6c384> &&</span><span style=color:#7e9cd8> confirm</span><span style=color:#9cabca>(</span><span style=color:#98bb6c>`Did you mean </span><span style=color:#9cabca>${</span><span>value</span><span style=color:#9cabca>}</span><span style=color:#98bb6c>`</span><span style=color:#9cabca>)) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span> value</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>Combinemos las nuevas funciones con <code>search</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// main.js</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>const</span><span style=color:#7e9cd8> suggest_word</span><span style=color:#e6c384> =</span><span> value</span><span style=color:#957fb8> =></span><span style=color:#9cabca> ()</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> suggest</span><span style=color:#9cabca>(</span><span>value</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#9cabca>  .</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>confirm_word</span><span style=color:#9cabca>)</span></span>
<span class=giallo-l><span style=color:#9cabca>  .</span><span style=color:#7e9cd8>map</span><span style=color:#9cabca>(</span><span>search</span><span style=color:#9cabca>);</span></span></code></pre><p>Agregamos la nueva funcionalidad a <code>search_word</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=diff><span class=giallo-l><span> const search_word = word => search(word)</span></span>
<span class=giallo-l><span>   .or_else(() => search_name(word))</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a>  .or_else(suggest_word(word))</span></span>
<span class=giallo-l><span>   .map(format)</span></span>
<span class=giallo-l><span>   .unwrap_or('word not found');</span></span></code></pre><p>Funciona. Pero ahora digamos que somos alérgicos a los <code>if</code>, sin mencionar que es de mala educación devolver <code>undefined</code> de una función. Podemos ser mejores.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=diff><span class=giallo-l><span> function confirm_word(value) {</span></span>
<span class=giallo-l><span style=color:#9cabca>-</span><span style=color:#c34043>  if(value && confirm(`Did you mean ${value}`)) {</span></span>
<span class=giallo-l><span style=color:#9cabca>-</span><span style=color:#c34043>    return value;</span></span>
<span class=giallo-l><span style=color:#9cabca>-</span><span style=color:#c34043>  }</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a>  return confirm(`Did you mean ${value}`);</span></span>
<span class=giallo-l><span> }</span></span></code></pre><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=diff><span class=giallo-l><span> const suggest_word = value => () => suggest(value)</span></span>
<span class=giallo-l><span style=color:#9cabca>-</span><span style=color:#c34043>  .map(confirm_word)</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a>  .filter(confirm_word)</span></span>
<span class=giallo-l><span>   .map(search);</span></span></code></pre><p>Algo me molesta. Cuando busco "accu," el dialogo aparece, confirmo la sugerencia y el resultado aparece. Pero "accu" sigue ahí en el formulario, es incómodo. Haremos el formulario se actualice con la palabra correcta.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>const</span><span style=color:#7e9cd8> update_input</span><span style=color:#e6c384> =</span><span> val</span><span style=color:#957fb8> =></span><span> window</span><span style=color:#9cabca>.</span><span style=color:#e6c384>search_form</span><span style=color:#9cabca>[</span><span style=color:#d27e99>0</span><span style=color:#9cabca>].</span><span style=color:#e6c384>value =</span><span> val</span><span style=color:#9cabca>;</span></span></code></pre><pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=diff><span class=giallo-l><span> const suggest_word = value => () => suggest(value)</span></span>
<span class=giallo-l><span>   .filter(confirm_word)</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a>  .tap(update_input)</span></span>
<span class=giallo-l><span>   .map(search);</span></span></code></pre><p>¿Quieren verlo en acción? Aquí tienen.<p data-pen-title="Maybe I got your word" style="box-sizing:border-box;border:2px solid;justify-content:center;align-items:center;height:600px;margin:1em 0;padding:1em;display:flex" class=codepen data-default-tab=js,result data-height=600 data-preview=true data-slug-hash=JjjNvLE data-theme-id=dark data-user=VonHeikemen><span> See the Pen <a href=https://codepen.io/VonHeikemen/pen/JjjNvLE>Maybe I got your word</a> by Heiker (<a href=https://codepen.io/VonHeikemen>@VonHeikemen</a>) on <a href=https://codepen.io>CodePen</a>. </span></p><script async src=https://static.codepen.io/assets/embed/ei.js></script><h2 id=bonus-track>Bonus track</h2><blockquote><p><em>Advertencia</em>: El objetivo de todo esto ya fue logrado, que vieran ese ejemplo en codepen. Lo que sigue es un experimento para ver si podía agregar soporte de operaciones asíncronas en la función <code>Maybe</code>. Si ya están cansados vayan directo al final y vean el último ejemplo.</blockquote><p>Ahora quizá estén pensando: muy bonito y todo pero en el "mundo real" hacemos peticiones a servidores, consultamos bases de datos, hacemos todo tipo de cosas asíncronas, ¿puedo usar eso en este contexto?<p>Bien. Entiendo. La implementación actual sólo contempla tareas normales. Tendrían que romper la cadena de <code>Maybe</code>s en el momento que aparezca una promesa (<code>Promise</code>)<p>Podemos crear un nuevo <code>Just</code> que esté consciente de que contiene una promesa. Es perfectamente posible, ¿un <code>AsyncJust</code>? ¿<code>JustAsync</code>? Suena horrible.<p>Por si no lo saben, una promesa en javascript (me refiero a una instancia de la clase <code>Promise</code>) es un tipo de dato que se utiliza para coordinar eventos futuros. Lo hace usando un método llamado <code>then</code> el cual acepta una función (lo que llaman callback) y también tiene un método <code>catch</code> para cuando las cosas salen mal. Pero si controlamos lo que va dentro del <code>then</code> podemos mantener la misma interface del <code>Maybe</code>.<p>¿Qué tan buenos son siguiendo un montón de callbacks?<p>Aquí está. Lo llamaré <code>Future</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#727169>// no me juzguen</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> Future</span><span style=color:#9cabca>(</span><span>promise_thing</span><span style=color:#9cabca>) {</span><span> </span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span style=color:#9cabca> {</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    map</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> Future</span><span style=color:#9cabca>(</span><span>promise_thing</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>map_future</span><span style=color:#9cabca>(</span><span>fun</span><span style=color:#9cabca>))),</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    and_then</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> Future</span><span style=color:#9cabca>(</span><span>promise_thing</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>map_future</span><span style=color:#9cabca>(</span><span>fun</span><span style=color:#9cabca>))),</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    or_else</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> Future</span><span style=color:#9cabca>(</span><span>promise_thing</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>catch</span><span style=color:#9cabca>(</span><span>fun</span><span style=color:#9cabca>)),</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    tap</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> Future</span><span style=color:#9cabca>(</span><span>promise_thing</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#957fb8> =></span><span style=color:#9cabca> (</span><span style=color:#7e9cd8>fun</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#9cabca>),</span><span> val</span><span style=color:#9cabca>))),</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    unwrap_or</span><span style=color:#9cabca>:</span><span> arg</span><span style=color:#957fb8> =></span><span> promise_thing</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>catch</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#957fb8> =></span><span> arg</span><span style=color:#9cabca>),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#7e9cd8>    filter</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span style=color:#7e9cd8> Future</span><span style=color:#9cabca>(</span><span>promise_thing</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>filter_future</span><span style=color:#9cabca>(</span><span>fun</span><span style=color:#9cabca>))),</span><span> </span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    is_just</span><span style=color:#9cabca>:</span><span style=color:#ffa066> false</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span>    is_nothing</span><span style=color:#9cabca>:</span><span style=color:#ffa066> false</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span>    is_future</span><span style=color:#9cabca>:</span><span style=color:#ffa066> true</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span style=color:#7e9cd8>    inspect</span><span style=color:#9cabca>: ()</span><span style=color:#957fb8> =></span><span style=color:#98bb6c> `&lt;Promise>`</span></span>
<span class=giallo-l><span style=color:#9cabca>  };</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>Si apartamos todo el ruido tal vez se pueda entender mejor.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l></span>
<span class=giallo-l><span style=color:#9cabca>{</span></span>
<span class=giallo-l><span style=color:#7aa89f>  map</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span> promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>fun</span><span style=color:#9cabca>),</span></span>
<span class=giallo-l><span style=color:#7aa89f>  and_then</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span> promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>fun</span><span style=color:#9cabca>),</span></span>
<span class=giallo-l><span style=color:#7aa89f>  or_else</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span> promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>catch</span><span style=color:#9cabca>(</span><span>fun</span><span style=color:#9cabca>),</span></span>
<span class=giallo-l><span style=color:#7aa89f>  tap</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span> promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#957fb8> =></span><span style=color:#9cabca> (</span><span style=color:#7e9cd8>fun</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#9cabca>),</span><span> val</span><span style=color:#9cabca>))</span><span>)</span><span style=color:#9cabca>,</span></span>
<span class=giallo-l><span style=color:#7aa89f>  unwrap_or</span><span style=color:#9cabca>:</span><span> arg</span><span style=color:#957fb8> =></span><span> promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>catch</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#957fb8> =></span><span> arg</span><span style=color:#9cabca>),</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#7aa89f>  filter</span><span style=color:#9cabca>:</span><span> fun</span><span style=color:#957fb8> =></span><span> promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>fun</span><span style=color:#9cabca>),</span><span> </span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><ul><li><code>map</code>/<code>and_then</code>: estos son iguales porque no puedes escaparte de una promesa.<li><code>or_else</code>: toma la función proporcionada y la pasa al método <code>catch</code>, esto para imitar el comportamiento de un <code>else</code>.<li><code>tap</code>: usa el método <code>then</code> para "echarle un vistazo" al valor dentro de la promesa. Este método es conviniente para colocar esas funciones "impuras" que tienen efecto sobre el mundo exterior.<li><code>unwrap_or</code>: Esto devuelve la promesa para que puedan usar <code>await</code>. Si todo sale bien obtendrán el valor original de la promesa, sino devolverá el primer parámetro que fue proporcionado.<li><code>filter</code>: este es un caso especial de <code>map</code>, es por eso que existe <code>filter_future</code>.<li>Casi todos estos métodos devuelven un nuevo <code>Future</code> porque <code>promise.then</code> siempre devuelve una nueva promesa.</ul><p>Pero lo que hace que <code>Future</code> sea raro es lo que pasa dentro de <code>map</code>. ¿Recuerdan <code>map_future</code>?<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> map_future</span><span style=color:#9cabca>(</span><span>fun</span><span style=color:#9cabca>) {</span><span style=color:#727169> // `fun` es el callback proporcionado</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> val</span><span style=color:#957fb8> =></span><span style=color:#9cabca> {</span></span>
<span class=giallo-l><span style=color:#727169>    /* Evaluemos el valor original de la promesa */</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8>    let</span><span> promise_content</span><span style=color:#e6c384> =</span><span> val</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    // Necesitamos decidir si podemos confiar </span></span>
<span class=giallo-l><span style=color:#727169>    // en el valor original</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    if</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>Maybe</span><span style=color:#9cabca>(</span><span>promise_content</span><span style=color:#9cabca>).</span><span style=color:#e6c384>is_nothing</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#7aa89f>      Promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>reject</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>      return</span><span style=color:#9cabca>;</span></span>
<span class=giallo-l><span style=color:#9cabca>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    // Si es un Just obtenemos su contenido</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    if</span><span style=color:#9cabca>(</span><span>promise_content</span><span style=color:#9cabca>.</span><span style=color:#e6c384>is_just</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span>      promise_content</span><span style=color:#e6c384> =</span><span> val</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>unwrap_or</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l><span style=color:#9cabca>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    /* Evaluemos el valor que devuelve el callback */</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    // Usaremos Maybe otra vez </span></span>
<span class=giallo-l><span style=color:#727169>    // porque tengo problemas de confianza.</span></span>
<span class=giallo-l><span style=color:#957fb8>    const</span><span> result</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> Maybe</span><span style=color:#9cabca>(</span><span style=color:#7e9cd8>fun</span><span style=color:#9cabca>(</span><span>promise_content</span><span style=color:#9cabca>));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    if</span><span style=color:#9cabca>(</span><span>result</span><span style=color:#9cabca>.</span><span style=color:#e6c384>is_just</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#727169>      // Si llegamos hasta aquí todo está bien.</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>      return</span><span> result</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>unwrap_or</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l><span style=color:#9cabca>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    // en este punto debería revisar si result</span></span>
<span class=giallo-l><span style=color:#727169>    // tiene un Future pero de ser así</span></span>
<span class=giallo-l><span style=color:#727169>    // lo están usando mal, así que por ahora</span></span>
<span class=giallo-l><span style=color:#727169>    // no hago nada.</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    // Algo anda muy mal.</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span style=color:#7aa89f> Promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>reject</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>Ahora <code>filter_future</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span style=color:#957fb8>function</span><span style=color:#7e9cd8> filter_future</span><span style=color:#9cabca>(</span><span>predicate_fun</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span> val</span><span style=color:#957fb8> =></span><span style=color:#9cabca> {</span></span>
<span class=giallo-l><span style=color:#957fb8>    const</span><span> result</span><span style=color:#e6c384> =</span><span style=color:#7e9cd8> predicate_fun</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>    // ¿Acaso devolviste una promesa?</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    if</span><span style=color:#9cabca>(</span><span>result</span><span style=color:#9cabca>.</span><span style=color:#e6c384>then</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#727169>      // Lo hiciste. Es por eso que no te pasan cosas buenas.</span></span>
<span class=giallo-l><span> </span></span>
<span class=giallo-l><span style=color:#727169>      // veamos dentro de la promesa.</span></span>
<span class=giallo-l><span style=color:#957fb8>      const</span><span style=color:#7e9cd8> return_result</span><span style=color:#e6c384> =</span><span> the_real_result</span><span style=color:#957fb8> =></span><span> the_real_result </span></span>
<span class=giallo-l><span style=color:#e6c384>        ?</span><span> val</span></span>
<span class=giallo-l><span style=color:#e6c384>        :</span><span style=color:#7aa89f> Promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>reject</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#727169>      // mantenemos la cadena viva.</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>      return</span><span> result</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>then</span><span style=color:#9cabca>(</span><span>return_result</span><span style=color:#9cabca>);</span></span>
<span class=giallo-l><span style=color:#9cabca>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>    return</span><span> result</span><span style=color:#e6c384> ?</span><span> val</span><span style=color:#e6c384> :</span><span style=color:#7aa89f> Promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>reject</span><span style=color:#9cabca>();</span></span>
<span class=giallo-l><span style=color:#9cabca>  }</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>Lo último que me gustaría hacer es crear una función que convierta un valor regular en un <code>Future</code>.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=javascript><span class=giallo-l><span>Future</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>from_val</span><span style=color:#e6c384> =</span><span style=color:#957fb8> function</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#9cabca>) {</span></span>
<span class=giallo-l><span style=color:#957fb8;font-weight:700>  return</span><span style=color:#7e9cd8> Future</span><span style=color:#9cabca>(</span><span style=color:#7aa89f>Promise</span><span style=color:#9cabca>.</span><span style=color:#7e9cd8>resolve</span><span style=color:#9cabca>(</span><span>val</span><span style=color:#9cabca>));</span></span>
<span class=giallo-l><span style=color:#9cabca>}</span></span></code></pre><p>Ahora lo que tenemos que hacer para agregar soporte dentro de <code>Maybe</code> es esto.<pre class=giallo style=color:#dcd7ba;background-color:#1f1f28><code data-lang=diff><span class=giallo-l><span> function Maybe(the_thing) {</span></span>
<span class=giallo-l><span>   if(the_thing === null </span></span>
<span class=giallo-l><span>     || the_thing === undefined </span></span>
<span class=giallo-l><span>     || the_thing.is_nothing</span></span>
<span class=giallo-l><span>   ) {</span></span>
<span class=giallo-l><span>     return Nothing();</span></span>
<span class=giallo-l><span>   }</span></span>
<span class=giallo-l><span style=color:#9cabca>-</span></span>
<span class=giallo-l><span style=color:#9cabca>-</span><span style=color:#c34043>  if(the_thing.is_just) {</span></span>
<span class=giallo-l><span style=color:#9cabca>+</span><span style=color:#76946a>  if(the_thing.is_future || the_thing.is_just) {</span></span>
<span class=giallo-l><span>     return the_thing;</span></span>
<span class=giallo-l><span>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    return Just(the_thing);</span></span>
<span class=giallo-l><span> }</span></span></code></pre><p>Pero la pregunta del millón sigue ahí. ¿Funciona?<p>Hice una "<a rel="noopener external" href=https://github.com/VonHeikemen/maybe-type-in-js target=_blank>versión para terminal</a>" de esta aplicación. También modifiqué el ejemplo de codepen: agregué las funciones relacionadas con <code>Future</code>, el dialogo de confirmación ahora sí es un dialogo (<a rel="noopener external" href=https://github.hubspot.com/vex/ target=_blank>este</a>) y la función del evento 'submit' la marqué con <code>async</code> para poder usar <code>await</code>.<p data-pen-title="Maybe I will promise you a word" style="box-sizing:border-box;border:2px solid;justify-content:center;align-items:center;height:600px;margin:1em 0;padding:1em;display:flex" class=codepen data-default-tab=js,result data-height=600 data-preview=true data-slug-hash=oNNwagG data-theme-id=dark data-user=VonHeikemen><span> See the Pen <a href=https://codepen.io/VonHeikemen/pen/oNNwagG>Maybe I will promise you a word</a> by Heiker (<a href=https://codepen.io/VonHeikemen>@VonHeikemen</a>) on <a href=https://codepen.io>CodePen</a>. </span><h3 id=bonus-bonus-edit>Bonus bonus edit</h3><p>Antes mencioné que haríamos trampa con esta implementación. <a rel="noopener external" href=https://codepen.io/VonHeikemen/pen/QWWYJwZ target=_blank>Así sería</a> con una implementación más apegada a las ideas del paradigma funcional.<hr><p>¿Tienen alguna pregunta? Pueden dejar un comentario en cualquiera de estas plataformas:<ul><li><a href=https://dev.to/vonheikemen/un-poco-del-paradigma-funcional-en-tu-javascript-usando-un-maybe-4a33 rel=noopener target=_blank>dev.to</a><li><a href=https://vonheikemen.hashnode.dev/using-a-maybe-es rel=noopener target=_blank>Hashnode</a></ul><p>Pueden contactarme por las redes sociales:<ul><li>Twitter <a rel="noopener me" href=https://twitter.com/VonHeikemen_ target=_blank> @VonHeikemen_ </a><li>Bluesky <a rel="noopener me" href=https://bsky.app/profile/vonheikemen.bsky.social target=_blank> @vonheikemen.bsky.social </a><li>Mastodon <a rel="noopener me" href=https://hachyderm.io/@vonheikemen target=_blank> @vonheikemen@hachyderm.io </a></ul><p>Gracias por su tiempo. Si este artículo les pareció útil y quieren apoyar mis esfuerzos para crear más contenido, pueden dejar una propina en buy me a coffee ☕.</p><a href=https://ko-fi.com/vonheikemen style=justify-content:center;display:flex target=_blank> <img alt="Buy Me A Coffee" src="https://storage.ko-fi.com/cdn/kofi2.png?v=3" style=width:217px!important;height:60px!important> </a></div></div>