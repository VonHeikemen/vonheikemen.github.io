<!doctype html><html lang=es><meta http-equiv=x-ua-compatible content="IE=edge"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><meta http-equiv=permissions-policy content="interest-cohort=()"><title>Lenses o mejor dicho getters y setters combinables | Devlog</title><link rel=stylesheet href=https://vonheikemen.github.io/devlog/print.css media=print><link rel=stylesheet href=https://vonheikemen.github.io/devlog/styles.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=me href=https://hachyderm.io/@vonheikemen><link rel=me href=https://twitter.com/VonHeikemen_><meta name=keywords content="javascript,paradigma-funcional,software,coding,development"><meta name=description content="Vamos implementar lenses desde cero"><link rel=canonical href=https://dev.to/vonheikemen/lenses-o-mejor-dicho-getters-y-setters-combinables-kfo><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a></ul>© 2020-2023 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>Lenses o mejor dicho getters y setters combinables</h1><span class=post-date>2019-11-27
| Originalmente publicado en
<a href=https://dev.to/vonheikemen/lenses-o-mejor-dicho-getters-y-setters-combinables-kfo>dev.to</a>
| 11 minutos
| <a href=https://vonheikemen.github.io/devlog/web-development/learn-fp/lenses-a-k-a-composable-getters-and-setters/>Read in english</a></span><p>Esta vez vamos a descubrir qué son lenses (lentes en inglés), cómo se ven en javascript y espero que al final de todo esto podamos crear una implementación casi adecuada.<p>Pero primero vamos a retroceder un poco y vamos a preguntarnos.<h2 id=que-son-getter-y-setter>¿Qué son getter y setter?</h2><p>Son funciones que deben cumplir un propósito, extraer o asignar un valor. Pero claro eso no es lo único que pueden hacer. En la mayoría de los casos (que yo he visto) se usan para observar los cambios a una variable y causar algún efecto o para colocar validaciones que impidan algún comportamiento no deseado.<p>En javascript pueden ser explícitos.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>Some</span><span style=color:#5fb3b3>() {
</span><span>  </span><span style=color:#c594c5>let </span><span>thing </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>stuff</span><span style=color:#5fb3b3>&#39;;
</span><span>
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#69c>get_thing</span><span style=color:#5fb3b3>() {
</span><span style=color:#5fb3b3>      </span><span style=color:#5f6364>// puedes hacer lo que sea aquí
</span><span>      </span><span style=color:#c594c5>return </span><span>thing</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>},
</span><span>    </span><span style=color:#69c>set_thing</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>value</span><span style=color:#5fb3b3>) {
</span><span style=color:#5fb3b3>      </span><span style=color:#5f6364>// igual aquí
</span><span>      thing </span><span style=color:#5fb3b3>= </span><span>value</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>let </span><span>obj </span><span style=color:#5fb3b3>= </span><span style=color:#69c>Some</span><span>()</span><span style=color:#5fb3b3>;
</span><span>obj</span><span style=color:#5fb3b3>.</span><span style=color:#69c>get_thing</span><span>()</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &#39;stuff&#39;
</span><span>
</span><span>obj</span><span style=color:#5fb3b3>.</span><span style=color:#69c>set_thing</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>other stuff</span><span style=color:#5fb3b3>&#39;</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>obj</span><span style=color:#5fb3b3>.</span><span style=color:#69c>get_thing</span><span>()</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &#39;other stuff&#39;
</span></code></pre><p>O pueden ser implícitos.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>let </span><span>some </span><span style=color:#5fb3b3>= {};
</span><span>
</span><span style=color:#fac863>Object</span><span style=color:#5fb3b3>.</span><span style=color:#69c>defineProperty</span><span>(some</span><span style=color:#5fb3b3>, &#39;</span><span style=color:#99c794>thing</span><span style=color:#5fb3b3>&#39;, {
</span><span>  </span><span style=color:#69c>get</span><span style=color:#5fb3b3>() {
</span><span>    </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>thing</span><span style=color:#5fb3b3>&#39;;
</span><span>  </span><span style=color:#5fb3b3>},
</span><span>  </span><span style=color:#69c>set</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>value</span><span style=color:#5fb3b3>) {
</span><span>    </span><span style=color:#fac863>console</span><span style=color:#5fb3b3>.</span><span style=color:#69c>log</span><span>(</span><span style=color:#5fb3b3>&quot;</span><span style=color:#99c794>no pasarás</span><span style=color:#5fb3b3>&quot;</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>some</span><span style=color:#5fb3b3>.</span><span>thing </span><span style=color:#5f6364>// =&gt; &#39;thing&#39;
</span><span>some</span><span style=color:#5fb3b3>.</span><span>thing </span><span style=color:#5fb3b3>= &#39;</span><span style=color:#99c794>what?</span><span style=color:#5fb3b3>&#39;;
</span><span>
</span><span style=color:#5f6364>//
</span><span style=color:#5f6364>// no pasarás
</span><span style=color:#5f6364>//
</span><span>
</span><span>some</span><span style=color:#5fb3b3>.</span><span>thing </span><span style=color:#5f6364>// =&gt; &#39;thing&#39;
</span></code></pre><p>¿Pero qué tiene eso de malo que algunas personas sienten la necesidad de usar alternativas como lenses?<p>Comencemos con el segundo ejemplo. Puedo decirles a algunas personas no les gustan las cosas mágicas, el sólo hecho de tener una función que se ha estado ejecutando sin su conocimiento es suficiente para evitarlos.<p>El primer ejemplo es más interesante. Vamos a verlo otra vez.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span>obj</span><span style=color:#5fb3b3>.</span><span style=color:#69c>get_thing</span><span>()</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &#39;stuff&#39;
</span><span>
</span><span>obj</span><span style=color:#5fb3b3>.</span><span style=color:#69c>set_thing</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>other stuff</span><span style=color:#5fb3b3>&#39;</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>obj</span><span style=color:#5fb3b3>.</span><span style=color:#69c>get_thing</span><span>()</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &#39;other stuff&#39;
</span></code></pre><p>Se ejecuta <code>get_thing</code> el resultado es <code>stuff</code>, hasta ahora todo bien. Pero aquí viene el problema, cuando lo usas otra vez y de la misma manera obtienes <code>other stuff</code>. Tienes que rastrear la última llamada a <code>set_thing</code> para saber lo que obtendrás. No tienes la capacidad de predicir el resultado de <code>get_thing</code>, no puedes estar 100% seguro sin mirar (o saber) otras partes del código.<h2 id=hay-una-alternativa-mejor>¿Hay una alternativa mejor?</h2><p>No diría mejor. Intentemos crear estos lenses, después pueden decidir si les gusta o no.<p>¿Qué necesitamos? Lenses son un concepto que se encuentra en el paradigma de la programación funcional, entonces lo primero que haremos será crear unas funciones auxiliares. Estas serán nuestra primera versión de getter y setter.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#5f6364>// Getter
</span><span style=color:#c594c5>function </span><span style=color:#69c>prop</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>key</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#f99157>obj </span><span style=color:#c594c5>=&gt; </span><span>obj[key]</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#5f6364>// Setter
</span><span style=color:#c594c5>function </span><span style=color:#69c>assoc</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>key</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>(</span><span style=color:#f99157>val</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) </span><span style=color:#c594c5>=&gt; </span><span style=color:#fac863>Object</span><span style=color:#5fb3b3>.</span><span style=color:#69c>assign</span><span>(</span><span style=color:#5fb3b3>{}, </span><span>obj</span><span style=color:#5fb3b3>, {</span><span>[key]</span><span style=color:#5fb3b3>: </span><span>val</span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Ahora el "constructor."<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>Lens</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>getter</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>setter</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{ </span><span>getter</span><span style=color:#5fb3b3>, </span><span>setter </span><span style=color:#5fb3b3>};
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#5f6364>// Eso es todo.
</span></code></pre><p>Notarán que <code>Lens</code> no hace absolutamente nada, esto es a propósito. Desde ya pueden darse cuenta que la mayor parte del trabajo está en <code>getter</code> y <code>setter</code>. El resultado será tan eficiente como lo sean sus implementaciones de <code>getter</code> y <code>setter</code>.<p>Ahora, para hacer que un <code>lens</code> haga algo útil crearemos tres funciones.<p><code>view</code>: Extrae un valor.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>view</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>lens</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span>   </span><span style=color:#c594c5>return </span><span>lens</span><span style=color:#5fb3b3>.</span><span style=color:#69c>getter</span><span>(obj)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p><code>over</code>: transforma un valor usando un callback.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>over</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>lens</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>fn</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span>lens</span><span style=color:#5fb3b3>.</span><span style=color:#69c>setter</span><span>(
</span><span>    </span><span style=color:#69c>fn</span><span>(lens</span><span style=color:#5fb3b3>.</span><span style=color:#69c>getter</span><span>(obj))</span><span style=color:#5fb3b3>,
</span><span>    obj
</span><span>  )</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p><code>set</code>: reemplaza un valor<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>always</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>val</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>=&gt; </span><span>val</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#69c>set</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>lens</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>val</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span style=color:#5fb3b3>  </span><span style=color:#5f6364>// no es genial? Ya estamos reusando funciones
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>over</span><span>(lens</span><span style=color:#5fb3b3>, </span><span style=color:#69c>always</span><span>(val)</span><span style=color:#5fb3b3>, </span><span>obj)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Es momento de crear unas pruebas.<p>Digamos que tenemos un objeto llamado <code>alice</code>.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>const </span><span>alice </span><span style=color:#5fb3b3>= {
</span><span>  name</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>Alice Jones</span><span style=color:#5fb3b3>&#39;,
</span><span>  address</span><span style=color:#5fb3b3>: </span><span>[</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>22 Walnut St</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>San Francisco</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>CA</span><span style=color:#5fb3b3>&#39;</span><span>]</span><span style=color:#5fb3b3>,
</span><span>  pets</span><span style=color:#5fb3b3>: { </span><span>dog</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>joker</span><span style=color:#5fb3b3>&#39;, </span><span>cat</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>batman</span><span style=color:#5fb3b3>&#39; }
</span><span style=color:#5fb3b3>};
</span></code></pre><p>Empecemos con algo simple, vamos a inspeccionar un valor. Tendríamos que hacer esto.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>const </span><span>result </span><span style=color:#5fb3b3>= </span><span style=color:#69c>view</span><span>(
</span><span>  </span><span style=color:#69c>Lens</span><span>(</span><span style=color:#69c>prop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>name</span><span style=color:#5fb3b3>&#39;</span><span>)</span><span style=color:#5fb3b3>, </span><span style=color:#69c>assoc</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>name</span><span style=color:#5fb3b3>&#39;</span><span>))</span><span style=color:#5fb3b3>,
</span><span>  alice
</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>result </span><span style=color:#5f6364>// =&gt; &quot;Alice Jones&quot;
</span></code></pre><p>Veo que no están impresionados y eso está bien. Acabo de escribir un montón de cosas sólo para ver un nombre. Pero este es el asunto, todo eso son funciones aisladas. Siempre tenemos la opción de combinarlas y crear nuevas. Empecemos con <code>Lens(prop, assoc)</code>, vamos usarlo con mucha frecuencia.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>Lprop</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>key</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>Lens</span><span>(</span><span style=color:#69c>prop</span><span>(key)</span><span style=color:#5fb3b3>, </span><span style=color:#69c>assoc</span><span>(key))</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Y ahora...<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>const </span><span>result </span><span style=color:#5fb3b3>= </span><span style=color:#69c>view</span><span>(</span><span style=color:#69c>Lprop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>name</span><span style=color:#5fb3b3>&#39;</span><span>)</span><span style=color:#5fb3b3>, </span><span>alice)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>result </span><span style=color:#5f6364>// =&gt; &quot;Alice Jones&quot;
</span></code></pre><p>Pueden incluso ir más allá y crear una función que sólo acepte el objeto que contiene los datos.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>const </span><span style=color:#69c>get_name </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>obj </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>view</span><span>(</span><span style=color:#69c>Lprop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>name</span><span style=color:#5fb3b3>&#39;</span><span>)</span><span style=color:#5fb3b3>, </span><span>obj)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5f6364>// o con aplicación parcial
</span><span>
</span><span style=color:#c594c5>const </span><span>get_name </span><span style=color:#5fb3b3>= </span><span>view</span><span style=color:#5fb3b3>.</span><span style=color:#69c>bind</span><span>(</span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, </span><span style=color:#69c>Lprop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>name</span><span style=color:#5fb3b3>&#39;</span><span>))</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5f6364>// o usando una dependencia.
</span><span style=color:#5f6364>// view = curry(view);
</span><span>
</span><span style=color:#c594c5>const </span><span>get_name </span><span style=color:#5fb3b3>= </span><span style=color:#69c>view</span><span>(</span><span style=color:#69c>Lprop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>name</span><span style=color:#5fb3b3>&#39;</span><span>))</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5f6364>// y lo mismo aplica para `set` y `over`
</span></code></pre><p>Suficiente. Volvamos a nuestras pruebas. Vamos con <code>over</code>, vamos a transformar el texto a mayúsculas.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>const </span><span style=color:#69c>upper </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>str </span><span style=color:#c594c5>=&gt; </span><span>str</span><span style=color:#5fb3b3>.</span><span style=color:#69c>toUpperCase</span><span>()</span><span style=color:#5fb3b3>;
</span><span style=color:#c594c5>const </span><span>uppercase_alice </span><span style=color:#5fb3b3>= </span><span style=color:#69c>over</span><span>(</span><span style=color:#69c>Lprop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>name</span><span style=color:#5fb3b3>&#39;</span><span>)</span><span style=color:#5fb3b3>, </span><span>upper</span><span style=color:#5fb3b3>, </span><span>alice)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5f6364>// vieron lo que hice?
</span><span style=color:#69c>get_name</span><span>(uppercase_alice) </span><span style=color:#5f6364>// =&gt; &quot;ALICE JONES&quot;
</span><span>
</span><span style=color:#69c>get_name</span><span>(alice)           </span><span style=color:#5f6364>// =&gt; &quot;Alice Jones&quot;
</span></code></pre><p>Es el turno de <code>set</code>.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>const </span><span>alice_smith </span><span style=color:#5fb3b3>= </span><span style=color:#69c>set</span><span>(</span><span style=color:#69c>Lprop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>name</span><span style=color:#5fb3b3>&#39;</span><span>)</span><span style=color:#5fb3b3>, &#39;</span><span style=color:#99c794>Alice smith</span><span style=color:#5fb3b3>&#39;, </span><span>alice)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#69c>get_name</span><span>(alice_smith) </span><span style=color:#5f6364>// =&gt; &quot;Alice smith&quot;
</span><span>
</span><span style=color:#69c>get_name</span><span>(alice)       </span><span style=color:#5f6364>// =&gt; &quot;Alice Jones&quot;
</span></code></pre><p>Todo muy bonito pero <code>name</code> es sólo una propiedad, ¿Qué pasa con los objetos anidados o los arreglos? Bueno, es ahí donde nuestra implementación se vuelve algo incómoda. Justo ahora tendríamos que hacer algo así.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>let </span><span>dog </span><span style=color:#5fb3b3>= </span><span style=color:#69c>Lens</span><span>(
</span><span>  </span><span style=color:#f99157>obj </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>prop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>dog</span><span style=color:#5fb3b3>&#39;</span><span>)(</span><span style=color:#69c>prop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>pets</span><span style=color:#5fb3b3>&#39;</span><span>)(obj))</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#f99157>obj </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>assoc</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>dog</span><span style=color:#5fb3b3>&#39;</span><span>)(</span><span style=color:#69c>assoc</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>pets</span><span style=color:#5fb3b3>&#39;</span><span>)(obj))
</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#69c>view</span><span>(dog</span><span style=color:#5fb3b3>, </span><span>alice)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &quot;joker&quot;
</span><span>
</span><span style=color:#5f6364>// o traemos una dependencia, `compose`
</span><span>
</span><span>dog </span><span style=color:#5fb3b3>= </span><span style=color:#69c>Lens</span><span>(
</span><span>  </span><span style=color:#69c>compose</span><span>(</span><span style=color:#69c>prop</span><span>(</span><span style=color:#5fb3b3>&quot;</span><span style=color:#99c794>dog</span><span style=color:#5fb3b3>&quot;</span><span>)</span><span style=color:#5fb3b3>, </span><span style=color:#69c>prop</span><span>(</span><span style=color:#5fb3b3>&quot;</span><span style=color:#99c794>pets</span><span style=color:#5fb3b3>&quot;</span><span>))</span><span style=color:#5fb3b3>,
</span><span>  </span><span style=color:#69c>compose</span><span>(</span><span style=color:#69c>assoc</span><span>(</span><span style=color:#5fb3b3>&quot;</span><span style=color:#99c794>dog</span><span style=color:#5fb3b3>&quot;</span><span>)</span><span style=color:#5fb3b3>, </span><span style=color:#69c>assoc</span><span>(</span><span style=color:#5fb3b3>&quot;</span><span style=color:#99c794>pets</span><span style=color:#5fb3b3>&quot;</span><span>))
</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#69c>view</span><span>(dog</span><span style=color:#5fb3b3>, </span><span>alice)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &quot;joker&quot;
</span></code></pre><p>Los escucho. No se preocupen, no los dejaría escribir cosas así. Es por cosas como esta que algunos van y dicen "usa <a rel=noopener target=_blank href=https://ramdajs.com/>Ramda</a> y ya" (y tienen razón) ¿Pero qué hace ramda que lo hace tan especial?<h2 id=el-toque-especial>El toque especial</h2><p>Si van a la documentación de ramda y buscan "lens" verán que tienen una función llamada <code>lensProp</code> que basicamente hace lo mismo que <code>Lprop</code>. Y si van al código fuente verán esto.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>lensProp</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>k</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>lens</span><span>(</span><span style=color:#69c>prop</span><span>(k)</span><span style=color:#5fb3b3>, </span><span style=color:#69c>assoc</span><span>(k))</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Miren eso. Ahora bien, los comentarios en el código y la documentación sugieren que trabaja con una sola propiedad. Volvamos a nuestra búsqueda en su documentación. Ahora prestemos atención a esa curiosa función llamada <code>lensPath</code>. Parece que hace exactamente lo que queremos. Una vez más vemos el código fuente y ¿qué vemos?<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>lensPath</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>p</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>lens</span><span>(</span><span style=color:#69c>path</span><span>(p)</span><span style=color:#5fb3b3>, </span><span style=color:#69c>assocPath</span><span>(p))</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#5f6364>// Bienvenidos al paradigma funcional
</span></code></pre><p>El secreto está en otras funciones que no tienen ningún vinculo específico con <code>lenses</code>. ¿No es genial?<p>¿Qué hay en esa función <code>path</code>? Vamos a revisar. Voy a mostrarles una versión ligeramente diferente, pero el comportamiento es el mismo.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>path</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>keys</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>if </span><span>(</span><span style=color:#ec5f67>arguments</span><span style=color:#5fb3b3>.</span><span>length </span><span style=color:#5fb3b3>=== </span><span style=color:#f99157>1</span><span>) </span><span style=color:#5fb3b3>{
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// esto es para imitar la dependencia `curry`
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// esto es lo que pasa
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// retornan una función que recuerda `keys`
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// y espera el argumento `obj`
</span><span>    </span><span style=color:#c594c5>return </span><span>path</span><span style=color:#5fb3b3>.</span><span style=color:#69c>bind</span><span>(</span><span style=color:#ec5f67>this</span><span style=color:#5fb3b3>, </span><span>keys)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span>
</span><span>  </span><span style=color:#c594c5>var </span><span>result </span><span style=color:#5fb3b3>= </span><span>obj</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>var </span><span>idx </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>0</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>while </span><span>(idx </span><span style=color:#5fb3b3>&lt; </span><span>keys</span><span style=color:#5fb3b3>.</span><span>length) </span><span style=color:#5fb3b3>{
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// no nos agrada null
</span><span>    </span><span style=color:#c594c5>if </span><span>(result </span><span style=color:#5fb3b3>== </span><span style=color:#f99157>null</span><span>) </span><span style=color:#5fb3b3>{
</span><span>      </span><span style=color:#c594c5>return</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>    
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// así obtenemos los objetos anidados
</span><span>    result </span><span style=color:#5fb3b3>= </span><span>result[keys[idx]]</span><span style=color:#5fb3b3>;
</span><span>    idx </span><span style=color:#5fb3b3>+= </span><span style=color:#f99157>1</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span>
</span><span>  </span><span style=color:#c594c5>return </span><span>result</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Haré lo mismo con <code>assocPath</code>. En este caso en ramda usan algunas funciones internas pero en esencia esto es lo que pasa.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>assocPath</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>path</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>value</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span style=color:#5fb3b3>  </span><span style=color:#5f6364>// otra vez esto
</span><span style=color:#5fb3b3>  </span><span style=color:#5f6364>// por eso tienen la función `curry`
</span><span>  </span><span style=color:#c594c5>if </span><span>(</span><span style=color:#ec5f67>arguments</span><span style=color:#5fb3b3>.</span><span>length </span><span style=color:#5fb3b3>=== </span><span style=color:#f99157>1</span><span>) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>return </span><span>assocPath</span><span style=color:#5fb3b3>.</span><span style=color:#69c>bind</span><span>(</span><span style=color:#ec5f67>this</span><span style=color:#5fb3b3>, </span><span>path)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>} </span><span style=color:#c594c5>else if </span><span>(</span><span style=color:#ec5f67>arguments</span><span style=color:#5fb3b3>.</span><span>length </span><span style=color:#5fb3b3>=== </span><span style=color:#f99157>2</span><span>) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>return </span><span>assocPath</span><span style=color:#5fb3b3>.</span><span style=color:#69c>bind</span><span>(</span><span style=color:#ec5f67>this</span><span style=color:#5fb3b3>, </span><span>path</span><span style=color:#5fb3b3>, </span><span>value)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#5fb3b3>  </span><span style=color:#5f6364>// revisamos si está vacío
</span><span>  </span><span style=color:#c594c5>if </span><span>(path</span><span style=color:#5fb3b3>.</span><span>length </span><span style=color:#5fb3b3>=== </span><span style=color:#f99157>0</span><span>) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>return </span><span>value</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span>
</span><span>  </span><span style=color:#c594c5>var </span><span>index </span><span style=color:#5fb3b3>= </span><span>path[</span><span style=color:#f99157>0</span><span>]</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5fb3b3>  </span><span style=color:#5f6364>// Cuidado: recursividad adelante
</span><span>  </span><span style=color:#c594c5>if </span><span>(path</span><span style=color:#5fb3b3>.</span><span>length </span><span style=color:#5fb3b3>&gt; </span><span style=color:#f99157>1</span><span>) </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>var </span><span>is_empty </span><span style=color:#5fb3b3>=
</span><span>      </span><span style=color:#5fb3b3>typeof </span><span>obj </span><span style=color:#5fb3b3>!== &#39;</span><span style=color:#99c794>object</span><span style=color:#5fb3b3>&#39; || </span><span>obj </span><span style=color:#5fb3b3>=== </span><span style=color:#f99157>null </span><span style=color:#5fb3b3>|| !</span><span>obj</span><span style=color:#5fb3b3>.</span><span style=color:#69c>hasOwnProperty</span><span>(index)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// si el objeto actual está &quot;vacío&quot;
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// tenemos que crear otro
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// de lo contrario usamos el valor en `index`
</span><span>    </span><span style=color:#c594c5>var </span><span>next </span><span style=color:#5fb3b3>= </span><span>is_empty
</span><span>      </span><span style=color:#5fb3b3>? typeof </span><span>path[</span><span style=color:#f99157>1</span><span>] </span><span style=color:#5fb3b3>=== &#39;</span><span style=color:#99c794>number</span><span style=color:#5fb3b3>&#39;
</span><span>        </span><span style=color:#5fb3b3>? </span><span>[]
</span><span>        </span><span style=color:#5fb3b3>: {}
</span><span>      </span><span style=color:#5fb3b3>: </span><span>obj[index]</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// empecemos otra vez
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// pero ahora con un `path` reducido
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// y `next` es el nuevo `obj`
</span><span>    value </span><span style=color:#5fb3b3>= </span><span style=color:#69c>assocPath</span><span>(</span><span style=color:#fac863>Array</span><span style=color:#5fb3b3>.</span><span style=color:#69c>prototype</span><span style=color:#5fb3b3>.</span><span>slice</span><span style=color:#5fb3b3>.</span><span style=color:#69c>call</span><span>(path</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>1</span><span>)</span><span style=color:#5fb3b3>, </span><span>value</span><span style=color:#5fb3b3>, </span><span>next)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#5fb3b3>  </span><span style=color:#5f6364>// el caso base
</span><span style=color:#5fb3b3>  </span><span style=color:#5f6364>// o copiamos un arreglo o un objeto
</span><span>  </span><span style=color:#c594c5>if </span><span>(</span><span style=color:#5fb3b3>typeof </span><span>index </span><span style=color:#5fb3b3>=== &#39;</span><span style=color:#99c794>number</span><span style=color:#5fb3b3>&#39; &amp;&amp; </span><span style=color:#fac863>Array</span><span style=color:#5fb3b3>.</span><span style=color:#69c>isArray</span><span>(obj)) </span><span style=color:#5fb3b3>{
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// &#39;copiamos&#39; el arreglo
</span><span>    </span><span style=color:#c594c5>var </span><span>arr </span><span style=color:#5fb3b3>= </span><span>[]</span><span style=color:#5fb3b3>.</span><span style=color:#69c>concat</span><span>(obj)</span><span style=color:#5fb3b3>;
</span><span>
</span><span>    arr[index] </span><span style=color:#5fb3b3>= </span><span>value</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#c594c5>return </span><span>arr</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>} </span><span style=color:#c594c5>else </span><span style=color:#5fb3b3>{
</span><span style=color:#5fb3b3>    </span><span style=color:#5f6364>// una copia como las de antes
</span><span>    </span><span style=color:#c594c5>var </span><span>result </span><span style=color:#5fb3b3>= {};
</span><span>    </span><span style=color:#c594c5>for </span><span>(</span><span style=color:#c594c5>var </span><span>p </span><span style=color:#5fb3b3>in </span><span>obj) </span><span style=color:#5fb3b3>{
</span><span>      result[p] </span><span style=color:#5fb3b3>= </span><span>obj[p]</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#5fb3b3>}
</span><span>
</span><span>    result[index] </span><span style=color:#5fb3b3>= </span><span>value</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#c594c5>return </span><span>result</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Con nuestro nuevo conocimiento podemos crear <code>Lpath</code> y mejorar <code>Lprop</code>.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>Lpath</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>keys</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>Lens</span><span>(</span><span style=color:#69c>path</span><span>(keys)</span><span style=color:#5fb3b3>, </span><span style=color:#69c>assocPath</span><span>(keys))</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#69c>Lprop</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>key</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>Lens</span><span>(</span><span style=color:#69c>path</span><span>([key])</span><span style=color:#5fb3b3>, </span><span style=color:#69c>assocPath</span><span>([key]))</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Ahora podemos hacer otras cosas, como manipular la propiedad <code>pets</code> de <code>alice</code>.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>const </span><span>dog_lens </span><span style=color:#5fb3b3>= </span><span style=color:#69c>Lpath</span><span>([</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>pets</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>dog</span><span style=color:#5fb3b3>&#39;</span><span>])</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#69c>view</span><span>(dog_lens</span><span style=color:#5fb3b3>, </span><span>alice)</span><span style=color:#5fb3b3>;     </span><span style=color:#5f6364>// =&gt; &#39;joker&#39;
</span><span>
</span><span style=color:#c594c5>let </span><span>new_alice </span><span style=color:#5fb3b3>= </span><span style=color:#69c>over</span><span>(dog_lens</span><span style=color:#5fb3b3>, </span><span>upper</span><span style=color:#5fb3b3>, </span><span>alice)</span><span style=color:#5fb3b3>;
</span><span style=color:#69c>view</span><span>(dog_lens</span><span style=color:#5fb3b3>, </span><span>new_alice)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &#39;JOKER&#39;
</span><span>
</span><span>new_alice </span><span style=color:#5fb3b3>= </span><span style=color:#69c>set</span><span>(dog_lens</span><span style=color:#5fb3b3>, &#39;</span><span style=color:#99c794>Joker</span><span style=color:#5fb3b3>&#39;, </span><span>alice)</span><span style=color:#5fb3b3>;
</span><span style=color:#69c>view</span><span>(dog_lens</span><span style=color:#5fb3b3>, </span><span>new_alice)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &#39;Joker&#39;
</span></code></pre><p>Todo funciona de maravilla pero hay un pequeño detalle, nuestro constructor <code>Lens</code> no produce "instancias" combinables. Imaginen que tenemos lenses en varios lugares y queremos combinarlos de la siguiente manera.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#69c>compose</span><span>(pet_lens</span><span style=color:#5fb3b3>, </span><span>imaginary_lens</span><span style=color:#5fb3b3>, </span><span>dragon_lens)</span><span style=color:#5fb3b3>;
</span></code></pre><p>Eso no funcionaría porque <code>compose</code> espera una lista de funciones y lo que tenemos ahora son objetos. Pero podemos cambiar eso (de una forma muy curiosa) con algunos trucos propios de la programación funcional.<p>Empecemos con el constructor. En lugar de devolver un objeto vamos retornar una función, una que reciba "por partes" un callback, un objeto y que devuelva un <strong>Functor</strong> (eso es una cosa que tiene un método <code>map</code> que sigue <a rel=noopener target=_blank href=https://github.com/fantasyland/fantasy-land#functor>estas reglas</a>)<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>Lens</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>getter</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>setter</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#f99157>fn </span><span style=color:#c594c5>=&gt; </span><span style=color:#f99157>obj </span><span style=color:#c594c5>=&gt; </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>const </span><span style=color:#69c>apply </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>focus </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>setter</span><span>(focus</span><span style=color:#5fb3b3>, </span><span>obj)</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#c594c5>const </span><span>functor </span><span style=color:#5fb3b3>= </span><span style=color:#69c>fn</span><span>(</span><span style=color:#69c>getter</span><span>(obj))</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#c594c5>return </span><span>functor</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(apply)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>};
</span><span style=color:#5fb3b3>}
</span></code></pre><p>¿Y eso de <code>fn => obj => </code>qué? Eso nos va ayudar con el problema que tenemos con <code>compose</code>. Después de que le proporcionas <code>getter</code> y <code>setter</code> te devuelve una función que es compatible con <code>compose</code>.<p>¿Y <code>functor.map</code>? Eso es para asegurarnos que podamos usar un lens como una unidad (como <code>Lprop('pets')</code>) y también como parte de una cadena usando <code>compose</code>.<p>En caso de que se pregunten qué diferencia hay con lo que hace ramda, ellos usan su propia implementación de la función <code>map</code>.<p>Ahora modificamos <code>view</code> y <code>over</code>. Empezando con <code>view</code>.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>view</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>lens</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>const </span><span style=color:#69c>constant </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>value </span><span style=color:#c594c5>=&gt; </span><span>(</span><span style=color:#5fb3b3>{ </span><span>value</span><span style=color:#5fb3b3>, </span><span style=color:#69c>map</span><span style=color:#5fb3b3>: () </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>constant</span><span>(value) </span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>lens</span><span>(constant)(obj)</span><span style=color:#5fb3b3>.</span><span>value</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Esa función <code>constant</code> puede que parezca innecariamente compleja pero tiene su propósito. Las cosas se pueden enredar mucho cuando usas <code>compose</code>, esa estructura se asegura que el valor que queremos se mantenga intacto.<p>¿Y <code>over</code>? Es casi igual, excepto que en ese caso sí utilizamos la función <code>setter</code>.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>over</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>lens</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>fn</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>const </span><span style=color:#69c>identity </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>value </span><span style=color:#c594c5>=&gt; </span><span>(</span><span style=color:#5fb3b3>{ </span><span>value</span><span style=color:#5fb3b3>, </span><span style=color:#69c>map</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>setter </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>identity</span><span>(</span><span style=color:#69c>setter</span><span>(value)) </span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>const </span><span style=color:#69c>apply </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>val </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>identity</span><span>(</span><span style=color:#69c>fn</span><span>(val))</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>lens</span><span>(apply)(obj)</span><span style=color:#5fb3b3>.</span><span>value</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Y ahora deberíamos tener una implementación casi adecuada. Esto es lo que tenemos sin contar las dependencias (<code>path</code> and <code>assocPath</code>).<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>function </span><span style=color:#69c>Lens</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>getter</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>setter</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#f99157>fn </span><span style=color:#c594c5>=&gt; </span><span style=color:#f99157>obj </span><span style=color:#c594c5>=&gt; </span><span style=color:#5fb3b3>{
</span><span>    </span><span style=color:#c594c5>const </span><span style=color:#69c>apply </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>focus </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>setter</span><span>(focus</span><span style=color:#5fb3b3>, </span><span>obj)</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#c594c5>const </span><span>functor </span><span style=color:#5fb3b3>= </span><span style=color:#69c>fn</span><span>(</span><span style=color:#69c>getter</span><span>(obj))</span><span style=color:#5fb3b3>;
</span><span>    </span><span style=color:#c594c5>return </span><span>functor</span><span style=color:#5fb3b3>.</span><span style=color:#69c>map</span><span>(apply)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#5fb3b3>};
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#69c>view</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>lens</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>const </span><span style=color:#69c>constant </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>value </span><span style=color:#c594c5>=&gt; </span><span>(</span><span style=color:#5fb3b3>{ </span><span>value</span><span style=color:#5fb3b3>, </span><span style=color:#69c>map</span><span style=color:#5fb3b3>: () </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>constant</span><span>(value) </span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>lens</span><span>(constant)(obj)</span><span style=color:#5fb3b3>.</span><span>value</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#69c>over</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>lens</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>fn</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>const </span><span style=color:#69c>identity </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>value </span><span style=color:#c594c5>=&gt; </span><span>(</span><span style=color:#5fb3b3>{ </span><span>value</span><span style=color:#5fb3b3>, </span><span style=color:#69c>map</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>setter </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>identity</span><span>(</span><span style=color:#69c>setter</span><span>(value)) </span><span style=color:#5fb3b3>}</span><span>)</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>const </span><span style=color:#69c>apply </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>val </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>identity</span><span>(</span><span style=color:#69c>fn</span><span>(val))</span><span style=color:#5fb3b3>;
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>lens</span><span>(apply)(obj)</span><span style=color:#5fb3b3>.</span><span>value</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#69c>set</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>lens</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>val</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>over</span><span>(lens</span><span style=color:#5fb3b3>, </span><span style=color:#69c>always</span><span>(val)</span><span style=color:#5fb3b3>, </span><span>obj)</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#69c>Lprop</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>key</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>Lens</span><span>(</span><span style=color:#69c>path</span><span>([key])</span><span style=color:#5fb3b3>, </span><span style=color:#69c>assocPath</span><span>([key]))</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#69c>Lpath</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>keys</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#69c>Lens</span><span>(</span><span style=color:#69c>path</span><span>(keys)</span><span style=color:#5fb3b3>, </span><span style=color:#69c>assocPath</span><span>(keys))</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#69c>always</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>val</span><span style=color:#5fb3b3>) {
</span><span>  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>() </span><span style=color:#c594c5>=&gt; </span><span>val</span><span style=color:#5fb3b3>;
</span><span style=color:#5fb3b3>}
</span></code></pre><p>¿Me creerían si les digo que funciona? No deberían. Hagamos unas pruebas. Volvamos con <code>alice</code> y vamos añadirle otro objeto, <code>calie</code>.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>const </span><span>alice </span><span style=color:#5fb3b3>= {
</span><span>  name</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>Alice Jones</span><span style=color:#5fb3b3>&quot;,
</span><span>  address</span><span style=color:#5fb3b3>: </span><span>[</span><span style=color:#5fb3b3>&quot;</span><span style=color:#99c794>22 Walnut St</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>San Francisco</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>CA</span><span style=color:#5fb3b3>&quot;</span><span>]</span><span style=color:#5fb3b3>,
</span><span>  pets</span><span style=color:#5fb3b3>: { </span><span>dog</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>joker</span><span style=color:#5fb3b3>&quot;, </span><span>cat</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>batman</span><span style=color:#5fb3b3>&quot;, </span><span>imaginary</span><span style=color:#5fb3b3>: { </span><span>dragon</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>harley</span><span style=color:#5fb3b3>&quot; } }
</span><span style=color:#5fb3b3>};
</span><span>
</span><span style=color:#c594c5>const </span><span>calie </span><span style=color:#5fb3b3>= {
</span><span>  name</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>calie Jones</span><span style=color:#5fb3b3>&quot;,
</span><span>  address</span><span style=color:#5fb3b3>: </span><span>[</span><span style=color:#5fb3b3>&quot;</span><span style=color:#99c794>22 Walnut St</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>San Francisco</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>CA</span><span style=color:#5fb3b3>&quot;</span><span>]</span><span style=color:#5fb3b3>,
</span><span>  pets</span><span style=color:#5fb3b3>: { </span><span>dog</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>riddler</span><span style=color:#5fb3b3>&quot;, </span><span>cat</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>ivy</span><span style=color:#5fb3b3>&quot;, </span><span>imaginary</span><span style=color:#5fb3b3>: { </span><span>dragon</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>hush</span><span style=color:#5fb3b3>&quot; } },
</span><span>  friend</span><span style=color:#5fb3b3>: </span><span>[alice]
</span><span style=color:#5fb3b3>};
</span></code></pre><p>Y porque teniamos todo planeado desde antes, ya tenemos unos lenses disponibles.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#5f6364>// uno genérico
</span><span style=color:#c594c5>const </span><span>head_lens </span><span style=color:#5fb3b3>= </span><span style=color:#69c>Lprop</span><span>(</span><span style=color:#f99157>0</span><span>)</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5f6364>// otros específicos
</span><span style=color:#c594c5>const </span><span>bff_lens </span><span style=color:#5fb3b3>= </span><span style=color:#69c>compose</span><span>(</span><span style=color:#69c>Lprop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>friend</span><span style=color:#5fb3b3>&#39;</span><span>)</span><span style=color:#5fb3b3>, </span><span>head_lens)</span><span style=color:#5fb3b3>; 
</span><span style=color:#c594c5>const </span><span>imaginary_lens </span><span style=color:#5fb3b3>= </span><span style=color:#69c>Lpath</span><span>([</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>pets</span><span style=color:#5fb3b3>&#39;, &#39;</span><span style=color:#99c794>imaginary</span><span style=color:#5fb3b3>&#39;</span><span>])</span><span style=color:#5fb3b3>;
</span></code></pre><p>Supongamos que queremos manipular la propiedad <code>dragon</code> de cada una, todo lo que tenemos que hacer es combinar.<pre data-lang=javascript style=background-color:#2b2c2f;color:#cccece class=language-javascript><code class=language-javascript data-lang=javascript><span style=color:#c594c5>const </span><span>dragon_lens </span><span style=color:#5fb3b3>= </span><span style=color:#69c>compose</span><span>(imaginary_lens</span><span style=color:#5fb3b3>, </span><span style=color:#69c>Lprop</span><span>(</span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>dragon</span><span style=color:#5fb3b3>&#39;</span><span>))</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5f6364>// sólo porque sí
</span><span style=color:#c594c5>const </span><span>bff_dragon_lens </span><span style=color:#5fb3b3>= </span><span style=color:#69c>compose</span><span>(bff_lens</span><span style=color:#5fb3b3>, </span><span>dragon_lens)</span><span style=color:#5fb3b3>; 
</span><span>
</span><span style=color:#5f6364>// demo
</span><span style=color:#c594c5>const </span><span style=color:#69c>upper </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>str </span><span style=color:#c594c5>=&gt; </span><span>str</span><span style=color:#5fb3b3>.</span><span style=color:#69c>toUpperCase</span><span>()</span><span style=color:#5fb3b3>;
</span><span>
</span><span style=color:#5f6364>// view
</span><span style=color:#69c>view</span><span>(dragon_lens</span><span style=color:#5fb3b3>, </span><span>calie)</span><span style=color:#5fb3b3>;         </span><span style=color:#5f6364>// =&gt; &quot;hush&quot;
</span><span style=color:#69c>view</span><span>(bff_dragon_lens</span><span style=color:#5fb3b3>, </span><span>calie)</span><span style=color:#5fb3b3>;     </span><span style=color:#5f6364>// =&gt; &quot;harley&quot;
</span><span>
</span><span style=color:#5f6364>// over
</span><span style=color:#c594c5>let </span><span>new_calie </span><span style=color:#5fb3b3>= </span><span style=color:#69c>over</span><span>(dragon_lens</span><span style=color:#5fb3b3>, </span><span>upper</span><span style=color:#5fb3b3>, </span><span>calie)</span><span style=color:#5fb3b3>;
</span><span style=color:#69c>view</span><span>(dragon_lens</span><span style=color:#5fb3b3>, </span><span>new_calie)</span><span style=color:#5fb3b3>;     </span><span style=color:#5f6364>// =&gt; &quot;HUSH&quot;
</span><span>
</span><span>new_calie </span><span style=color:#5fb3b3>= </span><span style=color:#69c>over</span><span>(bff_dragon_lens</span><span style=color:#5fb3b3>, </span><span>upper</span><span style=color:#5fb3b3>, </span><span>calie)</span><span style=color:#5fb3b3>;
</span><span style=color:#69c>view</span><span>(bff_dragon_lens</span><span style=color:#5fb3b3>, </span><span>new_calie)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &quot;HARLEY&quot;
</span><span>
</span><span style=color:#5f6364>// set
</span><span>new_calie </span><span style=color:#5fb3b3>= </span><span style=color:#69c>set</span><span>(dragon_lens</span><span style=color:#5fb3b3>, &#39;</span><span style=color:#99c794>fluffykins</span><span style=color:#5fb3b3>&#39;, </span><span>calie)</span><span style=color:#5fb3b3>;
</span><span style=color:#69c>view</span><span>(dragon_lens</span><span style=color:#5fb3b3>, </span><span>new_calie)</span><span style=color:#5fb3b3>;     </span><span style=color:#5f6364>// =&gt; &quot;fluffykins&quot;
</span><span>
</span><span>new_calie </span><span style=color:#5fb3b3>= </span><span style=color:#69c>set</span><span>(bff_dragon_lens</span><span style=color:#5fb3b3>, &#39;</span><span style=color:#99c794>pumpkin</span><span style=color:#5fb3b3>&#39;, </span><span>calie)</span><span style=color:#5fb3b3>;
</span><span style=color:#69c>view</span><span>(bff_dragon_lens</span><span style=color:#5fb3b3>, </span><span>new_calie)</span><span style=color:#5fb3b3>; </span><span style=color:#5f6364>// =&gt; &quot;pumpkin&quot;
</span></code></pre><p>Así que acabamos de manipular un objeto anidado en varios niveles combinando lenses. Resolvimos un problema combinando funciones. Si no les parece genial no sé qué más decirles.<p>Estas cosas son difíciles de vender porque requieren de un estilo particular para poder aprovecharlos al máximo. Y para los que usan javascript, probablemente existe una librería que resuelve el mismo problema pero de una manera más conveniente o por lo menos que se ajuste a su estilo.<p>En fin, si aún están interesado en cómo funcionarían estos lenses en un contexto más complejo revisen <a rel=noopener target=_blank href=https://github.com/kwasniew/hyperapp-realworld-example-app>este repositorio</a>, es un <a rel=noopener target=_blank href=https://github.com/gothinkster/realworld>ejemplo de "real world app"</a> (algo así como un clon de medium.com) usa hyperapp para manejar la interfaz. El autor quiso usar lenses para manejar el estado de la aplicación.<h2 id=fuentes>Fuentes</h2><ul><li><a rel=noopener target=_blank href=https://ramdajs.com/docs/>ramda - docs</a><li><a rel=noopener target=_blank href=https://gist.github.com/branneman/f06bd451f74e5bc1725db23be682d4fe>fp-lenses.js</a><li><a rel=noopener target=_blank href="https://www.youtube.com/watch?v=IoVaArsh6tM">Lambda World 2018 - Functional Lenses in JavaScript (video)</a></ul><hr><p>¿Tienen alguna pregunta? Pueden dejar un comentario
en cualquiera de estas plataformas:<ul><li><a rel=noopener target=_blank href=https://dev.to/vonheikemen/lenses-o-mejor-dicho-getters-y-setters-combinables-kfo>dev.to</a><li><a rel=noopener target=_blank href=https://vonheikemen.hashnode.dev/lenses-aka-composable-getters-and-setters-es>Hashnode</a></ul><p>Pueden contactarme por las redes sociales:<ul><li>Twitter <a rel="noopener me" target=_blank href=https://twitter.com/VonHeikemen_>@VonHeikemen_</a><li>Mastodon <a rel="noopener me" target=_blank href=https://hachyderm.io/@vonheikemen>@vonheikemen@hachyderm.io</a></ul><p>Gracias por su tiempo. Si este artículo les pareció útil y quieren apoyar mis esfuerzos para crear más contenido, pueden dejar una propina en buy me a coffee ☕.</p><a href=https://www.buymeacoffee.com/vonheikemen style=display:flex;justify-content:center target=_blank><img src=https://cdn.buymeacoffee.com/buttons/v2/default-blue.png alt="Buy Me A Coffee" style=height:60px!important;width:217px!important></a></div></div>