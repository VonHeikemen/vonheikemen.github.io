<!doctype html><html lang=en><meta http-equiv=x-ua-compatible content="IE=edge"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><title>Devlog | La utilidad de los reducers</title><link rel=stylesheet href=https://vonheikemen.github.io/devlog/print.css media=print><link rel=stylesheet href=https://vonheikemen.github.io/devlog/styles.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><meta name=keywords content="javascript,software,coding,development"><meta name=monetization content="$ilp.uphold.com/dFQbFZ49nJdQ"><meta name=description content="Los reducers son buenos para muchas cosas, vamos a descubrir qué son esas cosas"><body class=theme-base-custom><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vonheikemen.github.io/devlog/es/><h1>Devlog</h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>Whoami</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/es/tags/>Explorar tags</a><li class=sidebar-nav-item><a href=https://vonheikemen.github.io/devlog/>Devlog in english</a></ul>© 2020-2021 Heiker Curiel</div></div><div class="content container"><div class=post><h1 class=post-title>La utilidad de los reducers</h1><span class=post-date>2020-11-27
| <a href=https://vonheikemen.github.io/devlog/web-development/the-case-for-reducers/>Read in english</a></span><p>En un <a href=https://vonheikemen.github.io/devlog/web-development/learn-fp/reduce-how-and-when/>artículo anterior</a> les hablé del método <code>.reduce</code>, cómo funciona y el caso ideal en el que podemos usarlo (en mi opinion). Esta vez voy a mostrar más casos en los que podría ser una buena opción. Ahora bien, no tienen que haber leído ese artículo pero de aquí en adelante voy a asumir que saben cómo funciona el método <code>Array.reduce</code>. Al finalizar espero que aprendan a reconocer en qué lugares <code>.reduce</code> podría funcionar perfectamente.<h2 id=que-estamos-buscando>¿Qué estamos buscando?</h2><p>Patrones, buscamos patrones. Bueno... sólo uno. Y para saber qué estamos buscando tenemos que ver los requerimientos de un <code>reducer</code>. Piensen en ellos por un momento, cuando empiezan a escribir uno que quieren usar con <code>Array.reduce</code> tal vez luce así.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>function </span><span style=color:#5fb3b3>(</span><span style=color:#f99157>accumulator</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>value</span><span style=color:#5fb3b3>) {
  </span><span style=color:#5f6364>/*
    algo de lógica por aquí
  */
  </span><span style=color:#c594c5>return </span><span style=color:#cccece>accumulator</span><span style=color:#5fb3b3>;
}
</span></code></pre><p>Okey, por lo general retornamos una copia modificada de <code>accumulator</code> pero eso no es importante, el punto es que retornamos el mismo "tipo" de dato que obtuvimos en el primer parámetro. Entonces tenemos que la <strong>comportamiento de la función</strong> es el siguiente.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>(Accumulator, Value) -&gt; Accumulator
</span></code></pre><p>Pero en este caso lo que tenemos aquí es un ejemplo concreto. Yo quiero que vean esto de una forma más abstracta. Lo que en realidad buscamos son funciones con esta forma.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>(A, B) -&gt; A
</span></code></pre><p>Eso es básicamente todo lo que necesitan saber. Para que un <code>reduce</code> pueda hacer bien su trabajo sólo debe ser capaz de retornar el mismo tipo de dato que recibió en el primer parámetro.<p>¿Aún están confundidos? No se preocupen, pasaremos lo que queda de este artículo revisando ejemplos donde este patrón puede aparecer.<h2 id=casos-de-uso>Casos de uso</h2><h3 id=acumuladores>Acumuladores</h3><p>Aquí generalmente es la parte donde les muestro una situación donde sumamos un arreglo de números o algo parecido. No hagamos eso. Podemos imaginarnos un escenario más complejo donde un acumulador nos sea útil.<p>Entonces, vamos a fingir que estamos trabajando en un proyecto que tiene una especie de blog y nos encontramos creando la página del perfil de usuario. Queremos mostrar todos los tags donde el usuario tiene por lo menos un artículo. Quizá quieran extraer ese dato de la base de datos usando una consulta elaborada pero eso llevaría mucho tiempo. Primero hagamos un prototipo.<p>Antes de hacer las cosas de la manera adecuada lo que vamos a hacer es transformar un arreglo que contiene todos los artículos en un <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set>Set</a> con todos los tags, para eso usaremos <code>Array.reduce</code>.<pre style=background-color:#2b2c2f>
<code><span style=color:#5f6364>// Imaginen que estos objetos son más complejos
</span><span style=color:#c594c5>const </span><span style=color:#cccece>posts </span><span style=color:#5fb3b3>= [
  { </span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>: [&quot;</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>discuss</span><span style=color:#5fb3b3>&quot;] },
  { </span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>: [&quot;</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>react</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>vue-is-better</span><span style=color:#5fb3b3>&quot;] },
  { </span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>: [&quot;</span><span style=color:#99c794>discuss</span><span style=color:#5fb3b3>&quot;] },
  { </span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>: [&quot;</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>&quot;] },
];

</span><span style=color:#c594c5>function </span><span style=color:#69c>dangerously_add_tags</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>acc</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>post</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>for</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>let </span><span style=color:#cccece>value </span><span style=color:#5fb3b3>of </span><span style=color:#cccece>post</span><span style=color:#5fb3b3>.</span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>) {
    </span><span style=color:#cccece>acc</span><span style=color:#5fb3b3>.</span><span style=color:#69c>add</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>value</span><span style=color:#5fb3b3>);
  }

  </span><span style=color:#c594c5>return </span><span style=color:#cccece>acc</span><span style=color:#5fb3b3>;
}

</span><span style=color:#cccece>posts</span><span style=color:#5fb3b3>.</span><span style=color:#69c>reduce</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>dangerously_add_tags</span><span style=color:#5fb3b3>, new </span><span style=color:#fac863>Set</span><span style=color:#5fb3b3>());
</span></code></pre><p>Este sería el resultado.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>Set(4) [ &quot;javascript&quot;, &quot;discuss&quot;, &quot;react&quot;, &quot;vue-is-better&quot; ]
</span></code></pre><p>Ahora piensen en el comportamiento de nuestro <code>reducer</code>. Tenemos un <code>Set</code> con tags que hace el papel de <code>Accumulator</code> y un objeto que representa un post como nuestro <code>Value</code>. Podríamos decir que se comporta de la siguiente manera.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>(Set, Objeto) -&gt; Set
</span></code></pre><p>Bueno, técnicamente <code>Objeto</code> no puede ser cualquier objeto, debe tener una propiedad llamada <code>tags</code>. Así que sería algo más como esto.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>(Set, Artículo) -&gt; Set
</span></code></pre><p>En fin, este es el patrón del que les hablaba <code>(A, B) -> A</code>. La implementación de <code>dangerously_add_tags</code> demanda que <code>B</code> sea un <code>Artículo</code>. Pero para que esta función sea un <code>reducer</code> debe ser capaz de retornar el mismo tipo de dato que recibió en el primer parámetro (<code>Set</code>), y eso lo logramos retornando <code>acc</code>.<h3 id=transformaciones>Transformaciones</h3><p>Probablemente han escuchado que pueden usar <code>Array.reduce</code> para suplantar otros métodos del prototipo <code>Array</code>, pero aunque esto suene como un dato interesante no tiene mucha utilidad. ¿Por qué harían algo así? No tiene sentido para mí. Sin embargo, aún puede resultar útil si planean "fusionar" las características de varios de esos métodos en uno. ¿Alguna vez han querido filtrar y transformar un arreglo al mismo tiempo? Con <code>.reduce</code> eso es posible.<p>Vamos a reusar nuestra variable <code>posts</code> aquí también.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>const </span><span style=color:#cccece>posts </span><span style=color:#5fb3b3>= [
  {
    </span><span style=color:#cccece>category</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>&quot;,
    </span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>: [&quot;</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>discuss</span><span style=color:#5fb3b3>&quot;]
  },
  {
    </span><span style=color:#cccece>category</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>frameworks</span><span style=color:#5fb3b3>&quot;,
    </span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>: [&quot;</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>react</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>vue-is-better</span><span style=color:#5fb3b3>&quot;]
  },
  {
    </span><span style=color:#cccece>category</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>watercooler</span><span style=color:#5fb3b3>&quot;,
    </span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>: [&quot;</span><span style=color:#99c794>discuss</span><span style=color:#5fb3b3>&quot;]
  },
  {
    </span><span style=color:#cccece>category</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>functional programming</span><span style=color:#5fb3b3>&quot;,
    </span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>: [&quot;</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>&quot;]
  },
];
</span></code></pre><p>Esta vez lo que queremos hacer es filtrar los que tengan el tag <code>discuss</code>, y por cada uno que pase la prueba queremos extraer la categoría y capitalizar el valor. ¿Cómo haríamos eso?<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>function </span><span style=color:#69c>capitalize</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>str</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>return </span><span style=color:#cccece>str</span><span style=color:#5fb3b3>[</span><span style=color:#f99157>0</span><span style=color:#5fb3b3>].</span><span style=color:#69c>toUpperCase</span><span style=color:#5fb3b3>() + </span><span style=color:#cccece>str</span><span style=color:#5fb3b3>.</span><span style=color:#69c>slice</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>);
}

</span><span style=color:#c594c5>function </span><span style=color:#69c>filter_map_posts</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>acc</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>post</span><span style=color:#5fb3b3>) {
  </span><span style=color:#5f6364>// aquí estamos filtrando
  </span><span style=color:#c594c5>if</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>post</span><span style=color:#5fb3b3>.</span><span style=color:#69c>tags</span><span style=color:#5fb3b3>.</span><span style=color:#69c>includes</span><span style=color:#5fb3b3>(&#39;</span><span style=color:#99c794>discuss</span><span style=color:#5fb3b3>&#39;)) {
    </span><span style=color:#c594c5>return </span><span style=color:#cccece>acc</span><span style=color:#5fb3b3>.</span><span style=color:#69c>concat</span><span style=color:#5fb3b3>(
      </span><span style=color:#5f6364>// esta es la transformación
      </span><span style=color:#69c>capitalize</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>post</span><span style=color:#5fb3b3>.</span><span style=color:#69c>category</span><span style=color:#5fb3b3>)
    );
  }
	
  </span><span style=color:#c594c5>return </span><span style=color:#cccece>acc</span><span style=color:#5fb3b3>;
}

</span><span style=color:#cccece>posts</span><span style=color:#5fb3b3>.</span><span style=color:#69c>reduce</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>filter_map_posts</span><span style=color:#5fb3b3>, []);
</span></code></pre><p>Aquí tenemos nuestro resultado.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>Array [ &quot;Javascript&quot;, &quot;Watercooler&quot; ]
</span></code></pre><p>¿Por qué funciona? Si revisan el comportamiento de <code>filter_map_posts</code> tenemos esto.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>(Arreglo, Artículo) -&gt; Arreglo
</span></code></pre><h3 id=coordinacion>Coordinación</h3><p>Si han indagado un poco en librerías enfocadas en el paradigma funcional hay una alta probabilidad de que se hayan topado con una función llamada <code>pipe</code>. Con esta función podemos combinar una cantidad arbitraria de funciones. Esta es la manera en la que se usa.<pre style=background-color:#2b2c2f>
<code><span style=color:#69c>pipe</span><span style=color:#5fb3b3>(
  </span><span style=color:#cccece>una_funcion</span><span style=color:#5fb3b3>,
  </span><span style=color:#cccece>otra</span><span style=color:#5fb3b3>,
  </span><span style=color:#cccece>proceso_serio</span><span style=color:#5fb3b3>,
  </span><span style=color:#cccece>efectos_adelante</span><span style=color:#5fb3b3>,
);
</span></code></pre><p>La idea detrás de esto se centra en transportar el resultado de una función hacia la siguiente en la lista. En efecto lo que hacemos aquí es coordinar llamadas de funciones. En este caso, el fragmento anterior es equivalente a esto:<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>function </span><span style=color:#69c>pipe</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>arg</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>return </span><span style=color:#69c>efectos_adelante</span><span style=color:#5fb3b3>(</span><span style=color:#69c>proceso_serio</span><span style=color:#5fb3b3>(</span><span style=color:#69c>otra</span><span style=color:#5fb3b3>(</span><span style=color:#69c>una_funcion</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>arg</span><span style=color:#5fb3b3>))));
}
</span></code></pre><p>Si se preguntan por qué les digo esto, es porque podemos implementar <code>pipe</code> usando <code>.reduce</code>. Si se fijan bien notarán que lo único que hacemos en esa función es aplicar funciones a un argumento. Eso es todo. No hay nada más.<p>¿Y qué?<p>¡Es una operación binaria! Podemos transformar eso en una función.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>function </span><span style=color:#69c>apply</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>arg</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>fn</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>return </span><span style=color:#69c>fn</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>arg</span><span style=color:#5fb3b3>);
}
</span></code></pre><p>¿Y saben qué funciona bien con operaciones binarias? Nuestro amigo <code>.reduce</code>.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>function </span><span style=color:#69c>pipe</span><span style=color:#5fb3b3>(...</span><span style=color:#f99157>fns</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>return function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>some_arg</span><span style=color:#5fb3b3>) {
    </span><span style=color:#c594c5>return </span><span style=color:#cccece>fns</span><span style=color:#5fb3b3>.</span><span style=color:#69c>reduce</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>apply</span><span style=color:#5fb3b3>, </span><span style=color:#cccece>some_arg</span><span style=color:#5fb3b3>);
  };
}
</span></code></pre><p>Lo primero que hacemos en <code>pipe</code> es recolectar la lista de funciones que usaremos y convertirla en un arreglo. El segundo paso es retornar una función que desencadenará las llamadas a las funciones en nuestro arreglo, también en este paso obtenemos nuestro argumento inicial. Al final de eso, con todo en su lugar, <code>.reduce</code> se encarga del resto. Pueden probarlo ustedes mismos.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>const </span><span style=color:#cccece>post </span><span style=color:#5fb3b3>= { 
  </span><span style=color:#cccece>category</span><span style=color:#5fb3b3>: &quot;</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>&quot;,
  </span><span style=color:#cccece>tags</span><span style=color:#5fb3b3>: [&quot;</span><span style=color:#99c794>javascript</span><span style=color:#5fb3b3>&quot;, &quot;</span><span style=color:#99c794>discuss</span><span style=color:#5fb3b3>&quot;] 
}

</span><span style=color:#c594c5>function </span><span style=color:#69c>capitalize</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>str</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>return </span><span style=color:#cccece>str</span><span style=color:#5fb3b3>[</span><span style=color:#f99157>0</span><span style=color:#5fb3b3>].</span><span style=color:#69c>toUpperCase</span><span style=color:#5fb3b3>() + </span><span style=color:#cccece>str</span><span style=color:#5fb3b3>.</span><span style=color:#69c>slice</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>1</span><span style=color:#5fb3b3>);
}

</span><span style=color:#c594c5>function </span><span style=color:#69c>get_prop</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>key</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>return function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>obj</span><span style=color:#5fb3b3>) {
    </span><span style=color:#c594c5>return </span><span style=color:#cccece>obj</span><span style=color:#5fb3b3>[</span><span style=color:#cccece>key</span><span style=color:#5fb3b3>];
  }
}

</span><span style=color:#c594c5>function </span><span style=color:#69c>exclaim</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>str</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>return </span><span style=color:#cccece>str </span><span style=color:#5fb3b3>+ &quot;</span><span style=color:#99c794>!!</span><span style=color:#5fb3b3>&quot;;
}

</span><span style=color:#c594c5>const </span><span style=color:#cccece>exciting_category </span><span style=color:#5fb3b3>= </span><span style=color:#69c>pipe</span><span style=color:#5fb3b3>(
  </span><span style=color:#69c>get_prop</span><span style=color:#5fb3b3>(&quot;</span><span style=color:#99c794>category</span><span style=color:#5fb3b3>&quot;),
  </span><span style=color:#cccece>capitalize</span><span style=color:#5fb3b3>,
  </span><span style=color:#cccece>exclaim
</span><span style=color:#5fb3b3>);

</span><span style=color:#69c>exciting_category</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>post</span><span style=color:#5fb3b3>);
</span><span style=color:#5f6364>// =&gt; Javascript!!
</span></code></pre><p>Okey, okey. Ahora bien, ¿Cómo es que <code>apply</code> sigue el patrón?<p>Ah, buena pregunta. Es algo raro pero aún podemos darle sentido. Mírenlo de esta manera.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>(Algo, Función) -&gt; Algo
</span></code></pre><p>Si tienen una unidad de lo que sea (literalmente cualquier cosa) y una función, <code>apply</code> hará su trabajo. Pero tengan presente que aquí no hay garantía de que su función no explote, esa sería responsabilidad de ustedes.<h3 id=cambios-de-estado-a-traves-del-tiempo>Cambios de estado a través del tiempo</h3><p>Este bonus track es para todos aquellos desarrolladores frontend allí afuera.<p>Si han pasado cualquier cantidad de tiempo investigando sobre librerías para manejar el estado de una aplicación tal vez hayan escuchado de una cosa llamada <a href=https://redux.js.org/>redux</a>. Esta librería tiene un enfoque interesante porque espera que el usuario (el desarrollador) suministre un <code>reducer</code> que sea capaz de manejar los cambios en el estado de la aplicación. A algunos les parece genial, a otros no. Pero bien sea que estén de acuerdo con esto o no, su enfoque tiene mucho sentido. Déjenme mostrarles.<p>Empecemos con el <code>reducer</code>. En esta ocasión necesitamos uno con este comportamiento.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>(Estado, Acción) -&gt; Estado
</span></code></pre><p><code>Estado</code> y <code>Acción</code> son objetos. Aquí no hay nada extravagante. La "forma" de nuestro <code>Estado</code> depende de la aplicación en la que trabajamos, los desarrolladores pueden hacer lo que quieran con él. La <code>Acción</code> por otro lado debe tener una propiedad <code>type</code>, y <code>redux</code> se asegura de esto.<p>Entonces, vamos a fingir que este es el estado de una aplicación imaginaria en la que estamos trabajando.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>const </span><span style=color:#cccece>state </span><span style=color:#5fb3b3>= {
  </span><span style=color:#cccece>count</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>40</span><span style=color:#5fb3b3>,
  </span><span style=color:#cccece>flag</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>false
</span><span style=color:#5fb3b3>};
</span></code></pre><p>Ah, sí. Un milagro de la ingeniería.<p>Ahora que sabemos cómo luce el <code>Estado</code>, y también sabemos qué necesita una <code>Acción</code>, podemos comenzar a escribir nuestro <code>reducer</code>.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>function </span><span style=color:#69c>reducer</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>state</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>action</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>switch</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>action</span><span style=color:#5fb3b3>.</span><span style=color:#cccece>type</span><span style=color:#5fb3b3>) {
    </span><span style=color:#c594c5>case </span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>add</span><span style=color:#5fb3b3>&#39;:
      </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{
        ...</span><span style=color:#cccece>state</span><span style=color:#5fb3b3>,
        </span><span style=color:#cccece>count</span><span style=color:#5fb3b3>: </span><span style=color:#cccece>state</span><span style=color:#5fb3b3>.</span><span style=color:#cccece>count </span><span style=color:#5fb3b3>+ </span><span style=color:#f99157>1</span><span style=color:#5fb3b3>,
      };
    </span><span style=color:#c594c5>case </span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>subtract</span><span style=color:#5fb3b3>&#39;:
      </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{
        ...</span><span style=color:#cccece>state</span><span style=color:#5fb3b3>,
        </span><span style=color:#cccece>count</span><span style=color:#5fb3b3>: </span><span style=color:#cccece>state</span><span style=color:#5fb3b3>.</span><span style=color:#cccece>count </span><span style=color:#5fb3b3>- </span><span style=color:#f99157>1</span><span style=color:#5fb3b3>,
      };
    </span><span style=color:#c594c5>case </span><span style=color:#5fb3b3>&#39;</span><span style=color:#99c794>toggle_flag</span><span style=color:#5fb3b3>&#39;:
      </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{
        ...</span><span style=color:#cccece>state</span><span style=color:#5fb3b3>,
        </span><span style=color:#cccece>flag</span><span style=color:#5fb3b3>: !</span><span style=color:#cccece>state</span><span style=color:#5fb3b3>.</span><span style=color:#cccece>flag</span><span style=color:#5fb3b3>,
      };
    </span><span style=color:#c594c5>default</span><span style=color:#5fb3b3>:
      </span><span style=color:#c594c5>return </span><span style=color:#cccece>state</span><span style=color:#5fb3b3>;
  }
}
</span></code></pre><p>Aquí viene la parte curiosa: no necesitamos <code>redux</code> para probar nuestro <code>reducer</code>. Es un <code>reducer</code> genérico, bien podríamos usarlo con <code>Array.reduce</code> para ver qué puede hacer.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>const </span><span style=color:#cccece>actions </span><span style=color:#5fb3b3>= [
  { </span><span style=color:#cccece>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>add</span><span style=color:#5fb3b3>&#39; },
  { </span><span style=color:#cccece>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>add</span><span style=color:#5fb3b3>&#39; },
  { </span><span style=color:#cccece>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>subtract</span><span style=color:#5fb3b3>&#39; },
  { </span><span style=color:#cccece>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>add</span><span style=color:#5fb3b3>&#39; },
  { </span><span style=color:#cccece>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>subtract</span><span style=color:#5fb3b3>&#39; },
  { </span><span style=color:#cccece>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>add</span><span style=color:#5fb3b3>&#39; },
  { </span><span style=color:#cccece>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>toggle_flag</span><span style=color:#5fb3b3>&#39; }
];

</span><span style=color:#cccece>actions</span><span style=color:#5fb3b3>.</span><span style=color:#69c>reduce</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>reducer</span><span style=color:#5fb3b3>, </span><span style=color:#cccece>state</span><span style=color:#5fb3b3>);
</span></code></pre><p><code>actions.reduce</code> debería devolvernos otra "instancia" de nuestro estado. En nuestro caso, después de aplicar todas esas acciones, tendríamos el siguiente resultado.<pre style=background-color:#2b2c2f>
<code><span style=color:#5fb3b3>{
  </span><span style=color:#cccece>count</span><span style=color:#5fb3b3>: </span><span style=color:#f99157>42</span><span style=color:#5fb3b3>,
  </span><span style=color:#cccece>flag: </span><span style=color:#f99157>true
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Y allí lo tienen, la funcionalidad principal de <code>redux</code> sin <code>redux</code>.<p>Vamos a dar un paso adelante en nuestro proceso e introduzcamos el concepto de tiempo. Para esto vamos a agregar una tienda "falsa" de <code>redux</code>. Bueno... la tienda será "real" pero será una imitación barata. Empecemos.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>function </span><span style=color:#69c>Store</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>reducer</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>state</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>let </span><span style=color:#cccece>_listener </span><span style=color:#5fb3b3>= </span><span style=color:#f99157>null</span><span style=color:#5fb3b3>;

  </span><span style=color:#c594c5>const </span><span style=color:#cccece>get_state </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>() {
    </span><span style=color:#c594c5>return </span><span style=color:#cccece>state</span><span style=color:#5fb3b3>;
  };

  </span><span style=color:#c594c5>const </span><span style=color:#cccece>subscribe </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>listener</span><span style=color:#5fb3b3>) {
    </span><span style=color:#cccece>_listener </span><span style=color:#5fb3b3>= </span><span style=color:#cccece>listener</span><span style=color:#5fb3b3>;
  };

  </span><span style=color:#c594c5>const </span><span style=color:#cccece>dispatch </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>action</span><span style=color:#5fb3b3>) {
    </span><span style=color:#cccece>state </span><span style=color:#5fb3b3>= </span><span style=color:#69c>reducer</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>state</span><span style=color:#5fb3b3>, </span><span style=color:#cccece>action</span><span style=color:#5fb3b3>);
    </span><span style=color:#cccece>_listener </span><span style=color:#5fb3b3>&amp;&amp; </span><span style=color:#69c>_listener</span><span style=color:#5fb3b3>();

    </span><span style=color:#c594c5>return </span><span style=color:#cccece>action</span><span style=color:#5fb3b3>;
  };

  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{ </span><span style=color:#cccece>get_state</span><span style=color:#5fb3b3>, </span><span style=color:#cccece>dispatch</span><span style=color:#5fb3b3>, </span><span style=color:#cccece>subscribe </span><span style=color:#5fb3b3>};
}
</span></code></pre><p>¿Todo bien? ¿Saben lo que ocurre ahí? La parte que realmente nos interesa es la del <code>dispatch</code>. Esto de aquí.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>const </span><span style=color:#cccece>dispatch </span><span style=color:#5fb3b3>= </span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>action</span><span style=color:#5fb3b3>) {
  </span><span style=color:#cccece>state </span><span style=color:#5fb3b3>= </span><span style=color:#69c>reducer</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>state</span><span style=color:#5fb3b3>, </span><span style=color:#cccece>action</span><span style=color:#5fb3b3>);
  </span><span style=color:#cccece>_listener </span><span style=color:#5fb3b3>&amp;&amp; </span><span style=color:#69c>_listener</span><span style=color:#5fb3b3>();

  </span><span style=color:#c594c5>return </span><span style=color:#cccece>action</span><span style=color:#5fb3b3>;
};
</span></code></pre><p>Esta función se encarga de reemplazar el <code>Estado</code> actual. Como mencioné antes, el <code>reducer</code> se encarga de la lógica que dice <strong>cómo</strong> actualizar el <code>Estado</code>. La tienda (<code>Store</code>) se encarga de la lógica que dice <strong>cuando</strong> debe actualizarse. Suficiente palabrería, vamos a probarlo.<pre style=background-color:#2b2c2f>
<code><span style=color:#c594c5>function </span><span style=color:#69c>delay</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>ms</span><span style=color:#5fb3b3>) {
  </span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>new </span><span style=color:#fac863>Promise</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>resolve </span><span style=color:#c594c5>=&gt; </span><span style=color:#69c>setTimeout</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>resolve</span><span style=color:#5fb3b3>, </span><span style=color:#cccece>ms</span><span style=color:#5fb3b3>));
}

</span><span style=color:#c594c5>const </span><span style=color:#cccece>store </span><span style=color:#5fb3b3>= </span><span style=color:#69c>Store</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>reducer</span><span style=color:#5fb3b3>, </span><span style=color:#cccece>state</span><span style=color:#5fb3b3>);
</span><span style=color:#cccece>store</span><span style=color:#5fb3b3>.</span><span style=color:#69c>subscribe</span><span style=color:#5fb3b3>(</span><span style=color:#c594c5>function</span><span style=color:#5fb3b3>() {
  </span><span style=color:#fac863>console</span><span style=color:#5fb3b3>.</span><span style=color:#69c>log</span><span style=color:#5fb3b3>(</span><span style=color:#cccece>store</span><span style=color:#5fb3b3>.</span><span style=color:#69c>get_state</span><span style=color:#5fb3b3>());
});

(</span><span style=color:#c594c5>async function</span><span style=color:#5fb3b3>() {
  </span><span style=color:#cccece>store</span><span style=color:#5fb3b3>.</span><span style=color:#69c>dispatch</span><span style=color:#5fb3b3>({ </span><span style=color:#69c>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>add</span><span style=color:#5fb3b3>&#39; });
  </span><span style=color:#c594c5>await </span><span style=color:#69c>delay</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>500</span><span style=color:#5fb3b3>);

  </span><span style=color:#cccece>store</span><span style=color:#5fb3b3>.</span><span style=color:#69c>dispatch</span><span style=color:#5fb3b3>({ </span><span style=color:#69c>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>add</span><span style=color:#5fb3b3>&#39; });
  </span><span style=color:#c594c5>await </span><span style=color:#69c>delay</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>500</span><span style=color:#5fb3b3>);

  </span><span style=color:#cccece>store</span><span style=color:#5fb3b3>.</span><span style=color:#69c>dispatch</span><span style=color:#5fb3b3>({ </span><span style=color:#69c>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>subtract</span><span style=color:#5fb3b3>&#39; });
  </span><span style=color:#c594c5>await </span><span style=color:#69c>delay</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>700</span><span style=color:#5fb3b3>);

  </span><span style=color:#cccece>store</span><span style=color:#5fb3b3>.</span><span style=color:#69c>dispatch</span><span style=color:#5fb3b3>({ </span><span style=color:#69c>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>add</span><span style=color:#5fb3b3>&#39; });
  </span><span style=color:#c594c5>await </span><span style=color:#69c>delay</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>400</span><span style=color:#5fb3b3>);

  </span><span style=color:#cccece>store</span><span style=color:#5fb3b3>.</span><span style=color:#69c>dispatch</span><span style=color:#5fb3b3>({ </span><span style=color:#69c>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>subtract</span><span style=color:#5fb3b3>&#39; });
  </span><span style=color:#c594c5>await </span><span style=color:#69c>delay</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>800</span><span style=color:#5fb3b3>);

  </span><span style=color:#cccece>store</span><span style=color:#5fb3b3>.</span><span style=color:#69c>dispatch</span><span style=color:#5fb3b3>({ </span><span style=color:#69c>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>add</span><span style=color:#5fb3b3>&#39; });
  </span><span style=color:#c594c5>await </span><span style=color:#69c>delay</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>100</span><span style=color:#5fb3b3>);

  </span><span style=color:#cccece>store</span><span style=color:#5fb3b3>.</span><span style=color:#69c>dispatch</span><span style=color:#5fb3b3>({ </span><span style=color:#69c>type</span><span style=color:#5fb3b3>: &#39;</span><span style=color:#99c794>toggle_flag</span><span style=color:#5fb3b3>&#39; });
})();
</span></code></pre><p>Si ejecutan eso notarán cómo los mensajes aparecen en pantalla (o la cónsola del navegador) con una pequeña demora entre cada uno.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>- { count: 41, flag: false }
- { count: 42, flag: false }
- { count: 41, flag: false }
- { count: 42, flag: false }
- { count: 41, flag: false }
- { count: 42, flag: false }
- { count: 42, flag: true }
</span></code></pre><p>¿Se dieron cuenta que el resultado final es el mismo que nos dio <code>Array.reduce</code>? ¿No es genial?<p>Si quieren jugar con el verdadero <code>redux</code> aquí les dejo un ejemplo en codepen.<p class=codepen data-height=600 data-theme-id=dark data-default-tab=js,result data-user=VonHeikemen data-slug-hash=zYBgObJ data-preview=true style="height:600px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;border:2px solid;margin:1em 0;padding:1em" data-pen-title="Using redux"><span>See the Pen <a href=https://codepen.io/VonHeikemen/pen/zYBgObJ>Using redux</a> by Heiker (<a href=https://codepen.io/VonHeikemen>@VonHeikemen</a>) on <a href=https://codepen.io>CodePen</a>.</span></p><script async src=https://static.codepen.io/assets/embed/ei.js></script><h2 id=conclusion>Conclusión</h2><p>Espero que en este punto los <code>reducers</code> no parezcan tan misteriosos y aterradores. Sólo recuerden que se trata de una función con este comportamiento.<pre style=background-color:#2b2c2f>
<code><span style=color:#cccece>(A, B) -&gt; A
</span></code></pre><p>Eso es todo. No hay ninguna magia extraña detrás de eso. Si pueden hacer que una función tenga esas características pueden estar seguros que funcionará de maravilla con cualquier cosa que actue como <code>.reduce</code>.<h2 id=fuentes>Fuentes</h2><ul><li><a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce>Array.prototype.reduce()</a><li><a href=https://vonheikemen.github.io/devlog/web-development/learn-fp/reduce-how-and-when/>Reduce: how and when</a><li><a href=https://redux.js.org/api/store>Redux: Store</a></ul><hr><p>Gracias por su tiempo. Si este artículo les pareció útil y quieren apoyar mis esfuerzos para crear más contenido, pueden dejar una propina en buy me a coffee ☕.</p><a href=https://www.buymeacoffee.com/vonheikemen style=display:flex;justify-content:center target=_blank><img src=https://cdn.buymeacoffee.com/buttons/v2/default-blue.png alt="Buy Me A Coffee" style=height:60px!important;width:217px!important></a></div></div>